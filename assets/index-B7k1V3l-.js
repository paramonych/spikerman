import{s as t}from"./obfuscated-BXvJdPXx.js";import"./index-B7k1V3l-.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&i(t)}).observe(document,{childList:!0,subtree:!0})}function i(t){if(t.ep)return;t.ep=!0;const i=function(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?i.credentials="include":"anonymous"===t.crossOrigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}();var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){return t&&t.u&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var n,s={},r={};n=r,Object.defineProperty(n,"u",{value:!0}),n.default=function(t){var i,e=t.Symbol;if("function"==typeof e)if(e.observable)i=e.observable;else{i=e.for("https://github.com/benlesh/symbol-observable");try{e.observable=i}catch(n){}}else i="@@observable";return i};var o,h,a=r,u=Object.prototype.toString,c=function(t){var i=u.call(t),e="[object Arguments]"===i;return e||(e="[object Array]"!==i&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===u.call(t.callee)),e};var l=Array.prototype.slice,f=c,d=Object.keys,p=d?function(t){return d(t)}:function(){if(h)return o;var t;if(h=1,!Object.keys){var i=Object.prototype.hasOwnProperty,e=Object.prototype.toString,n=c,s=Object.prototype.propertyIsEnumerable,r=!s.call({toString:null},"toString"),a=s.call(function(){},"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(t){var i=t.constructor;return i&&i.prototype===t},f={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},d=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!f["$"+t]&&i.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{l(window[t])}catch(e){return!0}}catch(e){return!0}return!1}();t=function(t){var s=null!==t&&"object"==typeof t,o="[object Function]"===e.call(t),h=n(t),c=s&&"[object String]"===e.call(t),f=[];if(!s&&!o&&!h)throw new TypeError("Object.keys called on a non-object");var p=a&&o;if(c&&t.length>0&&!i.call(t,0))for(var v=0;v<t.length;++v)f.push(String(v));if(h&&t.length>0)for(var m=0;m<t.length;++m)f.push(String(m));else for(var g in t)p&&"prototype"===g||!i.call(t,g)||f.push(String(g));if(r)for(var b=function(t){if("undefined"==typeof window||!d)return l(t);try{return l(t)}catch(i){return!1}}(t),y=0;y<u.length;++y)b&&"constructor"===u[y]||!i.call(t,u[y])||f.push(u[y]);return f}}return o=t}(),v=Object.keys;p.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return f(t)?v(l.call(t)):v(t)})}else Object.keys=p;return Object.keys||p};var m=p,g=Object.defineProperty||!1;if(g)try{g({},"a",{value:1})}catch(Qv){g=!1}var b=g,y=SyntaxError,x=TypeError,w=Object.getOwnPropertyDescriptor;if(w)try{w([],"length")}catch(Qv){w=null}var M=w,A=b,T=y,_=x,k=M,C=b,S=function(){return!!C};S.hasArrayLengthDefineBug=function(){if(!C)return null;try{return 1!==C([],"length",{value:1}).length}catch(Qv){return!0}};var P=S,E=m,R="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),F=Object.prototype.toString,O=Array.prototype.concat,$=function(t,i,e){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new _("`obj` must be an object or a function`");if("string"!=typeof i&&"symbol"!=typeof i)throw new _("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new _("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new _("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new _("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new _("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,r=arguments.length>5?arguments[5]:null,o=arguments.length>6&&arguments[6],h=!!k&&k(t,i);if(A)A(t,i,{configurable:null===r&&h?h.configurable:!r,enumerable:null===n&&h?h.enumerable:!n,value:e,writable:null===s&&h?h.writable:!s});else{if(!o&&(n||s||r))throw new T("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[i]=e}},U=P(),B=function(t,i,e,n){if(i in t)if(!0===n){if(t[i]===e)return}else if("function"!=typeof(s=n)||"[object Function]"!==F.call(s)||!n())return;var s;U?$(t,i,e,!0):$(t,i,e)},I=function(t,i){var e=arguments.length>2?arguments[2]:{},n=E(i);R&&(n=O.call(n,Object.getOwnPropertySymbols(i)));for(var s=0;s<n.length;s+=1)B(t,n[s],i[n[s]],e[n[s]])};I.supportsDescriptors=!!U;var j=I,G={exports:{}};"undefined"!=typeof self?G.exports=self:"undefined"!=typeof window?G.exports=window:G.exports=Function("return this")();var z=G.exports,D=z,L=function(){return"object"==typeof i&&i&&i.Math===Math&&i.Array===Array?i:D},N=j,V=M,W=L,H=j,q=z,X=L,Y=function(){var t=W();if(N.supportsDescriptors){var i=V(t,"globalThis");i&&(!i.configurable||!i.enumerable&&i.writable&&globalThis===t)||Object.defineProperty(t,"globalThis",{configurable:!0,enumerable:!1,value:t,writable:!0})}else"object"==typeof globalThis&&globalThis===t||(t.globalThis=t);return t},K=X(),Q=function(){return K};H(Q,{getPolyfill:X,implementation:q,shim:Y});var Z=Q,J=i&&i._||function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(i,e)};return function(i,e){function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(s,"u",{value:!0}),s.NO_IL=s.NO=s.MemoryStream=Rt=s.Stream=void 0;var tt=a.default(Z.getPolyfill()),it={};function et(){}function nt(t){for(var i=t.length,e=Array(i),n=0;n<i;++n)e[n]=t[n];return e}function st(t,i,e){try{return t.f(i)}catch(Qv){return e.k(Qv),it}}s.NO=it;var rt={j:et,k:et,tt:et};function ot(t){t.it=function(t){t.next=t.j,t.error=t.k,t.complete=t.tt,this.start(t)},t.et=t.stop}s.NO_IL=rt;var ht=function(){function t(t,i){this.nt=t,this.st=i}return t.prototype.unsubscribe=function(){this.nt.rt(this.st)},t}(),at=function(){function t(t){this.st=t}return t.prototype.next=function(t){this.st.j(t)},t.prototype.error=function(t){this.st.k(t)},t.prototype.complete=function(){this.st.tt()},t}(),ut=function(){function t(t){this.type="fromObservable",this.ins=t,this.active=!1}return t.prototype.it=function(t){this.out=t,this.active=!0,this.ot=this.ins.subscribe(new at(t)),this.active||this.ot.unsubscribe()},t.prototype.et=function(){this.ot&&this.ot.unsubscribe(),this.active=!1},t}(),ct=function(){function t(t){this.type="merge",this.insArr=t,this.out=it,this.ac=0}return t.prototype.it=function(t){this.out=t;var i=this.insArr,e=i.length;this.ac=e;for(var n=0;n<e;n++)i[n].ht(this)},t.prototype.et=function(){for(var t=this.insArr,i=t.length,e=0;e<i;e++)t[e].rt(this);this.out=it},t.prototype.j=function(t){var i=this.out;i!==it&&i.j(t)},t.prototype.k=function(t){var i=this.out;i!==it&&i.k(t)},t.prototype.tt=function(){if(--this.ac<=0){var t=this.out;if(t===it)return;t.tt()}},t}(),lt=function(){function t(t,i,e){this.i=t,this.out=i,this.p=e,e.ils.push(this)}return t.prototype.j=function(t){var i=this.p,e=this.out;if(e!==it&&i.up(t,this.i)){var n=nt(i.vals);e.j(n)}},t.prototype.k=function(t){var i=this.out;i!==it&&i.k(t)},t.prototype.tt=function(){var t=this.p;t.out!==it&&0===--t.Nc&&t.out.tt()},t}(),ft=function(){function t(t){this.type="combine",this.insArr=t,this.out=it,this.ils=[],this.Nc=this.Nn=0,this.vals=[]}return t.prototype.up=function(t,i){var e=this.vals[i],n=this.Nn?e===it?--this.Nn:this.Nn:0;return this.vals[i]=t,0===n},t.prototype.it=function(t){this.out=t;var i=this.insArr,e=this.Nc=this.Nn=i.length,n=this.vals=new Array(e);if(0===e)t.j([]),t.tt();else for(var s=0;s<e;s++)n[s]=it,i[s].ht(new lt(s,t,this))},t.prototype.et=function(){for(var t=this.insArr,i=t.length,e=this.ils,n=0;n<i;n++)t[n].rt(e[n]);this.out=it,this.ils=[],this.vals=[]},t}(),dt=function(){function t(t){this.type="fromArray",this.a=t}return t.prototype.it=function(t){for(var i=this.a,e=0,n=i.length;e<n;e++)t.j(i[e]);t.tt()},t.prototype.et=function(){},t}(),pt=function(){function t(t){this.type="fromPromise",this.on=!1,this.p=t}return t.prototype.it=function(t){var i=this;this.on=!0,this.p.then(function(e){i.on&&(t.j(e),t.tt())},function(i){t.k(i)}).then(et,function(t){setTimeout(function(){throw t})})},t.prototype.et=function(){this.on=!1},t}(),vt=function(){function t(t){this.type="periodic",this.period=t,this.intervalID=-1,this.i=0}return t.prototype.it=function(t){var i=this;this.intervalID=setInterval(function(){t.j(i.i++)},this.period)},t.prototype.et=function(){-1!==this.intervalID&&clearInterval(this.intervalID),this.intervalID=-1,this.i=0},t}(),mt=function(){function t(t,i){this.type="debug",this.ins=t,this.out=it,this.s=et,this.l="","string"==typeof i?this.l=i:"function"==typeof i&&(this.s=i)}return t.prototype.it=function(t){this.out=t,this.ins.ht(this)},t.prototype.et=function(){this.ins.rt(this),this.out=it},t.prototype.j=function(t){var i=this.out;if(i!==it){var e=this.s;this.l;if(e!==et)try{e(t)}catch(Qv){i.k(Qv)}i.j(t)}},t.prototype.k=function(t){var i=this.out;i!==it&&i.k(t)},t.prototype.tt=function(){var t=this.out;t!==it&&t.tt()},t}(),gt=function(){function t(t,i){this.type="drop",this.ins=i,this.out=it,this.max=t,this.dropped=0}return t.prototype.it=function(t){this.out=t,this.dropped=0,this.ins.ht(this)},t.prototype.et=function(){this.ins.rt(this),this.out=it},t.prototype.j=function(t){var i=this.out;i!==it&&this.dropped++>=this.max&&i.j(t)},t.prototype.k=function(t){var i=this.out;i!==it&&i.k(t)},t.prototype.tt=function(){var t=this.out;t!==it&&t.tt()},t}(),bt=function(){function t(t,i){this.out=t,this.op=i}return t.prototype.j=function(){this.op.end()},t.prototype.k=function(t){this.out.k(t)},t.prototype.tt=function(){this.op.end()},t}(),yt=function(){function t(t,i){this.type="endWhen",this.ins=i,this.out=it,this.o=t,this.oil=rt}return t.prototype.it=function(t){this.out=t,this.o.ht(this.oil=new bt(t,this)),this.ins.ht(this)},t.prototype.et=function(){this.ins.rt(this),this.o.rt(this.oil),this.out=it,this.oil=rt},t.prototype.end=function(){var t=this.out;t!==it&&t.tt()},t.prototype.j=function(t){var i=this.out;i!==it&&i.j(t)},t.prototype.k=function(t){var i=this.out;i!==it&&i.k(t)},t.prototype.tt=function(){this.end()},t}(),xt=function(){function t(t,i){this.type="filter",this.ins=i,this.out=it,this.f=t}return t.prototype.it=function(t){this.out=t,this.ins.ht(this)},t.prototype.et=function(){this.ins.rt(this),this.out=it},t.prototype.j=function(t){var i=this.out;if(i!==it){var e=st(this,t,i);e!==it&&e&&i.j(t)}},t.prototype.k=function(t){var i=this.out;i!==it&&i.k(t)},t.prototype.tt=function(){var t=this.out;t!==it&&t.tt()},t}(),wt=function(){function t(t,i){this.out=t,this.op=i}return t.prototype.j=function(t){this.out.j(t)},t.prototype.k=function(t){this.out.k(t)},t.prototype.tt=function(){this.op.inner=it,this.op.less()},t}(),Mt=function(){function t(t){this.type="flatten",this.ins=t,this.out=it,this.open=!0,this.inner=it,this.il=rt}return t.prototype.it=function(t){this.out=t,this.open=!0,this.inner=it,this.il=rt,this.ins.ht(this)},t.prototype.et=function(){this.ins.rt(this),this.inner!==it&&this.inner.rt(this.il),this.out=it,this.open=!0,this.inner=it,this.il=rt},t.prototype.less=function(){var t=this.out;t!==it&&(this.open||this.inner!==it||t.tt())},t.prototype.j=function(t){var i=this.out;if(i!==it){var e=this.inner,n=this.il;e!==it&&n!==rt&&e.rt(n),(this.inner=t).ht(this.il=new wt(i,this))}},t.prototype.k=function(t){var i=this.out;i!==it&&i.k(t)},t.prototype.tt=function(){this.open=!1,this.less()},t}(),At=function(){function t(t,i,e){var n=this;this.type="fold",this.ins=e,this.out=it,this.f=function(i){return t(n.acc,i)},this.acc=this.seed=i}return t.prototype.it=function(t){this.out=t,this.acc=this.seed,t.j(this.acc),this.ins.ht(this)},t.prototype.et=function(){this.ins.rt(this),this.out=it,this.acc=this.seed},t.prototype.j=function(t){var i=this.out;if(i!==it){var e=st(this,t,i);e!==it&&i.j(this.acc=e)}},t.prototype.k=function(t){var i=this.out;i!==it&&i.k(t)},t.prototype.tt=function(){var t=this.out;t!==it&&t.tt()},t}(),Tt=function(){function t(t){this.type="last",this.ins=t,this.out=it,this.has=!1,this.val=it}return t.prototype.it=function(t){this.out=t,this.has=!1,this.ins.ht(this)},t.prototype.et=function(){this.ins.rt(this),this.out=it,this.val=it},t.prototype.j=function(t){this.has=!0,this.val=t},t.prototype.k=function(t){var i=this.out;i!==it&&i.k(t)},t.prototype.tt=function(){var t=this.out;t!==it&&(this.has?(t.j(this.val),t.tt()):t.k(new Error("last() failed because input stream completed")))},t}(),_t=function(){function t(t,i){this.type="map",this.ins=i,this.out=it,this.f=t}return t.prototype.it=function(t){this.out=t,this.ins.ht(this)},t.prototype.et=function(){this.ins.rt(this),this.out=it},t.prototype.j=function(t){var i=this.out;if(i!==it){var e=st(this,t,i);e!==it&&i.j(e)}},t.prototype.k=function(t){var i=this.out;i!==it&&i.k(t)},t.prototype.tt=function(){var t=this.out;t!==it&&t.tt()},t}(),kt=function(){function t(t){this.type="remember",this.ins=t,this.out=it}return t.prototype.it=function(t){this.out=t,this.ins.ht(t)},t.prototype.et=function(){this.ins.rt(this.out),this.out=it},t}(),Ct=function(){function t(t,i){this.type="replaceError",this.ins=i,this.out=it,this.f=t}return t.prototype.it=function(t){this.out=t,this.ins.ht(this)},t.prototype.et=function(){this.ins.rt(this),this.out=it},t.prototype.j=function(t){var i=this.out;i!==it&&i.j(t)},t.prototype.k=function(t){var i=this.out;if(i!==it)try{this.ins.rt(this),(this.ins=this.f(t)).ht(this)}catch(Qv){i.k(Qv)}},t.prototype.tt=function(){var t=this.out;t!==it&&t.tt()},t}(),St=function(){function t(t,i){this.type="startWith",this.ins=t,this.out=it,this.val=i}return t.prototype.it=function(t){this.out=t,this.out.j(this.val),this.ins.ht(t)},t.prototype.et=function(){this.ins.rt(this.out),this.out=it},t}(),Pt=function(){function t(t,i){this.type="take",this.ins=i,this.out=it,this.max=t,this.taken=0}return t.prototype.it=function(t){this.out=t,this.taken=0,this.max<=0?t.tt():this.ins.ht(this)},t.prototype.et=function(){this.ins.rt(this),this.out=it},t.prototype.j=function(t){var i=this.out;if(i!==it){var e=++this.taken;e<this.max?i.j(t):e===this.max&&(i.j(t),i.tt())}},t.prototype.k=function(t){var i=this.out;i!==it&&i.k(t)},t.prototype.tt=function(){var t=this.out;t!==it&&t.tt()},t}(),Et=function(){function t(t){this.ut=t||it,this.ct=[],this.ft=it,this.dt=it,this.vt=!1,this.bt=null,this.yt=it}return t.prototype.j=function(t){var i=this.ct,e=i.length;if(this.vt&&this.dt.j(t),1==e)i[0].j(t);else{if(0==e)return;for(var n=nt(i),s=0;s<e;s++)n[s].j(t)}},t.prototype.k=function(t){if(this.yt===it){this.yt=t;var i=this.ct,e=i.length;if(this.xt(),this.vt&&this.dt.k(t),1==e)i[0].k(t);else{if(0==e)return;for(var n=nt(i),s=0;s<e;s++)n[s].k(t)}if(!this.vt&&0==e)throw this.yt}},t.prototype.tt=function(){var t=this.ct,i=t.length;if(this.xt(),this.vt&&this.dt.tt(),1==i)t[0].tt();else{if(0==i)return;for(var e=nt(t),n=0;n<i;n++)e[n].tt()}},t.prototype.xt=function(){0!==this.ct.length&&(this.ut!==it&&this.ut.et(),this.yt=it,this.ct=[])},t.prototype.wt=function(){this.ut.et(),this.yt=it,this.ft=it},t.prototype.ht=function(t){var i=this.bt;if(i)return i.ht(t);var e=this.ct;if(e.push(t),!(e.length>1))if(this.ft!==it)clearTimeout(this.ft),this.ft=it;else{var n=this.ut;n!==it&&n.it(this)}},t.prototype.rt=function(t){var i=this,e=this.bt;if(e)return e.rt(t);var n=this.ct,s=n.indexOf(t);s>-1&&(n.splice(s,1),this.ut!==it&&n.length<=0?(this.yt=it,this.ft=setTimeout(function(){return i.wt()})):1===n.length&&this.Mt())},t.prototype.Mt=function(){this.At(this,[])&&this.rt(this.ct[0])},t.prototype.At=function(t,i){if(-1!==i.indexOf(t))return!0;if(t.out===this)return!0;if(t.out&&t.out!==it)return this.At(t.out,i.concat(t));if(t.ct){for(var e=0,n=t.ct.length;e<n;e++)if(!this.At(t.ct[e],i.concat(t)))return!1;return!0}return!1},t.prototype.ctor=function(){return this instanceof Ft?Ft:t},t.prototype.addListener=function(t){t.j=t.next||et,t.k=t.error||et,t.tt=t.complete||et,this.ht(t)},t.prototype.removeListener=function(t){this.rt(t)},t.prototype.subscribe=function(t){return this.addListener(t),new ht(this,t)},t.prototype[tt]=function(){return this},t.create=function(i){if(i){if("function"!=typeof i.start||"function"!=typeof i.stop)throw new Error("producer requires both start and stop functions");ot(i)}return new t(i)},t.createWithMemory=function(t){return t&&ot(t),new Ft(t)},t.never=function(){return new t({it:et,et:et})},t.empty=function(){return new t({it:function(t){t.tt()},et:et})},t.throw=function(i){return new t({it:function(t){t.k(i)},et:et})},t.from=function(i){if("function"==typeof i[tt])return t.fromObservable(i);if("function"==typeof i.then)return t.fromPromise(i);if(Array.isArray(i))return t.fromArray(i);throw new TypeError("Type of input to from() must be an Array, Promise, or Observable")},t.of=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return t.fromArray(i)},t.fromArray=function(i){return new t(new dt(i))},t.fromPromise=function(i){return new t(new pt(i))},t.fromObservable=function(i){if(void 0!==i.endWhen)return i;var e="function"==typeof i[tt]?i[tt]():i;return new t(new ut(e))},t.periodic=function(i){return new t(new vt(i))},t.prototype.Tt=function(t){return new(this.ctor())(new _t(t,this))},t.prototype.map=function(t){return this.Tt(t)},t.prototype.mapTo=function(t){var i=this.map(function(){return t});return i.ut.type="mapTo",i},t.prototype.filter=function(i){var e,n,s=this.ut;return new t(s instanceof xt?new xt((e=s.f,n=i,function(t){return e(t)&&n(t)}),s.ins):new xt(i,this))},t.prototype.take=function(t){return new(this.ctor())(new Pt(t,this))},t.prototype.drop=function(i){return new t(new gt(i,this))},t.prototype.last=function(){return new t(new Tt(this))},t.prototype.startWith=function(t){return new Ft(new St(this,t))},t.prototype.endWhen=function(t){return new(this.ctor())(new yt(t,this))},t.prototype.fold=function(t,i){return new Ft(new At(t,i,this))},t.prototype.replaceError=function(t){return new(this.ctor())(new Ct(t,this))},t.prototype.flatten=function(){return new t(new Mt(this))},t.prototype.compose=function(t){return t(this)},t.prototype.remember=function(){return new Ft(new kt(this))},t.prototype.debug=function(t){return new(this.ctor())(new mt(this,t))},t.prototype.imitate=function(t){if(t instanceof Ft)throw new Error("A MemoryStream was given to imitate(), but it only supports a Stream. Read more about this restriction here: https://github.com/staltz/xstream#faq");this.bt=t;for(var i=this.ct,e=i.length,n=0;n<e;n++)t.ht(i[n]);this.ct=[]},t.prototype.shamefullySendNext=function(t){this.j(t)},t.prototype.shamefullySendError=function(t){this.k(t)},t.prototype.shamefullySendComplete=function(){this.tt()},t.prototype.setDebugListener=function(t){t?(this.vt=!0,t.j=t.next||et,t.k=t.error||et,t.tt=t.complete||et,this.dt=t):(this.vt=!1,this.dt=it)},t.merge=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return new t(new ct(i))},t.combine=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return new t(new ft(i))},t}(),Rt=s.Stream=Et,Ft=function(t){function i(i){var e=t.call(this,i)||this;return e._t=!1,e}return J(i,t),i.prototype.j=function(i){this.kt=i,this._t=!0,t.prototype.j.call(this,i)},i.prototype.ht=function(t){var i=this.bt;if(i)return i.ht(t);var e=this.ct;if(e.push(t),e.length>1)this._t&&t.j(this.kt);else if(this.ft!==it)this._t&&t.j(this.kt),clearTimeout(this.ft),this.ft=it;else if(this._t)t.j(this.kt);else{var n=this.ut;n!==it&&n.it(this)}},i.prototype.wt=function(){this._t=!1,t.prototype.wt.call(this)},i.prototype.xt=function(){this._t=!1,t.prototype.xt.call(this)},i.prototype.map=function(t){return this.Tt(t)},i.prototype.mapTo=function(i){return t.prototype.mapTo.call(this,i)},i.prototype.take=function(i){return t.prototype.take.call(this,i)},i.prototype.endWhen=function(i){return t.prototype.endWhen.call(this,i)},i.prototype.replaceError=function(i){return t.prototype.replaceError.call(this,i)},i.prototype.remember=function(){return this},i.prototype.debug=function(i){return t.prototype.debug.call(this,i)},i}(Et);s.MemoryStream=Ft;var Ot=Et,$t=s.default=Ot;const Ut="#0eff00",Bt="red",It="#000",jt="#4874de",Gt="#163479",zt="#808080",Dt="#d3d3d3",Lt="#565656",Nt=40,Vt=60,Wt={A:".-",B:"-...",C:"-.-.",D:"-..",E:".",F:"..-.",G:"--.",H:"....",I:"..",J:".---",K:"-.-",L:".-..",M:"--",N:"-.",O:"---",P:".--.",Q:"--.-",R:".-.",S:"...",T:"-",U:"..-",V:"...-",W:".--",X:"-..-",Y:"-.--",Z:"--..",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----.",0:"-----",".":".-.-.-",",":"--..--","?":"..--..","'":".----.","!":"-.-.--","/":"-..-.","(":"-.--.",")":"-.--.-","&":".-...",":":"---...",";":"-.-.-.","=":"-...-","+":".-.-.","-":"-....-",Ct:"..--.-",'"':".-..-.",$:"...-..-","@":".--.-."," ":" "},Ht="spikerman:",qt=1300,Xt=1100,Yt=1235,Kt=1045,Qt=100*Math.ceil(4.8);var Zt=(t=>(t.Random="RandomSpikes",t.Phrase="Phrase",t.Channels="Channeled",t))(Zt||{});const Jt="afterFireChargeDelay",ti="leakThreshold",ii="linearLeakThreshold",ei="fireThreshold",ni="visibilityRadius",si="chargePercentStep",ri="leakFactor",oi="inactiveUtilTick";var hi=(t=>(t.OFF="OFF",t.STDP="STDP",t))(hi||{});function ai(t,i){return i-t>0?.01*Math.exp(-(i-t)/20):i-t<0?.01*Math.exp((t-i)/20)*-1:0}var ui=(t=>(t.LeftRect="LeftRect",t.RightRect="RightRect",t.TopRect="TopRect",t.BotRect="BotRect",t.Circle="Circle",t))(ui||{}),ci=(t=>(t.LEARN="Learn",t.EVALUATE="Evaluate",t.INTERACTIVE="Interactive",t.CHANNELS="Channels",t))(ci||{});function li(t,i){switch(t){case ui.LeftRect:return t=>t.x<=qt*i/100;case ui.TopRect:case ui.Circle:return t=>t.y<=Xt*i/100;default:return t=>!1}}function fi(t,i){switch(t){case ui.RightRect:return t=>t.x>=qt*(1-i/100);case ui.BotRect:case ui.Circle:return t=>t.y>=Xt*(1-i/100);default:return t=>!1}}var di=(t=>(t.Grid="Grid",t.Columns="Columns",t.Random="Random",t.Custom="Custom",t))(di||{});function pi(t,i){return Math.random()*(i-t)+t}function vi(t,i){return(i-t)/2}function mi(t,i,e,n){const s=[],r=(n-e)/(t-1);for(let o=0;o<t;o++)s.push(e+o*r);return s[i]}function gi(i,e,n){const s=n?Math.ceil(Math.sqrt(i*n)):Math.ceil(Math.sqrt(i)),r=n?Math.ceil(s/n):Math.ceil(i/s),o=Math.round(1250/s),h=Math.round(1010/r),a=Math.floor(e/s),u=e%s,c=(qt-(s-1)*o)/2,l=(Xt-(r-1)*h)/2-20,f=Math.round(c+u*o),d=Math.round(l+a*h),p=t.config.connections,v=li(p.inputAreaType,p.inputAreaWidth),m=fi(p.outputAreaType,p.outputAreaWidth),g={x:f,y:d},b=v(g),y=m(g),x=!b||b&&!t.dC$.topology.ignoreHeatOnInput,w=!y||y&&!t.dC$.topology.ignoreHeatOnOutput;return t.config.topology.heat&&x&&w?[f+bi()*t.config.topology.heat*o*Math.random(),d+bi()*t.config.topology.heat*h*Math.random()]:[f,d]}function bi(){return Math.random()>.5?-1:1}function yi(t,i){const e=Math.random();return Math.exp(e*(Math.log(i)-Math.log(t))+Math.log(t))}function xi(t,i){return-Math.log(1-Math.random())/t*i}function wi(t,i,e){const n=Math.random();return t+Math.pow(n,e)*(i-t)}function Mi(t,i){let e=Math.random(),n=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*n)*i+t}var Ai=(t=>(t.LinearRandom="LinearRandom",t.LinearEvenly="LinearEvenly",t.LinearGrid="LinearGrid",t.LogRandom="LogRandom",t.ExpRandom="ExpRandom",t.PowerRandom="PowerRandom",t.GaussRandom="GaussRandom",t.RangeCenter="RangeCenter",t))(Ai||{});function Ti(t){switch(t){case di.Grid:return{x:ki("LinearGrid"),y:ki("LinearGrid")};case di.Columns:return{x:ki("GaussRandom"),y:ki("PowerRandom")};case di.Random:default:return{x:ki("LinearRandom"),y:ki("LinearRandom")}}}function _i(t,i){t.distribution=Ti(i)}function ki(t){let i={type:t};switch(t){case"LinearRandom":return{...i,func:pi,args:{min:0,max:0}};case"LinearEvenly":return{...i,func:mi,args:{numElements:0,index:0,min:0,max:0}};case"LinearGrid":return{...i,func:gi,args:{numElements:0,index:0,aspectRatio:0}};case"LogRandom":return{...i,func:yi,args:{min:0,max:0}};case"ExpRandom":return{...i,func:xi,args:{lambda:0,max:0}};case"PowerRandom":return{...i,func:wi,args:{min:0,max:0,power:0}};case"GaussRandom":return{...i,func:Mi,args:{mu:0,sigma:0}};case"RangeCenter":return{...i,func:vi,args:{min:0,max:0}}}}function Ci(t,i){switch(t){case"LinearRandom":case"LogRandom":case"RangeCenter":return{min:i.min,max:i.max};case"LinearEvenly":return{numElements:i.numElements,index:i.index,min:i.min,max:i.max};case"LinearGrid":return{numElements:i.numElements,index:i.index,aspectRatio:i.aspectRatio};case"ExpRandom":return{lambda:i.lambda,max:i.max};case"PowerRandom":return{min:i.min,max:i.max,power:i.power};case"GaussRandom":return{mu:i.mu,sigma:i.sigma}}}var Si,Pi,Ei={exports:{}};
/*!
 * jQuery JavaScript Library v3.7.1
 * https://jquery.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2023-08-28T13:37Z
 */Si="undefined"!=typeof window?window:i,Pi=function(t,i){var e=[],n=Object.getPrototypeOf,s=e.slice,r=e.flat?function(t){return e.flat.call(t)}:function(t){return e.concat.apply([],t)},o=e.push,h=e.indexOf,a={},u=a.toString,c=a.hasOwnProperty,l=c.toString,f=l.call(Object),d={},p=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType&&"function"!=typeof t.item},v=function(t){return null!=t&&t===t.window},m=t.document,g={type:!0,src:!0,nonce:!0,noModule:!0};function b(t,i,e){var n,s,r=(e=e||m).createElement("script");if(r.text=t,i)for(n in g)(s=i[n]||i.getAttribute&&i.getAttribute(n))&&r.setAttribute(n,s);e.head.appendChild(r).parentNode.removeChild(r)}function y(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?a[u.call(t)]||"object":typeof t}var x="3.7.1",w=/HTML$/i,M=function(t,i){return new M.fn.init(t,i)};function A(t){var i=!!t&&"length"in t&&t.length,e=y(t);return!p(t)&&!v(t)&&("array"===e||0===i||"number"==typeof i&&i>0&&i-1 in t)}function T(t,i){return t.nodeName&&t.nodeName.toLowerCase()===i.toLowerCase()}M.fn=M.prototype={jquery:x,constructor:M,length:0,toArray:function(){return s.call(this)},get:function(t){return null==t?s.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var i=M.merge(this.constructor(),t);return i.prevObject=this,i},each:function(t){return M.each(this,t)},map:function(t){return this.pushStack(M.map(this,function(i,e){return t.call(i,e,i)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(M.grep(this,function(t,i){return(i+1)%2}))},odd:function(){return this.pushStack(M.grep(this,function(t,i){return i%2}))},eq:function(t){var i=this.length,e=+t+(t<0?i:0);return this.pushStack(e>=0&&e<i?[this[e]]:[])},end:function(){return this.prevObject||this.constructor()},push:o,sort:e.sort,splice:e.splice},M.extend=M.fn.extend=function(){var t,i,e,n,s,r,o=arguments[0]||{},h=1,a=arguments.length,u=!1;for("boolean"==typeof o&&(u=o,o=arguments[h]||{},h++),"object"==typeof o||p(o)||(o={}),h===a&&(o=this,h--);h<a;h++)if(null!=(t=arguments[h]))for(i in t)n=t[i],"__proto__"!==i&&o!==n&&(u&&n&&(M.isPlainObject(n)||(s=Array.isArray(n)))?(e=o[i],r=s&&!Array.isArray(e)?[]:s||M.isPlainObject(e)?e:{},s=!1,o[i]=M.extend(u,r,n)):void 0!==n&&(o[i]=n));return o},M.extend({expando:"jQuery"+(x+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var i,e;return!(!t||"[object Object]"!==u.call(t)||(i=n(t))&&("function"!=typeof(e=c.call(i,"constructor")&&i.constructor)||l.call(e)!==f))},isEmptyObject:function(t){var i;for(i in t)return!1;return!0},globalEval:function(t,i,e){b(t,{nonce:i&&i.nonce},e)},each:function(t,i){var e,n=0;if(A(t))for(e=t.length;n<e&&!1!==i.call(t[n],n,t[n]);n++);else for(n in t)if(!1===i.call(t[n],n,t[n]))break;return t},text:function(t){var i,e="",n=0,s=t.nodeType;if(!s)for(;i=t[n++];)e+=M.text(i);return 1===s||11===s?t.textContent:9===s?t.documentElement.textContent:3===s||4===s?t.nodeValue:e},makeArray:function(t,i){var e=i||[];return null!=t&&(A(Object(t))?M.merge(e,"string"==typeof t?[t]:t):o.call(e,t)),e},inArray:function(t,i,e){return null==i?-1:h.call(i,t,e)},isXMLDoc:function(t){var i=t&&t.namespaceURI,e=t&&(t.ownerDocument||t).documentElement;return!w.test(i||e&&e.nodeName||"HTML")},merge:function(t,i){for(var e=+i.length,n=0,s=t.length;n<e;n++)t[s++]=i[n];return t.length=s,t},grep:function(t,i,e){for(var n=[],s=0,r=t.length,o=!e;s<r;s++)!i(t[s],s)!==o&&n.push(t[s]);return n},map:function(t,i,e){var n,s,o=0,h=[];if(A(t))for(n=t.length;o<n;o++)null!=(s=i(t[o],o,e))&&h.push(s);else for(o in t)null!=(s=i(t[o],o,e))&&h.push(s);return r(h)},guid:1,support:d}),"function"==typeof Symbol&&(M.fn[Symbol.iterator]=e[Symbol.iterator]),M.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,i){a["[object "+i+"]"]=i.toLowerCase()});var _=e.pop,k=e.sort,C=e.splice,S="[\\x20\\t\\r\\n\\f]",P=new RegExp("^"+S+"+|((?:^|[^\\\\])(?:\\\\.)*)"+S+"+$","g");M.contains=function(t,i){var e=i&&i.parentNode;return t===e||!(!e||1!==e.nodeType||!(t.contains?t.contains(e):t.compareDocumentPosition&&16&t.compareDocumentPosition(e)))};var E=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function R(t,i){return i?"\0"===t?"ï¿½":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t}M.escapeSelector=function(t){return(t+"").replace(E,R)};var F=m,O=o;!function(){var i,n,r,o,a,u,l,f,p,v,m=O,g=M.expando,b=0,y=0,x=tt(),w=tt(),A=tt(),E=tt(),R=function(t,i){return t===i&&(a=!0),0},$="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",U="(?:\\\\[\\da-fA-F]{1,6}"+S+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",B="\\["+S+"*("+U+")(?:"+S+"*([*^$|!~]?=)"+S+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+U+"))|)"+S+"*\\]",I=":("+U+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+B+")*)|.*)\\)|)",j=new RegExp(S+"+","g"),G=new RegExp("^"+S+"*,"+S+"*"),z=new RegExp("^"+S+"*([>+~]|"+S+")"+S+"*"),D=new RegExp(S+"|>"),L=new RegExp(I),N=new RegExp("^"+U+"$"),V={ID:new RegExp("^#("+U+")"),CLASS:new RegExp("^\\.("+U+")"),TAG:new RegExp("^("+U+"|[*])"),ATTR:new RegExp("^"+B),PSEUDO:new RegExp("^"+I),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+S+"*(even|odd|(([+-]|)(\\d*)n|)"+S+"*(?:([+-]|)"+S+"*(\\d+)|))"+S+"*\\)|)","i"),bool:new RegExp("^(?:"+$+")$","i"),needsContext:new RegExp("^"+S+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+S+"*((?:-\\d)?\\d*)"+S+"*\\)|)(?=[^-]|$)","i")},W=/^(?:input|select|textarea|button)$/i,H=/^h\d$/i,q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,X=/[+~]/,Y=new RegExp("\\\\[\\da-fA-F]{1,6}"+S+"?|\\\\([^\\r\\n\\f])","g"),K=function(t,i){var e="0x"+t.slice(1)-65536;return i||(e<0?String.fromCharCode(e+65536):String.fromCharCode(e>>10|55296,1023&e|56320))},Q=function(){at()},Z=ft(function(t){return!0===t.disabled&&T(t,"fieldset")},{dir:"parentNode",next:"legend"});try{m.apply(e=s.call(F.childNodes),F.childNodes),e[F.childNodes.length].nodeType}catch(Qv){m={apply:function(t,i){O.apply(t,s.call(i))},call:function(t){O.apply(t,s.call(arguments,1))}}}function J(t,i,e,n){var s,r,o,h,a,c,l,v=i&&i.ownerDocument,b=i?i.nodeType:9;if(e=e||[],"string"!=typeof t||!t||1!==b&&9!==b&&11!==b)return e;if(!n&&(at(i),i=i||u,f)){if(11!==b&&(a=q.exec(t)))if(s=a[1]){if(9===b){if(!(o=i.getElementById(s)))return e;if(o.id===s)return m.call(e,o),e}else if(v&&(o=v.getElementById(s))&&J.contains(i,o)&&o.id===s)return m.call(e,o),e}else{if(a[2])return m.apply(e,i.getElementsByTagName(t)),e;if((s=a[3])&&i.getElementsByClassName)return m.apply(e,i.getElementsByClassName(s)),e}if(!(E[t+" "]||p&&p.test(t))){if(l=t,v=i,1===b&&(D.test(t)||z.test(t))){for((v=X.test(t)&&ht(i.parentNode)||i)==i&&d.scope||((h=i.getAttribute("id"))?h=M.escapeSelector(h):i.setAttribute("id",h=g)),r=(c=ct(t)).length;r--;)c[r]=(h?"#"+h:":scope")+" "+lt(c[r]);l=c.join(",")}try{return m.apply(e,v.querySelectorAll(l)),e}catch(y){E(t,!0)}finally{h===g&&i.removeAttribute("id")}}}return bt(t.replace(P,"$1"),i,e,n)}function tt(){var t=[];return function i(e,s){return t.push(e+" ")>n.cacheLength&&delete i[t.shift()],i[e+" "]=s}}function it(t){return t[g]=!0,t}function et(t){var i=u.createElement("fieldset");try{return!!t(i)}catch(Qv){return!1}finally{i.parentNode&&i.parentNode.removeChild(i),i=null}}function nt(t){return function(i){return T(i,"input")&&i.type===t}}function st(t){return function(i){return(T(i,"input")||T(i,"button"))&&i.type===t}}function rt(t){return function(i){return"form"in i?i.parentNode&&!1===i.disabled?"label"in i?"label"in i.parentNode?i.parentNode.disabled===t:i.disabled===t:i.isDisabled===t||i.isDisabled!==!t&&Z(i)===t:i.disabled===t:"label"in i&&i.disabled===t}}function ot(t){return it(function(i){return i=+i,it(function(e,n){for(var s,r=t([],e.length,i),o=r.length;o--;)e[s=r[o]]&&(e[s]=!(n[s]=e[s]))})})}function ht(t){return t&&void 0!==t.getElementsByTagName&&t}function at(t){var i,e=t?t.ownerDocument||t:F;return e!=u&&9===e.nodeType&&e.documentElement?(l=(u=e).documentElement,f=!M.isXMLDoc(u),v=l.matches||l.webkitMatchesSelector||l.msMatchesSelector,l.msMatchesSelector&&F!=u&&(i=u.defaultView)&&i.top!==i&&i.addEventListener("unload",Q),d.getById=et(function(t){return l.appendChild(t).id=M.expando,!u.getElementsByName||!u.getElementsByName(M.expando).length}),d.disconnectedMatch=et(function(t){return v.call(t,"*")}),d.scope=et(function(){return u.querySelectorAll(":scope")}),d.cssHas=et(function(){try{return u.querySelector(":has(*,:jqfake)"),!1}catch(Qv){return!0}}),d.getById?(n.filter.ID=function(t){var i=t.replace(Y,K);return function(t){return t.getAttribute("id")===i}},n.find.ID=function(t,i){if(void 0!==i.getElementById&&f){var e=i.getElementById(t);return e?[e]:[]}}):(n.filter.ID=function(t){var i=t.replace(Y,K);return function(t){var e=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return e&&e.value===i}},n.find.ID=function(t,i){if(void 0!==i.getElementById&&f){var e,n,s,r=i.getElementById(t);if(r){if((e=r.getAttributeNode("id"))&&e.value===t)return[r];for(s=i.getElementsByName(t),n=0;r=s[n++];)if((e=r.getAttributeNode("id"))&&e.value===t)return[r]}return[]}}),n.find.TAG=function(t,i){return void 0!==i.getElementsByTagName?i.getElementsByTagName(t):i.querySelectorAll(t)},n.find.CLASS=function(t,i){if(void 0!==i.getElementsByClassName&&f)return i.getElementsByClassName(t)},p=[],et(function(t){var i;l.appendChild(t).innerHTML="<a id='"+g+"' href='' disabled='disabled'></a><select id='"+g+"-\r\\' disabled='disabled'><option selected=''></option></select>",t.querySelectorAll("[selected]").length||p.push("\\["+S+"*(?:value|"+$+")"),t.querySelectorAll("[id~="+g+"-]").length||p.push("~="),t.querySelectorAll("a#"+g+"+*").length||p.push(".#.+[+~]"),t.querySelectorAll(":checked").length||p.push(":checked"),(i=u.createElement("input")).setAttribute("type","hidden"),t.appendChild(i).setAttribute("name","D"),l.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&p.push(":enabled",":disabled"),(i=u.createElement("input")).setAttribute("name",""),t.appendChild(i),t.querySelectorAll("[name='']").length||p.push("\\["+S+"*name"+S+"*="+S+"*(?:''|\"\")")}),d.cssHas||p.push(":has"),p=p.length&&new RegExp(p.join("|")),R=function(t,i){if(t===i)return a=!0,0;var e=!t.compareDocumentPosition-!i.compareDocumentPosition;return e||(1&(e=(t.ownerDocument||t)==(i.ownerDocument||i)?t.compareDocumentPosition(i):1)||!d.sortDetached&&i.compareDocumentPosition(t)===e?t===u||t.ownerDocument==F&&J.contains(F,t)?-1:i===u||i.ownerDocument==F&&J.contains(F,i)?1:o?h.call(o,t)-h.call(o,i):0:4&e?-1:1)},u):u}for(i in J.matches=function(t,i){return J(t,null,null,i)},J.matchesSelector=function(t,i){if(at(t),f&&!E[i+" "]&&(!p||!p.test(i)))try{var e=v.call(t,i);if(e||d.disconnectedMatch||t.document&&11!==t.document.nodeType)return e}catch(Qv){E(i,!0)}return J(i,u,null,[t]).length>0},J.contains=function(t,i){return(t.ownerDocument||t)!=u&&at(t),M.contains(t,i)},J.attr=function(t,i){(t.ownerDocument||t)!=u&&at(t);var e=n.attrHandle[i.toLowerCase()],s=e&&c.call(n.attrHandle,i.toLowerCase())?e(t,i,!f):void 0;return void 0!==s?s:t.getAttribute(i)},J.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},M.uniqueSort=function(t){var i,e=[],n=0,r=0;if(a=!d.sortStable,o=!d.sortStable&&s.call(t,0),k.call(t,R),a){for(;i=t[r++];)i===t[r]&&(n=e.push(r));for(;n--;)C.call(t,e[n],1)}return o=null,t},M.fn.uniqueSort=function(){return this.pushStack(M.uniqueSort(s.apply(this)))},(n=M.expr={cacheLength:50,createPseudo:it,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(Y,K),t[3]=(t[3]||t[4]||t[5]||"").replace(Y,K),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||J.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&J.error(t[0]),t},PSEUDO:function(t){var i,e=!t[6]&&t[2];return V.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":e&&L.test(e)&&(i=ct(e,!0))&&(i=e.indexOf(")",e.length-i)-e.length)&&(t[0]=t[0].slice(0,i),t[2]=e.slice(0,i)),t.slice(0,3))}},filter:{TAG:function(t){var i=t.replace(Y,K).toLowerCase();return"*"===t?function(){return!0}:function(t){return T(t,i)}},CLASS:function(t){var i=x[t+" "];return i||(i=new RegExp("(^|"+S+")"+t+"("+S+"|$)"))&&x(t,function(t){return i.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,i,e){return function(n){var s=J.attr(n,t);return null==s?"!="===i:!i||(s+="","="===i?s===e:"!="===i?s!==e:"^="===i?e&&0===s.indexOf(e):"*="===i?e&&s.indexOf(e)>-1:"$="===i?e&&s.slice(-e.length)===e:"~="===i?(" "+s.replace(j," ")+" ").indexOf(e)>-1:"|="===i&&(s===e||s.slice(0,e.length+1)===e+"-"))}},CHILD:function(t,i,e,n,s){var r="nth"!==t.slice(0,3),o="last"!==t.slice(-4),h="of-type"===i;return 1===n&&0===s?function(t){return!!t.parentNode}:function(i,e,a){var u,c,l,f,d,p=r!==o?"nextSibling":"previousSibling",v=i.parentNode,m=h&&i.nodeName.toLowerCase(),y=!a&&!h,x=!1;if(v){if(r){for(;p;){for(l=i;l=l[p];)if(h?T(l,m):1===l.nodeType)return!1;d=p="only"===t&&!d&&"nextSibling"}return!0}if(d=[o?v.firstChild:v.lastChild],o&&y){for(x=(f=(u=(c=v[g]||(v[g]={}))[t]||[])[0]===b&&u[1])&&u[2],l=f&&v.childNodes[f];l=++f&&l&&l[p]||(x=f=0)||d.pop();)if(1===l.nodeType&&++x&&l===i){c[t]=[b,f,x];break}}else if(y&&(x=f=(u=(c=i[g]||(i[g]={}))[t]||[])[0]===b&&u[1]),!1===x)for(;(l=++f&&l&&l[p]||(x=f=0)||d.pop())&&(!(h?T(l,m):1===l.nodeType)||!++x||(y&&((c=l[g]||(l[g]={}))[t]=[b,x]),l!==i)););return(x-=s)===n||x%n===0&&x/n>=0}}},PSEUDO:function(t,i){var e,s=n.pseudos[t]||n.setFilters[t.toLowerCase()]||J.error("unsupported pseudo: "+t);return s[g]?s(i):s.length>1?(e=[t,t,"",i],n.setFilters.hasOwnProperty(t.toLowerCase())?it(function(t,e){for(var n,r=s(t,i),o=r.length;o--;)t[n=h.call(t,r[o])]=!(e[n]=r[o])}):function(t){return s(t,0,e)}):s}},pseudos:{not:it(function(t){var i=[],e=[],n=gt(t.replace(P,"$1"));return n[g]?it(function(t,i,e,s){for(var r,o=n(t,null,s,[]),h=t.length;h--;)(r=o[h])&&(t[h]=!(i[h]=r))}):function(t,s,r){return i[0]=t,n(i,null,r,e),i[0]=null,!e.pop()}}),has:it(function(t){return function(i){return J(t,i).length>0}}),contains:it(function(t){return t=t.replace(Y,K),function(i){return(i.textContent||M.text(i)).indexOf(t)>-1}}),lang:it(function(t){return N.test(t||"")||J.error("unsupported lang: "+t),t=t.replace(Y,K).toLowerCase(),function(i){var e;do{if(e=f?i.lang:i.getAttribute("xml:lang")||i.getAttribute("lang"))return(e=e.toLowerCase())===t||0===e.indexOf(t+"-")}while((i=i.parentNode)&&1===i.nodeType);return!1}}),target:function(i){var e=t.location&&t.location.hash;return e&&e.slice(1)===i.id},root:function(t){return t===l},focus:function(t){return t===function(){try{return u.activeElement}catch(t){}}()&&u.hasFocus()&&!!(t.type||t.href||~t.tabIndex)},enabled:rt(!1),disabled:rt(!0),checked:function(t){return T(t,"input")&&!!t.checked||T(t,"option")&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!n.pseudos.empty(t)},header:function(t){return H.test(t.nodeName)},input:function(t){return W.test(t.nodeName)},button:function(t){return T(t,"input")&&"button"===t.type||T(t,"button")},text:function(t){var i;return T(t,"input")&&"text"===t.type&&(null==(i=t.getAttribute("type"))||"text"===i.toLowerCase())},first:ot(function(){return[0]}),last:ot(function(t,i){return[i-1]}),eq:ot(function(t,i,e){return[e<0?e+i:e]}),even:ot(function(t,i){for(var e=0;e<i;e+=2)t.push(e);return t}),odd:ot(function(t,i){for(var e=1;e<i;e+=2)t.push(e);return t}),lt:ot(function(t,i,e){var n;for(n=e<0?e+i:e>i?i:e;--n>=0;)t.push(n);return t}),gt:ot(function(t,i,e){for(var n=e<0?e+i:e;++n<i;)t.push(n);return t})}}).pseudos.nth=n.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[i]=nt(i);for(i in{submit:!0,reset:!0})n.pseudos[i]=st(i);function ut(){}function ct(t,i){var e,s,r,o,h,a,u,c=w[t+" "];if(c)return i?0:c.slice(0);for(h=t,a=[],u=n.preFilter;h;){for(o in e&&!(s=G.exec(h))||(s&&(h=h.slice(s[0].length)||h),a.push(r=[])),e=!1,(s=z.exec(h))&&(e=s.shift(),r.push({value:e,type:s[0].replace(P," ")}),h=h.slice(e.length)),n.filter)!(s=V[o].exec(h))||u[o]&&!(s=u[o](s))||(e=s.shift(),r.push({value:e,type:o,matches:s}),h=h.slice(e.length));if(!e)break}return i?h.length:h?J.error(t):w(t,a).slice(0)}function lt(t){for(var i=0,e=t.length,n="";i<e;i++)n+=t[i].value;return n}function ft(t,i,e){var n=i.dir,s=i.next,r=s||n,o=e&&"parentNode"===r,h=y++;return i.first?function(i,e,s){for(;i=i[n];)if(1===i.nodeType||o)return t(i,e,s);return!1}:function(i,e,a){var u,c,l=[b,h];if(a){for(;i=i[n];)if((1===i.nodeType||o)&&t(i,e,a))return!0}else for(;i=i[n];)if(1===i.nodeType||o)if(c=i[g]||(i[g]={}),s&&T(i,s))i=i[n]||i;else{if((u=c[r])&&u[0]===b&&u[1]===h)return l[2]=u[2];if(c[r]=l,l[2]=t(i,e,a))return!0}return!1}}function dt(t){return t.length>1?function(i,e,n){for(var s=t.length;s--;)if(!t[s](i,e,n))return!1;return!0}:t[0]}function pt(t,i,e,n,s){for(var r,o=[],h=0,a=t.length,u=null!=i;h<a;h++)(r=t[h])&&(e&&!e(r,n,s)||(o.push(r),u&&i.push(h)));return o}function vt(t,i,e,n,s,r){return n&&!n[g]&&(n=vt(n)),s&&!s[g]&&(s=vt(s,r)),it(function(r,o,a,u){var c,l,f,d,p=[],v=[],g=o.length,b=r||function(t,i,e){for(var n=0,s=i.length;n<s;n++)J(t,i[n],e);return e}(i||"*",a.nodeType?[a]:a,[]),y=!t||!r&&i?b:pt(b,p,t,a,u);if(e?e(y,d=s||(r?t:g||n)?[]:o,a,u):d=y,n)for(c=pt(d,v),n(c,[],a,u),l=c.length;l--;)(f=c[l])&&(d[v[l]]=!(y[v[l]]=f));if(r){if(s||t){if(s){for(c=[],l=d.length;l--;)(f=d[l])&&c.push(y[l]=f);s(null,d=[],c,u)}for(l=d.length;l--;)(f=d[l])&&(c=s?h.call(r,f):p[l])>-1&&(r[c]=!(o[c]=f))}}else d=pt(d===o?d.splice(g,d.length):d),s?s(null,o,d,u):m.apply(o,d)})}function mt(t){for(var i,e,s,o=t.length,a=n.relative[t[0].type],u=a||n.relative[" "],c=a?1:0,l=ft(function(t){return t===i},u,!0),f=ft(function(t){return h.call(i,t)>-1},u,!0),d=[function(t,e,n){var s=!a&&(n||e!=r)||((i=e).nodeType?l(t,e,n):f(t,e,n));return i=null,s}];c<o;c++)if(e=n.relative[t[c].type])d=[ft(dt(d),e)];else{if((e=n.filter[t[c].type].apply(null,t[c].matches))[g]){for(s=++c;s<o&&!n.relative[t[s].type];s++);return vt(c>1&&dt(d),c>1&&lt(t.slice(0,c-1).concat({value:" "===t[c-2].type?"*":""})).replace(P,"$1"),e,c<s&&mt(t.slice(c,s)),s<o&&mt(t=t.slice(s)),s<o&&lt(t))}d.push(e)}return dt(d)}function gt(t,i){var e,s=[],o=[],h=A[t+" "];if(!h){for(i||(i=ct(t)),e=i.length;e--;)(h=mt(i[e]))[g]?s.push(h):o.push(h);h=A(t,function(t,i){var e=i.length>0,s=t.length>0,o=function(o,h,a,c,l){var d,p,v,g=0,y="0",x=o&&[],w=[],A=r,T=o||s&&n.find.TAG("*",l),k=b+=null==A?1:Math.random()||.1,C=T.length;for(l&&(r=h==u||h||l);y!==C&&null!=(d=T[y]);y++){if(s&&d){for(p=0,h||d.ownerDocument==u||(at(d),a=!f);v=t[p++];)if(v(d,h||u,a)){m.call(c,d);break}l&&(b=k)}e&&((d=!v&&d)&&g--,o&&x.push(d))}if(g+=y,e&&y!==g){for(p=0;v=i[p++];)v(x,w,h,a);if(o){if(g>0)for(;y--;)x[y]||w[y]||(w[y]=_.call(c));w=pt(w)}m.apply(c,w),l&&!o&&w.length>0&&g+i.length>1&&M.uniqueSort(c)}return l&&(b=k,r=A),x};return e?it(o):o}(o,s)),h.selector=t}return h}function bt(t,i,e,s){var r,o,h,a,u,c="function"==typeof t&&t,l=!s&&ct(t=c.selector||t);if(e=e||[],1===l.length){if((o=l[0]=l[0].slice(0)).length>2&&"ID"===(h=o[0]).type&&9===i.nodeType&&f&&n.relative[o[1].type]){if(!(i=(n.find.ID(h.matches[0].replace(Y,K),i)||[])[0]))return e;c&&(i=i.parentNode),t=t.slice(o.shift().value.length)}for(r=V.needsContext.test(t)?0:o.length;r--&&(h=o[r],!n.relative[a=h.type]);)if((u=n.find[a])&&(s=u(h.matches[0].replace(Y,K),X.test(o[0].type)&&ht(i.parentNode)||i))){if(o.splice(r,1),!(t=s.length&&lt(o)))return m.apply(e,s),e;break}}return(c||gt(t,l))(s,i,!f,e,!i||X.test(t)&&ht(i.parentNode)||i),e}ut.prototype=n.filters=n.pseudos,n.setFilters=new ut,d.sortStable=g.split("").sort(R).join("")===g,at(),d.sortDetached=et(function(t){return 1&t.compareDocumentPosition(u.createElement("fieldset"))}),M.find=J,M.expr[":"]=M.expr.pseudos,M.unique=M.uniqueSort,J.compile=gt,J.select=bt,J.setDocument=at,J.tokenize=ct,J.escape=M.escapeSelector,J.getText=M.text,J.isXML=M.isXMLDoc,J.selectors=M.expr,J.support=M.support,J.uniqueSort=M.uniqueSort}();var $=function(t,i,e){for(var n=[],s=void 0!==e;(t=t[i])&&9!==t.nodeType;)if(1===t.nodeType){if(s&&M(t).is(e))break;n.push(t)}return n},U=function(t,i){for(var e=[];t;t=t.nextSibling)1===t.nodeType&&t!==i&&e.push(t);return e},B=M.expr.match.needsContext,I=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(t,i,e){return p(i)?M.grep(t,function(t,n){return!!i.call(t,n,t)!==e}):i.nodeType?M.grep(t,function(t){return t===i!==e}):"string"!=typeof i?M.grep(t,function(t){return h.call(i,t)>-1!==e}):M.filter(i,t,e)}M.filter=function(t,i,e){var n=i[0];return e&&(t=":not("+t+")"),1===i.length&&1===n.nodeType?M.find.matchesSelector(n,t)?[n]:[]:M.find.matches(t,M.grep(i,function(t){return 1===t.nodeType}))},M.fn.extend({find:function(t){var i,e,n=this.length,s=this;if("string"!=typeof t)return this.pushStack(M(t).filter(function(){for(i=0;i<n;i++)if(M.contains(s[i],this))return!0}));for(e=this.pushStack([]),i=0;i<n;i++)M.find(t,s[i],e);return n>1?M.uniqueSort(e):e},filter:function(t){return this.pushStack(j(this,t||[],!1))},not:function(t){return this.pushStack(j(this,t||[],!0))},is:function(t){return!!j(this,"string"==typeof t&&B.test(t)?M(t):t||[],!1).length}});var G,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(M.fn.init=function(t,i,e){var n,s;if(!t)return this;if(e=e||G,"string"==typeof t){if(!(n="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:z.exec(t))||!n[1]&&i)return!i||i.jquery?(i||e).find(t):this.constructor(i).find(t);if(n[1]){if(i=i instanceof M?i[0]:i,M.merge(this,M.parseHTML(n[1],i&&i.nodeType?i.ownerDocument||i:m,!0)),I.test(n[1])&&M.isPlainObject(i))for(n in i)p(this[n])?this[n](i[n]):this.attr(n,i[n]);return this}return(s=m.getElementById(n[2]))&&(this[0]=s,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):p(t)?void 0!==e.ready?e.ready(t):t(M):M.makeArray(t,this)}).prototype=M.fn,G=M(m);var D=/^(?:parents|prev(?:Until|All))/,L={children:!0,contents:!0,next:!0,prev:!0};function N(t,i){for(;(t=t[i])&&1!==t.nodeType;);return t}M.fn.extend({has:function(t){var i=M(t,this),e=i.length;return this.filter(function(){for(var t=0;t<e;t++)if(M.contains(this,i[t]))return!0})},closest:function(t,i){var e,n=0,s=this.length,r=[],o="string"!=typeof t&&M(t);if(!B.test(t))for(;n<s;n++)for(e=this[n];e&&e!==i;e=e.parentNode)if(e.nodeType<11&&(o?o.index(e)>-1:1===e.nodeType&&M.find.matchesSelector(e,t))){r.push(e);break}return this.pushStack(r.length>1?M.uniqueSort(r):r)},index:function(t){return t?"string"==typeof t?h.call(M(t),this[0]):h.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,i){return this.pushStack(M.uniqueSort(M.merge(this.get(),M(t,i))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),M.each({parent:function(t){var i=t.parentNode;return i&&11!==i.nodeType?i:null},parents:function(t){return $(t,"parentNode")},parentsUntil:function(t,i,e){return $(t,"parentNode",e)},next:function(t){return N(t,"nextSibling")},prev:function(t){return N(t,"previousSibling")},nextAll:function(t){return $(t,"nextSibling")},prevAll:function(t){return $(t,"previousSibling")},nextUntil:function(t,i,e){return $(t,"nextSibling",e)},prevUntil:function(t,i,e){return $(t,"previousSibling",e)},siblings:function(t){return U((t.parentNode||{}).firstChild,t)},children:function(t){return U(t.firstChild)},contents:function(t){return null!=t.contentDocument&&n(t.contentDocument)?t.contentDocument:(T(t,"template")&&(t=t.content||t),M.merge([],t.childNodes))}},function(t,i){M.fn[t]=function(e,n){var s=M.map(this,i,e);return"Until"!==t.slice(-5)&&(n=e),n&&"string"==typeof n&&(s=M.filter(n,s)),this.length>1&&(L[t]||M.uniqueSort(s),D.test(t)&&s.reverse()),this.pushStack(s)}});var V=/[^\x20\t\r\n\f]+/g;function W(t){return t}function H(t){throw t}function q(t,i,e,n){var s;try{t&&p(s=t.promise)?s.call(t).done(i).fail(e):t&&p(s=t.then)?s.call(t,i,e):i.apply(void 0,[t].slice(n))}catch(r){e.apply(void 0,[r])}}M.Callbacks=function(t){t="string"==typeof t?function(t){var i={};return M.each(t.match(V)||[],function(t,e){i[e]=!0}),i}(t):M.extend({},t);var i,e,n,s,r=[],o=[],h=-1,a=function(){for(s=s||t.once,n=i=!0;o.length;h=-1)for(e=o.shift();++h<r.length;)!1===r[h].apply(e[0],e[1])&&t.stopOnFalse&&(h=r.length,e=!1);t.memory||(e=!1),i=!1,s&&(r=e?[]:"")},u={add:function(){return r&&(e&&!i&&(h=r.length-1,o.push(e)),function i(e){M.each(e,function(e,n){p(n)?t.unique&&u.has(n)||r.push(n):n&&n.length&&"string"!==y(n)&&i(n)})}(arguments),e&&!i&&a()),this},remove:function(){return M.each(arguments,function(t,i){for(var e;(e=M.inArray(i,r,e))>-1;)r.splice(e,1),e<=h&&h--}),this},has:function(t){return t?M.inArray(t,r)>-1:r.length>0},empty:function(){return r&&(r=[]),this},disable:function(){return s=o=[],r=e="",this},disabled:function(){return!r},lock:function(){return s=o=[],e||i||(r=e=""),this},locked:function(){return!!s},fireWith:function(t,e){return s||(e=[t,(e=e||[]).slice?e.slice():e],o.push(e),i||a()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!n}};return u},M.extend({Deferred:function(i){var e=[["notify","progress",M.Callbacks("memory"),M.Callbacks("memory"),2],["resolve","done",M.Callbacks("once memory"),M.Callbacks("once memory"),0,"resolved"],["reject","fail",M.Callbacks("once memory"),M.Callbacks("once memory"),1,"rejected"]],n="pending",s={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},catch:function(t){return s.then(null,t)},pipe:function(){var t=arguments;return M.Deferred(function(i){M.each(e,function(e,n){var s=p(t[n[4]])&&t[n[4]];r[n[1]](function(){var t=s&&s.apply(this,arguments);t&&p(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[n[0]+"With"](this,s?[t]:arguments)})}),t=null}).promise()},then:function(i,n,s){var r=0;function o(i,e,n,s){return function(){var h=this,a=arguments,u=function(){var t,u;if(!(i<r)){if((t=n.apply(h,a))===e.promise())throw new TypeError("Thenable self-resolution");u=t&&("object"==typeof t||"function"==typeof t)&&t.then,p(u)?s?u.call(t,o(r,e,W,s),o(r,e,H,s)):(r++,u.call(t,o(r,e,W,s),o(r,e,H,s),o(r,e,W,e.notifyWith))):(n!==W&&(h=void 0,a=[t]),(s||e.resolveWith)(h,a))}},c=s?u:function(){try{u()}catch(Qv){M.Deferred.exceptionHook&&M.Deferred.exceptionHook(Qv,c.error),i+1>=r&&(n!==H&&(h=void 0,a=[Qv]),e.rejectWith(h,a))}};i?c():(M.Deferred.getErrorHook?c.error=M.Deferred.getErrorHook():M.Deferred.getStackHook&&(c.error=M.Deferred.getStackHook()),t.setTimeout(c))}}return M.Deferred(function(t){e[0][3].add(o(0,t,p(s)?s:W,t.notifyWith)),e[1][3].add(o(0,t,p(i)?i:W)),e[2][3].add(o(0,t,p(n)?n:H))}).promise()},promise:function(t){return null!=t?M.extend(t,s):s}},r={};return M.each(e,function(t,i){var o=i[2],h=i[5];s[i[1]]=o.add,h&&o.add(function(){n=h},e[3-t][2].disable,e[3-t][3].disable,e[0][2].lock,e[0][3].lock),o.add(i[3].fire),r[i[0]]=function(){return r[i[0]+"With"](this===r?void 0:this,arguments),this},r[i[0]+"With"]=o.fireWith}),s.promise(r),i&&i.call(r,r),r},when:function(t){var i=arguments.length,e=i,n=Array(e),r=s.call(arguments),o=M.Deferred(),h=function(t){return function(e){n[t]=this,r[t]=arguments.length>1?s.call(arguments):e,--i||o.resolveWith(n,r)}};if(i<=1&&(q(t,o.done(h(e)).resolve,o.reject,!i),"pending"===o.state()||p(r[e]&&r[e].then)))return o.then();for(;e--;)q(r[e],h(e),o.reject);return o.promise()}});var X=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;M.Deferred.exceptionHook=function(i,e){t.console&&t.console.warn&&i&&X.test(i.name)&&t.console.warn("jQuery.Deferred exception: "+i.message,i.stack,e)},M.readyException=function(i){t.setTimeout(function(){throw i})};var Y=M.Deferred();function K(){m.removeEventListener("DOMContentLoaded",K),t.removeEventListener("load",K),M.ready()}M.fn.ready=function(t){return Y.then(t).catch(function(t){M.readyException(t)}),this},M.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--M.readyWait:M.isReady)||(M.isReady=!0,!0!==t&&--M.readyWait>0||Y.resolveWith(m,[M]))}}),M.ready.then=Y.then,"complete"===m.readyState||"loading"!==m.readyState&&!m.documentElement.doScroll?t.setTimeout(M.ready):(m.addEventListener("DOMContentLoaded",K),t.addEventListener("load",K));var Q=function(t,i,e,n,s,r,o){var h=0,a=t.length,u=null==e;if("object"===y(e))for(h in s=!0,e)Q(t,i,h,e[h],!0,r,o);else if(void 0!==n&&(s=!0,p(n)||(o=!0),u&&(o?(i.call(t,n),i=null):(u=i,i=function(t,i,e){return u.call(M(t),e)})),i))for(;h<a;h++)i(t[h],e,o?n:n.call(t[h],h,i(t[h],e)));return s?t:u?i.call(t):a?i(t[0],e):r},Z=/^-ms-/,J=/-([a-z])/g;function tt(t,i){return i.toUpperCase()}function it(t){return t.replace(Z,"ms-").replace(J,tt)}var et=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function nt(){this.expando=M.expando+nt.uid++}nt.uid=1,nt.prototype={cache:function(t){var i=t[this.expando];return i||(i={},et(t)&&(t.nodeType?t[this.expando]=i:Object.defineProperty(t,this.expando,{value:i,configurable:!0}))),i},set:function(t,i,e){var n,s=this.cache(t);if("string"==typeof i)s[it(i)]=e;else for(n in i)s[it(n)]=i[n];return s},get:function(t,i){return void 0===i?this.cache(t):t[this.expando]&&t[this.expando][it(i)]},access:function(t,i,e){return void 0===i||i&&"string"==typeof i&&void 0===e?this.get(t,i):(this.set(t,i,e),void 0!==e?e:i)},remove:function(t,i){var e,n=t[this.expando];if(void 0!==n){if(void 0!==i){e=(i=Array.isArray(i)?i.map(it):(i=it(i))in n?[i]:i.match(V)||[]).length;for(;e--;)delete n[i[e]]}(void 0===i||M.isEmptyObject(n))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var i=t[this.expando];return void 0!==i&&!M.isEmptyObject(i)}};var st=new nt,rt=new nt,ot=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ht=/[A-Z]/g;function at(t,i,e){var n;if(void 0===e&&1===t.nodeType)if(n="data-"+i.replace(ht,"-$&").toLowerCase(),"string"==typeof(e=t.getAttribute(n))){try{e=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:ot.test(t)?JSON.parse(t):t)}(e)}catch(Qv){}rt.set(t,i,e)}else e=void 0;return e}M.extend({hasData:function(t){return rt.hasData(t)||st.hasData(t)},data:function(t,i,e){return rt.access(t,i,e)},removeData:function(t,i){rt.remove(t,i)},St:function(t,i,e){return st.access(t,i,e)},Pt:function(t,i){st.remove(t,i)}}),M.fn.extend({data:function(t,i){var e,n,s,r=this[0],o=r&&r.attributes;if(void 0===t){if(this.length&&(s=rt.get(r),1===r.nodeType&&!st.get(r,"hasDataAttrs"))){for(e=o.length;e--;)o[e]&&0===(n=o[e].name).indexOf("data-")&&(n=it(n.slice(5)),at(r,n,s[n]));st.set(r,"hasDataAttrs",!0)}return s}return"object"==typeof t?this.each(function(){rt.set(this,t)}):Q(this,function(i){var e;if(r&&void 0===i)return void 0!==(e=rt.get(r,t))||void 0!==(e=at(r,t))?e:void 0;this.each(function(){rt.set(this,t,i)})},null,i,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){rt.remove(this,t)})}}),M.extend({queue:function(t,i,e){var n;if(t)return i=(i||"fx")+"queue",n=st.get(t,i),e&&(!n||Array.isArray(e)?n=st.access(t,i,M.makeArray(e)):n.push(e)),n||[]},dequeue:function(t,i){i=i||"fx";var e=M.queue(t,i),n=e.length,s=e.shift(),r=M.Et(t,i);"inprogress"===s&&(s=e.shift(),n--),s&&("fx"===i&&e.unshift("inprogress"),delete r.stop,s.call(t,function(){M.dequeue(t,i)},r)),!n&&r&&r.empty.fire()},Et:function(t,i){var e=i+"queueHooks";return st.get(t,e)||st.access(t,e,{empty:M.Callbacks("once memory").add(function(){st.remove(t,[i+"queue",e])})})}}),M.fn.extend({queue:function(t,i){var e=2;return"string"!=typeof t&&(i=t,t="fx",e--),arguments.length<e?M.queue(this[0],t):void 0===i?this:this.each(function(){var e=M.queue(this,t,i);M.Et(this,t),"fx"===t&&"inprogress"!==e[0]&&M.dequeue(this,t)})},dequeue:function(t){return this.each(function(){M.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,i){var e,n=1,s=M.Deferred(),r=this,o=this.length,h=function(){--n||s.resolveWith(r,[r])};for("string"!=typeof t&&(i=t,t=void 0),t=t||"fx";o--;)(e=st.get(r[o],t+"queueHooks"))&&e.empty&&(n++,e.empty.add(h));return h(),s.promise(i)}});var ut=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ct=new RegExp("^(?:([+-])=|)("+ut+")([a-z%]*)$","i"),lt=["Top","Right","Bottom","Left"],ft=m.documentElement,dt=function(t){return M.contains(t.ownerDocument,t)},pt={composed:!0};ft.getRootNode&&(dt=function(t){return M.contains(t.ownerDocument,t)||t.getRootNode(pt)===t.ownerDocument});var vt=function(t,i){return"none"===(t=i||t).style.display||""===t.style.display&&dt(t)&&"none"===M.css(t,"display")};function mt(t,i,e,n){var s,r,o=20,h=n?function(){return n.cur()}:function(){return M.css(t,i,"")},a=h(),u=e&&e[3]||(M.cssNumber[i]?"":"px"),c=t.nodeType&&(M.cssNumber[i]||"px"!==u&&+a)&&ct.exec(M.css(t,i));if(c&&c[3]!==u){for(a/=2,u=u||c[3],c=+a||1;o--;)M.style(t,i,c+u),(1-r)*(1-(r=h()/a||.5))<=0&&(o=0),c/=r;c*=2,M.style(t,i,c+u),e=e||[]}return e&&(c=+c||+a||0,s=e[1]?c+(e[1]+1)*e[2]:+e[2],n&&(n.unit=u,n.start=c,n.end=s)),s}var gt={};function bt(t){var i,e=t.ownerDocument,n=t.nodeName,s=gt[n];return s||(i=e.body.appendChild(e.createElement(n)),s=M.css(i,"display"),i.parentNode.removeChild(i),"none"===s&&(s="block"),gt[n]=s,s)}function yt(t,i){for(var e,n,s=[],r=0,o=t.length;r<o;r++)(n=t[r]).style&&(e=n.style.display,i?("none"===e&&(s[r]=st.get(n,"display")||null,s[r]||(n.style.display="")),""===n.style.display&&vt(n)&&(s[r]=bt(n))):"none"!==e&&(s[r]="none",st.set(n,"display",e)));for(r=0;r<o;r++)null!=s[r]&&(t[r].style.display=s[r]);return t}M.fn.extend({show:function(){return yt(this,!0)},hide:function(){return yt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){vt(this)?M(this).show():M(this).hide()})}});var xt,wt,Mt=/^(?:checkbox|radio)$/i,At=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Tt=/^$|^module$|\/(?:java|ecma)script/i;xt=m.createDocumentFragment().appendChild(m.createElement("div")),(wt=m.createElement("input")).setAttribute("type","radio"),wt.setAttribute("checked","checked"),wt.setAttribute("name","t"),xt.appendChild(wt),d.checkClone=xt.cloneNode(!0).cloneNode(!0).lastChild.checked,xt.innerHTML="<textarea>x</textarea>",d.noCloneChecked=!!xt.cloneNode(!0).lastChild.defaultValue,xt.innerHTML="<option></option>",d.option=!!xt.lastChild;var _t={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],Rt:[0,"",""]};function kt(t,i){var e;return e=void 0!==t.getElementsByTagName?t.getElementsByTagName(i||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(i||"*"):[],void 0===i||i&&T(t,i)?M.merge([t],e):e}function Ct(t,i){for(var e=0,n=t.length;e<n;e++)st.set(t[e],"globalEval",!i||st.get(i[e],"globalEval"))}_t.tbody=_t.tfoot=_t.colgroup=_t.caption=_t.thead,_t.th=_t.td,d.option||(_t.optgroup=_t.option=[1,"<select multiple='multiple'>","</select>"]);var St=/<|&#?\w+;/;function Pt(t,i,e,n,s){for(var r,o,h,a,u,c,l=i.createDocumentFragment(),f=[],d=0,p=t.length;d<p;d++)if((r=t[d])||0===r)if("object"===y(r))M.merge(f,r.nodeType?[r]:r);else if(St.test(r)){for(o=o||l.appendChild(i.createElement("div")),h=(At.exec(r)||["",""])[1].toLowerCase(),a=_t[h]||_t.Rt,o.innerHTML=a[1]+M.htmlPrefilter(r)+a[2],c=a[0];c--;)o=o.lastChild;M.merge(f,o.childNodes),(o=l.firstChild).textContent=""}else f.push(i.createTextNode(r));for(l.textContent="",d=0;r=f[d++];)if(n&&M.inArray(r,n)>-1)s&&s.push(r);else if(u=dt(r),o=kt(l.appendChild(r),"script"),u&&Ct(o),e)for(c=0;r=o[c++];)Tt.test(r.type||"")&&e.push(r);return l}var Et=/^([^.]*)(?:\.(.+)|)/;function Rt(){return!0}function Ft(){return!1}function Ot(t,i,e,n,s,r){var o,h;if("object"==typeof i){for(h in"string"!=typeof e&&(n=n||e,e=void 0),i)Ot(t,h,e,n,i[h],r);return t}if(null==n&&null==s?(s=e,n=e=void 0):null==s&&("string"==typeof e?(s=n,n=void 0):(s=n,n=e,e=void 0)),!1===s)s=Ft;else if(!s)return t;return 1===r&&(o=s,s=function(t){return M().off(t),o.apply(this,arguments)},s.guid=o.guid||(o.guid=M.guid++)),t.each(function(){M.event.add(this,i,s,n,e)})}function $t(t,i,e){e?(st.set(t,i,!1),M.event.add(t,i,{namespace:!1,handler:function(t){var e,n=st.get(this,i);if(1&t.isTrigger&&this[i]){if(n)(M.event.special[i]||{}).delegateType&&t.stopPropagation();else if(n=s.call(arguments),st.set(this,i,n),this[i](),e=st.get(this,i),st.set(this,i,!1),n!==e)return t.stopImmediatePropagation(),t.preventDefault(),e}else n&&(st.set(this,i,M.event.trigger(n[0],n.slice(1),this)),t.stopPropagation(),t.isImmediatePropagationStopped=Rt)}})):void 0===st.get(t,i)&&M.event.add(t,i,Rt)}M.event={global:{},add:function(t,i,e,n,s){var r,o,h,a,u,c,l,f,d,p,v,m=st.get(t);if(et(t))for(e.handler&&(e=(r=e).handler,s=r.selector),s&&M.find.matchesSelector(ft,s),e.guid||(e.guid=M.guid++),(a=m.events)||(a=m.events=Object.create(null)),(o=m.handle)||(o=m.handle=function(i){return void 0!==M&&M.event.triggered!==i.type?M.event.dispatch.apply(t,arguments):void 0}),u=(i=(i||"").match(V)||[""]).length;u--;)d=v=(h=Et.exec(i[u])||[])[1],p=(h[2]||"").split(".").sort(),d&&(l=M.event.special[d]||{},d=(s?l.delegateType:l.bindType)||d,l=M.event.special[d]||{},c=M.extend({type:d,origType:v,data:n,handler:e,guid:e.guid,selector:s,needsContext:s&&M.expr.match.needsContext.test(s),namespace:p.join(".")},r),(f=a[d])||((f=a[d]=[]).delegateCount=0,l.setup&&!1!==l.setup.call(t,n,p,o)||t.addEventListener&&t.addEventListener(d,o)),l.add&&(l.add.call(t,c),c.handler.guid||(c.handler.guid=e.guid)),s?f.splice(f.delegateCount++,0,c):f.push(c),M.event.global[d]=!0)},remove:function(t,i,e,n,s){var r,o,h,a,u,c,l,f,d,p,v,m=st.hasData(t)&&st.get(t);if(m&&(a=m.events)){for(u=(i=(i||"").match(V)||[""]).length;u--;)if(d=v=(h=Et.exec(i[u])||[])[1],p=(h[2]||"").split(".").sort(),d){for(l=M.event.special[d]||{},f=a[d=(n?l.delegateType:l.bindType)||d]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=r=f.length;r--;)c=f[r],!s&&v!==c.origType||e&&e.guid!==c.guid||h&&!h.test(c.namespace)||n&&n!==c.selector&&("**"!==n||!c.selector)||(f.splice(r,1),c.selector&&f.delegateCount--,l.remove&&l.remove.call(t,c));o&&!f.length&&(l.teardown&&!1!==l.teardown.call(t,p,m.handle)||M.removeEvent(t,d,m.handle),delete a[d])}else for(d in a)M.event.remove(t,d+i[u],e,n,!0);M.isEmptyObject(a)&&st.remove(t,"handle events")}},dispatch:function(t){var i,e,n,s,r,o,h=new Array(arguments.length),a=M.event.fix(t),u=(st.get(this,"events")||Object.create(null))[a.type]||[],c=M.event.special[a.type]||{};for(h[0]=a,i=1;i<arguments.length;i++)h[i]=arguments[i];if(a.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,a)){for(o=M.event.handlers.call(this,a,u),i=0;(s=o[i++])&&!a.isPropagationStopped();)for(a.currentTarget=s.elem,e=0;(r=s.handlers[e++])&&!a.isImmediatePropagationStopped();)a.rnamespace&&!1!==r.namespace&&!a.rnamespace.test(r.namespace)||(a.handleObj=r,a.data=r.data,void 0!==(n=((M.event.special[r.origType]||{}).handle||r.handler).apply(s.elem,h))&&!1===(a.result=n)&&(a.preventDefault(),a.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,a),a.result}},handlers:function(t,i){var e,n,s,r,o,h=[],a=i.delegateCount,u=t.target;if(a&&u.nodeType&&!("click"===t.type&&t.button>=1))for(;u!==this;u=u.parentNode||this)if(1===u.nodeType&&("click"!==t.type||!0!==u.disabled)){for(r=[],o={},e=0;e<a;e++)void 0===o[s=(n=i[e]).selector+" "]&&(o[s]=n.needsContext?M(s,this).index(u)>-1:M.find(s,this,null,[u]).length),o[s]&&r.push(n);r.length&&h.push({elem:u,handlers:r})}return u=this,a<i.length&&h.push({elem:u,handlers:i.slice(a)}),h},addProp:function(t,i){Object.defineProperty(M.Event.prototype,t,{enumerable:!0,configurable:!0,get:p(i)?function(){if(this.originalEvent)return i(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(i){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:i})}})},fix:function(t){return t[M.expando]?t:new M.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var i=this||t;return Mt.test(i.type)&&i.click&&T(i,"input")&&$t(i,"click",!0),!1},trigger:function(t){var i=this||t;return Mt.test(i.type)&&i.click&&T(i,"input")&&$t(i,"click"),!0},Rt:function(t){var i=t.target;return Mt.test(i.type)&&i.click&&T(i,"input")&&st.get(i,"click")||T(i,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},M.removeEvent=function(t,i,e){t.removeEventListener&&t.removeEventListener(i,e)},M.Event=function(t,i){if(!(this instanceof M.Event))return new M.Event(t,i);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?Rt:Ft,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,i&&M.extend(this,i),this.timeStamp=t&&t.timeStamp||Date.now(),this[M.expando]=!0},M.Event.prototype={constructor:M.Event,isDefaultPrevented:Ft,isPropagationStopped:Ft,isImmediatePropagationStopped:Ft,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Rt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Rt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Rt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},M.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},M.event.addProp),M.each({focus:"focusin",blur:"focusout"},function(t,i){function e(t){if(m.documentMode){var e=st.get(this,"handle"),n=M.event.fix(t);n.type="focusin"===t.type?"focus":"blur",n.isSimulated=!0,e(t),n.target===n.currentTarget&&e(n)}else M.event.simulate(i,t.target,M.event.fix(t))}M.event.special[t]={setup:function(){var n;if($t(this,t,!0),!m.documentMode)return!1;(n=st.get(this,i))||this.addEventListener(i,e),st.set(this,i,(n||0)+1)},trigger:function(){return $t(this,t),!0},teardown:function(){var t;if(!m.documentMode)return!1;(t=st.get(this,i)-1)?st.set(this,i,t):(this.removeEventListener(i,e),st.remove(this,i))},Rt:function(i){return st.get(i.target,t)},delegateType:i},M.event.special[i]={setup:function(){var n=this.ownerDocument||this.document||this,s=m.documentMode?this:n,r=st.get(s,i);r||(m.documentMode?this.addEventListener(i,e):n.addEventListener(t,e,!0)),st.set(s,i,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this.document||this,s=m.documentMode?this:n,r=st.get(s,i)-1;r?st.set(s,i,r):(m.documentMode?this.removeEventListener(i,e):n.removeEventListener(t,e,!0),st.remove(s,i))}}}),M.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,i){M.event.special[t]={delegateType:i,bindType:i,handle:function(t){var e,n=t.relatedTarget,s=t.handleObj;return n&&(n===this||M.contains(this,n))||(t.type=s.origType,e=s.handler.apply(this,arguments),t.type=i),e}}}),M.fn.extend({on:function(t,i,e,n){return Ot(this,t,i,e,n)},one:function(t,i,e,n){return Ot(this,t,i,e,n,1)},off:function(t,i,e){var n,s;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,M(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(s in t)this.off(s,i,t[s]);return this}return!1!==i&&"function"!=typeof i||(e=i,i=void 0),!1===e&&(e=Ft),this.each(function(){M.event.remove(this,t,e,i)})}});var Ut=/<script|<style|<link/i,Bt=/checked\s*(?:[^=]|=\s*.checked.)/i,It=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function jt(t,i){return T(t,"table")&&T(11!==i.nodeType?i:i.firstChild,"tr")&&M(t).children("tbody")[0]||t}function Gt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function zt(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function Dt(t,i){var e,n,s,r,o,h;if(1===i.nodeType){if(st.hasData(t)&&(h=st.get(t).events))for(s in st.remove(i,"handle events"),h)for(e=0,n=h[s].length;e<n;e++)M.event.add(i,s,h[s][e]);rt.hasData(t)&&(r=rt.access(t),o=M.extend({},r),rt.set(i,o))}}function Lt(t,i){var e=i.nodeName.toLowerCase();"input"===e&&Mt.test(t.type)?i.checked=t.checked:"input"!==e&&"textarea"!==e||(i.defaultValue=t.defaultValue)}function Nt(t,i,e,n){i=r(i);var s,o,h,a,u,c,l=0,f=t.length,v=f-1,m=i[0],g=p(m);if(g||f>1&&"string"==typeof m&&!d.checkClone&&Bt.test(m))return t.each(function(s){var r=t.eq(s);g&&(i[0]=m.call(this,s,r.html())),Nt(r,i,e,n)});if(f&&(o=(s=Pt(i,t[0].ownerDocument,!1,t,n)).firstChild,1===s.childNodes.length&&(s=o),o||n)){for(a=(h=M.map(kt(s,"script"),Gt)).length;l<f;l++)u=s,l!==v&&(u=M.clone(u,!0,!0),a&&M.merge(h,kt(u,"script"))),e.call(t[l],u,l);if(a)for(c=h[h.length-1].ownerDocument,M.map(h,zt),l=0;l<a;l++)u=h[l],Tt.test(u.type||"")&&!st.access(u,"globalEval")&&M.contains(c,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?M.Ft&&!u.noModule&&M.Ft(u.src,{nonce:u.nonce||u.getAttribute("nonce")},c):b(u.textContent.replace(It,""),u,c))}return t}function Vt(t,i,e){for(var n,s=i?M.filter(i,t):t,r=0;null!=(n=s[r]);r++)e||1!==n.nodeType||M.cleanData(kt(n)),n.parentNode&&(e&&dt(n)&&Ct(kt(n,"script")),n.parentNode.removeChild(n));return t}M.extend({htmlPrefilter:function(t){return t},clone:function(t,i,e){var n,s,r,o,h=t.cloneNode(!0),a=dt(t);if(!(d.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||M.isXMLDoc(t)))for(o=kt(h),n=0,s=(r=kt(t)).length;n<s;n++)Lt(r[n],o[n]);if(i)if(e)for(r=r||kt(t),o=o||kt(h),n=0,s=r.length;n<s;n++)Dt(r[n],o[n]);else Dt(t,h);return(o=kt(h,"script")).length>0&&Ct(o,!a&&kt(t,"script")),h},cleanData:function(t){for(var i,e,n,s=M.event.special,r=0;void 0!==(e=t[r]);r++)if(et(e)){if(i=e[st.expando]){if(i.events)for(n in i.events)s[n]?M.event.remove(e,n):M.removeEvent(e,n,i.handle);e[st.expando]=void 0}e[rt.expando]&&(e[rt.expando]=void 0)}}}),M.fn.extend({detach:function(t){return Vt(this,t,!0)},remove:function(t){return Vt(this,t)},text:function(t){return Q(this,function(t){return void 0===t?M.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)})},null,t,arguments.length)},append:function(){return Nt(this,arguments,function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||jt(this,t).appendChild(t)})},prepend:function(){return Nt(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var i=jt(this,t);i.insertBefore(t,i.firstChild)}})},before:function(){return Nt(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return Nt(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,i=0;null!=(t=this[i]);i++)1===t.nodeType&&(M.cleanData(kt(t,!1)),t.textContent="");return this},clone:function(t,i){return t=null!=t&&t,i=null==i?t:i,this.map(function(){return M.clone(this,t,i)})},html:function(t){return Q(this,function(t){var i=this[0]||{},e=0,n=this.length;if(void 0===t&&1===i.nodeType)return i.innerHTML;if("string"==typeof t&&!Ut.test(t)&&!_t[(At.exec(t)||["",""])[1].toLowerCase()]){t=M.htmlPrefilter(t);try{for(;e<n;e++)1===(i=this[e]||{}).nodeType&&(M.cleanData(kt(i,!1)),i.innerHTML=t);i=0}catch(Qv){}}i&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=[];return Nt(this,arguments,function(i){var e=this.parentNode;M.inArray(this,t)<0&&(M.cleanData(kt(this)),e&&e.replaceChild(i,this))},t)}}),M.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,i){M.fn[t]=function(t){for(var e,n=[],s=M(t),r=s.length-1,h=0;h<=r;h++)e=h===r?this:this.clone(!0),M(s[h])[i](e),o.apply(n,e.get());return this.pushStack(n)}});var Wt=new RegExp("^("+ut+")(?!px)[a-z%]+$","i"),Ht=/^--/,qt=function(i){var e=i.ownerDocument.defaultView;return e&&e.opener||(e=t),e.getComputedStyle(i)},Xt=function(t,i,e){var n,s,r={};for(s in i)r[s]=t.style[s],t.style[s]=i[s];for(s in n=e.call(t),i)t.style[s]=r[s];return n},Yt=new RegExp(lt.join("|"),"i");function Kt(t,i,e){var n,s,r,o,h=Ht.test(i),a=t.style;return(e=e||qt(t))&&(o=e.getPropertyValue(i)||e[i],h&&o&&(o=o.replace(P,"$1")||void 0),""!==o||dt(t)||(o=M.style(t,i)),!d.pixelBoxStyles()&&Wt.test(o)&&Yt.test(i)&&(n=a.width,s=a.minWidth,r=a.maxWidth,a.minWidth=a.maxWidth=a.width=o,o=e.width,a.width=n,a.minWidth=s,a.maxWidth=r)),void 0!==o?o+"":o}function Qt(t,i){return{get:function(){if(!t())return(this.get=i).apply(this,arguments);delete this.get}}}!function(){function i(){if(c){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ft.appendChild(u).appendChild(c);var i=t.getComputedStyle(c);n="1%"!==i.top,a=12===e(i.marginLeft),c.style.right="60%",o=36===e(i.right),s=36===e(i.width),c.style.position="absolute",r=12===e(c.offsetWidth/3),ft.removeChild(u),c=null}}function e(t){return Math.round(parseFloat(t))}var n,s,r,o,h,a,u=m.createElement("div"),c=m.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",d.clearCloneStyle="content-box"===c.style.backgroundClip,M.extend(d,{boxSizingReliable:function(){return i(),s},pixelBoxStyles:function(){return i(),o},pixelPosition:function(){return i(),n},reliableMarginLeft:function(){return i(),a},scrollboxSize:function(){return i(),r},reliableTrDimensions:function(){var i,e,n,s;return null==h&&(i=m.createElement("table"),e=m.createElement("tr"),n=m.createElement("div"),i.style.cssText="position:absolute;left:-11111px;border-collapse:separate",e.style.cssText="box-sizing:content-box;border:1px solid",e.style.height="1px",n.style.height="9px",n.style.display="block",ft.appendChild(i).appendChild(e).appendChild(n),s=t.getComputedStyle(e),h=parseInt(s.height,10)+parseInt(s.borderTopWidth,10)+parseInt(s.borderBottomWidth,10)===e.offsetHeight,ft.removeChild(i)),h}}))}();var Zt=["Webkit","Moz","ms"],Jt=m.createElement("div").style,ti={};function ii(t){var i=M.cssProps[t]||ti[t];return i||(t in Jt?t:ti[t]=function(t){for(var i=t[0].toUpperCase()+t.slice(1),e=Zt.length;e--;)if((t=Zt[e]+i)in Jt)return t}(t)||t)}var ei=/^(none|table(?!-c[ea]).+)/,ni={position:"absolute",visibility:"hidden",display:"block"},si={letterSpacing:"0",fontWeight:"400"};function ri(t,i,e){var n=ct.exec(i);return n?Math.max(0,n[2]-(e||0))+(n[3]||"px"):i}function oi(t,i,e,n,s,r){var o="width"===i?1:0,h=0,a=0,u=0;if(e===(n?"border":"content"))return 0;for(;o<4;o+=2)"margin"===e&&(u+=M.css(t,e+lt[o],!0,s)),n?("content"===e&&(a-=M.css(t,"padding"+lt[o],!0,s)),"margin"!==e&&(a-=M.css(t,"border"+lt[o]+"Width",!0,s))):(a+=M.css(t,"padding"+lt[o],!0,s),"padding"!==e?a+=M.css(t,"border"+lt[o]+"Width",!0,s):h+=M.css(t,"border"+lt[o]+"Width",!0,s));return!n&&r>=0&&(a+=Math.max(0,Math.ceil(t["offset"+i[0].toUpperCase()+i.slice(1)]-r-a-h-.5))||0),a+u}function hi(t,i,e){var n=qt(t),s=(!d.boxSizingReliable()||e)&&"border-box"===M.css(t,"boxSizing",!1,n),r=s,o=Kt(t,i,n),h="offset"+i[0].toUpperCase()+i.slice(1);if(Wt.test(o)){if(!e)return o;o="auto"}return(!d.boxSizingReliable()&&s||!d.reliableTrDimensions()&&T(t,"tr")||"auto"===o||!parseFloat(o)&&"inline"===M.css(t,"display",!1,n))&&t.getClientRects().length&&(s="border-box"===M.css(t,"boxSizing",!1,n),(r=h in t)&&(o=t[h])),(o=parseFloat(o)||0)+oi(t,i,e||(s?"border":"content"),r,n,o)+"px"}function ai(t,i,e,n,s){return new ai.prototype.init(t,i,e,n,s)}M.extend({cssHooks:{opacity:{get:function(t,i){if(i){var e=Kt(t,"opacity");return""===e?"1":e}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(t,i,e,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var s,r,o,h=it(i),a=Ht.test(i),u=t.style;if(a||(i=ii(h)),o=M.cssHooks[i]||M.cssHooks[h],void 0===e)return o&&"get"in o&&void 0!==(s=o.get(t,!1,n))?s:u[i];"string"==(r=typeof e)&&(s=ct.exec(e))&&s[1]&&(e=mt(t,i,s),r="number"),null!=e&&e==e&&("number"!==r||a||(e+=s&&s[3]||(M.cssNumber[h]?"":"px")),d.clearCloneStyle||""!==e||0!==i.indexOf("background")||(u[i]="inherit"),o&&"set"in o&&void 0===(e=o.set(t,e,n))||(a?u.setProperty(i,e):u[i]=e))}},css:function(t,i,e,n){var s,r,o,h=it(i);return Ht.test(i)||(i=ii(h)),(o=M.cssHooks[i]||M.cssHooks[h])&&"get"in o&&(s=o.get(t,!0,e)),void 0===s&&(s=Kt(t,i,n)),"normal"===s&&i in si&&(s=si[i]),""===e||e?(r=parseFloat(s),!0===e||isFinite(r)?r||0:s):s}}),M.each(["height","width"],function(t,i){M.cssHooks[i]={get:function(t,e,n){if(e)return!ei.test(M.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?hi(t,i,n):Xt(t,ni,function(){return hi(t,i,n)})},set:function(t,e,n){var s,r=qt(t),o=!d.scrollboxSize()&&"absolute"===r.position,h=(o||n)&&"border-box"===M.css(t,"boxSizing",!1,r),a=n?oi(t,i,n,h,r):0;return h&&o&&(a-=Math.ceil(t["offset"+i[0].toUpperCase()+i.slice(1)]-parseFloat(r[i])-oi(t,i,"border",!1,r)-.5)),a&&(s=ct.exec(e))&&"px"!==(s[3]||"px")&&(t.style[i]=e,e=M.css(t,i)),ri(0,e,a)}}}),M.cssHooks.marginLeft=Qt(d.reliableMarginLeft,function(t,i){if(i)return(parseFloat(Kt(t,"marginLeft"))||t.getBoundingClientRect().left-Xt(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),M.each({margin:"",padding:"",border:"Width"},function(t,i){M.cssHooks[t+i]={expand:function(e){for(var n=0,s={},r="string"==typeof e?e.split(" "):[e];n<4;n++)s[t+lt[n]+i]=r[n]||r[n-2]||r[0];return s}},"margin"!==t&&(M.cssHooks[t+i].set=ri)}),M.fn.extend({css:function(t,i){return Q(this,function(t,i,e){var n,s,r={},o=0;if(Array.isArray(i)){for(n=qt(t),s=i.length;o<s;o++)r[i[o]]=M.css(t,i[o],!1,n);return r}return void 0!==e?M.style(t,i,e):M.css(t,i)},t,i,arguments.length>1)}}),M.Tween=ai,ai.prototype={constructor:ai,init:function(t,i,e,n,s,r){this.elem=t,this.prop=e,this.easing=s||M.easing.Rt,this.options=i,this.start=this.now=this.cur(),this.end=n,this.unit=r||(M.cssNumber[e]?"":"px")},cur:function(){var t=ai.propHooks[this.prop];return t&&t.get?t.get(this):ai.propHooks.Rt.get(this)},run:function(t){var i,e=ai.propHooks[this.prop];return this.options.duration?this.pos=i=M.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=i=t,this.now=(this.end-this.start)*i+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),e&&e.set?e.set(this):ai.propHooks.Rt.set(this),this}},ai.prototype.init.prototype=ai.prototype,ai.propHooks={Rt:{get:function(t){var i;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(i=M.css(t.elem,t.prop,""))&&"auto"!==i?i:0},set:function(t){M.fx.step[t.prop]?M.fx.step[t.prop](t):1!==t.elem.nodeType||!M.cssHooks[t.prop]&&null==t.elem.style[ii(t.prop)]?t.elem[t.prop]=t.now:M.style(t.elem,t.prop,t.now+t.unit)}}},ai.propHooks.scrollTop=ai.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},M.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},Rt:"swing"},M.fx=ai.prototype.init,M.fx.step={};var ui,ci,li=/^(?:toggle|show|hide)$/,fi=/queueHooks$/;function di(){ci&&(!1===m.hidden&&t.requestAnimationFrame?t.requestAnimationFrame(di):t.setTimeout(di,M.fx.interval),M.fx.tick())}function pi(){return t.setTimeout(function(){ui=void 0}),ui=Date.now()}function vi(t,i){var e,n=0,s={height:t};for(i=i?1:0;n<4;n+=2-i)s["margin"+(e=lt[n])]=s["padding"+e]=t;return i&&(s.opacity=s.width=t),s}function mi(t,i,e){for(var n,s=(gi.tweeners[i]||[]).concat(gi.tweeners["*"]),r=0,o=s.length;r<o;r++)if(n=s[r].call(e,i,t))return n}function gi(t,i,e){var n,s,r=0,o=gi.prefilters.length,h=M.Deferred().always(function(){delete a.elem}),a=function(){if(s)return!1;for(var i=ui||pi(),e=Math.max(0,u.startTime+u.duration-i),n=1-(e/u.duration||0),r=0,o=u.tweens.length;r<o;r++)u.tweens[r].run(n);return h.notifyWith(t,[u,n,e]),n<1&&o?e:(o||h.notifyWith(t,[u,1,0]),h.resolveWith(t,[u]),!1)},u=h.promise({elem:t,props:M.extend({},i),opts:M.extend(!0,{specialEasing:{},easing:M.easing.Rt},e),originalProperties:i,originalOptions:e,startTime:ui||pi(),duration:e.duration,tweens:[],createTween:function(i,e){var n=M.Tween(t,u.opts,i,e,u.opts.specialEasing[i]||u.opts.easing);return u.tweens.push(n),n},stop:function(i){var e=0,n=i?u.tweens.length:0;if(s)return this;for(s=!0;e<n;e++)u.tweens[e].run(1);return i?(h.notifyWith(t,[u,1,0]),h.resolveWith(t,[u,i])):h.rejectWith(t,[u,i]),this}}),c=u.props;for(function(t,i){var e,n,s,r,o;for(e in t)if(s=i[n=it(e)],r=t[e],Array.isArray(r)&&(s=r[1],r=t[e]=r[0]),e!==n&&(t[n]=r,delete t[e]),(o=M.cssHooks[n])&&"expand"in o)for(e in r=o.expand(r),delete t[n],r)e in t||(t[e]=r[e],i[e]=s);else i[n]=s}(c,u.opts.specialEasing);r<o;r++)if(n=gi.prefilters[r].call(u,t,c,u.opts))return p(n.stop)&&(M.Et(u.elem,u.opts.queue).stop=n.stop.bind(n)),n;return M.map(c,mi,u),p(u.opts.start)&&u.opts.start.call(t,u),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always),M.fx.timer(M.extend(a,{elem:t,anim:u,queue:u.opts.queue})),u}M.Animation=M.extend(gi,{tweeners:{"*":[function(t,i){var e=this.createTween(t,i);return mt(e.elem,t,ct.exec(i),e),e}]},tweener:function(t,i){p(t)?(i=t,t=["*"]):t=t.match(V);for(var e,n=0,s=t.length;n<s;n++)e=t[n],gi.tweeners[e]=gi.tweeners[e]||[],gi.tweeners[e].unshift(i)},prefilters:[function(t,i,e){var n,s,r,o,h,a,u,c,l="width"in i||"height"in i,f=this,d={},p=t.style,v=t.nodeType&&vt(t),m=st.get(t,"fxshow");for(n in e.queue||(null==(o=M.Et(t,"fx")).unqueued&&(o.unqueued=0,h=o.empty.fire,o.empty.fire=function(){o.unqueued||h()}),o.unqueued++,f.always(function(){f.always(function(){o.unqueued--,M.queue(t,"fx").length||o.empty.fire()})})),i)if(s=i[n],li.test(s)){if(delete i[n],r=r||"toggle"===s,s===(v?"hide":"show")){if("show"!==s||!m||void 0===m[n])continue;v=!0}d[n]=m&&m[n]||M.style(t,n)}if((a=!M.isEmptyObject(i))||!M.isEmptyObject(d))for(n in l&&1===t.nodeType&&(e.overflow=[p.overflow,p.overflowX,p.overflowY],null==(u=m&&m.display)&&(u=st.get(t,"display")),"none"===(c=M.css(t,"display"))&&(u?c=u:(yt([t],!0),u=t.style.display||u,c=M.css(t,"display"),yt([t]))),("inline"===c||"inline-block"===c&&null!=u)&&"none"===M.css(t,"float")&&(a||(f.done(function(){p.display=u}),null==u&&(c=p.display,u="none"===c?"":c)),p.display="inline-block")),e.overflow&&(p.overflow="hidden",f.always(function(){p.overflow=e.overflow[0],p.overflowX=e.overflow[1],p.overflowY=e.overflow[2]})),a=!1,d)a||(m?"hidden"in m&&(v=m.hidden):m=st.access(t,"fxshow",{display:u}),r&&(m.hidden=!v),v&&yt([t],!0),f.done(function(){for(n in v||yt([t]),st.remove(t,"fxshow"),d)M.style(t,n,d[n])})),a=mi(v?m[n]:0,n,f),n in m||(m[n]=a.start,v&&(a.end=a.start,a.start=0))}],prefilter:function(t,i){i?gi.prefilters.unshift(t):gi.prefilters.push(t)}}),M.speed=function(t,i,e){var n=t&&"object"==typeof t?M.extend({},t):{complete:e||!e&&i||p(t)&&t,duration:t,easing:e&&i||i&&!p(i)&&i};return M.fx.off?n.duration=0:"number"!=typeof n.duration&&(n.duration in M.fx.speeds?n.duration=M.fx.speeds[n.duration]:n.duration=M.fx.speeds.Rt),null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){p(n.old)&&n.old.call(this),n.queue&&M.dequeue(this,n.queue)},n},M.fn.extend({fadeTo:function(t,i,e,n){return this.filter(vt).css("opacity",0).show().end().animate({opacity:i},t,e,n)},animate:function(t,i,e,n){var s=M.isEmptyObject(t),r=M.speed(i,e,n),o=function(){var i=gi(this,M.extend({},t),r);(s||st.get(this,"finish"))&&i.stop(!0)};return o.finish=o,s||!1===r.queue?this.each(o):this.queue(r.queue,o)},stop:function(t,i,e){var n=function(t){var i=t.stop;delete t.stop,i(e)};return"string"!=typeof t&&(e=i,i=t,t=void 0),i&&this.queue(t||"fx",[]),this.each(function(){var i=!0,s=null!=t&&t+"queueHooks",r=M.timers,o=st.get(this);if(s)o[s]&&o[s].stop&&n(o[s]);else for(s in o)o[s]&&o[s].stop&&fi.test(s)&&n(o[s]);for(s=r.length;s--;)r[s].elem!==this||null!=t&&r[s].queue!==t||(r[s].anim.stop(e),i=!1,r.splice(s,1));!i&&e||M.dequeue(this,t)})},finish:function(t){return!1!==t&&(t=t||"fx"),this.each(function(){var i,e=st.get(this),n=e[t+"queue"],s=e[t+"queueHooks"],r=M.timers,o=n?n.length:0;for(e.finish=!0,M.queue(this,t,[]),s&&s.stop&&s.stop.call(this,!0),i=r.length;i--;)r[i].elem===this&&r[i].queue===t&&(r[i].anim.stop(!0),r.splice(i,1));for(i=0;i<o;i++)n[i]&&n[i].finish&&n[i].finish.call(this);delete e.finish})}}),M.each(["toggle","show","hide"],function(t,i){var e=M.fn[i];M.fn[i]=function(t,n,s){return null==t||"boolean"==typeof t?e.apply(this,arguments):this.animate(vi(i,!0),t,n,s)}}),M.each({slideDown:vi("show"),slideUp:vi("hide"),slideToggle:vi("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,i){M.fn[t]=function(t,e,n){return this.animate(i,t,e,n)}}),M.timers=[],M.fx.tick=function(){var t,i=0,e=M.timers;for(ui=Date.now();i<e.length;i++)(t=e[i])()||e[i]!==t||e.splice(i--,1);e.length||M.fx.stop(),ui=void 0},M.fx.timer=function(t){M.timers.push(t),M.fx.start()},M.fx.interval=13,M.fx.start=function(){ci||(ci=!0,di())},M.fx.stop=function(){ci=null},M.fx.speeds={slow:600,fast:200,Rt:400},M.fn.delay=function(i,e){return i=M.fx&&M.fx.speeds[i]||i,e=e||"fx",this.queue(e,function(e,n){var s=t.setTimeout(e,i);n.stop=function(){t.clearTimeout(s)}})},function(){var t=m.createElement("input"),i=m.createElement("select").appendChild(m.createElement("option"));t.type="checkbox",d.checkOn=""!==t.value,d.optSelected=i.selected,(t=m.createElement("input")).value="t",t.type="radio",d.radioValue="t"===t.value}();var bi,yi=M.expr.attrHandle;M.fn.extend({attr:function(t,i){return Q(this,M.attr,t,i,arguments.length>1)},removeAttr:function(t){return this.each(function(){M.removeAttr(this,t)})}}),M.extend({attr:function(t,i,e){var n,s,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return void 0===t.getAttribute?M.prop(t,i,e):(1===r&&M.isXMLDoc(t)||(s=M.attrHooks[i.toLowerCase()]||(M.expr.match.bool.test(i)?bi:void 0)),void 0!==e?null===e?void M.removeAttr(t,i):s&&"set"in s&&void 0!==(n=s.set(t,e,i))?n:(t.setAttribute(i,e+""),e):s&&"get"in s&&null!==(n=s.get(t,i))?n:null==(n=M.find.attr(t,i))?void 0:n)},attrHooks:{type:{set:function(t,i){if(!d.radioValue&&"radio"===i&&T(t,"input")){var e=t.value;return t.setAttribute("type",i),e&&(t.value=e),i}}}},removeAttr:function(t,i){var e,n=0,s=i&&i.match(V);if(s&&1===t.nodeType)for(;e=s[n++];)t.removeAttribute(e)}}),bi={set:function(t,i,e){return!1===i?M.removeAttr(t,e):t.setAttribute(e,e),e}},M.each(M.expr.match.bool.source.match(/\w+/g),function(t,i){var e=yi[i]||M.find.attr;yi[i]=function(t,i,n){var s,r,o=i.toLowerCase();return n||(r=yi[o],yi[o]=s,s=null!=e(t,i,n)?o:null,yi[o]=r),s}});var xi=/^(?:input|select|textarea|button)$/i,wi=/^(?:a|area)$/i;function Mi(t){return(t.match(V)||[]).join(" ")}function Ai(t){return t.getAttribute&&t.getAttribute("class")||""}function Ti(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(V)||[]}M.fn.extend({prop:function(t,i){return Q(this,M.prop,t,i,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[M.propFix[t]||t]})}}),M.extend({prop:function(t,i,e){var n,s,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return 1===r&&M.isXMLDoc(t)||(i=M.propFix[i]||i,s=M.propHooks[i]),void 0!==e?s&&"set"in s&&void 0!==(n=s.set(t,e,i))?n:t[i]=e:s&&"get"in s&&null!==(n=s.get(t,i))?n:t[i]},propHooks:{tabIndex:{get:function(t){var i=M.find.attr(t,"tabindex");return i?parseInt(i,10):xi.test(t.nodeName)||wi.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),d.optSelected||(M.propHooks.selected={get:function(t){var i=t.parentNode;return i&&i.parentNode&&i.parentNode.selectedIndex,null},set:function(t){var i=t.parentNode;i&&(i.selectedIndex,i.parentNode&&i.parentNode.selectedIndex)}}),M.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){M.propFix[this.toLowerCase()]=this}),M.fn.extend({addClass:function(t){var i,e,n,s,r,o;return p(t)?this.each(function(i){M(this).addClass(t.call(this,i,Ai(this)))}):(i=Ti(t)).length?this.each(function(){if(n=Ai(this),e=1===this.nodeType&&" "+Mi(n)+" "){for(r=0;r<i.length;r++)s=i[r],e.indexOf(" "+s+" ")<0&&(e+=s+" ");o=Mi(e),n!==o&&this.setAttribute("class",o)}}):this},removeClass:function(t){var i,e,n,s,r,o;return p(t)?this.each(function(i){M(this).removeClass(t.call(this,i,Ai(this)))}):arguments.length?(i=Ti(t)).length?this.each(function(){if(n=Ai(this),e=1===this.nodeType&&" "+Mi(n)+" "){for(r=0;r<i.length;r++)for(s=i[r];e.indexOf(" "+s+" ")>-1;)e=e.replace(" "+s+" "," ");o=Mi(e),n!==o&&this.setAttribute("class",o)}}):this:this.attr("class","")},toggleClass:function(t,i){var e,n,s,r,o=typeof t,h="string"===o||Array.isArray(t);return p(t)?this.each(function(e){M(this).toggleClass(t.call(this,e,Ai(this),i),i)}):"boolean"==typeof i&&h?i?this.addClass(t):this.removeClass(t):(e=Ti(t),this.each(function(){if(h)for(r=M(this),s=0;s<e.length;s++)n=e[s],r.hasClass(n)?r.removeClass(n):r.addClass(n);else void 0!==t&&"boolean"!==o||((n=Ai(this))&&st.set(this,"__className__",n),this.setAttribute&&this.setAttribute("class",n||!1===t?"":st.get(this,"__className__")||""))}))},hasClass:function(t){var i,e,n=0;for(i=" "+t+" ";e=this[n++];)if(1===e.nodeType&&(" "+Mi(Ai(e))+" ").indexOf(i)>-1)return!0;return!1}});var _i=/\r/g;M.fn.extend({val:function(t){var i,e,n,s=this[0];return arguments.length?(n=p(t),this.each(function(e){var s;1===this.nodeType&&(null==(s=n?t.call(this,e,M(this).val()):t)?s="":"number"==typeof s?s+="":Array.isArray(s)&&(s=M.map(s,function(t){return null==t?"":t+""})),(i=M.valHooks[this.type]||M.valHooks[this.nodeName.toLowerCase()])&&"set"in i&&void 0!==i.set(this,s,"value")||(this.value=s))})):s?(i=M.valHooks[s.type]||M.valHooks[s.nodeName.toLowerCase()])&&"get"in i&&void 0!==(e=i.get(s,"value"))?e:"string"==typeof(e=s.value)?e.replace(_i,""):null==e?"":e:void 0}}),M.extend({valHooks:{option:{get:function(t){var i=M.find.attr(t,"value");return null!=i?i:Mi(M.text(t))}},select:{get:function(t){var i,e,n,s=t.options,r=t.selectedIndex,o="select-one"===t.type,h=o?null:[],a=o?r+1:s.length;for(n=r<0?a:o?r:0;n<a;n++)if(((e=s[n]).selected||n===r)&&!e.disabled&&(!e.parentNode.disabled||!T(e.parentNode,"optgroup"))){if(i=M(e).val(),o)return i;h.push(i)}return h},set:function(t,i){for(var e,n,s=t.options,r=M.makeArray(i),o=s.length;o--;)((n=s[o]).selected=M.inArray(M.valHooks.option.get(n),r)>-1)&&(e=!0);return e||(t.selectedIndex=-1),r}}}}),M.each(["radio","checkbox"],function(){M.valHooks[this]={set:function(t,i){if(Array.isArray(i))return t.checked=M.inArray(M(t).val(),i)>-1}},d.checkOn||(M.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var ki=t.location,Ci={guid:Date.now()},Si=/\?/;M.parseXML=function(i){var e,n;if(!i||"string"!=typeof i)return null;try{e=(new t.DOMParser).parseFromString(i,"text/xml")}catch(Qv){}return n=e&&e.getElementsByTagName("parsererror")[0],e&&!n||M.error("Invalid XML: "+(n?M.map(n.childNodes,function(t){return t.textContent}).join("\n"):i)),e};var Pi=/^(?:focusinfocus|focusoutblur)$/,Ei=function(t){t.stopPropagation()};M.extend(M.event,{trigger:function(i,e,n,s){var r,o,h,a,u,l,f,d,g=[n||m],b=c.call(i,"type")?i.type:i,y=c.call(i,"namespace")?i.namespace.split("."):[];if(o=d=h=n=n||m,3!==n.nodeType&&8!==n.nodeType&&!Pi.test(b+M.event.triggered)&&(b.indexOf(".")>-1&&(y=b.split("."),b=y.shift(),y.sort()),u=b.indexOf(":")<0&&"on"+b,(i=i[M.expando]?i:new M.Event(b,"object"==typeof i&&i)).isTrigger=s?2:3,i.namespace=y.join("."),i.rnamespace=i.namespace?new RegExp("(^|\\.)"+y.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,i.result=void 0,i.target||(i.target=n),e=null==e?[i]:M.makeArray(e,[i]),f=M.event.special[b]||{},s||!f.trigger||!1!==f.trigger.apply(n,e))){if(!s&&!f.noBubble&&!v(n)){for(a=f.delegateType||b,Pi.test(a+b)||(o=o.parentNode);o;o=o.parentNode)g.push(o),h=o;h===(n.ownerDocument||m)&&g.push(h.defaultView||h.parentWindow||t)}for(r=0;(o=g[r++])&&!i.isPropagationStopped();)d=o,i.type=r>1?a:f.bindType||b,(l=(st.get(o,"events")||Object.create(null))[i.type]&&st.get(o,"handle"))&&l.apply(o,e),(l=u&&o[u])&&l.apply&&et(o)&&(i.result=l.apply(o,e),!1===i.result&&i.preventDefault());return i.type=b,s||i.isDefaultPrevented()||f.Rt&&!1!==f.Rt.apply(g.pop(),e)||!et(n)||u&&p(n[b])&&!v(n)&&((h=n[u])&&(n[u]=null),M.event.triggered=b,i.isPropagationStopped()&&d.addEventListener(b,Ei),n[b](),i.isPropagationStopped()&&d.removeEventListener(b,Ei),M.event.triggered=void 0,h&&(n[u]=h)),i.result}},simulate:function(t,i,e){var n=M.extend(new M.Event,e,{type:t,isSimulated:!0});M.event.trigger(n,null,i)}}),M.fn.extend({trigger:function(t,i){return this.each(function(){M.event.trigger(t,i,this)})},triggerHandler:function(t,i){var e=this[0];if(e)return M.event.trigger(t,i,e,!0)}});var Ri=/\[\]$/,Fi=/\r?\n/g,Oi=/^(?:submit|button|image|reset|file)$/i,$i=/^(?:input|select|textarea|keygen)/i;function Ui(t,i,e,n){var s;if(Array.isArray(i))M.each(i,function(i,s){e||Ri.test(t)?n(t,s):Ui(t+"["+("object"==typeof s&&null!=s?i:"")+"]",s,e,n)});else if(e||"object"!==y(i))n(t,i);else for(s in i)Ui(t+"["+s+"]",i[s],e,n)}M.param=function(t,i){var e,n=[],s=function(t,i){var e=p(i)?i():i;n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==e?"":e)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!M.isPlainObject(t))M.each(t,function(){s(this.name,this.value)});else for(e in t)Ui(e,t[e],i,s);return n.join("&")},M.fn.extend({serialize:function(){return M.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=M.prop(this,"elements");return t?M.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!M(this).is(":disabled")&&$i.test(this.nodeName)&&!Oi.test(t)&&(this.checked||!Mt.test(t))}).map(function(t,i){var e=M(this).val();return null==e?null:Array.isArray(e)?M.map(e,function(t){return{name:i.name,value:t.replace(Fi,"\r\n")}}):{name:i.name,value:e.replace(Fi,"\r\n")}}).get()}});var Bi=/%20/g,Ii=/#.*$/,ji=/([?&])_=[^&]*/,Gi=/^(.*?):[ \t]*([^\r\n]*)$/gm,zi=/^(?:GET|HEAD)$/,Di=/^\/\//,Li={},Ni={},Vi="*/".concat("*"),Wi=m.createElement("a");function Hi(t){return function(i,e){"string"!=typeof i&&(e=i,i="*");var n,s=0,r=i.toLowerCase().match(V)||[];if(p(e))for(;n=r[s++];)"+"===n[0]?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(e)):(t[n]=t[n]||[]).push(e)}}function qi(t,i,e,n){var s={},r=t===Ni;function o(h){var a;return s[h]=!0,M.each(t[h]||[],function(t,h){var u=h(i,e,n);return"string"!=typeof u||r||s[u]?r?!(a=u):void 0:(i.dataTypes.unshift(u),o(u),!1)}),a}return o(i.dataTypes[0])||!s["*"]&&o("*")}function Xi(t,i){var e,n,s=M.ajaxSettings.flatOptions||{};for(e in i)void 0!==i[e]&&((s[e]?t:n||(n={}))[e]=i[e]);return n&&M.extend(!0,t,n),t}Wi.href=ki.href,M.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ki.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(ki.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Vi,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":M.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,i){return i?Xi(Xi(t,M.ajaxSettings),i):Xi(M.ajaxSettings,t)},ajaxPrefilter:Hi(Li),ajaxTransport:Hi(Ni),ajax:function(i,e){"object"==typeof i&&(e=i,i=void 0),e=e||{};var n,s,r,o,h,a,u,c,l,f,d=M.ajaxSetup({},e),p=d.context||d,v=d.context&&(p.nodeType||p.jquery)?M(p):M.event,g=M.Deferred(),b=M.Callbacks("once memory"),y=d.statusCode||{},x={},w={},A="canceled",T={readyState:0,getResponseHeader:function(t){var i;if(u){if(!o)for(o={};i=Gi.exec(r);)o[i[1].toLowerCase()+" "]=(o[i[1].toLowerCase()+" "]||[]).concat(i[2]);i=o[t.toLowerCase()+" "]}return null==i?null:i.join(", ")},getAllResponseHeaders:function(){return u?r:null},setRequestHeader:function(t,i){return null==u&&(t=w[t.toLowerCase()]=w[t.toLowerCase()]||t,x[t]=i),this},overrideMimeType:function(t){return null==u&&(d.mimeType=t),this},statusCode:function(t){var i;if(t)if(u)T.always(t[T.status]);else for(i in t)y[i]=[y[i],t[i]];return this},abort:function(t){var i=t||A;return n&&n.abort(i),_(0,i),this}};if(g.promise(T),d.url=((i||d.url||ki.href)+"").replace(Di,ki.protocol+"//"),d.type=e.method||e.type||d.method||d.type,d.dataTypes=(d.dataType||"*").toLowerCase().match(V)||[""],null==d.crossDomain){a=m.createElement("a");try{a.href=d.url,a.href=a.href,d.crossDomain=Wi.protocol+"//"+Wi.host!=a.protocol+"//"+a.host}catch(Qv){d.crossDomain=!0}}if(d.data&&d.processData&&"string"!=typeof d.data&&(d.data=M.param(d.data,d.traditional)),qi(Li,d,e,T),u)return T;for(l in(c=M.event&&d.global)&&0===M.active++&&M.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!zi.test(d.type),s=d.url.replace(Ii,""),d.hasContent?d.data&&d.processData&&0===(d.contentType||"").indexOf("application/x-www-form-urlencoded")&&(d.data=d.data.replace(Bi,"+")):(f=d.url.slice(s.length),d.data&&(d.processData||"string"==typeof d.data)&&(s+=(Si.test(s)?"&":"?")+d.data,delete d.data),!1===d.cache&&(s=s.replace(ji,"$1"),f=(Si.test(s)?"&":"?")+"_="+Ci.guid+++f),d.url=s+f),d.ifModified&&(M.lastModified[s]&&T.setRequestHeader("If-Modified-Since",M.lastModified[s]),M.etag[s]&&T.setRequestHeader("If-None-Match",M.etag[s])),(d.data&&d.hasContent&&!1!==d.contentType||e.contentType)&&T.setRequestHeader("Content-Type",d.contentType),T.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Vi+"; q=0.01":""):d.accepts["*"]),d.headers)T.setRequestHeader(l,d.headers[l]);if(d.beforeSend&&(!1===d.beforeSend.call(p,T,d)||u))return T.abort();if(A="abort",b.add(d.complete),T.done(d.success),T.fail(d.error),n=qi(Ni,d,e,T)){if(T.readyState=1,c&&v.trigger("ajaxSend",[T,d]),u)return T;d.async&&d.timeout>0&&(h=t.setTimeout(function(){T.abort("timeout")},d.timeout));try{u=!1,n.send(x,_)}catch(Qv){if(u)throw Qv;_(-1,Qv)}}else _(-1,"No Transport");function _(i,e,o,a){var l,f,m,x,w,A=e;u||(u=!0,h&&t.clearTimeout(h),n=void 0,r=a||"",T.readyState=i>0?4:0,l=i>=200&&i<300||304===i,o&&(x=function(t,i,e){for(var n,s,r,o,h=t.contents,a=t.dataTypes;"*"===a[0];)a.shift(),void 0===n&&(n=t.mimeType||i.getResponseHeader("Content-Type"));if(n)for(s in h)if(h[s]&&h[s].test(n)){a.unshift(s);break}if(a[0]in e)r=a[0];else{for(s in e){if(!a[0]||t.converters[s+" "+a[0]]){r=s;break}o||(o=s)}r=r||o}if(r)return r!==a[0]&&a.unshift(r),e[r]}(d,T,o)),!l&&M.inArray("script",d.dataTypes)>-1&&M.inArray("json",d.dataTypes)<0&&(d.converters["text script"]=function(){}),x=function(t,i,e,n){var s,r,o,h,a,u={},c=t.dataTypes.slice();if(c[1])for(o in t.converters)u[o.toLowerCase()]=t.converters[o];for(r=c.shift();r;)if(t.responseFields[r]&&(e[t.responseFields[r]]=i),!a&&n&&t.dataFilter&&(i=t.dataFilter(i,t.dataType)),a=r,r=c.shift())if("*"===r)r=a;else if("*"!==a&&a!==r){if(!(o=u[a+" "+r]||u["* "+r]))for(s in u)if((h=s.split(" "))[1]===r&&(o=u[a+" "+h[0]]||u["* "+h[0]])){!0===o?o=u[s]:!0!==u[s]&&(r=h[0],c.unshift(h[1]));break}if(!0!==o)if(o&&t.throws)i=o(i);else try{i=o(i)}catch(Qv){return{state:"parsererror",error:o?Qv:"No conversion from "+a+" to "+r}}}return{state:"success",data:i}}(d,x,T,l),l?(d.ifModified&&((w=T.getResponseHeader("Last-Modified"))&&(M.lastModified[s]=w),(w=T.getResponseHeader("etag"))&&(M.etag[s]=w)),204===i||"HEAD"===d.type?A="nocontent":304===i?A="notmodified":(A=x.state,f=x.data,l=!(m=x.error))):(m=A,!i&&A||(A="error",i<0&&(i=0))),T.status=i,T.statusText=(e||A)+"",l?g.resolveWith(p,[f,A,T]):g.rejectWith(p,[T,A,m]),T.statusCode(y),y=void 0,c&&v.trigger(l?"ajaxSuccess":"ajaxError",[T,d,l?f:m]),b.fireWith(p,[T,A]),c&&(v.trigger("ajaxComplete",[T,d]),--M.active||M.event.trigger("ajaxStop")))}return T},getJSON:function(t,i,e){return M.get(t,i,e,"json")},getScript:function(t,i){return M.get(t,void 0,i,"script")}}),M.each(["get","post"],function(t,i){M[i]=function(t,e,n,s){return p(e)&&(s=s||n,n=e,e=void 0),M.ajax(M.extend({url:t,type:i,dataType:s,data:e,success:n},M.isPlainObject(t)&&t))}}),M.ajaxPrefilter(function(t){var i;for(i in t.headers)"content-type"===i.toLowerCase()&&(t.contentType=t.headers[i]||"")}),M.Ft=function(t,i,e){return M.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){M.globalEval(t,i,e)}})},M.fn.extend({wrapAll:function(t){var i;return this[0]&&(p(t)&&(t=t.call(this[0])),i=M(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&i.insertBefore(this[0]),i.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this},wrapInner:function(t){return p(t)?this.each(function(i){M(this).wrapInner(t.call(this,i))}):this.each(function(){var i=M(this),e=i.contents();e.length?e.wrapAll(t):i.append(t)})},wrap:function(t){var i=p(t);return this.each(function(e){M(this).wrapAll(i?t.call(this,e):t)})},unwrap:function(t){return this.parent(t).not("body").each(function(){M(this).replaceWith(this.childNodes)}),this}}),M.expr.pseudos.hidden=function(t){return!M.expr.pseudos.visible(t)},M.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},M.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(Qv){}};var Yi={0:200,1223:204},Ki=M.ajaxSettings.xhr();d.cors=!!Ki&&"withCredentials"in Ki,d.ajax=Ki=!!Ki,M.ajaxTransport(function(i){var e,n;if(d.cors||Ki&&!i.crossDomain)return{send:function(s,r){var o,h=i.xhr();if(h.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(o in i.xhrFields)h[o]=i.xhrFields[o];for(o in i.mimeType&&h.overrideMimeType&&h.overrideMimeType(i.mimeType),i.crossDomain||s["X-Requested-With"]||(s["X-Requested-With"]="XMLHttpRequest"),s)h.setRequestHeader(o,s[o]);e=function(t){return function(){e&&(e=n=h.onload=h.onerror=h.onabort=h.ontimeout=h.onreadystatechange=null,"abort"===t?h.abort():"error"===t?"number"!=typeof h.status?r(0,"error"):r(h.status,h.statusText):r(Yi[h.status]||h.status,h.statusText,"text"!==(h.responseType||"text")||"string"!=typeof h.responseText?{binary:h.response}:{text:h.responseText},h.getAllResponseHeaders()))}},h.onload=e(),n=h.onerror=h.ontimeout=e("error"),void 0!==h.onabort?h.onabort=n:h.onreadystatechange=function(){4===h.readyState&&t.setTimeout(function(){e&&n()})},e=e("abort");try{h.send(i.hasContent&&i.data||null)}catch(Qv){if(e)throw Qv}},abort:function(){e&&e()}}}),M.ajaxPrefilter(function(t){t.crossDomain&&(t.contents.script=!1)}),M.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return M.globalEval(t),t}}}),M.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),M.ajaxTransport("script",function(t){var i,e;if(t.crossDomain||t.scriptAttrs)return{send:function(n,s){i=M("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",e=function(t){i.remove(),e=null,t&&s("error"===t.type?404:200,t.type)}),m.head.appendChild(i[0])},abort:function(){e&&e()}}});var Qi,Zi=[],Ji=/(=)\?(?=&|$)|\?\?/;M.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Zi.pop()||M.expando+"_"+Ci.guid++;return this[t]=!0,t}}),M.ajaxPrefilter("json jsonp",function(i,e,n){var s,r,o,h=!1!==i.jsonp&&(Ji.test(i.url)?"url":"string"==typeof i.data&&0===(i.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ji.test(i.data)&&"data");if(h||"jsonp"===i.dataTypes[0])return s=i.jsonpCallback=p(i.jsonpCallback)?i.jsonpCallback():i.jsonpCallback,h?i[h]=i[h].replace(Ji,"$1"+s):!1!==i.jsonp&&(i.url+=(Si.test(i.url)?"&":"?")+i.jsonp+"="+s),i.converters["script json"]=function(){return o||M.error(s+" was not called"),o[0]},i.dataTypes[0]="json",r=t[s],t[s]=function(){o=arguments},n.always(function(){void 0===r?M(t).removeProp(s):t[s]=r,i[s]&&(i.jsonpCallback=e.jsonpCallback,Zi.push(s)),o&&p(r)&&r(o[0]),o=r=void 0}),"script"}),d.createHTMLDocument=((Qi=m.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Qi.childNodes.length),M.parseHTML=function(t,i,e){return"string"!=typeof t?[]:("boolean"==typeof i&&(e=i,i=!1),i||(d.createHTMLDocument?((n=(i=m.implementation.createHTMLDocument("")).createElement("base")).href=m.location.href,i.head.appendChild(n)):i=m),r=!e&&[],(s=I.exec(t))?[i.createElement(s[1])]:(s=Pt([t],i,r),r&&r.length&&M(r).remove(),M.merge([],s.childNodes)));var n,s,r},M.fn.load=function(t,i,e){var n,s,r,o=this,h=t.indexOf(" ");return h>-1&&(n=Mi(t.slice(h)),t=t.slice(0,h)),p(i)?(e=i,i=void 0):i&&"object"==typeof i&&(s="POST"),o.length>0&&M.ajax({url:t,type:s||"GET",dataType:"html",data:i}).done(function(t){r=arguments,o.html(n?M("<div>").append(M.parseHTML(t)).find(n):t)}).always(e&&function(t,i){o.each(function(){e.apply(this,r||[t.responseText,i,t])})}),this},M.expr.pseudos.animated=function(t){return M.grep(M.timers,function(i){return t===i.elem}).length},M.offset={setOffset:function(t,i,e){var n,s,r,o,h,a,u=M.css(t,"position"),c=M(t),l={};"static"===u&&(t.style.position="relative"),h=c.offset(),r=M.css(t,"top"),a=M.css(t,"left"),("absolute"===u||"fixed"===u)&&(r+a).indexOf("auto")>-1?(o=(n=c.position()).top,s=n.left):(o=parseFloat(r)||0,s=parseFloat(a)||0),p(i)&&(i=i.call(t,e,M.extend({},h))),null!=i.top&&(l.top=i.top-h.top+o),null!=i.left&&(l.left=i.left-h.left+s),"using"in i?i.using.call(t,l):c.css(l)}},M.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(i){M.offset.setOffset(this,t,i)});var i,e,n=this[0];return n?n.getClientRects().length?(i=n.getBoundingClientRect(),e=n.ownerDocument.defaultView,{top:i.top+e.pageYOffset,left:i.left+e.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,i,e,n=this[0],s={top:0,left:0};if("fixed"===M.css(n,"position"))i=n.getBoundingClientRect();else{for(i=this.offset(),e=n.ownerDocument,t=n.offsetParent||e.documentElement;t&&(t===e.body||t===e.documentElement)&&"static"===M.css(t,"position");)t=t.parentNode;t&&t!==n&&1===t.nodeType&&((s=M(t).offset()).top+=M.css(t,"borderTopWidth",!0),s.left+=M.css(t,"borderLeftWidth",!0))}return{top:i.top-s.top-M.css(n,"marginTop",!0),left:i.left-s.left-M.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&"static"===M.css(t,"position");)t=t.offsetParent;return t||ft})}}),M.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var e="pageYOffset"===i;M.fn[t]=function(n){return Q(this,function(t,n,s){var r;if(v(t)?r=t:9===t.nodeType&&(r=t.defaultView),void 0===s)return r?r[i]:t[n];r?r.scrollTo(e?r.pageXOffset:s,e?s:r.pageYOffset):t[n]=s},t,n,arguments.length)}}),M.each(["top","left"],function(t,i){M.cssHooks[i]=Qt(d.pixelPosition,function(t,e){if(e)return e=Kt(t,i),Wt.test(e)?M(t).position()[i]+"px":e})}),M.each({Height:"height",Width:"width"},function(t,i){M.each({padding:"inner"+t,content:i,"":"outer"+t},function(e,n){M.fn[n]=function(s,r){var o=arguments.length&&(e||"boolean"!=typeof s),h=e||(!0===s||!0===r?"margin":"border");return Q(this,function(i,e,s){var r;return v(i)?0===n.indexOf("outer")?i["inner"+t]:i.document.documentElement["client"+t]:9===i.nodeType?(r=i.documentElement,Math.max(i.body["scroll"+t],r["scroll"+t],i.body["offset"+t],r["offset"+t],r["client"+t])):void 0===s?M.css(i,e,h):M.style(i,e,s,h)},i,o?s:void 0,o)}})}),M.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,i){M.fn[i]=function(t){return this.on(i,t)}}),M.fn.extend({bind:function(t,i,e){return this.on(t,null,i,e)},unbind:function(t,i){return this.off(t,null,i)},delegate:function(t,i,e,n){return this.on(i,t,e,n)},undelegate:function(t,i,e){return 1===arguments.length?this.off(t,"**"):this.off(i,t||"**",e)},hover:function(t,i){return this.on("mouseenter",t).on("mouseleave",i||t)}}),M.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(t,i){M.fn[i]=function(t,e){return arguments.length>0?this.on(i,null,t,e):this.trigger(i)}});var te=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;M.proxy=function(t,i){var e,n,r;if("string"==typeof i&&(e=t[i],i=t,t=e),p(t))return n=s.call(arguments,2),r=function(){return t.apply(i||this,n.concat(s.call(arguments)))},r.guid=t.guid=t.guid||M.guid++,r},M.holdReady=function(t){t?M.readyWait++:M.ready(!0)},M.isArray=Array.isArray,M.parseJSON=JSON.parse,M.nodeName=T,M.isFunction=p,M.isWindow=v,M.camelCase=it,M.type=y,M.now=Date.now,M.isNumeric=function(t){var i=M.type(t);return("number"===i||"string"===i)&&!isNaN(t-parseFloat(t))},M.trim=function(t){return null==t?"":(t+"").replace(te,"$1")};var ie=t.jQuery,ee=t.$;return M.noConflict=function(i){return t.$===M&&(t.$=ee),i&&t.jQuery===M&&(t.jQuery=ie),M},void 0===i&&(t.jQuery=t.$=M),M};const Ri=e(Ei.exports=Si.document?Pi(Si,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return Pi(t)}),Fi="modelSelector";function Oi(i,e,n,s,r){Ri("#buttons").show(),Ri("#Import").removeClass("disabled"),Ri("#Reset").removeClass("disabled"),Ri("#Start").removeClass("disabled"),Ri("#Stop").addClass("disabled"),Ri("#Export").addClass("disabled");const o=Ri("#Import").off("click").on("click",()=>{o.hasClass("disabled")||(r(),o.addClass("disabled"),h.addClass("disabled"),a.removeClass("disabled"))}),h=Ri("#Reset").off("click").on("click",()=>{h.hasClass("disabled")||(o.addClass("disabled"),c.addClass("disabled"),u.addClass("disabled"),a.removeClass("disabled"),e(),n())}),a=Ri("#Start").off("click").on("click",()=>{a.hasClass("disabled")||(o.addClass("disabled"),h.addClass("disabled"),a.addClass("disabled"),c.addClass("disabled"),u.removeClass("disabled"),i())}),u=Ri("#Stop").off("click").on("click",()=>{u.hasClass("disabled")||(u.addClass("disabled"),h.removeClass("disabled"),o.removeClass("disabled"),a.removeClass("disabled"),c.removeClass("disabled"),e())}),c=Ri("#Export").off("click").on("click",()=>{c.hasClass("disabled")||(c.addClass("disabled"),s())});$i(Ri("#modelSelector").off("change").on("change",i=>{"-"!=i&&(t.dC$.importModel=i,o.removeClass("disabled"))}))}function $i(t,i){const e=t||Ri(`#${Fi}`).empty(),n=Ri("<option>",{value:"-",text:"-"});i||n.attr("selected","true"),e.append(n),Object.keys(localStorage).filter(t=>-1!=t.indexOf(Ht)).forEach(t=>{const n=t.split(Ht)[1],s=Ri("<option>",{value:n,text:n});t===i&&s.attr("selected","true"),e.append(s)})}var Ui=(t=>(t.LAYER="Layer",t.RADIUS="Radius",t.GAUSS="Gauss",t))(Ui||{});function Bi(t){return new Map(Object.entries(t).map(([t,i])=>[Number(t),i]))}function Ii(i,e,n){return i>n.x&&i<n.x+2*t.config.neurons.radius&&e>n.y&&e<n.y+2*t.config.neurons.radius}function ji(t,i,e,n,s){return t>e.x-n&&t<e.x+n&&i>e.y-s&&i<e.y+s}function Gi(i){!function(){for(const i of t.Ot.values())for(const e of t.Ot.values())zi(i.key,e.key)}(),function(i){for(const e of function(t){const i=Array.from(t);for(let e=i.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[i[e],i[t]]=[i[t],i[e]]}return i}(t.$t.values())){const t=e;if(t.sourceKey!=t.targetKey){if(Li(t,i))continue;Di(t)}}}(i),Ni()}function zi(i,e){const n=Ki(i,e);if(!t.$t.has(n)&&i!=e){const s=t.Ut.position;return t.$t.set(n,{key:n,sourceKey:i,targetKey:e,distance:Math.round(Math.sqrt(Math.pow(s.get(i).x-s.get(e).x,2)+Math.pow(s.get(i).y-s.get(e).y,2))),weight:t.dC$.connections.randomWeights?2*Math.random():t.dC$.connections.defaultWeight}),t.$t.get(n)}}function Di(i){t.Bt.has(i.sourceKey)||t.Bt.set(i.sourceKey,[]),t.Bt.get(i.sourceKey).push(i.key),t.It.has(i.targetKey)||t.It.set(i.targetKey,[]),t.It.get(i.targetKey).push(i.key)}function Li(i,e){const n=t.$t,s=t.config,r=t.dC$,o=r.topology.allowReversed,h=s.connections,a=r.neurons.visibilityRadius,u=h.type,c=a,l=a,f=t.Ut.position,d=t.Ot,p=d.get(i.sourceKey),v=d.get(i.targetKey),m=t.dC$.topology.geometryType==di.Custom;if(u==Ui.LAYER&&!function(i,e,n){const s=Math.abs(e-i),r=13*(1+t.dC$.topology.heat),o=n||qt*t.dC$.connections.inputAreaWidth/100;return t.dC$.connections.inputAreaType==ui.LeftRect&&s>r&&s<o&&e>i}(f.get(p.key).x,f.get(v.key).x,a)&&!function(i,e,n){const s=Math.abs(e-i),r=11*(1+t.dC$.topology.heat),o=n||Xt*t.dC$.connections.inputAreaWidth/100;return t.dC$.connections.inputAreaType==ui.TopRect&&s>r&&s<o&&e>i}(f.get(p.key).y,f.get(v.key).y,a))return n.delete(i.key),!0;if(u==Ui.GAUSS||u==Ui.RADIUS){const s=m?t.jt.has(p.key):e[0](p);if(m?t.jt.has(v.key):e[0](v))return n.delete(i.key),!0;if(!s){if(!o&&n.has(Ki(v.key,p.key)))return n.delete(i.key),!0;if(0==i.distance)return n.delete(i.key),!0;if(u==Ui.GAUSS&&!function(i){const e=t.dC$.connections.sigma||1,n=Math.exp(-i*i/(2*e*e));return Math.random()<n}(i.distance))return n.delete(i.key),!0;if(u==Ui.RADIUS&&!qi(c,i.distance))return n.delete(i.key),!0}if(s&&!qi(l,i.distance))return n.delete(i.key),!0}}function Ni(){for(const i of t.Bt.keys())Vi(i)}function Vi(i){if(!t.Gt.has(i)){const e=t.Ot,n=t.$t;t.zt.has(i)||t.zt.set(i,Rt.create());const s=t.zt.get(i).subscribe({next:s=>{let r;const o=t.Bt.get(i);for(let i=0;i<o.length;i++){const h=e.get(n.get(o[i]).targetKey),a=t.Dt.get(h.key);r=t.Ut[si].get(h.key),Tv(h,a,s,Math.round(r*n.get(o[i]).weight*s.value),t.config.mode==ci.EVALUATE)}}});t.Gt.set(i,s)}}function Wi(i){t.zt.has(i)&&t.zt.get(i).shamefullySendComplete(),t.Gt.has(i)&&t.Gt.get(i).unsubscribe()}function Hi(i){t.zt.has(i)&&t.zt.delete(i),t.Gt.has(i)&&t.Gt.delete(i)}function qi(t,i){return i<t}function Xi(t,i,e){if(!i.has(t)||0==i.get(t).length)return 1;let n=0;for(let s=0;s<i.get(t).length;s++)n+=e.get(i.get(t)[s]).weight;return n/i.get(t).length}function Yi(t,i,e,n){if(!i.has(t)||0==i.get(t).length)return 1;let s=0;for(let o=0;o<i.get(t).length;o++)s+=Math.abs(e.get(i.get(t)[o]).weight-n);return r=s,Math.exp(r)/(Math.exp(r)+1);var r}function Ki(t,i){return`${t}$${i}`}function Qi(i){if(t.It.has(i.targetKey)){const n=t.It.get(i.targetKey);1==n.length?(t.It.delete(i.targetKey),function(i){const e=t.Ot.get(i);null!=e&&(t.Lt.has(i)||t.Lt.set(i,e),t.Ot.delete(i))}(e=i.targetKey),t.render.Nt.get(e).updateBackground(!1)):t.It.set(i.targetKey,n.filter(t=>t!==i.key))}var e}function Zi(i){if(t.Bt.has(i.sourceKey)){const e=t.Bt.get(i.sourceKey);1==e.length?(t.Bt.delete(i.sourceKey),Wi(i.sourceKey),Hi(i.sourceKey)):t.Bt.set(i.sourceKey,e.filter(t=>t!==i.key))}}const Ji={},te=function(t,i,e){let n=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),e=(null==t?void 0:t.nonce)||(null==t?void 0:t.getAttribute("nonce"));n=Promise.allSettled(i.map(t=>{if((t=function(t){return"/"+t}(t))in Ji)return;Ji[t]=!0;const i=t.endsWith(".css"),n=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${n}`))return;const s=document.createElement("link");return s.rel=i?"stylesheet":"modulepreload",i||(s.as="script"),s.crossOrigin="",s.href=t,e&&s.setAttribute("nonce",e),document.head.appendChild(s),i?new Promise((i,e)=>{s.addEventListener("load",i),s.addEventListener("error",()=>e(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}function s(t){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=t,window.dispatchEvent(i),!i.defaultPrevented)throw t}return n.then(i=>{for(const t of i||[])"rejected"===t.status&&s(t.reason);return t().catch(s)})};var ie=(t=>(t.Application="application",t.WebGLPipes="webgl-pipes",t.WebGLPipesAdaptor="webgl-pipes-adaptor",t.WebGLSystem="webgl-system",t.WebGPUPipes="webgpu-pipes",t.WebGPUPipesAdaptor="webgpu-pipes-adaptor",t.WebGPUSystem="webgpu-system",t.CanvasSystem="canvas-system",t.CanvasPipesAdaptor="canvas-pipes-adaptor",t.CanvasPipes="canvas-pipes",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t.MaskEffect="mask-effect",t.BlendMode="blend-mode",t.TextureSource="texture-source",t.Environment="environment",t.ShapeBuilder="shape-builder",t.Batcher="batcher",t))(ie||{});const ee=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},ne=(t,i)=>ee(t).priority??i,se={Vt:{},Wt:{},Ht:{},remove(...t){return t.map(ee).forEach(t=>{t.type.forEach(i=>{var e,n;return null==(n=(e=this.Wt)[i])?void 0:n.call(e,t)})}),this},add(...t){return t.map(ee).forEach(t=>{t.type.forEach(i=>{var e,n;const s=this.Vt,r=this.Ht;s[i]?null==(n=s[i])||n.call(s,t):(r[i]=r[i]||[],null==(e=r[i])||e.push(t))})}),this},handle(t,i,e){var n;const s=this.Vt,r=this.Wt;if(s[t]||r[t])throw new Error(`Extension type ${t} already has a handler`);s[t]=i,r[t]=e;const o=this.Ht;return o[t]&&(null==(n=o[t])||n.forEach(t=>i(t)),delete o[t]),this},handleByMap(t,i){return this.handle(t,t=>{t.name&&(i[t.name]=t.ref)},t=>{t.name&&delete i[t.name]})},handleByNamedList(t,i,e=-1){return this.handle(t,t=>{i.findIndex(i=>i.name===t.name)>=0||(i.push({name:t.name,value:t.ref}),i.sort((t,i)=>ne(i.value,e)-ne(t.value,e)))},t=>{const e=i.findIndex(i=>i.name===t.name);-1!==e&&i.splice(e,1)})},handleByList(t,i,e=-1){return this.handle(t,t=>{i.includes(t.ref)||(i.push(t.ref),i.sort((t,i)=>ne(i,e)-ne(t,e)))},t=>{const e=i.indexOf(t.ref);-1!==e&&i.splice(e,1)})},mixin(t,...i){for(const e of i)Object.defineProperties(t.prototype,Object.getOwnPropertyDescriptors(e))}},re={extension:{type:ie.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await te(()=>Promise.resolve().then(()=>Yv),void 0)}},oe={extension:{type:ie.Environment,name:"webworker",priority:0},test:()=>"undefined"!=typeof self&&void 0!==self.WorkerGlobalScope,load:async()=>{await te(()=>Promise.resolve().then(()=>Kv),void 0)}};class he{constructor(t,i,e){this.xt=i||0,this.qt=e||0,this.Xt=t}clone(t){return new he(t??this.Xt,this.xt,this.qt)}set(t=0,i=t){return this.xt===t&&this.qt===i||(this.xt=t,this.qt=i,this.Xt.Yt(this)),this}copyFrom(t){return this.xt===t.x&&this.qt===t.y||(this.xt=t.x,this.qt=t.y,this.Xt.Yt(this)),this}copyTo(t){return t.set(this.xt,this.qt),t}equals(t){return t.x===this.xt&&t.y===this.qt}toString(){return`[pixi.js/math:ObservablePoint x=${this.xt} y=${this.qt} scope=${this.Xt}]`}get x(){return this.xt}set x(t){this.xt!==t&&(this.xt=t,this.Xt.Yt(this))}get y(){return this.qt}set y(t){this.qt!==t&&(this.qt=t,this.Xt.Yt(this))}}var ae={exports:{}};!function(t){var i=Object.prototype.hasOwnProperty,e="~";function n(){}function s(t,i,e){this.fn=t,this.context=i,this.once=e||!1}function r(t,i,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var h=new s(n,r||t,o),a=e?e+i:i;return t.Kt[a]?t.Kt[a].fn?t.Kt[a]=[t.Kt[a],h]:t.Kt[a].push(h):(t.Kt[a]=h,t.Qt++),t}function o(t,i){0===--t.Qt?t.Kt=new n:delete t.Kt[i]}function h(){this.Kt=new n,this.Qt=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(e=!1)),h.prototype.eventNames=function(){var t,n,s=[];if(0===this.Qt)return s;for(n in t=this.Kt)i.call(t,n)&&s.push(e?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},h.prototype.listeners=function(t){var i=e?e+t:t,n=this.Kt[i];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,r=n.length,o=new Array(r);s<r;s++)o[s]=n[s].fn;return o},h.prototype.listenerCount=function(t){var i=e?e+t:t,n=this.Kt[i];return n?n.fn?1:n.length:0},h.prototype.emit=function(t,i,n,s,r,o){var h=e?e+t:t;if(!this.Kt[h])return!1;var a,u,c=this.Kt[h],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,i),!0;case 3:return c.fn.call(c.context,i,n),!0;case 4:return c.fn.call(c.context,i,n,s),!0;case 5:return c.fn.call(c.context,i,n,s,r),!0;case 6:return c.fn.call(c.context,i,n,s,r,o),!0}for(u=1,a=new Array(l-1);u<l;u++)a[u-1]=arguments[u];c.fn.apply(c.context,a)}else{var f,d=c.length;for(u=0;u<d;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,void 0,!0),l){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,i);break;case 3:c[u].fn.call(c[u].context,i,n);break;case 4:c[u].fn.call(c[u].context,i,n,s);break;default:if(!a)for(f=1,a=new Array(l-1);f<l;f++)a[f-1]=arguments[f];c[u].fn.apply(c[u].context,a)}}return!0},h.prototype.on=function(t,i,e){return r(this,t,i,e,!1)},h.prototype.once=function(t,i,e){return r(this,t,i,e,!0)},h.prototype.removeListener=function(t,i,n,s){var r=e?e+t:t;if(!this.Kt[r])return this;if(!i)return o(this,r),this;var h=this.Kt[r];if(h.fn)h.fn!==i||s&&!h.once||n&&h.context!==n||o(this,r);else{for(var a=0,u=[],c=h.length;a<c;a++)(h[a].fn!==i||s&&!h[a].once||n&&h[a].context!==n)&&u.push(h[a]);u.length?this.Kt[r]=1===u.length?u[0]:u:o(this,r)}return this},h.prototype.removeAllListeners=function(t){var i;return t?(i=e?e+t:t,this.Kt[i]&&o(this,i)):(this.Kt=new n,this.Qt=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=e,h.EventEmitter=h,t.exports=h}(ae);const ue=e(ae.exports),ce=2*Math.PI,le=180/Math.PI,fe=Math.PI/180;class de{constructor(t=0,i=0){this.x=0,this.y=0,this.x=t,this.y=i}clone(){return new de(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,i=t){return this.x=t,this.y=i,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return pe.x=0,pe.y=0,pe}}const pe=new de;class ve{constructor(t=1,i=0,e=0,n=1,s=0,r=0){this.array=null,this.a=t,this.b=i,this.c=e,this.d=n,this.tx=s,this.ty=r}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,i,e,n,s,r){return this.a=t,this.b=i,this.c=e,this.d=n,this.tx=s,this.ty=r,this}toArray(t,i){this.array||(this.array=new Float32Array(9));const e=i||this.array;return t?(e[0]=this.a,e[1]=this.b,e[2]=0,e[3]=this.c,e[4]=this.d,e[5]=0,e[6]=this.tx,e[7]=this.ty,e[8]=1):(e[0]=this.a,e[1]=this.c,e[2]=this.tx,e[3]=this.b,e[4]=this.d,e[5]=this.ty,e[6]=0,e[7]=0,e[8]=1),e}apply(t,i){i=i||new de;const e=t.x,n=t.y;return i.x=this.a*e+this.c*n+this.tx,i.y=this.b*e+this.d*n+this.ty,i}applyInverse(t,i){i=i||new de;const e=this.a,n=this.b,s=this.c,r=this.d,o=this.tx,h=this.ty,a=1/(e*r+s*-n),u=t.x,c=t.y;return i.x=r*a*u+-s*a*c+(h*s-o*r)*a,i.y=e*a*c+-n*a*u+(-h*e+o*n)*a,i}translate(t,i){return this.tx+=t,this.ty+=i,this}scale(t,i){return this.a*=t,this.d*=i,this.c*=t,this.b*=i,this.tx*=t,this.ty*=i,this}rotate(t){const i=Math.cos(t),e=Math.sin(t),n=this.a,s=this.c,r=this.tx;return this.a=n*i-this.b*e,this.b=n*e+this.b*i,this.c=s*i-this.d*e,this.d=s*e+this.d*i,this.tx=r*i-this.ty*e,this.ty=r*e+this.ty*i,this}append(t){const i=this.a,e=this.b,n=this.c,s=this.d;return this.a=t.a*i+t.b*n,this.b=t.a*e+t.b*s,this.c=t.c*i+t.d*n,this.d=t.c*e+t.d*s,this.tx=t.tx*i+t.ty*n+this.tx,this.ty=t.tx*e+t.ty*s+this.ty,this}appendFrom(t,i){const e=t.a,n=t.b,s=t.c,r=t.d,o=t.tx,h=t.ty,a=i.a,u=i.b,c=i.c,l=i.d;return this.a=e*a+n*c,this.b=e*u+n*l,this.c=s*a+r*c,this.d=s*u+r*l,this.tx=o*a+h*c+i.tx,this.ty=o*u+h*l+i.ty,this}setTransform(t,i,e,n,s,r,o,h,a){return this.a=Math.cos(o+a)*s,this.b=Math.sin(o+a)*s,this.c=-Math.sin(o-h)*r,this.d=Math.cos(o-h)*r,this.tx=t-(e*this.a+n*this.c),this.ty=i-(e*this.b+n*this.d),this}prepend(t){const i=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const i=this.a,e=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=e*t.a+this.d*t.c,this.d=e*t.b+this.d*t.d}return this.tx=i*t.a+this.ty*t.c+t.tx,this.ty=i*t.b+this.ty*t.d+t.ty,this}decompose(t){const i=this.a,e=this.b,n=this.c,s=this.d,r=t.pivot,o=-Math.atan2(-n,s),h=Math.atan2(e,i),a=Math.abs(o+h);return a<1e-5||Math.abs(ce-a)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=h),t.scale.x=Math.sqrt(i*i+e*e),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(r.x*i+r.y*n),t.position.y=this.ty+(r.x*e+r.y*s),t}invert(){const t=this.a,i=this.b,e=this.c,n=this.d,s=this.tx,r=t*n-i*e;return this.a=n/r,this.b=-i/r,this.c=-e/r,this.d=t/r,this.tx=(e*this.ty-n*s)/r,this.ty=-(t*this.ty-i*s)/r,this}isIdentity(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.tx&&0===this.ty}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new ve;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return ge.identity()}static get shared(){return me.identity()}}const me=new ve,ge=new ve,be=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ye=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],xe=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],we=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Me=[],Ae=[],Te=Math.sign;!function(){for(let t=0;t<16;t++){const i=[];Me.push(i);for(let e=0;e<16;e++){const n=Te(be[t]*be[e]+xe[t]*ye[e]),s=Te(ye[t]*be[e]+we[t]*ye[e]),r=Te(be[t]*xe[e]+xe[t]*we[e]),o=Te(ye[t]*xe[e]+we[t]*we[e]);for(let t=0;t<16;t++)if(be[t]===n&&ye[t]===s&&xe[t]===r&&we[t]===o){i.push(t);break}}}for(let t=0;t<16;t++){const i=new ve;i.set(be[t],ye[t],xe[t],we[t],0,0),Ae.push(i)}}();const _e={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>be[t],uY:t=>ye[t],vX:t=>xe[t],vY:t=>we[t],inv:t=>8&t?15&t:7&-t,add:(t,i)=>Me[t][i],sub:(t,i)=>Me[t][_e.inv(i)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,i)=>2*Math.abs(t)<=Math.abs(i)?i>=0?_e.S:_e.N:2*Math.abs(i)<=Math.abs(t)?t>0?_e.E:_e.W:i>0?t>0?_e.SE:_e.SW:t>0?_e.NE:_e.NW,matrixAppendRotationInv:(t,i,e=0,n=0)=>{const s=Ae[_e.inv(i)];s.tx=e,s.ty=n,t.append(s)},transformRectCoords:(t,i,e,n)=>{const{x:s,y:r,width:o,height:h}=t,{x:a,y:u,width:c,height:l}=i;return e===_e.E?(n.set(s+a,r+u,o,h),n):e===_e.S?n.set(c-r-h+a,s+u,h,o):e===_e.W?n.set(c-s-o+a,l-r-h+u,o,h):e===_e.N?n.set(r+a,l-s-o+u,h,o):n.set(s+a,r+u,o,h)}},ke=[new de,new de,new de,new de];class Ce{constructor(t=0,i=0,e=0,n=0){this.type="rectangle",this.x=Number(t),this.y=Number(i),this.width=Number(e),this.height=Number(n)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new Ce(0,0,0,0)}clone(){return new Ce(this.x,this.y,this.width,this.height)}copyFromBounds(t){return this.x=t.minX,this.y=t.minY,this.width=t.maxX-t.minX,this.height=t.maxY-t.minY,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,i){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&i>=this.y&&i<this.y+this.height)}strokeContains(t,i,e,n=.5){const{width:s,height:r}=this;if(s<=0||r<=0)return!1;const o=this.x,h=this.y,a=e*(1-n),u=e-a;return t>=o-a&&t<=o+s+a&&i>=h-a&&i<=h+r+a&&!(t>o+u&&t<o+s-u&&i>h+u&&i<h+r-u)}intersects(t,i){if(!i){const i=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=i)return!1;const e=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>e}const e=this.left,n=this.right,s=this.top,r=this.bottom;if(n<=e||r<=s)return!1;const o=ke[0].set(t.left,t.top),h=ke[1].set(t.left,t.bottom),a=ke[2].set(t.right,t.top),u=ke[3].set(t.right,t.bottom);if(a.x<=o.x||h.y<=o.y)return!1;const c=Math.sign(i.a*i.d-i.b*i.c);if(0===c)return!1;if(i.apply(o,o),i.apply(h,h),i.apply(a,a),i.apply(u,u),Math.max(o.x,h.x,a.x,u.x)<=e||Math.min(o.x,h.x,a.x,u.x)>=n||Math.max(o.y,h.y,a.y,u.y)<=s||Math.min(o.y,h.y,a.y,u.y)>=r)return!1;const l=c*(h.y-o.y),f=c*(o.x-h.x),d=l*e+f*s,p=l*n+f*s,v=l*e+f*r,m=l*n+f*r;if(Math.max(d,p,v,m)<=l*o.x+f*o.y||Math.min(d,p,v,m)>=l*u.x+f*u.y)return!1;const g=c*(o.y-a.y),b=c*(a.x-o.x),y=g*e+b*s,x=g*n+b*s,w=g*e+b*r,M=g*n+b*r;return!(Math.max(y,x,w,M)<=g*o.x+b*o.y||Math.min(y,x,w,M)>=g*u.x+b*u.y)}pad(t=0,i=t){return this.x-=t,this.y-=i,this.width+=2*t,this.height+=2*i,this}fit(t){const i=Math.max(this.x,t.x),e=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=i,this.width=Math.max(e-i,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(t=1,i=.001){const e=Math.ceil((this.x+this.width-i)*t)/t,n=Math.ceil((this.y+this.height-i)*t)/t;return this.x=Math.floor((this.x+i)*t)/t,this.y=Math.floor((this.y+i)*t)/t,this.width=e-this.x,this.height=n-this.y,this}scale(t,i=t){return this.x*=t,this.y*=i,this.width*=t,this.height*=i,this}enlarge(t){const i=Math.min(this.x,t.x),e=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=i,this.width=e-i,this.y=n,this.height=s-n,this}getBounds(t){return t||(t=new Ce),t.copyFrom(this),t}containsRect(t){if(this.width<=0||this.height<=0)return!1;const i=t.x,e=t.y,n=t.x+t.width,s=t.y+t.height;return i>=this.x&&i<this.x+this.width&&e>=this.y&&e<this.y+this.height&&n>=this.x&&n<this.x+this.width&&s>=this.y&&s<this.y+this.height}set(t,i,e,n){return this.x=t,this.y=i,this.width=e,this.height=n,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const Se={default:-1};function Pe(t="default"){return void 0===Se[t]&&(Se[t]=-1),++Se[t]}const Ee={};function Re(t,i,e=3){if(Ee[i])return;let n=(new Error).stack;void 0===n||(n=n.split("\n").splice(e).join("\n"),console.groupCollapsed),Ee[i]=!0}const Fe=()=>{};function Oe(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function $e(t){return!(t&t-1||!t)}function Ue(t){const i={};for(const e in t)void 0!==t[e]&&(i[e]=t[e]);return i}const Be=Object.create(null);const Ie=class t extends ue{constructor(i={}){super(),this.Zt="textureSampler",this.Jt=0,this.ti=1,this.destroyed=!1,i={...t.defaultOptions,...i},this.addressMode=i.addressMode,this.addressModeU=i.addressModeU??this.addressModeU,this.addressModeV=i.addressModeV??this.addressModeV,this.addressModeW=i.addressModeW??this.addressModeW,this.scaleMode=i.scaleMode,this.magFilter=i.magFilter??this.magFilter,this.minFilter=i.minFilter??this.minFilter,this.mipmapFilter=i.mipmapFilter??this.mipmapFilter,this.lodMinClamp=i.lodMinClamp,this.lodMaxClamp=i.lodMaxClamp,this.compare=i.compare,this.maxAnisotropy=i.maxAnisotropy??1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){Re(0,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this.ti=Math.min(t,16),this.ti>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this.ti}get ii(){return this.ei||this.ni()}update(){this.emit("change",this),this.ei=null}ni(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this.ti}`;return this.ei=function(t){const i=Be[t];return void 0===i&&(Be[t]=Pe("resource")),i}(t),this.ii}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};Ie.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let je=Ie;const Ge=class t extends ue{constructor(i={}){super(),this.options=i,this.uid=Pe("textureSource"),this.Zt="textureSource",this.ii=Pe("resource"),this.uploadMethodId="unknown",this.si=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this.Jt=0,this.ri=-1,this.oi=-1,i={...t.defaultOptions,...i},this.label=i.label??"",this.resource=i.resource,this.autoGarbageCollect=i.autoGarbageCollect,this.si=i.resolution,i.width?this.pixelWidth=i.width*this.si:this.pixelWidth=this.resource?this.resourceWidth??1:1,i.height?this.pixelHeight=i.height*this.si:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this.si,this.height=this.pixelHeight/this.si,this.format=i.format,this.dimension=i.dimensions,this.mipLevelCount=i.mipLevelCount,this.autoGenerateMipmaps=i.autoGenerateMipmaps,this.sampleCount=i.sampleCount,this.antialias=i.antialias,this.alphaMode=i.alphaMode,this.style=new je(Ue(i)),this.destroyed=!1,this.hi()}get source(){return this}get style(){return this.ai}set style(t){var i,e;this.style!==t&&(null==(i=this.ai)||i.off("change",this.ui,this),this.ai=t,null==(e=this.ai)||e.on("change",this.ui,this),this.ui())}set maxAnisotropy(t){this.ai.maxAnisotropy=t}get maxAnisotropy(){return this.ai.maxAnisotropy}get addressMode(){return this.ai.addressMode}set addressMode(t){this.ai.addressMode=t}get repeatMode(){return this.ai.addressMode}set repeatMode(t){this.ai.addressMode=t}get magFilter(){return this.ai.magFilter}set magFilter(t){this.ai.magFilter=t}get minFilter(){return this.ai.minFilter}set minFilter(t){this.ai.minFilter=t}get mipmapFilter(){return this.ai.mipmapFilter}set mipmapFilter(t){this.ai.mipmapFilter=t}get lodMinClamp(){return this.ai.lodMinClamp}set lodMinClamp(t){this.ai.lodMinClamp=t}get lodMaxClamp(){return this.ai.lodMaxClamp}set lodMaxClamp(t){this.ai.lodMaxClamp=t}ui(){this.emit("styleChange",this)}update(){if(this.resource){const t=this.si;if(this.resize(this.resourceWidth/t,this.resourceHeight/t))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.ai&&(this.ai.destroy(),this.ai=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this.ii=Pe("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this.si}set resolution(t){this.si!==t&&(this.si=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,i,e){e||(e=this.si),t||(t=this.width),i||(i=this.height);const n=Math.round(t*e),s=Math.round(i*e);return this.width=n/e,this.height=s/e,this.si=e,(this.pixelWidth!==n||this.pixelHeight!==s)&&(this.hi(),this.pixelWidth=n,this.pixelHeight=s,this.emit("resize",this),this.ii=Pe("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(t){this.ai.wrapMode=t}get wrapMode(){return this.ai.wrapMode}set scaleMode(t){this.ai.scaleMode=t}get scaleMode(){return this.ai.scaleMode}hi(){this.isPowerOfTwo=$e(this.pixelWidth)&&$e(this.pixelHeight)}static test(t){throw new Error("Unimplemented")}};Ge.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let ze=Ge;class De extends ze{constructor(t){const i=t.resource||new Float32Array(t.width*t.height*4);let e=t.format;e||(e=i instanceof Float32Array?"rgba32float":i instanceof Int32Array||i instanceof Uint32Array?"rgba32uint":i instanceof Int16Array||i instanceof Uint16Array?"rgba16uint":(Int8Array,"bgra8unorm")),super({...t,resource:i,format:e}),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}De.extension=ie.TextureSource;const Le=new ve;class Ne{constructor(t,i){this.mapCoord=new ve,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this.ci=-1,this.li=0,this.clampOffset=0,this.clampMargin=void 0===i?t.width<10?0:.5:i,this.isSimple=!1,this.texture=t}get texture(){return this.fi}set texture(t){var i;this.texture!==t&&(null==(i=this.fi)||i.removeListener("update",this.update,this),this.fi=t,this.fi.addListener("update",this.update,this),this.update())}multiplyUvs(t,i){void 0===i&&(i=t);const e=this.mapCoord;for(let n=0;n<t.length;n+=2){const s=t[n],r=t[n+1];i[n]=s*e.a+r*e.c+e.tx,i[n+1]=s*e.b+r*e.d+e.ty}return i}update(){const t=this.fi;this.li++;const i=t.uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const e=t.orig,n=t.trim;n&&(Le.set(e.width/n.width,0,0,e.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Le));const s=t.source,r=this.uClampFrame,o=this.clampMargin/s.si,h=this.clampOffset/s.si;return r[0]=(t.frame.x+o+h)/s.width,r[1]=(t.frame.y+o+h)/s.height,r[2]=(t.frame.x+t.frame.width-o+h)/s.width,r[3]=(t.frame.y+t.frame.height-o+h)/s.height,this.uClampOffset[0]=this.clampOffset/s.pixelWidth,this.uClampOffset[1]=this.clampOffset/s.pixelHeight,this.isSimple=t.frame.width===s.width&&t.frame.height===s.height&&0===t.rotate,!0}}class Ve extends ue{constructor({source:t,label:i,frame:e,orig:n,trim:s,defaultAnchor:r,defaultBorders:o,rotate:h,dynamic:a}={}){if(super(),this.uid=Pe("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new Ce,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=i,this.source=(null==t?void 0:t.source)??new ze,this.noFrame=!e,e)this.frame.copyFrom(e);else{const{width:t,height:i}=this.di;this.frame.width=t,this.frame.height=i}this.orig=n||this.frame,this.trim=s,this.rotate=h??0,this.defaultAnchor=r,this.defaultBorders=o,this.destroyed=!1,this.dynamic=a||!1,this.updateUvs()}set source(t){this.di&&this.di.off("resize",this.update,this),this.di=t,t.on("resize",this.update,this),this.emit("update",this)}get source(){return this.di}get textureMatrix(){return this.pi||(this.pi=new Ne(this)),this.pi}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:t,frame:i}=this,{width:e,height:n}=this.di,s=i.x/e,r=i.y/n,o=i.width/e,h=i.height/n;let a=this.rotate;if(a){const i=o/2,e=h/2,n=s+i,u=r+e;a=_e.add(a,_e.NW),t.x0=n+i*_e.uX(a),t.y0=u+e*_e.uY(a),a=_e.add(a,2),t.x1=n+i*_e.uX(a),t.y1=u+e*_e.uY(a),a=_e.add(a,2),t.x2=n+i*_e.uX(a),t.y2=u+e*_e.uY(a),a=_e.add(a,2),t.x3=n+i*_e.uX(a),t.y3=u+e*_e.uY(a)}else t.x0=s,t.y0=r,t.x1=s+o,t.y1=r,t.x2=s+o,t.y2=r+h,t.x3=s,t.y3=r+h}destroy(t=!1){this.di&&t&&(this.di.destroy(),this.di=null),this.pi=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this.di.width,this.frame.height=this.di.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return Re(0,"Texture.baseTexture is now Texture.source"),this.di}}function We(t,i,e){const{width:n,height:s}=e.orig,r=e.trim;if(r){const e=r.width,o=r.height;t.minX=r.x-i.xt*n,t.maxX=t.minX+e,t.minY=r.y-i.qt*s,t.maxY=t.minY+o}else t.minX=-i.xt*n,t.maxX=t.minX+n,t.minY=-i.qt*s,t.maxY=t.minY+s}Ve.EMPTY=new Ve({label:"EMPTY",source:new ze({label:"EMPTY"})}),Ve.EMPTY.destroy=Fe,Ve.WHITE=new Ve({source:new De({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"}),Ve.WHITE.destroy=Fe;const He=new ve;class qe{constructor(t=1/0,i=1/0,e=-1/0,n=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=He,this.minX=t,this.minY=i,this.maxX=e,this.maxY=n}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this.mi||(this.mi=new Ce);const t=this.mi;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=He,this}set(t,i,e,n){this.minX=t,this.minY=i,this.maxX=e,this.maxY=n}addFrame(t,i,e,n,s){s||(s=this.matrix);const r=s.a,o=s.b,h=s.c,a=s.d,u=s.tx,c=s.ty;let l=this.minX,f=this.minY,d=this.maxX,p=this.maxY,v=r*t+h*i+u,m=o*t+a*i+c;v<l&&(l=v),m<f&&(f=m),v>d&&(d=v),m>p&&(p=m),v=r*e+h*i+u,m=o*e+a*i+c,v<l&&(l=v),m<f&&(f=m),v>d&&(d=v),m>p&&(p=m),v=r*t+h*n+u,m=o*t+a*n+c,v<l&&(l=v),m<f&&(f=m),v>d&&(d=v),m>p&&(p=m),v=r*e+h*n+u,m=o*e+a*n+c,v<l&&(l=v),m<f&&(f=m),v>d&&(d=v),m>p&&(p=m),this.minX=l,this.minY=f,this.maxX=d,this.maxY=p}addRect(t,i){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,i)}addBounds(t,i){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,i)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const i=this.minX,e=this.minY,n=this.maxX,s=this.maxY,{a:r,b:o,c:h,d:a,tx:u,ty:c}=t;let l=r*i+h*e+u,f=o*i+a*e+c;this.minX=l,this.minY=f,this.maxX=l,this.maxY=f,l=r*n+h*e+u,f=o*n+a*e+c,this.minX=l<this.minX?l:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=l>this.maxX?l:this.maxX,this.maxY=f>this.maxY?f:this.maxY,l=r*i+h*s+u,f=o*i+a*s+c,this.minX=l<this.minX?l:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=l>this.maxX?l:this.maxX,this.maxY=f>this.maxY?f:this.maxY,l=r*n+h*s+u,f=o*n+a*s+c,this.minX=l<this.minX?l:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=l>this.maxX?l:this.maxX,this.maxY=f>this.maxY?f:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,i,e,n){return this.minX<t&&(this.minX=t),this.maxX>i&&(this.maxX=i),this.minY<e&&(this.minY=e),this.maxY>n&&(this.maxY=n),this}pad(t,i=t){return this.minX-=t,this.maxX+=t,this.minY-=i,this.maxY+=i,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new qe(this.minX,this.minY,this.maxX,this.maxY)}scale(t,i=t){return this.minX*=t,this.minY*=i,this.maxX*=t,this.maxY*=i,this}get x(){return this.minX}set x(t){const i=this.maxX-this.minX;this.minX=t,this.maxX=t+i}get y(){return this.minY}set y(t){const i=this.maxY-this.minY;this.minY=t,this.maxY=t+i}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,i,e,n){let s=this.minX,r=this.minY,o=this.maxX,h=this.maxY;n||(n=this.matrix);const a=n.a,u=n.b,c=n.c,l=n.d,f=n.tx,d=n.ty;for(let p=i;p<e;p+=2){const i=t[p],e=t[p+1],n=a*i+c*e+f,v=u*i+l*e+d;s=n<s?n:s,r=v<r?v:r,o=n>o?n:o,h=v>h?v:h}this.minX=s,this.minY=r,this.maxX=o,this.maxY=h}containsPoint(t,i){return this.minX<=t&&this.minY<=i&&this.maxX>=t&&this.maxY>=i}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}var Xe={grad:.9,turn:360,rad:360/(2*Math.PI)},Ye=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},Ke=function(t,i,e){return void 0===i&&(i=0),void 0===e&&(e=Math.pow(10,i)),Math.round(e*t)/e+0},Qe=function(t,i,e){return void 0===i&&(i=0),void 0===e&&(e=1),t>e?e:t>i?t:i},Ze=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},Je=function(t){return{r:Qe(t.r,0,255),g:Qe(t.g,0,255),b:Qe(t.b,0,255),a:Qe(t.a)}},tn=function(t){return{r:Ke(t.r),g:Ke(t.g),b:Ke(t.b),a:Ke(t.a,3)}},en=/^#([0-9a-f]{3,8})$/i,nn=function(t){var i=t.toString(16);return i.length<2?"0"+i:i},sn=function(t){var i=t.r,e=t.g,n=t.b,s=t.a,r=Math.max(i,e,n),o=r-Math.min(i,e,n),h=o?r===i?(e-n)/o:r===e?2+(n-i)/o:4+(i-e)/o:0;return{h:60*(h<0?h+6:h),s:r?o/r*100:0,v:r/255*100,a:s}},rn=function(t){var i=t.h,e=t.s,n=t.v,s=t.a;i=i/360*6,e/=100,n/=100;var r=Math.floor(i),o=n*(1-e),h=n*(1-(i-r)*e),a=n*(1-(1-i+r)*e),u=r%6;return{r:255*[n,h,o,o,a,n][u],g:255*[a,n,n,h,o,o][u],b:255*[o,o,a,n,n,h][u],a:s}},on=function(t){return{h:Ze(t.h),s:Qe(t.s,0,100),l:Qe(t.l,0,100),a:Qe(t.a)}},hn=function(t){return{h:Ke(t.h),s:Ke(t.s),l:Ke(t.l),a:Ke(t.a,3)}},an=function(t){return rn((e=(i=t).s,{h:i.h,s:(e*=((n=i.l)<50?n:100-n)/100)>0?2*e/(n+e)*100:0,v:n+e,a:i.a}));var i,e,n},un=function(t){return{h:(i=sn(t)).h,s:(s=(200-(e=i.s))*(n=i.v)/100)>0&&s<200?e*n/100/(s<=100?s:200-s)*100:0,l:s/2,a:i.a};var i,e,n,s},cn=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ln=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,fn=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,dn=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,pn={string:[[function(t){var i=en.exec(t);return i?(t=i[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?Ke(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?Ke(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var i=fn.exec(t)||dn.exec(t);return i?i[2]!==i[4]||i[4]!==i[6]?null:Je({r:Number(i[1])/(i[2]?100/255:1),g:Number(i[3])/(i[4]?100/255:1),b:Number(i[5])/(i[6]?100/255:1),a:void 0===i[7]?1:Number(i[7])/(i[8]?100:1)}):null},"rgb"],[function(t){var i=cn.exec(t)||ln.exec(t);if(!i)return null;var e,n,s=on({h:(e=i[1],n=i[2],void 0===n&&(n="deg"),Number(e)*(Xe[n]||1)),s:Number(i[3]),l:Number(i[4]),a:void 0===i[5]?1:Number(i[5])/(i[6]?100:1)});return an(s)},"hsl"]],object:[[function(t){var i=t.r,e=t.g,n=t.b,s=t.a,r=void 0===s?1:s;return Ye(i)&&Ye(e)&&Ye(n)?Je({r:Number(i),g:Number(e),b:Number(n),a:Number(r)}):null},"rgb"],[function(t){var i=t.h,e=t.s,n=t.l,s=t.a,r=void 0===s?1:s;if(!Ye(i)||!Ye(e)||!Ye(n))return null;var o=on({h:Number(i),s:Number(e),l:Number(n),a:Number(r)});return an(o)},"hsl"],[function(t){var i=t.h,e=t.s,n=t.v,s=t.a,r=void 0===s?1:s;if(!Ye(i)||!Ye(e)||!Ye(n))return null;var o,h=(o={h:Number(i),s:Number(e),v:Number(n),a:Number(r)},{h:Ze(o.h),s:Qe(o.s,0,100),v:Qe(o.v,0,100),a:Qe(o.a)});return rn(h)},"hsv"]]},vn=function(t,i){for(var e=0;e<i.length;e++){var n=i[e][0](t);if(n)return[n,i[e][1]]}return[null,void 0]},mn=function(t,i){var e=un(t);return{h:e.h,s:Qe(e.s+100*i,0,100),l:e.l,a:e.a}},gn=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},bn=function(t,i){var e=un(t);return{h:e.h,s:e.s,l:Qe(e.l+100*i,0,100),a:e.a}},yn=function(){function t(t){this.parsed=function(t){return"string"==typeof t?vn(t.trim(),pn.string):"object"==typeof t&&null!==t?vn(t,pn.object):[null,void 0]}(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return Ke(gn(this.rgba),2)},t.prototype.isDark=function(){return gn(this.rgba)<.5},t.prototype.isLight=function(){return gn(this.rgba)>=.5},t.prototype.toHex=function(){return i=(t=tn(this.rgba)).r,e=t.g,n=t.b,r=(s=t.a)<1?nn(Ke(255*s)):"","#"+nn(i)+nn(e)+nn(n)+r;var t,i,e,n,s,r},t.prototype.toRgb=function(){return tn(this.rgba)},t.prototype.toRgbString=function(){return i=(t=tn(this.rgba)).r,e=t.g,n=t.b,(s=t.a)<1?"rgba("+i+", "+e+", "+n+", "+s+")":"rgb("+i+", "+e+", "+n+")";var t,i,e,n,s},t.prototype.toHsl=function(){return hn(un(this.rgba))},t.prototype.toHslString=function(){return i=(t=hn(un(this.rgba))).h,e=t.s,n=t.l,(s=t.a)<1?"hsla("+i+", "+e+"%, "+n+"%, "+s+")":"hsl("+i+", "+e+"%, "+n+"%)";var t,i,e,n,s},t.prototype.toHsv=function(){return t=sn(this.rgba),{h:Ke(t.h),s:Ke(t.s),v:Ke(t.v),a:Ke(t.a,3)};var t},t.prototype.invert=function(){return xn({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),xn(mn(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),xn(mn(this.rgba,-t))},t.prototype.grayscale=function(){return xn(mn(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),xn(bn(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),xn(bn(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?xn({r:(i=this.rgba).r,g:i.g,b:i.b,a:t}):Ke(this.rgba.a,3);var i},t.prototype.hue=function(t){var i=un(this.rgba);return"number"==typeof t?xn({h:t,s:i.s,l:i.l,a:i.a}):Ke(i.h)},t.prototype.isEqual=function(t){return this.toHex()===xn(t).toHex()},t}(),xn=function(t){return t instanceof yn?t:new yn(t)},wn=[];[function(t,i){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var s in e)n[e[s]]=s;var r={};t.prototype.toName=function(i){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var s,o,h=n[this.toHex()];if(h)return h;if(null==i?void 0:i.closest){var a=this.toRgb(),u=1/0,c="black";if(!r.length)for(var l in e)r[l]=new t(e[l]).toRgb();for(var f in e){var d=(s=a,o=r[f],Math.pow(s.r-o.r,2)+Math.pow(s.g-o.g,2)+Math.pow(s.b-o.b,2));d<u&&(u=d,c=f)}return c}},i.string.push([function(i){var n=i.toLowerCase(),s="transparent"===n?"#0000":e[n];return s?new t(s).toRgb():null},"name"])}].forEach(function(t){wn.indexOf(t)<0&&(t(yn,pn),wn.push(t))});const Mn=class t{constructor(t=16777215){this.gi=null,this.bi=new Float32Array(4),this.bi.fill(1),this.yi=16777215,this.value=t}get red(){return this.bi[0]}get green(){return this.bi[1]}get blue(){return this.bi[2]}get alpha(){return this.bi[3]}setValue(t){return this.value=t,this}set value(i){if(i instanceof t)this.gi=this.xi(i.gi),this.yi=i.yi,this.bi.set(i.bi);else{if(null===i)throw new Error("Cannot set Color#value to null");null!==this.gi&&this.wi(this.gi,i)||(this.gi=this.xi(i),this.Mi(this.gi))}}get value(){return this.gi}xi(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?{...t}:t}wi(t,i){const e=typeof t;if(e!==typeof i)return!1;if("number"===e||"string"===e||t instanceof Number)return t===i;if(Array.isArray(t)&&Array.isArray(i)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(i))return t.length===i.length&&t.every((t,e)=>t===i[e]);if(null!==t&&null!==i){const e=Object.keys(t),n=Object.keys(i);return e.length===n.length&&e.every(e=>t[e]===i[e])}return t===i}toRgba(){const[t,i,e,n]=this.bi;return{r:t,g:i,b:e,a:n}}toRgb(){const[t,i,e]=this.bi;return{r:t,g:i,b:e}}toRgbaString(){const[t,i,e]=this.toUint8RgbArray();return`rgba(${t},${i},${e},${this.alpha})`}toUint8RgbArray(t){const[i,e,n]=this.bi;return this.Ai||(this.Ai=[]),t||(t=this.Ai),t[0]=Math.round(255*i),t[1]=Math.round(255*e),t[2]=Math.round(255*n),t}toArray(t){this.Ti||(this.Ti=[]),t||(t=this.Ti);const[i,e,n,s]=this.bi;return t[0]=i,t[1]=e,t[2]=n,t[3]=s,t}toRgbArray(t){this.Ai||(this.Ai=[]),t||(t=this.Ai);const[i,e,n]=this.bi;return t[0]=i,t[1]=e,t[2]=n,t}toNumber(){return this.yi}toBgrNumber(){const[t,i,e]=this.toUint8RgbArray();return(e<<16)+(i<<8)+t}toLittleEndianNumber(){const t=this.yi;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(i){const[e,n,s,r]=t._i.setValue(i).bi;return this.bi[0]*=e,this.bi[1]*=n,this.bi[2]*=s,this.bi[3]*=r,this.ki(),this.gi=null,this}premultiply(t,i=!0){return i&&(this.bi[0]*=t,this.bi[1]*=t,this.bi[2]*=t),this.bi[3]=t,this.ki(),this.gi=null,this}toPremultiplied(t,i=!0){if(1===t)return(255<<24)+this.yi;if(0===t)return i?0:this.yi;let e=this.yi>>16&255,n=this.yi>>8&255,s=255&this.yi;return i&&(e=e*t+.5|0,n=n*t+.5|0,s=s*t+.5|0),(255*t<<24)+(e<<16)+(n<<8)+s}toHex(){const t=this.yi.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this.bi[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this.bi[3]=this.Ci(t),this}Mi(i){let e,n,s,r;if(("number"==typeof i||i instanceof Number)&&i>=0&&i<=16777215){e=(i>>16&255)/255,n=(i>>8&255)/255,s=(255&i)/255,r=1}else if((Array.isArray(i)||i instanceof Float32Array)&&i.length>=3&&i.length<=4)i=this.Ci(i),[e,n,s,r=1]=i;else if((i instanceof Uint8Array||i instanceof Uint8ClampedArray)&&i.length>=3&&i.length<=4)i=this.Ci(i,0,255),[e,n,s,r=255]=i,e/=255,n/=255,s/=255,r/=255;else if("string"==typeof i||"object"==typeof i){if("string"==typeof i){const e=t.HEX_PATTERN.exec(i);e&&(i=`#${e[2]}`)}const o=xn(i);o.isValid()&&(({r:e,g:n,b:s,a:r}=o.rgba),e/=255,n/=255,s/=255)}if(void 0===e)throw new Error(`Unable to convert color ${i}`);this.bi[0]=e,this.bi[1]=n,this.bi[2]=s,this.bi[3]=r,this.ki()}ki(){this.Ci(this.bi);const[t,i,e]=this.bi;this.yi=(255*t<<16)+(255*i<<8)+(255*e|0)}Ci(t,i=0,e=1){return"number"==typeof t?Math.min(Math.max(t,i),e):(t.forEach((n,s)=>{t[s]=Math.min(Math.max(n,i),e)}),t)}static isColorLike(i){return"number"==typeof i||"string"==typeof i||i instanceof Number||i instanceof t||Array.isArray(i)||i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Float32Array||void 0!==i.r&&void 0!==i.g&&void 0!==i.b||void 0!==i.r&&void 0!==i.g&&void 0!==i.b&&void 0!==i.a||void 0!==i.h&&void 0!==i.s&&void 0!==i.l||void 0!==i.h&&void 0!==i.s&&void 0!==i.l&&void 0!==i.a||void 0!==i.h&&void 0!==i.s&&void 0!==i.v||void 0!==i.h&&void 0!==i.s&&void 0!==i.v&&void 0!==i.a}};Mn.shared=new Mn,Mn._i=new Mn,Mn.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let An=Mn;let Tn=0;function _n(...t){500!==Tn&&Tn++}class kn{constructor(t,i){this.Si=[],this.Pi=0,this.Ei=0,this.Ri=t,i&&this.prepopulate(i)}prepopulate(t){for(let i=0;i<t;i++)this.Si[this.Ei++]=new this.Ri;this.Pi+=t}get(t){var i;let e;return e=this.Ei>0?this.Si[--this.Ei]:new this.Ri,null==(i=e.init)||i.call(e,t),e}return(t){var i;null==(i=t.reset)||i.call(t),this.Si[this.Ei++]=t}get totalSize(){return this.Pi}get totalFree(){return this.Ei}get totalUsed(){return this.Pi-this.Ei}clear(){this.Si.length=0,this.Ei=0}}const Cn=new class{constructor(){this.Fi=new Map}prepopulate(t,i){this.getPool(t).prepopulate(i)}get(t,i){return this.getPool(t).get(i)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this.Fi.has(t)||this.Fi.set(t,new kn(t)),this.Fi.get(t)}stats(){const t={};return this.Fi.forEach(i=>{const e=t[i.Ri.name]?i.Ri.name+i.Ri.ID:i.Ri.name;t[e]={free:i.totalFree,used:i.totalUsed,size:i.totalSize}}),t}},Sn={get isCachedAsTexture(){var t;return!!(null==(t=this.renderGroup)?void 0:t.isCachedAsTexture)},cacheAsTexture(t){"boolean"==typeof t&&!1===t?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(!0===t?{}:t))},updateCacheTexture(){var t;null==(t=this.renderGroup)||t.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(t){Re(0,"cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(t)}};function Pn(t,i,e){const n=t.length;let s;if(i>=n||0===e)return;const r=n-(e=i+e>n?n-i:e);for(s=i;s<r;++s)t[s]=t[s+e];t.length=r}const En={allowChildren:!0,removeChildren(t=0,i){var e;const n=i??this.children.length,s=n-t,r=[];if(s>0&&s<=n){for(let e=n-1;e>=t;e--){const t=this.children[e];t&&(r.push(t),t.parent=null)}Pn(this.children,t,n);const i=this.renderGroup||this.parentRenderGroup;i&&i.removeChildren(r);for(let t=0;t<r.length;++t){const i=r[t];null==(e=i.parentRenderLayer)||e.detach(i),this.emit("childRemoved",i,this,t),r[t].emit("removed",this)}return r.length>0&&this.Oi++,r}if(0===s&&0===this.children.length)return r;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(t){const i=this.getChildAt(t);return this.removeChild(i)},getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]},setChildIndex(t,i){if(i<0||i>=this.children.length)throw new Error(`The index ${i} supplied is out of bounds ${this.children.length}`);this.getChildIndex(t),this.addChildAt(t,i)},getChildIndex(t){const i=this.children.indexOf(t);if(-1===i)throw new Error("The supplied Container must be a child of the caller");return i},addChildAt(t,i){this.allowChildren||Re(0,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:e}=this;if(i<0||i>e.length)throw new Error(`${t}addChildAt: The index ${i} supplied is out of bounds ${e.length}`);if(t.parent){const e=t.parent.children.indexOf(t);if(t.parent===this&&e===i)return t;-1!==e&&t.parent.children.splice(e,1)}i===e.length?e.push(t):e.splice(i,0,t),t.parent=this,t.didChange=!0,t.$i=15;const n=this.renderGroup||this.parentRenderGroup;return n&&n.addChild(t),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",t,this,i),t.emit("added",this),t},swapChildren(t,i){if(t===i)return;const e=this.getChildIndex(t),n=this.getChildIndex(i);this.children[e]=i,this.children[n]=t;const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0),this.Ui++},removeFromParent(){var t;null==(t=this.parent)||t.removeChild(this)},reparentChild(...t){return 1===t.length?this.reparentChildAt(t[0],this.children.length):(t.forEach(t=>this.reparentChildAt(t,this.children.length)),t[0])},reparentChildAt(t,i){if(t.parent===this)return this.setChildIndex(t,i),t;const e=t.worldTransform.clone();t.removeFromParent(),this.addChildAt(t,i);const n=this.worldTransform.clone();return n.invert(),e.prepend(n),t.setFromMatrix(e),t},replaceChild(t,i){t.updateLocalTransform(),this.addChildAt(i,this.getChildIndex(t)),i.setFromMatrix(t.localTransform),i.updateLocalTransform(),this.removeChild(t)}},Rn={collectRenderables(t,i,e){this.parentRenderLayer&&this.parentRenderLayer!==e||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(t,i,e):this.renderGroup?i.renderPipes.renderGroup.addRenderGroup(this.renderGroup,t):this.collectRenderablesWithEffects(t,i,e))},collectRenderablesSimple(t,i,e){const n=this.children,s=n.length;for(let r=0;r<s;r++)n[r].collectRenderables(t,i,e)},collectRenderablesWithEffects(t,i,e){const{renderPipes:n}=i;for(let s=0;s<this.effects.length;s++){const i=this.effects[s];n[i.pipe].push(i,this,t)}this.collectRenderablesSimple(t,i,e);for(let s=this.effects.length-1;s>=0;s--){const i=this.effects[s];n[i.pipe].pop(i,this,t)}}};class Fn{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null,this.filterArea=null}}const On=new class{constructor(){this.Bi=[],this.Ii=[],this.ji=!1}init(){this.ji||(this.ji=!0,this.Bi.forEach(t=>{this.add({test:t.test,maskClass:t})}))}add(t){this.Ii.push(t)}getMaskEffect(t){this.ji||this.init();for(let i=0;i<this.Ii.length;i++){const e=this.Ii[i];if(e.test(t))return Cn.get(e.maskClass,t)}return t}returnMaskEffect(t){Cn.return(t)}};se.handleByList(ie.MaskEffect,On.Bi);const $n={Gi:null,zi:{inverse:!1},Di:null,effects:[],Li(){const t=this.renderGroup||this.parentRenderGroup;t&&(t.structureDidChange=!0)},addEffect(t){-1===this.effects.indexOf(t)&&(this.effects.push(t),this.effects.sort((t,i)=>t.priority-i.priority),this.Li(),this.Ni())},removeEffect(t){const i=this.effects.indexOf(t);-1!==i&&(this.effects.splice(i,1),this.Li(),this.Ni())},set mask(t){const i=this.Gi;(null==i?void 0:i.mask)!==t&&(i&&(this.removeEffect(i),On.returnMaskEffect(i),this.Gi=null),null!=t&&(this.Gi=On.getMaskEffect(t),this.addEffect(this.Gi)))},get mask(){var t;return null==(t=this.Gi)?void 0:t.mask},setMask(t){this.zi={...this.zi,...t},t.mask&&(this.mask=t.mask),this.Li()},set filters(t){var i;!Array.isArray(t)&&t&&(t=[t]);const e=this.Di||(this.Di=new Fn),n=(null==t?void 0:t.length)>0,s=n!==(null==(i=e.filters)?void 0:i.length)>0;t=Array.isArray(t)?t.slice(0):t,e.filters=Object.freeze(t),s&&(n?this.addEffect(e):(this.removeEffect(e),e.filters=t??null))},get filters(){var t;return null==(t=this.Di)?void 0:t.filters},set filterArea(t){this.Di||(this.Di=new Fn),this.Di.filterArea=t},get filterArea(){var t;return null==(t=this.Di)?void 0:t.filterArea}},Un={label:null,get name(){return Re(0,"Container.name property has been removed, use Container.label instead"),this.label},set name(t){Re(0,"Container.name property has been removed, use Container.label instead"),this.label=t},getChildByName(t,i=!1){return this.getChildByLabel(t,i)},getChildByLabel(t,i=!1){const e=this.children;for(let n=0;n<e.length;n++){const i=e[n];if(i.label===t||t instanceof RegExp&&t.test(i.label))return i}if(i)for(let n=0;n<e.length;n++){const i=e[n].getChildByLabel(t,!0);if(i)return i}return null},getChildrenByLabel(t,i=!1,e=[]){const n=this.children;for(let s=0;s<n.length;s++){const i=n[s];(i.label===t||t instanceof RegExp&&t.test(i.label))&&e.push(i)}if(i)for(let s=0;s<n.length;s++)n[s].getChildrenByLabel(t,!0,e);return e}},Bn=new kn(ve),In=new kn(qe),jn=new ve,Gn={getFastGlobalBounds(t,i){i||(i=new qe),i.clear(),this.Vi(!!t,i,this.parentRenderLayer),i.isValid||i.set(0,0,0,0);const e=this.renderGroup||this.parentRenderGroup;return i.applyMatrix(e.worldTransform),i},Vi(t,i,e){let n=i;if(t&&this.parentRenderLayer&&this.parentRenderLayer!==e)return;if(7!==this.localDisplayStatus||!this.measurable)return;const s=!!this.effects.length;if((this.renderGroup||s)&&(n=In.get().clear()),this.boundsArea)i.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const t=this.bounds;n.addFrame(t.minX,t.minY,t.maxX,t.maxY,this.groupTransform)}const i=this.children;for(let s=0;s<i.length;s++)i[s].Vi(t,n,e)}if(s){let t=!1;const e=this.renderGroup||this.parentRenderGroup;for(let i=0;i<this.effects.length;i++)this.effects[i].addBounds&&(t||(t=!0,n.applyMatrix(e.worldTransform)),this.effects[i].addBounds(n,!0));t&&n.applyMatrix(e.worldTransform.copyTo(jn).invert()),i.addBounds(n),In.return(n)}else this.renderGroup&&(i.addBounds(n,this.relativeGroupTransform),In.return(n))}};function zn(t,i,e){let n,s;return e.clear(),t.parent?i?n=t.parent.worldTransform:(s=Bn.get().identity(),n=Ln(t,s)):n=ve.IDENTITY,Dn(t,e,n,i),s&&Bn.return(s),e.isValid||e.set(0,0,0,0),e}function Dn(t,i,e,n){var s,r;if(!t.visible||!t.measurable)return;let o;n?o=t.worldTransform:(t.updateLocalTransform(),o=Bn.get(),o.appendFrom(t.localTransform,e));const h=i,a=!!t.effects.length;if(a&&(i=In.get().clear()),t.boundsArea)i.addRect(t.boundsArea,o);else{t.bounds&&(i.matrix=o,i.addBounds(t.bounds));for(let e=0;e<t.children.length;e++)Dn(t.children[e],i,o,n)}if(a){for(let e=0;e<t.effects.length;e++)null==(r=(s=t.effects[e]).addBounds)||r.call(s,i);h.addBounds(i,ve.IDENTITY),In.return(i)}n||Bn.return(o)}function Ln(t,i){const e=t.parent;return e&&(Ln(e,i),e.updateLocalTransform(),i.append(e.localTransform)),i}function Nn(t,i){if(16777215===t||!i)return i;if(16777215===i||!t)return t;return(((t>>16&255)*(i>>16&255)/255|0)<<16)+(((t>>8&255)*(i>>8&255)/255|0)<<8)+((255&t)*(255&i)/255|0)}const Vn=16777215;function Wn(t,i){return t===Vn?i:i===Vn?t:Nn(t,i)}function Hn(t){return((255&t)<<16)+(65280&t)+(t>>16&255)}const qn={getGlobalAlpha(t){if(t)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let i=this.alpha,e=this.parent;for(;e;)i*=e.alpha,e=e.parent;return i},getGlobalTransform(t=new ve,i){if(i)return t.copyFrom(this.worldTransform);this.updateLocalTransform();const e=Ln(this,Bn.get().identity());return t.appendFrom(this.localTransform,e),Bn.return(e),t},getGlobalTint(t){if(t)return this.renderGroup?Hn(this.renderGroup.worldColor):this.parentRenderGroup?Hn(Wn(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let i=this.localColor,e=this.parent;for(;e;)i=Wn(i,e.localColor),e=e.parent;return Hn(i)}};function Xn(t,i,e){return i.clear(),e||(e=ve.IDENTITY),Yn(t,i,e,t,!0),i.isValid||i.set(0,0,0,0),i}function Yn(t,i,e,n,s){var r,o;let h;if(s)h=Bn.get(),h=e.copyTo(h);else{if(!t.visible||!t.measurable)return;t.updateLocalTransform();const i=t.localTransform;h=Bn.get(),h.appendFrom(i,e)}const a=i,u=!!t.effects.length;if(u&&(i=In.get().clear()),t.boundsArea)i.addRect(t.boundsArea,h);else{t.renderPipeId&&(i.matrix=h,i.addBounds(t.bounds));const e=t.children;for(let t=0;t<e.length;t++)Yn(e[t],i,h,n,!1)}if(u){for(let e=0;e<t.effects.length;e++)null==(o=(r=t.effects[e]).addLocalBounds)||o.call(r,i,n);a.addBounds(i,ve.IDENTITY),In.return(i)}Bn.return(h)}function Kn(t,i){const e=t.children;for(let n=0;n<e.length;n++){const t=e[n],s=t.uid,r=(65535&t.Oi)<<16|65535&t.Ui,o=i.index;i.data[o]===s&&i.data[o+1]===r||(i.data[i.index]=s,i.data[i.index+1]=r,i.didChange=!0),i.index=o+2,t.children.length&&Kn(t,i)}return i.didChange}const Qn=new ve,Zn={Wi:-1,Hi:null,qi(t,i){const e=Math.sign(this.scale.x)||1;this.scale.x=0!==i?t/i*e:e},Xi(t,i){const e=Math.sign(this.scale.y)||1;this.scale.y=0!==i?t/i*e:e},getLocalBounds(){this.Hi||(this.Hi={data:[],index:1,didChange:!1,localBounds:new qe});const t=this.Hi;return t.index=1,t.didChange=!1,t.data[0]!==this.Oi&&(t.didChange=!0,t.data[0]=this.Oi),Kn(this,t),t.didChange&&Xn(this,t.localBounds,Qn),t.localBounds},getBounds(t,i){return zn(this,t,i||new qe)}},Jn={Yi:null,set onRender(t){const i=this.renderGroup||this.parentRenderGroup;if(!t)return this.Yi&&(null==i||i.removeOnRender(this)),void(this.Yi=null);this.Yi||null==i||i.addOnRender(this),this.Yi=t},get onRender(){return this.Yi}},ts={Ki:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this.Ki},set zIndex(t){this.Ki!==t&&(this.Ki=t,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(is))}};function is(t,i){return t.Ki-i.Ki}const es={getGlobalPosition(t=new de,i=!1){return this.parent?this.parent.toGlobal(this.Qi,t,i):(t.x=this.Qi.x,t.y=this.Qi.y),t},toGlobal(t,i,e=!1){const n=this.getGlobalTransform(Bn.get(),e);return i=n.apply(t,i),Bn.return(n),i},toLocal(t,i,e,n){i&&(t=i.toGlobal(t,e,n));const s=this.getGlobalTransform(Bn.get(),n);return e=s.applyInverse(t,e),Bn.return(s),e}};class ns{constructor(){this.uid=Pe("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize}}let ss=0;const rs=new class{constructor(t){this.Zi=Object.create(null),this.Ji={},this.textureOptions=t||{},this.enableFullScreen=!1,this.textureStyle=new je(this.textureOptions)}createTexture(t,i,e){const n=new ze({...this.textureOptions,width:t,height:i,resolution:1,antialias:e,autoGarbageCollect:!1});return new Ve({source:n,label:"texturePool_"+ss++})}getOptimalTexture(t,i,e=1,n){let s=Math.ceil(t*e-1e-6),r=Math.ceil(i*e-1e-6);s=Oe(s),r=Oe(r);const o=(s<<17)+(r<<1)+(n?1:0);this.Ji[o]||(this.Ji[o]=[]);let h=this.Ji[o].pop();return h||(h=this.createTexture(s,r,n)),h.source.si=e,h.source.width=s/e,h.source.height=r/e,h.source.pixelWidth=s,h.source.pixelHeight=r,h.frame.x=0,h.frame.y=0,h.frame.width=t,h.frame.height=i,h.updateUvs(),this.Zi[h.uid]=o,h}getSameSizeTexture(t,i=!1){const e=t.source;return this.getOptimalTexture(t.width,t.height,e.si,i)}returnTexture(t,i=!1){const e=this.Zi[t.uid];i&&(t.source.style=this.textureStyle),this.Ji[e].push(t)}clear(t){if(t=!1!==t)for(const i in this.Ji){const t=this.Ji[i];if(t)for(let i=0;i<t.length;i++)t[i].destroy(!0)}this.Ji={}}};class os{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new ve,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new ns,this.te=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this.ie=7}init(t){this.root=t,t.Yi&&this.addOnRender(t),t.didChange=!0;const i=t.children;for(let e=0;e<i.length;e++){const t=i[e];t.$i=15,this.addChild(t)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(rs.returnTexture(this.texture,!0),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const i=this.childrenToUpdate[t];i.list.fill(null),i.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this.te.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent.ee(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}ee(t){const i=this.renderGroupChildren.indexOf(t);i>-1&&this.renderGroupChildren.splice(i,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup)return void this.addRenderGroupChild(t.renderGroup);t.Yi&&this.addOnRender(t);const i=t.children;for(let e=0;e<i.length;e++)this.addChild(i[e])}removeChild(t){if(this.structureDidChange=!0,t.Yi&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup)return void this.ee(t.renderGroup);const i=t.children;for(let e=0;e<i.length;e++)this.removeChild(i[e])}removeChildren(t){for(let i=0;i<t.length;i++)this.removeChild(t[i])}onChildUpdate(t){let i=this.childrenToUpdate[t.relativeRenderGroupDepth];i||(i=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),i.list[i.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return 7===this.root.localDisplayStatus&&this.worldAlpha>0}addOnRender(t){this.te.push(t)}removeOnRender(t){this.te.splice(this.te.indexOf(t),1)}runOnRender(t){for(let i=0;i<this.te.length;i++)this.te[i].Yi(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this.te=null,this.instructionSet=null}getChildren(t=[]){const i=this.root.children;for(let e=0;e<i.length;e++)this.ne(i[e],t);return t}ne(t,i=[]){if(i.push(t),t.renderGroup)return i;const e=t.children;for(let n=0;n<e.length;n++)this.ne(e[n],i);return i}invalidateMatrices(){this.ie=7}get inverseWorldTransform(){return 1&this.ie?(this.ie&=-2,this.se||(this.se=new ve),this.se.copyFrom(this.worldTransform).invert()):this.se}get textureOffsetInverseTransform(){return 2&this.ie?(this.ie&=-3,this.re||(this.re=new ve),this.re.copyFrom(this.inverseWorldTransform).translate(-this.oe.x,-this.oe.y)):this.re}get inverseParentTextureTransform(){if(!(4&this.ie))return this.he;this.ie&=-5;const t=this.ae;return t?(this.he||(this.he=new ve),this.he.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t.oe.x,-t.oe.y)):this.worldTransform}get cacheToLocalTransform(){return this.ae?this.ae.textureOffsetInverseTransform:null}}const hs=new he(null),as=new he(null),us=new he(null,1,1),cs=new he(null);class ls extends ue{constructor(t={}){var i,e;super(),this.uid=Pe("renderable"),this.$i=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new ve,this.relativeGroupTransform=new ve,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this.Qi=new he(this,0,0),this.ue=us,this.ce=as,this.le=cs,this.fe=hs,this.de=1,this.pe=0,this.ve=0,this.me=1,this.ge=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this.Ui=0,this.Oi=0,this.be=-1,this.effects=[],function(t,i,e={}){for(const n in i)e[n]||void 0===i[n]||(t[n]=i[n])}(this,t,{children:!0,parent:!0,effects:!0}),null==(i=t.children)||i.forEach(t=>this.addChild(t)),null==(e=t.parent)||e.addChild(this)}static mixin(t){Re(0,"Container.mixin is deprecated, please use extensions.mixin instead."),se.mixin(ls,t)}set ye(t){this.Oi=t>>12&4095,this.Ui=4095&t}get ye(){return 4095&this.Ui|(4095&this.Oi)<<12}addChild(...t){if(this.allowChildren||Re(0,"addChild: Only Containers will be allowed to add children in v8.0.0"),t.length>1){for(let i=0;i<t.length;i++)this.addChild(t[i]);return t[0]}const i=t[0],e=this.renderGroup||this.parentRenderGroup;return i.parent===this?(this.children.splice(this.children.indexOf(i),1),this.children.push(i),e&&(e.structureDidChange=!0),i):(i.parent&&i.parent.removeChild(i),this.children.push(i),this.sortableChildren&&(this.sortDirty=!0),i.parent=this,i.didChange=!0,i.$i=15,e&&e.addChild(i),this.emit("childAdded",i,this,this.children.length-1),i.emit("added",this),this.Oi++,0!==i.Ki&&i.depthOfChildModified(),i)}removeChild(...t){if(t.length>1){for(let i=0;i<t.length;i++)this.removeChild(t[i]);return t[0]}const i=t[0],e=this.children.indexOf(i);return e>-1&&(this.Oi++,this.children.splice(e,1),this.renderGroup?this.renderGroup.removeChild(i):this.parentRenderGroup&&this.parentRenderGroup.removeChild(i),i.parentRenderLayer&&i.parentRenderLayer.detach(i),i.parent=null,this.emit("childRemoved",i,this,e),i.emit("removed",this)),i}Yt(t){t&&t===this.fe&&this.xe(),this.Ui++,this.didChange||(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;null==t||t.removeChild(this),this.renderGroup=Cn.get(os,this),this.groupTransform=ve.IDENTITY,null==t||t.addChild(this),this.Ni()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;null==t||t.removeChild(this),Cn.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,null==t||t.addChild(this),this.Ni()}Ni(){this.isSimple=!this.renderGroup&&0===this.effects.length}get worldTransform(){return this.we||(this.we=new ve),this.renderGroup?this.we.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this.we.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this.we}get x(){return this.Qi.x}set x(t){this.Qi.x=t}get y(){return this.Qi.y}set y(t){this.Qi.y=t}get position(){return this.Qi}set position(t){this.Qi.copyFrom(t)}get rotation(){return this.ge}set rotation(t){this.ge!==t&&(this.ge=t,this.Yt(this.fe))}get angle(){return this.rotation*le}set angle(t){this.rotation=t*fe}get pivot(){return this.ce===as&&(this.ce=new he(this,0,0)),this.ce}set pivot(t){this.ce===as&&(this.ce=new he(this,0,0),this.le!==cs&&_n()),"number"==typeof t?this.ce.set(t):this.ce.copyFrom(t)}get skew(){return this.fe===hs&&(this.fe=new he(this,0,0)),this.fe}set skew(t){this.fe===hs&&(this.fe=new he(this,0,0)),this.fe.copyFrom(t)}get scale(){return this.ue===us&&(this.ue=new he(this,1,1)),this.ue}set scale(t){this.ue===us&&(this.ue=new he(this,0,0)),"string"==typeof t&&(t=parseFloat(t)),"number"==typeof t?this.ue.set(t):this.ue.copyFrom(t)}get origin(){return this.le===cs&&(this.le=new he(this,0,0)),this.le}set origin(t){this.le===cs&&(this.le=new he(this,0,0),this.ce!==as&&_n()),"number"==typeof t?this.le.set(t):this.le.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const i=this.getLocalBounds().width;this.qi(t,i)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const i=this.getLocalBounds().height;this.Xi(t,i)}getSize(t){t||(t={});const i=this.getLocalBounds();return t.width=Math.abs(this.scale.x*i.width),t.height=Math.abs(this.scale.y*i.height),t}setSize(t,i){const e=this.getLocalBounds();"object"==typeof t?(i=t.height??t.width,t=t.width):i??(i=t),void 0!==t&&this.qi(t,e.width),void 0!==i&&this.Xi(i,e.height)}xe(){const t=this.ge,i=this.fe;this.de=Math.cos(t+i.qt),this.pe=Math.sin(t+i.qt),this.ve=-Math.sin(t-i.xt),this.me=Math.cos(t-i.xt)}updateTransform(t){return this.position.set("number"==typeof t.x?t.x:this.position.x,"number"==typeof t.y?t.y:this.position.y),this.scale.set("number"==typeof t.scaleX?t.scaleX||1:this.scale.x,"number"==typeof t.scaleY?t.scaleY||1:this.scale.y),this.rotation="number"==typeof t.rotation?t.rotation:this.rotation,this.skew.set("number"==typeof t.skewX?t.skewX:this.skew.x,"number"==typeof t.skewY?t.skewY:this.skew.y),this.pivot.set("number"==typeof t.pivotX?t.pivotX:this.pivot.x,"number"==typeof t.pivotY?t.pivotY:this.pivot.y),this.origin.set("number"==typeof t.originX?t.originX:this.origin.x,"number"==typeof t.originY?t.originY:this.origin.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this.Ui;if(this.be===t)return;this.be=t;const i=this.localTransform,e=this.ue,n=this.ce,s=this.le,r=this.Qi,o=e.xt,h=e.qt,a=n.xt,u=n.qt,c=-s.xt,l=-s.qt;i.a=this.de*o,i.b=this.pe*o,i.c=this.ve*h,i.d=this.me*h,i.tx=r.xt-(a*i.a+u*i.c)+(c*i.a+l*i.c)-c,i.ty=r.qt-(a*i.b+u*i.d)+(c*i.b+l*i.d)-l}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this.$i|=1,this.Yt())}get alpha(){return this.localAlpha}set tint(t){const i=An.shared.setValue(t??16777215).toBgrNumber();i!==this.localColor&&(this.localColor=i,this.$i|=1,this.Yt())}get tint(){return Hn(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this.$i|=2,this.localBlendMode=t,this.Yt())}get blendMode(){return this.localBlendMode}get visible(){return!!(2&this.localDisplayStatus)}set visible(t){const i=t?2:0;(2&this.localDisplayStatus)!==i&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this.$i|=4,this.localDisplayStatus^=2,this.Yt())}get culled(){return!(4&this.localDisplayStatus)}set culled(t){const i=t?0:4;(4&this.localDisplayStatus)!==i&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this.$i|=4,this.localDisplayStatus^=4,this.Yt())}get renderable(){return!!(1&this.localDisplayStatus)}set renderable(t){const i=t?1:0;(1&this.localDisplayStatus)!==i&&(this.$i|=4,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this.Yt())}get isRenderable(){return 7===this.localDisplayStatus&&this.groupAlpha>0}destroy(t=!1){var i;if(this.destroyed)return;let e;this.destroyed=!0,this.children.length&&(e=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this.Gi=null,this.Di=null,this.effects=null,this.Qi=null,this.ue=null,this.ce=null,this.le=null,this.fe=null,this.emit("destroyed",this),this.removeAllListeners();if(("boolean"==typeof t?t:null==t?void 0:t.children)&&e)for(let n=0;n<e.length;++n)e[n].destroy(t);null==(i=this.renderGroup)||i.destroy(),this.renderGroup=null}}se.mixin(ls,En,Gn,es,Jn,Zn,$n,Un,ts,{cullArea:null,cullable:!1,cullableChildren:!0},Sn,qn,Rn);class fs extends ls{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this.Me=0,this.Ae=-1,this.Te=Object.create(null),this._e=new qe(0,1,0,0),this.ke=!0}get bounds(){return this.ke?(this.updateBounds(),this.ke=!1,this._e):this._e}get roundPixels(){return!!this.Me}set roundPixels(t){this.Me=t?1:0}containsPoint(t){const i=this.bounds,{x:e,y:n}=t;return e>=i.minX&&e<=i.maxX&&n>=i.minY&&n<=i.maxY}onViewUpdate(){if(this.Oi++,this.ke=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}destroy(t){var i,e;super.destroy(t),this._e=null;for(const n in this.Te)null==(e=(i=this.Te[n]).destroy)||e.call(i);this.Te=null}collectRenderablesSimple(t,i,e){const{renderPipes:n}=i;n.blendMode.setBlendMode(this,this.groupBlendMode,t);n[this.renderPipeId].addRenderable(this,t),this.didViewUpdate=!1;const s=this.children,r=s.length;for(let o=0;o<r;o++)s[o].collectRenderables(t,i,e)}}class ds extends fs{constructor(t=Ve.EMPTY){t instanceof Ve&&(t={texture:t});const{texture:i=Ve.EMPTY,anchor:e,roundPixels:n,width:s,height:r,...o}=t;super({label:"Sprite",...o}),this.renderPipeId="sprite",this.batched=!0,this.Ce={minX:0,maxX:1,minY:0,maxY:0},this.Se=new he({Yt:()=>{this.onViewUpdate()}}),e?this.anchor=e:i.defaultAnchor&&(this.anchor=i.defaultAnchor),this.texture=i,this.allowChildren=!1,this.roundPixels=n??!1,void 0!==s&&(this.width=s),void 0!==r&&(this.height=r)}static from(t,i=!1){return new ds(t instanceof Ve?t:Ve.from(t,i))}set texture(t){t||(t=Ve.EMPTY);const i=this.fi;i!==t&&(i&&i.dynamic&&i.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this.fi=t,this.Pe&&this.qi(this.Pe,this.fi.orig.width),this.Ee&&this.Xi(this.Ee,this.fi.orig.height),this.onViewUpdate())}get texture(){return this.fi}get visualBounds(){return We(this.Ce,this.Se,this.fi),this.Ce}get sourceBounds(){return Re(0,"Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const t=this.Se,i=this.fi,e=this._e,{width:n,height:s}=i.orig;e.minX=-t.xt*n,e.maxX=e.minX+n,e.minY=-t.qt*s,e.maxY=e.minY+s}destroy(t=!1){super.destroy(t);if("boolean"==typeof t?t:null==t?void 0:t.texture){const i="boolean"==typeof t?t:null==t?void 0:t.textureSource;this.fi.destroy(i)}this.fi=null,this.Ce=null,this._e=null,this.Se=null,this.Te=null}get anchor(){return this.Se}set anchor(t){"number"==typeof t?this.Se.set(t):this.Se.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this.fi.orig.width}set width(t){this.qi(t,this.fi.orig.width),this.Pe=t}get height(){return Math.abs(this.scale.y)*this.fi.orig.height}set height(t){this.Xi(t,this.fi.orig.height),this.Ee=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this.fi.orig.width,t.height=Math.abs(this.scale.y)*this.fi.orig.height,t}setSize(t,i){"object"==typeof t?(i=t.height??t.width,t=t.width):i??(i=t),void 0!==t&&this.qi(t,this.fi.orig.width),void 0!==i&&this.Xi(i,this.fi.orig.height)}}const ps=new qe;function vs(t,i,e){const n=ps;t.measurable=!0,zn(t,e,n),i.addBoundsMask(n),t.measurable=!1}function ms(t,i,e){const n=In.get();t.measurable=!0;const s=Bn.get().identity();Xn(t,n,gs(t,e,s)),t.measurable=!1,i.addBoundsMask(n),Bn.return(s),In.return(n)}function gs(t,i,e){return t?(t!==i&&(gs(t.parent,i,e),t.updateLocalTransform(),e.append(t.localTransform)),e):(_n(),e)}class bs{constructor(t){this.priority=0,this.inverse=!1,this.pipe="alphaMask",(null==t?void 0:t.mask)&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof ds),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(t,i){this.inverse||vs(this.mask,t,i)}addLocalBounds(t,i){ms(this.mask,t,i)}containsPoint(t,i){return i(this.mask,t)}destroy(){this.reset()}static test(t){return t instanceof ds}}bs.extension=ie.MaskEffect;class ys{constructor(t){this.priority=0,this.pipe="colorMask",(null==t?void 0:t.mask)&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return"number"==typeof t}}ys.extension=ie.MaskEffect;class xs{constructor(t){this.priority=0,this.pipe="stencilMask",(null==t?void 0:t.mask)&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(t,i){vs(this.mask,t,i)}addLocalBounds(t,i){ms(this.mask,t,i)}containsPoint(t,i){return i(this.mask,t)}destroy(){this.reset()}static test(t){return t instanceof ls}}xs.extension=ie.MaskEffect;let ws={createCanvas:(t,i)=>{const e=document.createElement("canvas");return e.width=t,e.height=i,e},createImage:()=>new Image,getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,i)=>fetch(t,i),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")};const Ms={get:()=>ws,set(t){ws=t}};class As extends ze{constructor(t){t.resource||(t.resource=Ms.get().createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.uploadMethodId="image",this.autoDensity=t.autoDensity,this.resizeCanvas(),this.transparent=!!t.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),this.resource.width===this.pixelWidth&&this.resource.height===this.pixelHeight||(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(t=this.width,i=this.height,e=this.si){const n=super.resize(t,i,e);return n&&this.resizeCanvas(),n}static test(t){return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&t instanceof OffscreenCanvas}get context2D(){return this.Re||(this.Re=this.resource.getContext("2d"))}}As.extension=ie.TextureSource;class Ts extends ze{constructor(t){super(t),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(t){return globalThis.HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||globalThis.VideoFrame&&t instanceof VideoFrame}}Ts.extension=ie.TextureSource;var _s=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(_s||{});class ks{constructor(t,i=null,e=0,n=!1){this.next=null,this.previous=null,this.Fe=!1,this.Oe=t,this.$e=i,this.priority=e,this.Ue=n}match(t,i=null){return this.Oe===t&&this.$e===i}emit(t){this.Oe&&(this.$e?this.Oe.call(this.$e,t):this.Oe(t));const i=this.next;return this.Ue&&this.destroy(!0),this.Fe&&(this.next=null),i}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this.Fe=!0,this.Oe=null,this.$e=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const i=this.next;return this.next=t?null:i,this.previous=null,i}}const Cs=class t{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this.Be=null,this.Ie=100,this.je=0,this.Ge=!1,this.ze=-1,this.De=new ks(null,null,1/0),this.deltaMS=1/t.targetFPMS,this.elapsedMS=1/t.targetFPMS,this.Le=t=>{this.Be=null,this.started&&(this.update(t),this.started&&null===this.Be&&this.De.next&&(this.Be=requestAnimationFrame(this.Le)))}}Ne(){null===this.Be&&this.De.next&&(this.lastTime=performance.now(),this.ze=this.lastTime,this.Be=requestAnimationFrame(this.Le))}Ve(){null!==this.Be&&(cancelAnimationFrame(this.Be),this.Be=null)}We(){this.started?this.Ne():this.autoStart&&this.start()}add(t,i,e=_s.NORMAL){return this.He(new ks(t,i,e))}addOnce(t,i,e=_s.NORMAL){return this.He(new ks(t,i,e,!0))}He(t){let i=this.De.next,e=this.De;if(i){for(;i;){if(t.priority>i.priority){t.connect(e);break}e=i,i=i.next}t.previous||t.connect(e)}else t.connect(e);return this.We(),this}remove(t,i){let e=this.De.next;for(;e;)e=e.match(t,i)?e.destroy():e.next;return this.De.next||this.Ve(),this}get count(){if(!this.De)return 0;let t=0,i=this.De;for(;i=i.next;)t++;return t}start(){this.started||(this.started=!0,this.Ne())}stop(){this.started&&(this.started=!1,this.Ve())}destroy(){if(!this.Ge){this.stop();let t=this.De.next;for(;t;)t=t.destroy(!0);this.De.destroy(),this.De=null}}update(i=performance.now()){let e;if(i>this.lastTime){if(e=this.elapsedMS=i-this.lastTime,e>this.Ie&&(e=this.Ie),e*=this.speed,this.je){const t=i-this.ze|0;if(t<this.je)return;this.ze=i-t%this.je}this.deltaMS=e,this.deltaTime=this.deltaMS*t.targetFPMS;const n=this.De;let s=n.next;for(;s;)s=s.emit(this);n.next||this.Ve()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=i}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this.Ie}set minFPS(i){const e=Math.min(this.maxFPS,i),n=Math.min(Math.max(0,e)/1e3,t.targetFPMS);this.Ie=1/n}get maxFPS(){return this.je?Math.round(1e3/this.je):0}set maxFPS(t){if(0===t)this.je=0;else{const i=Math.max(this.minFPS,t);this.je=1/(i/1e3)}}static get shared(){if(!t.qe){const i=t.qe=new t;i.autoStart=!0,i.Ge=!0}return t.qe}static get system(){if(!t.Xe){const i=t.Xe=new t;i.autoStart=!0,i.Ge=!0}return t.Xe}};Cs.targetFPMS=.06;let Ss,Ps=Cs;const Es=class t extends ze{constructor(i){super(i),this.isReady=!1,this.uploadMethodId="video",i={...t.defaultOptions,...i},this.Ye=!0,this.Ke=!1,this.Qe=i.updateFPS||0,this.Ze=0,this.autoPlay=!1!==i.autoPlay,this.alphaMode=i.alphaMode??"premultiply-alpha-on-upload",this.Je=this.Je.bind(this),this.tn=null,this.en=null,this.nn=null,this.sn=null,this.rn=this.rn.bind(this),this.hn=this.hn.bind(this),this.an=this.an.bind(this),this.un=this.un.bind(this),this.cn=this.cn.bind(this),this.ln=this.ln.bind(this),!1!==i.autoLoad&&this.load()}updateFrame(){if(!this.destroyed){if(this.Qe){const t=Ps.shared.elapsedMS*this.resource.playbackRate;this.Ze=Math.floor(this.Ze-t)}(!this.Qe||this.Ze<=0)&&(this.Ze=this.Qe?Math.floor(1e3/this.Qe):0),this.isValid&&this.update()}}Je(){this.updateFrame(),this.destroyed?this.tn=null:this.tn=this.resource.requestVideoFrameCallback(this.Je)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this.en)return this.en;const t=this.resource,i=this.options;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this.un),t.addEventListener("pause",this.cn),t.addEventListener("seeked",this.ln),this.dn()?this.pn():(i.preload||t.addEventListener("canplay",this.rn),t.addEventListener("canplaythrough",this.hn),t.addEventListener("error",this.an,!0)),this.alphaMode=await async function(){return Ss??(Ss=(async()=>{var t;const i=Ms.get().createCanvas(1,1).getContext("webgl");if(!i)return"premultiply-alpha-on-upload";const e=await new Promise(t=>{const i=document.createElement("video");i.onloadeddata=()=>t(i),i.onerror=()=>t(null),i.autoplay=!1,i.crossOrigin="anonymous",i.preload="auto",i.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",i.load()});if(!e)return"premultiply-alpha-on-upload";const n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n);const s=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,s),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n,0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e);const r=new Uint8Array(4);return i.readPixels(0,0,1,1,i.RGBA,i.UNSIGNED_BYTE,r),i.deleteFramebuffer(s),i.deleteTexture(n),null==(t=i.getExtension("WEBGL_lose_context"))||t.loseContext(),r[0]<=r[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),Ss}(),this.en=new Promise((e,n)=>{this.isValid?e(this):(this.nn=e,this.sn=n,void 0!==i.preloadTimeoutMs&&(this.vn=setTimeout(()=>{this.an(new ErrorEvent(`Preload exceeded timeout of ${i.preloadTimeoutMs}ms`))})),t.load())}),this.en}an(t){this.resource.removeEventListener("error",this.an,!0),this.emit("error",t),this.sn&&(this.sn(t),this.sn=null,this.nn=null)}mn(){const t=this.resource;return!t.paused&&!t.ended}dn(){return this.resource.readyState>2}un(){this.isValid||this.pn(),this.gn()}cn(){this.gn()}ln(){this.Ye&&!this.mn()&&(this.Ze=0,this.updateFrame(),this.Ze=0)}rn(){this.resource.removeEventListener("canplay",this.rn),this.pn()}hn(){this.resource.removeEventListener("canplaythrough",this.rn),this.vn&&(clearTimeout(this.vn),this.vn=void 0),this.pn()}pn(){const t=this.resource;this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this.Ze=0,this.updateFrame(),this.Ze=0,this.nn&&(this.nn(this),this.nn=null,this.sn=null),this.mn()?this.un():this.autoPlay&&this.resource.play()}destroy(){this.gn();const t=this.resource;t&&(t.removeEventListener("play",this.un),t.removeEventListener("pause",this.cn),t.removeEventListener("seeked",this.ln),t.removeEventListener("canplay",this.rn),t.removeEventListener("canplaythrough",this.hn),t.removeEventListener("error",this.an,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this.Ye}set autoUpdate(t){t!==this.Ye&&(this.Ye=t,this.gn())}get updateFPS(){return this.Qe}set updateFPS(t){t!==this.Qe&&(this.Qe=t,this.gn())}gn(){this.Ye&&this.mn()?!this.Qe&&this.resource.requestVideoFrameCallback?(this.Ke&&(Ps.shared.remove(this.updateFrame,this),this.Ke=!1,this.Ze=0),null===this.tn&&(this.tn=this.resource.requestVideoFrameCallback(this.Je))):(null!==this.tn&&(this.resource.cancelVideoFrameCallback(this.tn),this.tn=null),this.Ke||(Ps.shared.add(this.updateFrame,this),this.Ke=!0,this.Ze=0)):(null!==this.tn&&(this.resource.cancelVideoFrameCallback(this.tn),this.tn=null),this.Ke&&(Ps.shared.remove(this.updateFrame,this),this.Ke=!1,this.Ze=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement}};Es.extension=ie.TextureSource,Es.defaultOptions={...ze.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1},Es.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Rs=Es;const Fs=(t,i,e=!1)=>(Array.isArray(t)||(t=[t]),i?t.map(t=>"string"==typeof t||e?i(t):t):t);const Os=new class{constructor(){this.bn=[],this.yn=new Map,this.xn=new Map}reset(){this.xn.clear(),this.yn.clear()}has(t){return this.yn.has(t)}get(t){const i=this.yn.get(t);return i||_n(),i}set(t,i){const e=Fs(t);let n;for(let h=0;h<this.parsers.length;h++){const t=this.parsers[h];if(t.test(i)){n=t.getCacheableAssets(e,i);break}}const s=new Map(Object.entries(n||{}));n||e.forEach(t=>{s.set(t,i)});const r=[...s.keys()],o={cacheKeys:r,keys:e};e.forEach(t=>{this.xn.set(t,o)}),r.forEach(t=>{const e=n?n[t]:i;this.yn.has(t)&&this.yn.get(t)!==e&&_n(),this.yn.set(t,s.get(t))})}remove(t){if(!this.xn.has(t))return void _n();const i=this.xn.get(t);i.cacheKeys.forEach(t=>{this.yn.delete(t)}),i.keys.forEach(t=>{this.xn.delete(t)})}get parsers(){return this.bn}},$s=[];function Us(t={}){const i=t&&t.resource,e=i?t.resource:t,n=i?t:{resource:t};for(let s=0;s<$s.length;s++){const t=$s[s];if(t.test(e))return new t(n)}throw new Error(`Could not find a source type for resource: ${n.resource}`)}se.handleByList(ie.TextureSource,$s),Ve.from=function(t,i=!1){return"string"==typeof t?Os.get(t):t instanceof ze?new Ve({source:t}):function(t={},i=!1){const e=t&&t.resource,n=e?t.resource:t,s=e?t:{resource:t};if(!i&&Os.has(n))return Os.get(n);const r=new Ve({source:Us(s)});return r.on("destroy",()=>{Os.has(n)&&Os.remove(n)}),i||Os.set(n,r),r}(t,i)},ze.from=Us,se.add(bs,ys,xs,Rs,Ts,As,De);var Bs=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Bs||{});function Is(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function js(t){return t.split("?")[0].split("#")[0]}const Gs={toPosix(t){return i="\\",e="/",t.replace(new RegExp(i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),e);var i,e},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),isBlobUrl:t=>t.startsWith("blob:"),hasProtocol(t){return/^[^/:]+:/.test(this.toPosix(t))},getProtocol(t){Is(t),t=this.toPosix(t);const i=/^file:\/\/\//.exec(t);if(i)return i[0];const e=/^[^/:]+:\/{0,2}/.exec(t);return e?e[0]:""},toAbsolute(t,i,e){if(Is(t),this.isDataUrl(t)||this.isBlobUrl(t))return t;const n=js(this.toPosix(i??Ms.get().getBaseUrl())),s=js(this.toPosix(e??this.rootname(n)));if((t=this.toPosix(t)).startsWith("/"))return Gs.join(s,t.slice(1));return this.isAbsolute(t)?t:this.join(n,t)},normalize(t){if(Is(t),0===t.length)return".";if(this.isDataUrl(t)||this.isBlobUrl(t))return t;let i="";const e=(t=this.toPosix(t)).startsWith("/");this.hasProtocol(t)&&(i=this.rootname(t),t=t.slice(i.length));const n=t.endsWith("/");return(t=function(t){let i="",e=0,n=-1,s=0,r=-1;for(let o=0;o<=t.length;++o){if(o<t.length)r=t.charCodeAt(o);else{if(47===r)break;r=47}if(47===r){if(n===o-1||1===s);else if(n!==o-1&&2===s){if(i.length<2||2!==e||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2))if(i.length>2){const t=i.lastIndexOf("/");if(t!==i.length-1){-1===t?(i="",e=0):(i=i.slice(0,t),e=i.length-1-i.lastIndexOf("/")),n=o,s=0;continue}}else if(2===i.length||1===i.length){i="",e=0,n=o,s=0;continue}}else i.length>0?i+=`/${t.slice(n+1,o)}`:i=t.slice(n+1,o),e=o-n-1;n=o,s=0}else 46===r&&-1!==s?++s:s=-1}return i}(t)).length>0&&n&&(t+="/"),e?`/${t}`:i+t},isAbsolute(t){return Is(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let i;for(let e=0;e<t.length;++e){const n=t[e];if(Is(n),n.length>0)if(void 0===i)i=n;else{const s=t[e-1]??"";this.joinExtensions.includes(this.extname(s).toLowerCase())?i+=`/../${n}`:i+=`/${n}`}}return void 0===i?".":this.normalize(i)},dirname(t){if(Is(t),0===t.length)return".";let i=(t=this.toPosix(t)).charCodeAt(0);const e=47===i;let n=-1,s=!0;const r=this.getProtocol(t),o=t;for(let h=(t=t.slice(r.length)).length-1;h>=1;--h)if(i=t.charCodeAt(h),47===i){if(!s){n=h;break}}else s=!1;return-1===n?e?"/":this.isUrl(o)?r+t:r:e&&1===n?"//":r+t.slice(0,n)},rootname(t){Is(t);let i="";if(i=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const e=t.indexOf("/",i.length);i=-1!==e?t.slice(0,e):t,i.endsWith("/")||(i+="/")}return i},basename(t,i){Is(t),i&&Is(i),t=js(this.toPosix(t));let e,n=0,s=-1,r=!0;if(void 0!==i&&i.length>0&&i.length<=t.length){if(i.length===t.length&&i===t)return"";let o=i.length-1,h=-1;for(e=t.length-1;e>=0;--e){const a=t.charCodeAt(e);if(47===a){if(!r){n=e+1;break}}else-1===h&&(r=!1,h=e+1),o>=0&&(a===i.charCodeAt(o)?-1===--o&&(s=e):(o=-1,s=h))}return n===s?s=h:-1===s&&(s=t.length),t.slice(n,s)}for(e=t.length-1;e>=0;--e)if(47===t.charCodeAt(e)){if(!r){n=e+1;break}}else-1===s&&(r=!1,s=e+1);return-1===s?"":t.slice(n,s)},extname(t){Is(t);let i=-1,e=0,n=-1,s=!0,r=0;for(let o=(t=js(this.toPosix(t))).length-1;o>=0;--o){const h=t.charCodeAt(o);if(47!==h)-1===n&&(s=!1,n=o+1),46===h?-1===i?i=o:1!==r&&(r=1):-1!==i&&(r=-1);else if(!s){e=o+1;break}}return-1===i||-1===n||0===r||1===r&&i===n-1&&i===e+1?"":t.slice(i,n)},parse(t){Is(t);const i={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return i;let e=(t=js(this.toPosix(t))).charCodeAt(0);const n=this.isAbsolute(t);let s;i.root=this.rootname(t),s=n||this.hasProtocol(t)?1:0;let r=-1,o=0,h=-1,a=!0,u=t.length-1,c=0;for(;u>=s;--u)if(e=t.charCodeAt(u),47!==e)-1===h&&(a=!1,h=u+1),46===e?-1===r?r=u:1!==c&&(c=1):-1!==r&&(c=-1);else if(!a){o=u+1;break}return-1===r||-1===h||0===c||1===c&&r===h-1&&r===o+1?-1!==h&&(i.base=i.name=0===o&&n?t.slice(1,h):t.slice(o,h)):(0===o&&n?(i.name=t.slice(1,r),i.base=t.slice(1,h)):(i.name=t.slice(o,r),i.base=t.slice(o,h)),i.ext=t.slice(r,h)),i.dir=this.dirname(t),i},sep:"/",delimiter:":",joinExtensions:[".html"]};function zs(t,i,e,n,s){const r=i[e];for(let o=0;o<r.length;o++){const h=r[o];e<i.length-1?zs(t.replace(n[e],h),i,e+1,n,s):s.push(t.replace(n[e],h))}}function Ds(t){const i=t.match(/\{(.*?)\}/g),e=[];if(i){const n=[];i.forEach(t=>{const i=t.substring(1,t.length-1).split(",");n.push(i)}),zs(t,n,0,i,e)}else e.push(t);return e}const Ls=t=>!Array.isArray(t);class Ns{constructor(){this.wn={connector:"-",createBundleAssetId:(t,i)=>`${t}${this.Mn}${i}`,extractAssetIdFromBundle:(t,i)=>i.replace(`${t}${this.Mn}`,"")},this.Mn=this.wn.connector,this.An=this.wn.createBundleAssetId,this.Tn=this.wn.extractAssetIdFromBundle,this._n={},this.kn=[],this.bn=[],this.Cn={},this.Sn={}}setBundleIdentifier(t){if(this.Mn=t.connector??this.Mn,this.An=t.createBundleAssetId??this.An,this.Tn=t.extractAssetIdFromBundle??this.Tn,"bar"!==this.Tn("foo",this.An("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(t=>{this.kn.push(t),t.priority||(t.priority=Object.keys(t.params))}),this.Cn={}}set basePath(t){this.Pn=t}get basePath(){return this.Pn}set rootPath(t){this.En=t}get rootPath(){return this.En}get parsers(){return this.bn}reset(){this.setBundleIdentifier(this.wn),this._n={},this.kn=[],this.Cn={},this.En=null,this.Pn=null,this.Rn=null,this.Sn={},this.Fn=null}setDefaultSearchParams(t){if("string"==typeof t)this.Fn=t;else{const i=t;this.Fn=Object.keys(i).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(i[t])}`).join("&")}}getAlias(t){const{alias:i,src:e}=t;return Fs(i||e,t=>"string"==typeof t?t:Array.isArray(t)?t.map(t=>(null==t?void 0:t.src)??t):(null==t?void 0:t.src)?t.src:t,!0)}addManifest(t){this.Rn&&_n(),this.Rn=t,t.bundles.forEach(t=>{this.addBundle(t.name,t.assets)})}addBundle(t,i){const e=[];let n=i;Array.isArray(i)||(n=Object.entries(i).map(([t,i])=>"string"==typeof i||Array.isArray(i)?{alias:t,src:i}:{alias:t,...i})),n.forEach(i=>{const n=i.src,s=i.alias;let r;if("string"==typeof s){const i=this.An(t,s);e.push(i),r=[s,i]}else{const i=s.map(i=>this.An(t,i));e.push(...i),r=[...s,...i]}this.add({...i,alias:r,src:n})}),this.Sn[t]=e}add(t){const i=[];let e;Array.isArray(t)?i.push(...t):i.push(t),e=t=>{this.hasKey(t)&&_n()};Fs(i).forEach(t=>{const{src:i}=t;let{data:n,format:s,loadParser:r,parser:o}=t;const h=Fs(i).map(t=>"string"==typeof t?Ds(t):Array.isArray(t)?t:[t]),a=this.getAlias(t);Array.isArray(a)?a.forEach(e):e(a);const u=[];h.forEach(t=>{t.forEach(t=>{let i={};if("object"!=typeof t){i.src=t;for(let e=0;e<this.bn.length;e++){const n=this.bn[e];if(n.test(t)){i=n.parse(t);break}}}else n=t.data??n,s=t.format??s,(t.loadParser||t.parser)&&(r=t.loadParser??r,o=t.parser??o),i={...i,...t};if(!a)throw new Error(`[Resolver] alias is undefined for this asset: ${i.src}`);i=this.On(i,{aliases:a,data:n,format:s,loadParser:r,parser:o}),u.push(i)})}),a.forEach(t=>{this._n[t]=u})})}resolveBundle(t){const i=Ls(t);t=Fs(t);const e={};return t.forEach(t=>{const i=this.Sn[t];if(i){const n=this.resolve(i),s={};for(const i in n){const e=n[i];s[this.Tn(t,i)]=e}e[t]=s}}),i?e[t[0]]:e}resolveUrl(t){const i=this.resolve(t);if("string"!=typeof t){const t={};for(const e in i)t[e]=i[e].src;return t}return i.src}resolve(t){const i=Ls(t);t=Fs(t);const e={};return t.forEach(t=>{if(!this.Cn[t])if(this._n[t]){let i=this._n[t];const e=this.$n(i);null==e||e.priority.forEach(t=>{e.params[t].forEach(e=>{const n=i.filter(i=>!!i[t]&&i[t]===e);n.length&&(i=n)})}),this.Cn[t]=i[0]}else this.Cn[t]=this.On({alias:[t],src:t},{});e[t]=this.Cn[t]}),i?e[t[0]]:e}hasKey(t){return!!this._n[t]}hasBundle(t){return!!this.Sn[t]}$n(t){for(let i=0;i<t.length;i++){const e=t[i],n=this.kn.find(t=>t.params.format.includes(e.format));if(n)return n}return this.kn[0]}Un(t){if(!this.Fn)return t;return`${t}${/\?/.test(t)?"&":"?"}${this.Fn}`}On(t,i){const{aliases:e,data:n,loadParser:s,parser:r,format:o}=i;return(this.Pn||this.En)&&(t.src=Gs.toAbsolute(t.src,this.Pn,this.En)),t.alias=e??t.alias??[t.src],t.src=this.Un(t.src),t.data={...n||{},...t.data},t.loadParser=s??t.loadParser,t.parser=r??t.parser,t.format=o??t.format??t.src.split(".").pop().split("?").shift().split("#").shift(),t}}Ns.RETINA_PREFIX=/@([0-9\.]+)x/;const Vs=(t,i)=>{const e=i.split("?")[1];return e&&(t+=`?${e}`),t},Ws=class t{constructor(t,i){this.linkedSheets=[];let e=t;(null==t?void 0:t.source)instanceof ze&&(e={texture:t,data:i});const{texture:n,data:s,cachePrefix:r=""}=e;this.cachePrefix=r,this.fi=n instanceof Ve?n:null,this.textureSource=n.source,this.textures={},this.animations={},this.data=s;const o=parseFloat(s.meta.scale);o?(this.resolution=o,n.source.resolution=this.resolution):this.resolution=n.source.si,this.Bn=this.data.frames,this.In=Object.keys(this.Bn),this.jn=0,this.Gn=null}parse(){return new Promise(i=>{this.Gn=i,this.jn=0,this.In.length<=t.BATCH_SIZE?(this.zn(0),this.Dn(),this.Ln()):this.Vn()})}zn(i){let e=i;const n=t.BATCH_SIZE;for(;e-i<n&&e<this.In.length;){const t=this.In[e],i=this.Bn[t],n=i.frame;if(n){let e=null,s=null;const r=!1!==i.trimmed&&i.sourceSize?i.sourceSize:i.frame,o=new Ce(0,0,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution);e=i.rotated?new Ce(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):new Ce(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),!1!==i.trimmed&&i.spriteSourceSize&&(s=new Ce(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[t]=new Ve({source:this.textureSource,frame:e,orig:o,trim:s,rotate:i.rotated?2:0,defaultAnchor:i.anchor,defaultBorders:i.borders,label:t.toString()})}e++}}Dn(){const t=this.data.animations||{};for(const i in t){this.animations[i]=[];for(let e=0;e<t[i].length;e++){const n=t[i][e];this.animations[i].push(this.textures[n])}}}Ln(){const t=this.Gn;this.Gn=null,this.jn=0,t.call(this,this.textures)}Vn(){this.zn(this.jn*t.BATCH_SIZE),this.jn++,setTimeout(()=>{this.jn*t.BATCH_SIZE<this.In.length?this.Vn():(this.Dn(),this.Ln())},0)}destroy(t=!1){var i;for(const e in this.textures)this.textures[e].destroy();this.Bn=null,this.In=null,this.data=null,this.textures=null,t&&(null==(i=this.fi)||i.destroy(),this.textureSource.destroy()),this.fi=null,this.textureSource=null,this.linkedSheets=[]}};Ws.BATCH_SIZE=1e3;let Hs=Ws;const qs=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function Xs(t,i,e){const n={};if(t.forEach(t=>{n[t]=i}),Object.keys(i.textures).forEach(t=>{n[`${i.cachePrefix}${t}`]=i.textures[t]}),!e){const e=Gs.dirname(t[0]);i.linkedSheets.forEach((t,s)=>{const r=Xs([`${e}/${i.data.meta.related_multi_packs[s]}`],t,!0);Object.assign(n,r)})}return n}const Ys={extension:ie.Asset,cache:{test:t=>t instanceof Hs,getCacheableAssets:(t,i)=>Xs(t,i,!1)},resolver:{extension:{type:ie.ResolveParser,name:"resolveSpritesheet"},test:t=>{const i=t.split("?")[0].split("."),e=i.pop(),n=i.pop();return"json"===e&&qs.includes(n)},parse:t=>{var i;const e=t.split(".");return{resolution:parseFloat((null==(i=Ns.RETINA_PREFIX.exec(t))?void 0:i[1])??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",id:"spritesheet",extension:{type:ie.LoadParser,priority:Bs.Normal,name:"spritesheetLoader"},testParse:async(t,i)=>".json"===Gs.extname(i.src).toLowerCase()&&!!t.frames,async parse(t,i,e){var n,s;const{texture:r,imageFilename:o,textureOptions:h,cachePrefix:a}=(null==i?void 0:i.data)??{};let u,c=Gs.dirname(i.src);if(c&&c.lastIndexOf("/")!==c.length-1&&(c+="/"),r instanceof Ve)u=r;else{const n=Vs(c+(o??t.meta.image),i.src);u=(await e.load([{src:n,data:h}]))[n]}const l=new Hs({texture:u.source,data:t,cachePrefix:a});await l.parse();const f=null==(n=null==t?void 0:t.meta)?void 0:n.related_multi_packs;if(Array.isArray(f)){const t=[];for(const r of f){if("string"!=typeof r)continue;let n=c+r;(null==(s=i.data)?void 0:s.ignoreMultiPack)||(n=Vs(n,i.src),t.push(e.load({src:n,data:{textureOptions:h,ignoreMultiPack:!0}})))}const n=await Promise.all(t);l.linkedSheets=n,n.forEach(t=>{t.linkedSheets=[l].concat(l.linkedSheets.filter(i=>i!==t))})}return l},async unload(t,i,e){await e.unload(t.textureSource.Wn),t.destroy(!1)}}};se.add(Ys);class Ks{constructor(t){this.Hn="",this.Xt=null,this.qn=!1,this.updateTranslation=()=>{if(!this.Xn)return;const t=this.Xn.getBoundingClientRect(),i=this.Xn.width,e=this.Xn.height,n=t.width/i*this.Yn.resolution,s=t.height/e*this.Yn.resolution,r=`translate(${t.left}px, ${t.top}px) scale(${n}, ${s})`;r!==this.Hn&&(this.Kn.style.transform=r,this.Hn=r)},this.Kn=t.domElement,this.Yn=t.renderer,globalThis.OffscreenCanvas&&this.Yn.canvas instanceof OffscreenCanvas||(this.Xn=this.Yn.canvas,this.Qn())}get canvas(){return this.Xn}ensureAttached(){!this.Kn.parentNode&&this.Xn.parentNode&&(this.Xn.parentNode.appendChild(this.Kn),this.updateTranslation())}Qn(){"ResizeObserver"in globalThis?(this.Xt&&(this.Xt.disconnect(),this.Xt=null),this.Xt=new ResizeObserver(t=>{for(const i of t){if(i.target!==this.Xn)continue;const t=this.canvas.width,e=this.canvas.height,n=i.contentRect.width/t*this.Yn.resolution,s=i.contentRect.height/e*this.Yn.resolution;(this.Zn!==n||this.Jn!==s)&&(this.updateTranslation(),this.Zn=n,this.Jn=s)}}),this.Xt.observe(this.Xn)):this.qn||Ps.shared.add(this.updateTranslation,this,_s.HIGH)}destroy(){this.Xt?(this.Xt.disconnect(),this.Xt=null):this.qn&&Ps.shared.remove(this.updateTranslation),this.Kn=null,this.Yn=null,this.Xn=null,this.qn=!1,this.Hn="",this.Zn=null,this.Jn=null}}class Qs{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Qs.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new de,this.page=new de,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,i,e){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,i,e,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}var Zs=/iPhone/i,Js=/iPod/i,tr=/iPad/i,ir=/\biOS-universal(?:.+)Mac\b/i,er=/\bAndroid(?:.+)Mobile\b/i,nr=/Android/i,sr=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,rr=/Silk/i,or=/Windows Phone/i,hr=/\bWindows(?:.+)ARM\b/i,ar=/BlackBerry/i,ur=/BB10/i,cr=/Opera Mini/i,lr=/\b(CriOS|Chrome)(?:.+)Mobile/i,fr=/Mobile(?:.+)Firefox\b/i,dr=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function pr(t){var i={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?i.userAgent=t:t&&t.userAgent&&(i={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):i={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var e=i.userAgent,n=e.split("[FBAN");void 0!==n[1]&&(e=n[0]),void 0!==(n=e.split("Twitter"))[1]&&(e=n[0]);var s=function(t){return function(i){return i.test(t)}}(e),r={apple:{phone:s(Zs)&&!s(or),ipod:s(Js),tablet:!s(Zs)&&(s(tr)||dr(i))&&!s(or),universal:s(ir),device:(s(Zs)||s(Js)||s(tr)||s(ir)||dr(i))&&!s(or)},amazon:{phone:s(sr),tablet:!s(sr)&&s(rr),device:s(sr)||s(rr)},android:{phone:!s(or)&&s(sr)||!s(or)&&s(er),tablet:!s(or)&&!s(sr)&&!s(er)&&(s(rr)||s(nr)),device:!s(or)&&(s(sr)||s(rr)||s(er)||s(nr))||s(/\bokhttp\b/i)},windows:{phone:s(or),tablet:s(hr),device:s(or)||s(hr)},other:{blackberry:s(ar),blackberry10:s(ur),opera:s(cr),firefox:s(fr),chrome:s(lr),device:s(ar)||s(ur)||s(cr)||s(fr)||s(lr)},any:!1,phone:!1,tablet:!1};return r.any=r.apple.device||r.android.device||r.windows.device||r.other.device,r.phone=r.apple.phone||r.android.phone||r.windows.phone,r.tablet=r.apple.tablet||r.android.tablet||r.windows.tablet,r}const vr=(pr.default??pr)(globalThis.navigator),mr=class t{constructor(t,i=vr){this.ts=i,this.debug=!1,this.es=!0,this.ns=!0,this.ss=!1,this.rs=!1,this.hs=null,this.Si=[],this.us=0,this.cs=[],this.ls=0,this.fs=500,this.ds=null,(i.tablet||i.phone)&&this.ps(),this.Yn=t}get isActive(){return this.ss}get isMobileAccessibility(){return this.rs}get hookDiv(){return this.ds}ps(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this.rs=!0,this.vs(),this.gs()}),document.body.appendChild(t),this.ds=t}gs(){this.ds&&(document.body.removeChild(this.ds),this.ds=null)}vs(){if(this.ss)return;this.ss=!0,this.hs||(this.hs=document.createElement("div"),this.hs.style.position="absolute",this.hs.style.top="0px",this.hs.style.left="0px",this.hs.style.pointerEvents="none",this.hs.style.zIndex=2..toString(),this.bs=new Ks({domElement:this.hs,renderer:this.Yn})),this.es&&(this.ys=this.ys.bind(this),globalThis.addEventListener("keydown",this.ys,!1)),this.ns&&(this.xs=this.xs.bind(this),globalThis.document.addEventListener("mousemove",this.xs,!0));const t=this.Yn.view.canvas;if(t.parentNode)this.bs.ensureAttached(),this.ws();else{const i=new MutationObserver(()=>{t.parentNode&&(i.disconnect(),this.bs.ensureAttached(),this.ws())});i.observe(document.body,{childList:!0,subtree:!0})}}ws(){this.Yn.runners.postrender.add(this),this.Yn.lastObjectRendered&&this.Ms(this.Yn.lastObjectRendered)}As(){if(this.ss&&!this.rs){this.ss=!1,globalThis.document.removeEventListener("mousemove",this.xs,!0),this.es&&globalThis.addEventListener("keydown",this.ys,!1),this.Yn.runners.postrender.remove(this);for(const t of this.cs)t.Ts&&t.Ts.parentNode&&(t.Ts.parentNode.removeChild(t.Ts),t.Ts=null),t._s=!1;this.Si.forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)}),this.hs&&this.hs.parentNode&&this.hs.parentNode.removeChild(this.hs),this.Si=[],this.cs=[]}}Ms(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&(t._s||this.ks(t),t.us=this.us);const i=t.children;if(i)for(let e=0;e<i.length;e++)this.Ms(i[e])}init(i){const e={accessibilityOptions:{...t.defaultOptions,...(null==i?void 0:i.accessibilityOptions)||{}}};this.debug=e.accessibilityOptions.debug,this.es=e.accessibilityOptions.activateOnTab,this.ns=e.accessibilityOptions.deactivateOnMouseMove,e.accessibilityOptions.enabledByDefault?this.vs():this.es&&(this.ys=this.ys.bind(this),globalThis.addEventListener("keydown",this.ys,!1)),this.Yn.runners.postrender.remove(this)}postrender(){const t=performance.now();if(this.ts.android.device&&t<this.ls)return;if(this.ls=t+this.fs,!this.Yn.renderingToScreen||!this.Yn.view.canvas)return;const i=new Set;if(this.Yn.lastObjectRendered){this.Ms(this.Yn.lastObjectRendered);for(const t of this.cs)t.us===this.us&&i.add(this.cs.indexOf(t))}for(let e=this.cs.length-1;e>=0;e--){const t=this.cs[e];i.has(e)||(t.Ts&&t.Ts.parentNode&&(t.Ts.parentNode.removeChild(t.Ts),this.Si.push(t.Ts),t.Ts=null),t._s=!1,Pn(this.cs,e,1))}this.Yn.renderingToScreen&&this.bs.ensureAttached();for(let e=0;e<this.cs.length;e++){const t=this.cs[e];if(!t._s||!t.Ts)continue;const i=t.Ts,n=t.hitArea||t.getBounds().rectangle;if(t.hitArea){const e=t.worldTransform;i.style.left=`${e.tx+n.x*e.a}px`,i.style.top=`${e.ty+n.y*e.d}px`,i.style.width=n.width*e.a+"px",i.style.height=n.height*e.d+"px"}else this.Cs(n),i.style.left=`${n.x}px`,i.style.top=`${n.y}px`,i.style.width=`${n.width}px`,i.style.height=`${n.height}px`}this.us++}Ss(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}Cs(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:i,height:e}=this.Yn;t.x+t.width>i&&(t.width=i-t.x),t.y+t.height>e&&(t.height=e-t.y)}ks(t){let i=this.Si.pop();i||("button"===t.accessibleType?i=document.createElement("button"):(i=document.createElement(t.accessibleType),i.style.cssText="\n                        color: transparent;\n                        pointer-events: none;\n                        padding: 0;\n                        margin: 0;\n                        border: 0;\n                        outline: 0;\n                        background: transparent;\n                        box-sizing: border-box;\n                        user-select: none;\n                        -webkit-user-select: none;\n                        -moz-user-select: none;\n                        -ms-user-select: none;\n                    ",t.accessibleText&&(i.innerText=t.accessibleText)),i.style.width="100px",i.style.height="100px",i.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",i.style.position="absolute",i.style.zIndex=2..toString(),i.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?i.setAttribute("aria-live","off"):i.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?i.setAttribute("aria-relevant","additions"):i.setAttribute("aria-relevant","text"),i.addEventListener("click",this.Ps.bind(this)),i.addEventListener("focus",this.Es.bind(this)),i.addEventListener("focusout",this.Rs.bind(this))),i.style.pointerEvents=t.accessiblePointerEvents,i.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?i.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(i.title=`container ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&i.setAttribute("aria-label",t.accessibleHint),this.debug&&this.Ss(i),t._s=!0,t.Ts=i,i.container=t,this.cs.push(t),this.hs.appendChild(t.Ts),t.interactive&&(t.Ts.tabIndex=t.tabIndex)}Fs(t,i){const{container:e}=t.target,n=this.Yn.events.rootBoundary,s=Object.assign(new Qs(n),{target:e});n.rootTarget=this.Yn.lastObjectRendered,i.forEach(t=>n.dispatchEvent(s,t))}Ps(t){this.Fs(t,["click","pointertap","tap"])}Es(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this.Fs(t,["mouseover"])}Rs(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this.Fs(t,["mouseout"])}ys(t){9===t.keyCode&&this.es&&this.vs()}xs(t){0===t.movementX&&0===t.movementY||this.As()}destroy(){var t;this.As(),this.gs(),null==(t=this.bs)||t.destroy(),this.bs=null,this.hs=null,this.Si=null,this.cs=null,this.Yn=null,this.es&&globalThis.removeEventListener("keydown",this.ys)}setAccessibilityEnabled(t){t?this.vs():this.As()}};mr.extension={type:[ie.WebGLSystem,ie.WebGPUSystem],name:"accessibility"},mr.defaultOptions={enabledByDefault:!1,debug:!1,activateOnTab:!0,deactivateOnMouseMove:!0};let gr=mr;const br=Object.create(null),yr=Object.create(null);function xr(t,i){let e=yr[t];return void 0===e&&(void 0===br[i]&&(br[i]=1),yr[t]=e=br[i]++),e}let wr,Mr;function Ar(){if(!wr||(null==wr?void 0:wr.isContextLost())){const t=Ms.get().createCanvas();wr=t.getContext("webgl",{})}return wr}function Tr(){if(!Mr){Mr="mediump";const t=Ar();if(t&&t.getShaderPrecisionFormat){const i=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);Mr=i.precision?"highp":"mediump"}}return Mr}const _r={},kr={};const Cr={stripVersion:function(t,i){return i?t.replace("#version 300 es",""):t},ensurePrecision:function(t,i,e){const n=e?i.maxSupportedFragmentPrecision:i.maxSupportedVertexPrecision;if("precision"!==t.substring(0,9)){let s=e?i.requestedFragmentPrecision:i.requestedVertexPrecision;return"highp"===s&&"highp"!==n&&(s="mediump"),`precision ${s} float;\n${t}`}return"highp"!==n&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t},addProgramDefines:function(t,i,e){return i?t:e?`\n\n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in varying\n        #define finalColor gl_FragColor\n        #define texture texture2D\n        #endif\n        ${t=t.replace("out vec4 finalColor;","")}\n        `:`\n\n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in attribute\n        #define out varying\n        #endif\n        ${t}\n        `},setProgramName:function(t,{name:i="pixi-program"},e=!0){i=i.replace(/\s+/g,"-");const n=e?_r:kr;return n[i+=e?"-fragment":"-vertex"]?(n[i]++,i+=`-${n[i]}`):n[i]=1,-1!==t.indexOf("#define SHADER_NAME")?t:`${`#define SHADER_NAME ${i}`}\n${t}`},insertVersion:function(t,i){return i?`#version 300 es\n${t}`:t}},Sr=Object.create(null),Pr=class t{constructor(i){const e=-1!==(i={...t.defaultOptions,...i}).fragment.indexOf("#version 300 es"),n={stripVersion:e,ensurePrecision:{requestedFragmentPrecision:i.preferredFragmentPrecision,requestedVertexPrecision:i.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:Tr()},setProgramName:{name:i.name},addProgramDefines:e,insertVersion:e};let s=i.fragment,r=i.vertex;Object.keys(Cr).forEach(t=>{const i=n[t];s=Cr[t](s,i,!0),r=Cr[t](r,i,!1)}),this.fragment=s,this.vertex=r,this.transformFeedbackVaryings=i.transformFeedbackVaryings,this.Os=xr(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this.$s=null,this.Us=null,this.Bs=null,this.transformFeedbackVaryings=null}static from(i){const e=`${i.vertex}:${i.fragment}`;return Sr[e]||(Sr[e]=new t(i)),Sr[e]}};Pr.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let Er=Pr;const Rr={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function Fr(t){return Rr[t]??Rr.float32}const Or={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function $r(t){var i,e;const n=/@group\((\d+)\)/,s=/@binding\((\d+)\)/,r=/var(<[^>]+>)? (\w+)/,o=/:\s*(\w+)/,h=/(\w+)\s*:\s*([\w\<\>]+)/g,a=/struct\s+(\w+)/,u=null==(i=t.match(/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g))?void 0:i.map(t=>({group:parseInt(t.match(n)[1],10),binding:parseInt(t.match(s)[1],10),name:t.match(r)[2],isUniform:"<uniform>"===t.match(r)[1],type:t.match(o)[1]}));if(!u)return{groups:[],structs:[]};const c=(null==(e=t.match(/struct\s+(\w+)\s*{([^}]+)}/g))?void 0:e.map(t=>{const i=t.match(a)[1],e=t.match(h).reduce((t,i)=>{const[e,n]=i.split(":");return t[e.trim()]=n.trim(),t},{});return e?{name:i,members:e}:null}).filter(({name:t})=>u.some(i=>i.type===t)))??[];return{groups:u,structs:c}}var Ur=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.COMPUTE=4]="COMPUTE",t))(Ur||{});const Br=Object.create(null);class Ir{constructor(t){var i,e;this.Is=0,this.js=0;const{fragment:n,vertex:s,layout:r,gpuLayout:o,name:h}=t;if(this.name=h,this.fragment=n,this.vertex=s,n.source===s.source){const t=$r(n.source);this.structsAndGroups=t}else{const t=$r(s.source),i=$r(n.source);this.structsAndGroups=function(t,i){const e=new Set,n=new Set;return{structs:[...t.structs,...i.structs].filter(t=>!e.has(t.name)&&(e.add(t.name),!0)),groups:[...t.groups,...i.groups].filter(t=>{const i=`${t.name}-${t.binding}`;return!n.has(i)&&(n.add(i),!0)})}}(t,i)}this.layout=r??function({groups:t}){const i=[];for(let e=0;e<t.length;e++){const n=t[e];i[n.group]||(i[n.group]={}),i[n.group][n.name]=n.binding}return i}(this.structsAndGroups),this.gpuLayout=o??function({groups:t}){const i=[];for(let e=0;e<t.length;e++){const n=t[e];i[n.group]||(i[n.group]=[]),n.isUniform?i[n.group].push({binding:n.binding,visibility:Ur.VERTEX|Ur.FRAGMENT,buffer:{type:"uniform"}}):"sampler"===n.type?i[n.group].push({binding:n.binding,visibility:Ur.FRAGMENT,sampler:{type:"filtering"}}):"texture_2d"===n.type&&i[n.group].push({binding:n.binding,visibility:Ur.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return i}(this.structsAndGroups),this.autoAssignGlobalUniforms=!(void 0===(null==(i=this.layout[0])?void 0:i.globalUniforms)),this.autoAssignLocalUniforms=!(void 0===(null==(e=this.layout[1])?void 0:e.localUniforms)),this.Gs()}Gs(){const{vertex:t,fragment:i}=this,e=t.source+i.source+t.entryPoint+i.entryPoint;this.Is=xr(e,"program")}get attributeData(){return this.$s??(this.$s=function({source:t,entryPoint:i}){const e={},n=t.indexOf(`fn ${i}`);if(-1!==n){const i=t.indexOf("->",n);if(-1!==i){const s=t.substring(n,i),r=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let o;for(;null!==(o=r.exec(s));){const t=Or[o[3]]??"float32";e[o[2]]={location:parseInt(o[1],10),format:t,stride:Fr(t).stride,offset:0,instance:!1,start:0}}}}return e}(this.vertex)),this.$s}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(t){const i=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return Br[i]||(Br[i]=new Ir(t)),Br[i]}}const jr=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],Gr=jr.reduce((t,i)=>(t[i]=!0,t),{});function zr(t,i){switch(t){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*i);case"vec3<f32>":return new Float32Array(3*i);case"vec4<f32>":return new Float32Array(4*i);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Dr=class t{constructor(i,e){this.Jt=0,this.uid=Pe("uniform"),this.Zt="uniformGroup",this.ii=Pe("resource"),this.isUniformGroup=!0,this.zs=0,this.destroyed=!1,e={...t.defaultOptions,...e},this.uniformStructures=i;const n={};for(const t in i){const e=i[t];if(e.name=t,e.size=e.size??1,!Gr[e.type])throw new Error(`Uniform type ${e.type} is not supported. Supported uniform types are: ${jr.join(", ")}`);e.value??(e.value=zr(e.type,e.size)),n[t]=e.value}this.uniforms=n,this.zs=1,this.ubo=e.ubo,this.isStatic=e.isStatic,this.Ds=xr(Object.keys(n).map(t=>`${t}-${i[t].type}`).join("-"),"uniform-group")}update(){this.zs++}};Dr.defaultOptions={ubo:!1,isStatic:!1};let Lr=Dr;class Nr{constructor(t){this.resources=Object.create(null),this.Ls=!0;let i=0;for(const e in t){const n=t[e];this.setResource(n,i++)}this.Ns()}Ns(){if(!this.Ls)return;this.Ls=!1;const t=[];let i=0;for(const e in this.resources)t[i++]=this.resources[e].ii;this.Os=t.join("|")}setResource(t,i){var e,n;const s=this.resources[i];t!==s&&(s&&(null==(e=t.off)||e.call(t,"change",this.onResourceChange,this)),null==(n=t.on)||n.call(t,"change",this.onResourceChange,this),this.resources[i]=t,this.Ls=!0)}getResource(t){return this.resources[t]}Vs(t){const i=this.resources;for(const e in i)i[e].Jt=t}destroy(){var t;const i=this.resources;for(const e in i){const n=i[e];null==(t=n.off)||t.call(n,"change",this.onResourceChange,this)}this.resources=null}onResourceChange(t){if(this.Ls=!0,t.destroyed){const i=this.resources;for(const e in i)i[e]===t&&(i[e]=null)}else this.Ns()}}var Vr=(t=>(t[t.WEBGL=1]="WEBGL",t[t.WEBGPU=2]="WEBGPU",t[t.BOTH=3]="BOTH",t))(Vr||{});class Wr extends ue{constructor(t){super(),this.uid=Pe("shader"),this.Ws=Object.create(null),this.Hs=[];let{gpuProgram:i,glProgram:e,groups:n,resources:s,compatibleRenderers:r,groupMap:o}=t;this.gpuProgram=i,this.glProgram=e,void 0===r&&(r=0,i&&(r|=Vr.WEBGPU),e&&(r|=Vr.WEBGL)),this.compatibleRenderers=r;const h={};if(s||n||(s={}),s&&n)throw new Error("[Shader] Cannot have both resources and groups");if(!i&&n&&!o)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!i&&n&&o)for(const a in o)for(const t in o[a]){const i=o[a][t];h[i]={group:a,binding:t,name:i}}else if(i&&n&&!o){const t=i.structsAndGroups.groups;o={},t.forEach(t=>{o[t.group]=o[t.group]||{},o[t.group][t.binding]=t.name,h[t.name]=t})}else if(s){if(n={},o={},i){i.structsAndGroups.groups.forEach(t=>{o[t.group]=o[t.group]||{},o[t.group][t.binding]=t.name,h[t.name]=t})}let t=0;for(const i in s)h[i]||(n[99]||(n[99]=new Nr,this.Hs.push(n[99])),h[i]={group:99,binding:t,name:i},o[99]=o[99]||{},o[99][t]=i,t++);for(const i in s){const t=i;let e=s[i];e.source||e.Zt||(e=new Lr(e));const r=h[t];r&&(n[r.group]||(n[r.group]=new Nr,this.Hs.push(n[r.group])),n[r.group].setResource(e,r.binding))}}this.groups=n,this.Ws=o,this.resources=this.qs(n,h)}addResource(t,i,e){var n,s;(n=this.Ws)[i]||(n[i]={}),(s=this.Ws[i])[e]||(s[e]=t),this.groups[i]||(this.groups[i]=new Nr,this.Hs.push(this.groups[i]))}qs(t,i){const e={};for(const n in i){const s=i[n];Object.defineProperty(e,s.name,{get:()=>t[s.group].getResource(s.binding),set(i){t[s.group].setResource(i,s.binding)}})}return e}destroy(t=!1){var i,e;this.emit("destroy",this),t&&(null==(i=this.gpuProgram)||i.destroy(),null==(e=this.glProgram)||e.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this.Ws=null,this.Hs.forEach(t=>{t.destroy()}),this.Hs=null,this.resources=null,this.groups=null}static from(t){const{gpu:i,gl:e,...n}=t;let s,r;return i&&(s=Ir.from(i)),e&&(r=Er.from(e)),new Wr({gpuProgram:s,glProgram:r,...n})}}const Hr={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},qr=class t{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}set cullMode(t){"none"!==t?(this.culling=!0,this.clockwiseFrontFace="front"===t):this.culling=!1}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this.Xs}set blendMode(t){this.blend="none"!==t,this.Xs=t,this.Ys=Hr[t]||0}get polygonOffset(){return this.Ks}set polygonOffset(t){this.offsets=!!t,this.Ks=t}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const i=new t;return i.depthTest=!1,i.blend=!0,i}};qr.default2d=qr.for2d();let Xr=qr;const Yr=class t extends Wr{constructor(i){super(i={...t.defaultOptions,...i}),this.enabled=!0,this.Qs=Xr.for2d(),this.blendMode=i.blendMode,this.padding=i.padding,"boolean"==typeof i.antialias?this.antialias=i.antialias?"on":"off":this.antialias=i.antialias,this.resolution=i.resolution,this.blendRequired=i.blendRequired,this.clipToViewport=i.clipToViewport,this.addResource("uTexture",0,1)}apply(t,i,e,n){t.applyFilter(this,i,e,n)}get blendMode(){return this.Qs.blendMode}set blendMode(t){this.Qs.blendMode=t}static from(i){const{gpu:e,gl:n,...s}=i;let r,o;return e&&(r=Ir.from(e)),n&&(o=Er.from(n)),new t({gpuProgram:r,glProgram:o,...s})}};Yr.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let Kr=Yr;const Qr=[];let Zr;function Jr(){if("boolean"==typeof Zr)return Zr;try{const t=new Function("param1","param2","param3","return param1[param2] === param3;");Zr=!0===t({a:"b"},"a","b")}catch(t){Zr=!1}return Zr}function to(t,i,e=2){const n=i&&i.length,s=n?i[0]*e:t.length;let r=io(t,0,s,e,!0);const o=[];if(!r||r.next===r.prev)return o;let h,a,u;if(n&&(r=function(t,i,e,n){const s=[];for(let r=0,o=i.length;r<o;r++){const e=io(t,i[r]*n,r<o-1?i[r+1]*n:t.length,n,!1);e===e.next&&(e.steiner=!0),s.push(fo(e))}s.sort(ao);for(let r=0;r<s.length;r++)e=uo(s[r],e);return e}(t,i,r,e)),t.length>80*e){h=t[0],a=t[1];let i=h,n=a;for(let r=e;r<s;r+=e){const e=t[r],s=t[r+1];e<h&&(h=e),s<a&&(a=s),e>i&&(i=e),s>n&&(n=s)}u=Math.max(i-h,n-a),u=0!==u?32767/u:0}return no(r,o,e,h,a,u,0),o}function io(t,i,e,n,s){let r;if(s===function(t,i,e,n){let s=0;for(let r=i,o=e-n;r<e;r+=n)s+=(t[o]-t[r])*(t[r+1]+t[o+1]),o=r;return s}(t,i,e,n)>0)for(let o=i;o<e;o+=n)r=To(o/n|0,t[o],t[o+1],r);else for(let o=e-n;o>=i;o-=n)r=To(o/n|0,t[o],t[o+1],r);return r&&bo(r,r.next)&&(_o(r),r=r.next),r}function eo(t,i){if(!t)return t;i||(i=t);let e,n=t;do{if(e=!1,n.steiner||!bo(n,n.next)&&0!==go(n.prev,n,n.next))n=n.next;else{if(_o(n),n=i=n.prev,n===n.next)break;e=!0}}while(e||n!==i);return i}function no(t,i,e,n,s,r,o){if(!t)return;!o&&r&&function(t,i,e,n){let s=t;do{0===s.z&&(s.z=lo(s.x,s.y,i,e,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){let i,e=1;do{let n,s=t;t=null;let r=null;for(i=0;s;){i++;let o=s,h=0;for(let t=0;t<e&&(h++,o=o.nextZ,o);t++);let a=e;for(;h>0||a>0&&o;)0!==h&&(0===a||!o||s.z<=o.z)?(n=s,s=s.nextZ,h--):(n=o,o=o.nextZ,a--),r?r.nextZ=n:t=n,n.prevZ=r,r=n;s=o}r.nextZ=null,e*=2}while(i>1)}(s)}(t,n,s,r);let h=t;for(;t.prev!==t.next;){const a=t.prev,u=t.next;if(r?ro(t,n,s,r):so(t))i.push(a.i,t.i,u.i),_o(t),t=u.next,h=u.next;else if((t=u)===h){o?1===o?no(t=oo(eo(t),i),i,e,n,s,r,2):2===o&&ho(t,i,e,n,s,r):no(eo(t),i,e,n,s,r,1);break}}}function so(t){const i=t.prev,e=t,n=t.next;if(go(i,e,n)>=0)return!1;const s=i.x,r=e.x,o=n.x,h=i.y,a=e.y,u=n.y,c=Math.min(s,r,o),l=Math.min(h,a,u),f=Math.max(s,r,o),d=Math.max(h,a,u);let p=n.next;for(;p!==i;){if(p.x>=c&&p.x<=f&&p.y>=l&&p.y<=d&&vo(s,h,r,a,o,u,p.x,p.y)&&go(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function ro(t,i,e,n){const s=t.prev,r=t,o=t.next;if(go(s,r,o)>=0)return!1;const h=s.x,a=r.x,u=o.x,c=s.y,l=r.y,f=o.y,d=Math.min(h,a,u),p=Math.min(c,l,f),v=Math.max(h,a,u),m=Math.max(c,l,f),g=lo(d,p,i,e,n),b=lo(v,m,i,e,n);let y=t.prevZ,x=t.nextZ;for(;y&&y.z>=g&&x&&x.z<=b;){if(y.x>=d&&y.x<=v&&y.y>=p&&y.y<=m&&y!==s&&y!==o&&vo(h,c,a,l,u,f,y.x,y.y)&&go(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,x.x>=d&&x.x<=v&&x.y>=p&&x.y<=m&&x!==s&&x!==o&&vo(h,c,a,l,u,f,x.x,x.y)&&go(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;y&&y.z>=g;){if(y.x>=d&&y.x<=v&&y.y>=p&&y.y<=m&&y!==s&&y!==o&&vo(h,c,a,l,u,f,y.x,y.y)&&go(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=b;){if(x.x>=d&&x.x<=v&&x.y>=p&&x.y<=m&&x!==s&&x!==o&&vo(h,c,a,l,u,f,x.x,x.y)&&go(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function oo(t,i){let e=t;do{const n=e.prev,s=e.next.next;!bo(n,s)&&yo(n,e,e.next,s)&&Mo(n,s)&&Mo(s,n)&&(i.push(n.i,e.i,s.i),_o(e),_o(e.next),e=t=s),e=e.next}while(e!==t);return eo(e)}function ho(t,i,e,n,s,r){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&mo(o,t)){let h=Ao(o,t);return o=eo(o,o.next),h=eo(h,h.next),no(o,i,e,n,s,r,0),void no(h,i,e,n,s,r,0)}t=t.next}o=o.next}while(o!==t)}function ao(t,i){let e=t.x-i.x;if(0===e&&(e=t.y-i.y,0===e)){e=(t.next.y-t.y)/(t.next.x-t.x)-(i.next.y-i.y)/(i.next.x-i.x)}return e}function uo(t,i){const e=function(t,i){let e=i;const n=t.x,s=t.y;let r,o=-1/0;if(bo(t,e))return e;do{if(bo(t,e.next))return e.next;if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){const t=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(t<=n&&t>o&&(o=t,r=e.x<e.next.x?e:e.next,t===n))return r}e=e.next}while(e!==i);if(!r)return null;const h=r,a=r.x,u=r.y;let c=1/0;e=r;do{if(n>=e.x&&e.x>=a&&n!==e.x&&po(s<u?n:o,s,a,u,s<u?o:n,s,e.x,e.y)){const i=Math.abs(s-e.y)/(n-e.x);Mo(e,t)&&(i<c||i===c&&(e.x>r.x||e.x===r.x&&co(r,e)))&&(r=e,c=i)}e=e.next}while(e!==h);return r}(t,i);if(!e)return i;const n=Ao(e,t);return eo(n,n.next),eo(e,e.next)}function co(t,i){return go(t.prev,t,i.prev)<0&&go(i.next,t,t.next)<0}function lo(t,i,e,n,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-e)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*s|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function fo(t){let i=t,e=t;do{(i.x<e.x||i.x===e.x&&i.y<e.y)&&(e=i),i=i.next}while(i!==t);return e}function po(t,i,e,n,s,r,o,h){return(s-o)*(i-h)>=(t-o)*(r-h)&&(t-o)*(n-h)>=(e-o)*(i-h)&&(e-o)*(r-h)>=(s-o)*(n-h)}function vo(t,i,e,n,s,r,o,h){return!(t===o&&i===h)&&po(t,i,e,n,s,r,o,h)}function mo(t,i){return t.next.i!==i.i&&t.prev.i!==i.i&&!function(t,i){let e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==i.i&&e.next.i!==i.i&&yo(e,e.next,t,i))return!0;e=e.next}while(e!==t);return!1}(t,i)&&(Mo(t,i)&&Mo(i,t)&&function(t,i){let e=t,n=!1;const s=(t.x+i.x)/2,r=(t.y+i.y)/2;do{e.y>r!=e.next.y>r&&e.next.y!==e.y&&s<(e.next.x-e.x)*(r-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next}while(e!==t);return n}(t,i)&&(go(t.prev,t,i.prev)||go(t,i.prev,i))||bo(t,i)&&go(t.prev,t,t.next)>0&&go(i.prev,i,i.next)>0)}function go(t,i,e){return(i.y-t.y)*(e.x-i.x)-(i.x-t.x)*(e.y-i.y)}function bo(t,i){return t.x===i.x&&t.y===i.y}function yo(t,i,e,n){const s=wo(go(t,i,e)),r=wo(go(t,i,n)),o=wo(go(e,n,t)),h=wo(go(e,n,i));return s!==r&&o!==h||(!(0!==s||!xo(t,e,i))||(!(0!==r||!xo(t,n,i))||(!(0!==o||!xo(e,t,n))||!(0!==h||!xo(e,i,n)))))}function xo(t,i,e){return i.x<=Math.max(t.x,e.x)&&i.x>=Math.min(t.x,e.x)&&i.y<=Math.max(t.y,e.y)&&i.y>=Math.min(t.y,e.y)}function wo(t){return t>0?1:t<0?-1:0}function Mo(t,i){return go(t.prev,t,t.next)<0?go(t,i,t.next)>=0&&go(t,t.prev,i)>=0:go(t,i,t.prev)<0||go(t,t.next,i)<0}function Ao(t,i){const e=ko(t.i,t.x,t.y),n=ko(i.i,i.x,i.y),s=t.next,r=i.prev;return t.next=i,i.prev=t,e.next=s,s.prev=e,n.next=e,e.prev=n,r.next=n,n.prev=r,n}function To(t,i,e,n){const s=ko(t,i,e);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function _o(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ko(t,i,e){return{i:t,x:i,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}se.handleByNamedList(ie.Environment,Qr);const Co=to.default||to;var So=(t=>(t[t.NONE=0]="NONE",t[t.COLOR=16384]="COLOR",t[t.STENCIL=1024]="STENCIL",t[t.DEPTH=256]="DEPTH",t[t.COLOR_DEPTH=16640]="COLOR_DEPTH",t[t.COLOR_STENCIL=17408]="COLOR_STENCIL",t[t.DEPTH_STENCIL=1280]="DEPTH_STENCIL",t[t.ALL=17664]="ALL",t))(So||{});class Po{constructor(t){this.items=[],this.Zs=t}emit(t,i,e,n,s,r,o,h){const{name:a,items:u}=this;for(let c=0,l=u.length;c<l;c++)u[c][a](t,i,e,n,s,r,o,h);return this}add(t){return t[this.Zs]&&(this.remove(t),this.items.push(t)),this}remove(t){const i=this.items.indexOf(t);return-1!==i&&this.items.splice(i,1),this}contains(t){return-1!==this.items.indexOf(t)}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this.Zs=null}get empty(){return 0===this.items.length}get name(){return this.Zs}}const Eo=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Ro=class t extends ue{constructor(t){super(),this.uid=Pe("renderer"),this.runners=Object.create(null),this.renderPipes=Object.create(null),this.Js={},this.ir=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const i=[...Eo,...this.config.runners??[]];this.er(...i),this.nr()}async init(i={}){const e=!0===i.skipExtensionImports||!1===i.manageImports;await async function(t){if(!t)for(let i=0;i<Qr.length;i++){const t=Qr[i];if(t.value.test())return void(await t.value.load())}}(e),this.sr(this.config.systems),this.rr(this.config.renderPipes,this.config.renderPipeAdaptors);for(const t in this.ir){i={...this.ir[t].constructor.defaultOptions,...i}}i={...t.defaultOptions,...i},this.Me=i.roundPixels?1:0;for(let t=0;t<this.runners.init.items.length;t++)await this.runners.init.items[t].init(i);this.Js=i}render(t,i){let e=t;if(e instanceof ls&&(e={container:e},i&&(Re(0,"passing a second argument is deprecated, please use render options instead"),e.target=i.renderTexture)),e.target||(e.target=this.view.renderTarget),e.target===this.view.renderTarget&&(this.hr=e.container,e.clearColor??(e.clearColor=this.background.colorRgba),e.clear??(e.clear=this.background.clearBeforeRender)),e.clearColor){const t=Array.isArray(e.clearColor)&&4===e.clearColor.length;e.clearColor=t?e.clearColor:An.shared.setValue(e.clearColor).toArray()}e.transform||(e.container.updateLocalTransform(),e.transform=e.container.localTransform),e.container.enableRenderGroup(),this.runners.prerender.emit(e),this.runners.renderStart.emit(e),this.runners.render.emit(e),this.runners.renderEnd.emit(e),this.runners.postrender.emit(e)}resize(t,i,e){const n=this.view.resolution;this.view.resize(t,i,e),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),void 0!==e&&e!==n&&this.runners.resolutionChange.emit(e)}clear(t={}){t.target||(t.target=this.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=So.ALL);const{clear:i,clearColor:e,target:n}=t;An.shared.setValue(e??this.background.colorRgba),this.renderTarget.clear(n,i,An.shared.toArray())}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this.hr}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}er(...t){t.forEach(t=>{this.runners[t]=new Po(t)})}sr(t){let i;for(i in t){const e=t[i];this.ar(e.value,e.name)}}ar(t,i){const e=new t(this);if(this[i])throw new Error(`Whoops! The name "${i}" is already in use`);this[i]=e,this.ir[i]=e;for(const n in this.runners)this.runners[n].add(e);return this}rr(t,i){const e=i.reduce((t,i)=>(t[i.name]=i.value,t),{});t.forEach(t=>{const i=t.value,n=t.name,s=e[n];this.renderPipes[n]=new i(this,s?new s:null)})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),Object.values(this.runners).forEach(t=>{t.destroy()}),this.ir=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this.Me}nr(){if(!Jr())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Ro.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Fo,Oo,$o=Ro;function Uo(t){return void 0!==Fo||(Fo=(()=>{var i;const e={stencil:!0,failIfMajorPerformanceCaveat:t??$o.defaultOptions.failIfMajorPerformanceCaveat};try{if(!Ms.get().getWebGLRenderingContext())return!1;let t=Ms.get().createCanvas().getContext("webgl",e);const n=!!(null==(i=null==t?void 0:t.getContextAttributes())?void 0:i.stencil);if(t){const i=t.getExtension("WEBGL_lose_context");i&&i.loseContext()}return t=null,n}catch(n){return!1}})()),Fo}async function Bo(t={}){return void 0!==Oo||(Oo=await(async()=>{const i=Ms.get().getNavigator().gpu;if(!i)return!1;try{const e=await i.requestAdapter(t);return await e.requestDevice(),!0}catch(e){return!1}})()),Oo}const Io=["webgl","webgpu","canvas"];const jo="8.12.0";class Go{static init(){var t;null==(t=globalThis.__PIXI_APP_INIT__)||t.call(globalThis,this,jo)}static destroy(){}}Go.extension=ie.Application;class zo{constructor(t){this.Yn=t}init(){var t;null==(t=globalThis.__PIXI_RENDERER_INIT__)||t.call(globalThis,this.Yn,jo)}destroy(){this.Yn=null}}zo.extension={type:[ie.WebGLSystem,ie.WebGPUSystem],name:"initHook",priority:-10};const Do=class t{constructor(...t){this.stage=new ls,void 0!==t[0]&&Re(0,"Application constructor options are deprecated, please use Application.init() instead.")}async init(i){i={...i},this.renderer=await async function(t){let i,e=[];t.preference?(e.push(t.preference),Io.forEach(i=>{i!==t.preference&&e.push(i)})):e=Io.slice();let n={};for(let r=0;r<e.length;r++){const s=e[r];if("webgpu"===s&&await Bo()){const{WebGPURenderer:e}=await te(async()=>{const{WebGPURenderer:t}=await Promise.resolve().then(()=>Bd);return{WebGPURenderer:t}},void 0);i=e,n={...t,...t.webgpu};break}if("webgl"===s&&Uo(t.failIfMajorPerformanceCaveat??$o.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:e}=await te(async()=>{const{WebGLRenderer:t}=await Promise.resolve().then(()=>Kf);return{WebGLRenderer:t}},void 0);i=e,n={...t,...t.webgl};break}if("canvas"===s)throw n={...t},new Error("CanvasRenderer is not yet implemented")}if(delete n.webgpu,delete n.webgl,!i)throw new Error("No available renderer for the current environment");const s=new i;return await s.init(n),s}(i),t.ur.forEach(t=>{t.init.call(this,i)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return Re(0,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(i=!1,e=!1){const n=t.ur.slice(0);n.reverse(),n.forEach(t=>{t.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(i),this.renderer=null}};Do.ur=[];let Lo=Do;se.handleByList(ie.Application,Lo.ur),se.add(Go);class No{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this.cr=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this.cr}}),this.queueResize=()=>{this.cr&&(this.lr(),this.dr=requestAnimationFrame(()=>this.resize()))},this.lr=()=>{this.dr&&(cancelAnimationFrame(this.dr),this.dr=null)},this.resize=()=>{if(!this.cr)return;let t,i;if(this.lr(),this.cr===globalThis.window)t=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:e,clientHeight:n}=this.cr;t=e,i=n}this.renderer.resize(t,i),this.render()},this.dr=null,this.cr=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.lr(),this.lr=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}No.extension=ie.Application;class Vo{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this.pr&&this.pr.remove(this.render,this),this.pr=t,t&&t.add(this.render,this,_s.LOW)},get(){return this.pr}}),this.stop=()=>{this.pr.stop()},this.start=()=>{this.pr.start()},this.pr=null,this.ticker=t.sharedTicker?Ps.shared:new Ps,t.autoStart&&this.start()}static destroy(){if(this.pr){const t=this.pr;this.ticker=null,t.destroy()}}}Vo.extension=ie.Application;class Wo extends ue{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return Re(0,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return Re(0,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return Re(0,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return Re(0,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return Re(0,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){var i;this.emit("destroy",this),this.removeAllListeners();for(const e in this.chars)null==(i=this.chars[e].texture)||i.destroy();this.chars=null,t&&(this.pages.forEach(t=>t.texture.destroy(!0)),this.pages=null)}}const Ho=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function qo(t){const i="number"==typeof t.fontSize?`${t.fontSize}px`:t.fontSize;let e=t.fontFamily;Array.isArray(t.fontFamily)||(e=t.fontFamily.split(","));for(let n=e.length-1;n>=0;n--){let t=e[n].trim();/([\"\'])[^\'\"]+\1/.test(t)||Ho.includes(t)||(t=`"${t}"`),e[n]=t}return`${t.fontStyle} ${t.fontVariant} ${t.fontWeight} ${i} ${e.join(",")}`}const Xo={willReadFrequently:!0},Yo=class t{static get experimentalLetterSpacingSupported(){let i=t.vr;if(void 0===i){const e=Ms.get().getCanvasRenderingContext2D().prototype;i=t.vr="letterSpacing"in e||"textLetterSpacing"in e}return i}constructor(t,i,e,n,s,r,o,h,a){this.text=t,this.style=i,this.width=e,this.height=n,this.lines=s,this.lineWidths=r,this.lineHeight=o,this.maxLineWidth=h,this.fontProperties=a}static measureText(i=" ",e,n=t.Xn,s=e.wordWrap){var r;const o=qo(e),h=t.measureFont(o);0===h.fontSize&&(h.fontSize=e.fontSize,h.ascent=e.fontSize);const a=t.mr;a.font=o;const u=(s?t.gr(i,e,n):i).split(/(?:\r\n|\r|\n)/),c=new Array(u.length);let l=0;for(let m=0;m<u.length;m++){const i=t.br(u[m],e.letterSpacing,a);c[m]=i,l=Math.max(l,i)}const f=(null==(r=e.yr)?void 0:r.width)||0;let d=l+f;e.dropShadow&&(d+=e.dropShadow.distance);const p=e.lineHeight||h.fontSize;let v=Math.max(p,h.fontSize+f)+(u.length-1)*(p+e.leading);e.dropShadow&&(v+=e.dropShadow.distance);return new t(i,e,d,v,u,c,p+e.leading,l,h)}static br(i,e,n){let s=!1;t.experimentalLetterSpacingSupported&&(t.experimentalLetterSpacing?(n.letterSpacing=`${e}px`,n.textLetterSpacing=`${e}px`,s=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px"));const r=n.measureText(i);let o=r.width;const h=-r.actualBoundingBoxLeft;let a=r.actualBoundingBoxRight-h;if(o>0)if(s)o-=e,a-=e;else{const n=(t.graphemeSegmenter(i).length-1)*e;o+=n,a+=n}return Math.max(o,a)}static gr(i,e,n=t.Xn){const s=n.getContext("2d",Xo);let r=0,o="",h="";const a=Object.create(null),{letterSpacing:u,whiteSpace:c}=e,l=t.wr(c),f=t.Mr(c);let d=!l;const p=e.wordWrapWidth+u,v=t.Ar(i);for(let m=0;m<v.length;m++){let i=v[m];if(t.Tr(i)){if(!f){h+=t._r(o),d=!l,o="",r=0;continue}i=" "}if(l){const e=t.isBreakingSpace(i),n=t.isBreakingSpace(o[o.length-1]);if(e&&n)continue}const n=t.kr(i,u,a,s);if(n>p)if(""!==o&&(h+=t._r(o),o="",r=0),t.canBreakWords(i,e.breakWords)){const n=t.wordWrapSplit(i);for(let c=0;c<n.length;c++){let l=n[c],f=l,v=1;for(;n[c+v];){const s=n[c+v];if(t.canBreakChars(f,s,i,c,e.breakWords))break;l+=s,f=s,v++}c+=v-1;const m=t.kr(l,u,a,s);m+r>p&&(h+=t._r(o),d=!1,o="",r=0),o+=l,r+=m}}else{o.length>0&&(h+=t._r(o),o="",r=0);const e=m===v.length-1;h+=t._r(i,!e),d=!1,o="",r=0}else n+r>p&&(d=!1,h+=t._r(o),o="",r=0),(o.length>0||!t.isBreakingSpace(i)||d)&&(o+=i,r+=n)}return h+=t._r(o,!1),h}static _r(i,e=!0){return i=t.Cr(i),i=e?`${i}\n`:i}static kr(i,e,n,s){let r=n[i];return"number"!=typeof r&&(r=t.br(i,e,s)+e,n[i]=r),r}static wr(t){return"normal"===t||"pre-line"===t}static Mr(t){return"normal"===t}static Cr(i){if("string"!=typeof i)return"";for(let e=i.length-1;e>=0;e--){const n=i[e];if(!t.isBreakingSpace(n))break;i=i.slice(0,-1)}return i}static Tr(i){return"string"==typeof i&&t.Sr.includes(i.charCodeAt(0))}static isBreakingSpace(i,e){return"string"==typeof i&&t.Pr.includes(i.charCodeAt(0))}static Ar(i){const e=[];let n="";if("string"!=typeof i)return e;for(let s=0;s<i.length;s++){const r=i[s],o=i[s+1];t.isBreakingSpace(r,o)||t.Tr(r)?(""!==n&&(e.push(n),n=""),"\r"===r&&"\n"===o?(e.push("\r\n"),s++):e.push(r)):n+=r}return""!==n&&e.push(n),e}static canBreakWords(t,i){return i}static canBreakChars(t,i,e,n,s){return!0}static wordWrapSplit(i){return t.graphemeSegmenter(i)}static measureFont(i){if(t.Er[i])return t.Er[i];const e=t.$e;e.font=i;const n=e.measureText(t.METRICS_STRING+t.BASELINE_SYMBOL),s={ascent:n.actualBoundingBoxAscent,descent:n.actualBoundingBoxDescent,fontSize:n.actualBoundingBoxAscent+n.actualBoundingBoxDescent};return t.Er[i]=s,s}static clearMetrics(i=""){i?delete t.Er[i]:t.Er={}}static get Xn(){if(!t.Rr){let e;try{const i=new OffscreenCanvas(0,0),n=i.getContext("2d",Xo);if(null==n?void 0:n.measureText)return t.Rr=i,i;e=Ms.get().createCanvas()}catch(i){e=Ms.get().createCanvas()}e.width=e.height=10,t.Rr=e}return t.Rr}static get $e(){return t.mr||(t.mr=t.Xn.getContext("2d",Xo)),t.mr}};Yo.METRICS_STRING="|ÃqÃ",Yo.BASELINE_SYMBOL="M",Yo.BASELINE_MULTIPLIER=1.4,Yo.HEIGHT_MULTIPLIER=2,Yo.graphemeSegmenter=(()=>{if("function"==typeof(null==Intl?void 0:Intl.Segmenter)){const t=new Intl.Segmenter;return i=>{const e=t.segment(i),n=[];let s=0;for(const t of e)n[s++]=t.segment;return n}}return t=>[...t]})(),Yo.experimentalLetterSpacing=!1,Yo.Er={},Yo.Sr=[10,13],Yo.Pr=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Ko=Yo;const Qo=[{offset:0,color:"white"},{offset:1,color:"black"}],Zo=class t{constructor(...i){this.uid=Pe("fillGradient"),this.type="linear",this.colorStops=[];let e=function(t){let i=t[0]??{};("number"==typeof i||t[1])&&(Re(0,"use options object instead"),i={type:"linear",start:{x:t[0],y:t[1]},end:{x:t[2],y:t[3]},textureSpace:t[4],textureSize:t[5]??Jo.defaultLinearOptions.textureSize});return i}(i);e={..."radial"===e.type?t.defaultRadialOptions:t.defaultLinearOptions,...Ue(e)},this.Fr=e.textureSize,this.Or=e.wrapMode,"radial"===e.type?(this.center=e.center,this.outerCenter=e.outerCenter??this.center,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.scale=e.scale,this.rotation=e.rotation):(this.start=e.start,this.end=e.end),this.textureSpace=e.textureSpace,this.type=e.type,e.colorStops.forEach(t=>{this.addColorStop(t.offset,t.color)})}addColorStop(t,i){return this.colorStops.push({offset:t,color:An.shared.setValue(i).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:i}=this.start,{x:e,y:n}=this.end,s=e-t,r=n-i;const o=s<0||r<0;if("clamp-to-edge"===this.Or){if(s<0){const i=t;t=e,e=i,s*=-1}if(r<0){const t=i;i=n,n=t,r*=-1}}const h=this.colorStops.length?this.colorStops:Qo,a=this.Fr,{canvas:u,context:c}=ih(a,1),l=o?c.createLinearGradient(this.Fr,0,0,0):c.createLinearGradient(0,0,this.Fr,0);th(l,h),c.fillStyle=l,c.fillRect(0,0,a,1),this.texture=new Ve({source:new Ts({resource:u,addressMode:this.Or})});const f=Math.sqrt(s*s+r*r),d=Math.atan2(r,s),p=new ve;p.scale(f/a,1),p.rotate(d),p.translate(t,i),"local"===this.textureSpace&&p.scale(a,a),this.transform=p}buildGradient(){"linear"===this.type?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:Qo,i=this.Fr,{canvas:e,context:n}=ih(i,i),{x:s,y:r}=this.center,{x:o,y:h}=this.outerCenter,a=this.innerRadius,u=this.outerRadius,c=o-u,l=h-u,f=i/(2*u),d=(s-c)*f,p=(r-l)*f,v=n.createRadialGradient(d,p,a*f,(o-c)*f,(h-l)*f,u*f);th(v,t),n.fillStyle=t[t.length-1].color,n.fillRect(0,0,i,i),n.fillStyle=v,n.translate(d,p),n.rotate(this.rotation),n.scale(1,this.scale),n.translate(-d,-p),n.fillRect(0,0,i,i),this.texture=new Ve({source:new Ts({resource:e,addressMode:this.Or})});const m=new ve;m.scale(1/f,1/f),m.translate(c,l),"local"===this.textureSpace&&m.scale(i,i),this.transform=m}get styleKey(){return this.uid}destroy(){var t;null==(t=this.texture)||t.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}};Zo.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"},Zo.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let Jo=Zo;function th(t,i){for(let e=0;e<i.length;e++){const n=i[e];t.addColorStop(n.offset,n.color)}}function ih(t,i){const e=Ms.get().createCanvas(t,i),n=e.getContext("2d");return{canvas:e,context:n}}const eh={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class nh{constructor(t,i){this.uid=Pe("fillPattern"),this.transform=new ve,this.$r=null,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),i&&(t.source.style.addressModeU=eh[i].addressModeU,t.source.style.addressModeV=eh[i].addressModeV)}setTransform(t){const i=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/i.frame.width,1/i.frame.height),this.$r=null}get styleKey(){return this.$r||(this.$r=`fill-pattern-${this.uid}-${this.texture.uid}-${this.transform.toArray().join("-")}`),this.$r}destroy(){this.texture.destroy(!0),this.texture=null,this.$r=null}}var sh=function(t){var i=[];return t.replace(oh,function(t,e,n){var s=e.toLowerCase();for(n=function(t){var i=t.match(hh);return i?i.map(Number):[]}(n),"m"==s&&n.length>2&&(i.push([e].concat(n.splice(0,2))),s="l",e="m"==e?"l":"L");;){if(n.length==rh[s])return n.unshift(e),i.push(n);if(n.length<rh[s])throw new Error("malformed path data");i.push([e].concat(n.splice(0,rh[s])))}}),i},rh={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},oh=/([astvzqmhlc])([^astvzqmhlc]*)/gi;var hh=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;const ah=e(sh);class uh{constructor(t=0,i=0,e=0){this.type="circle",this.x=t,this.y=i,this.radius=e}clone(){return new uh(this.x,this.y,this.radius)}contains(t,i){if(this.radius<=0)return!1;const e=this.radius*this.radius;let n=this.x-t,s=this.y-i;return n*=n,s*=s,n+s<=e}strokeContains(t,i,e,n=.5){if(0===this.radius)return!1;const s=this.x-t,r=this.y-i,o=this.radius,h=(1-n)*e,a=Math.sqrt(s*s+r*r);return a<=o+h&&a>o-(e-h)}getBounds(t){return t||(t=new Ce),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=2*this.radius,t.height=2*this.radius,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class ch{constructor(t=0,i=0,e=0,n=0){this.type="ellipse",this.x=t,this.y=i,this.halfWidth=e,this.halfHeight=n}clone(){return new ch(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,i){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let e=(t-this.x)/this.halfWidth,n=(i-this.y)/this.halfHeight;return e*=e,n*=n,e+n<=1}strokeContains(t,i,e,n=.5){const{halfWidth:s,halfHeight:r}=this;if(s<=0||r<=0)return!1;const o=e*(1-n),h=e-o,a=s-h,u=r-h,c=s+o,l=r+o,f=t-this.x,d=i-this.y;return f*f/(a*a)+d*d/(u*u)>1&&f*f/(c*c)+d*d/(l*l)<=1}getBounds(t){return t||(t=new Ce),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=2*this.halfWidth,t.height=2*this.halfHeight,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function lh(t,i,e,n,s,r){const o=s-e,h=r-n,a=o*o+h*h;let u,c,l=-1;0!==a&&(l=((t-e)*o+(i-n)*h)/a),l<0?(u=e,c=n):l>1?(u=s,c=r):(u=e+l*o,c=n+l*h);const f=t-u,d=i-c;return f*f+d*d}class fh{constructor(...t){this.type="polygon";let i=Array.isArray(t[0])?t[0]:t;if("number"!=typeof i[0]){const t=[];for(let e=0,n=i.length;e<n;e++)t.push(i[e].x,i[e].y);i=t}this.points=i,this.closePath=!0}isClockwise(){let t=0;const i=this.points,e=i.length;for(let n=0;n<e;n+=2){const s=i[n],r=i[n+1];t+=(i[(n+2)%e]-s)*(i[(n+3)%e]+r)}return t<0}containsPolygon(t){const i=this.getBounds(undefined),e=t.getBounds(undefined);if(!i.containsRect(e))return!1;const n=t.points;for(let s=0;s<n.length;s+=2){const t=n[s],i=n[s+1];if(!this.contains(t,i))return!1}return!0}clone(){const t=this.points.slice(),i=new fh(t);return i.closePath=this.closePath,i}contains(t,i){let e=!1;const n=this.points.length/2;for(let s=0,r=n-1;s<n;r=s++){const n=this.points[2*s],o=this.points[2*s+1],h=this.points[2*r],a=this.points[2*r+1];o>i!=a>i&&t<(i-o)/(a-o)*(h-n)+n&&(e=!e)}return e}strokeContains(t,i,e,n=.5){const s=e*e,r=s*(1-n),o=s-r,{points:h}=this,a=h.length-(this.closePath?0:2);for(let u=0;u<a;u+=2){const e=h[u],n=h[u+1],s=h[(u+2)%h.length],a=h[(u+3)%h.length];if(lh(t,i,e,n,s,a)<=(Math.sign((s-e)*(i-n)-(a-n)*(t-e))<0?o:r))return!0}return!1}getBounds(t){t||(t=new Ce);const i=this.points;let e=1/0,n=-1/0,s=1/0,r=-1/0;for(let o=0,h=i.length;o<h;o+=2){const t=i[o],h=i[o+1];e=t<e?t:e,n=t>n?t:n,s=h<s?h:s,r=h>r?h:r}return t.x=e,t.width=n-e,t.y=s,t.height=r-s,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,i)=>`${t}, ${i}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return Re(0,"Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return Re(0,"Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const dh=(t,i,e,n,s,r,o)=>{const h=t-e,a=i-n,u=Math.sqrt(h*h+a*a);return u>=s-r&&u<=s+o};class ph{constructor(t=0,i=0,e=0,n=0,s=20){this.type="roundedRectangle",this.x=t,this.y=i,this.width=e,this.height=n,this.radius=s}getBounds(t){return t||(t=new Ce),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new ph(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,i){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&i>=this.y&&i<=this.y+this.height){const e=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(i>=this.y+e&&i<=this.y+this.height-e||t>=this.x+e&&t<=this.x+this.width-e)return!0;let n=t-(this.x+e),s=i-(this.y+e);const r=e*e;if(n*n+s*s<=r)return!0;if(n=t-(this.x+this.width-e),n*n+s*s<=r)return!0;if(s=i-(this.y+this.height-e),n*n+s*s<=r)return!0;if(n=t-(this.x+e),n*n+s*s<=r)return!0}return!1}strokeContains(t,i,e,n=.5){const{x:s,y:r,width:o,height:h,radius:a}=this,u=e*(1-n),c=e-u,l=s+a,f=r+a,d=s+o,p=r+h;return(t>=s-u&&t<=s+c||t>=d-c&&t<=d+u)&&i>=f&&i<=f+(h-2*a)||((i>=r-u&&i<=r+c||i>=p-c&&i<=p+u)&&t>=l&&t<=l+(o-2*a)||(t<l&&i<f&&dh(t,i,l,f,a,c,u)||t>d-a&&i<f&&dh(t,i,d-a,f,a,c,u)||t>d-a&&i>p-a&&dh(t,i,d-a,p-a,a,c,u)||t<l&&i>p-a&&dh(t,i,l,p-a,a,c,u)))}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const vh={};function mh(t,i,e){let n=2166136261;for(let s=0;s<i;s++)n^=t[s].uid,n=Math.imul(n,16777619),n>>>=0;return vh[n]||function(t,i,e,n){const s={};let r=0;for(let h=0;h<n;h++){const e=h<i?t[h]:Ve.EMPTY.source;s[r++]=e.source,s[r++]=e.style}const o=new Nr(s);return vh[e]=o,o}(t,i,n,e)}class gh{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this.Ur||(this.Ur=new Int8Array(this.rawBinaryData)),this.Ur}get uint8View(){return this.Br||(this.Br=new Uint8Array(this.rawBinaryData)),this.Br}get int16View(){return this.Ir||(this.Ir=new Int16Array(this.rawBinaryData)),this.Ir}get int32View(){return this.jr||(this.jr=new Int32Array(this.rawBinaryData)),this.jr}get float64View(){return this.Gr||(this.Gr=new Float64Array(this.rawBinaryData)),this.Gr}get bigUint64View(){return this.zr||(this.zr=new BigUint64Array(this.rawBinaryData)),this.zr}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this.Ur=null,this.Br=null,this.Ir=null,this.uint16View=null,this.jr=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function bh(t,i){const e=t.byteLength/8|0,n=new Float64Array(t,0,e);new Float64Array(i,0,e).set(n);const s=t.byteLength-8*e;if(s>0){const n=new Uint8Array(t,8*e,s);new Uint8Array(i,8*e,s).set(n)}}const yh={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var xh=(t=>(t[t.DISABLED=0]="DISABLED",t[t.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",t[t.MASK_ACTIVE=2]="MASK_ACTIVE",t[t.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",t[t.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",t[t.NONE=5]="NONE",t))(xh||{});function wh(t,i){return"no-premultiply-alpha"===i.alphaMode&&yh[t]||t}const Mh=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Ah(t){let i="";for(let e=0;e<t;++e)e>0&&(i+="\nelse "),e<t-1&&(i+=`if(test == ${e}.0){}`);return i}function Th(t,i){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=i.createShader(i.FRAGMENT_SHADER);try{for(;;){const n=Mh.replace(/%forloop%/gi,Ah(t));if(i.shaderSource(e,n),i.compileShader(e),i.getShaderParameter(e,i.COMPILE_STATUS))break;t=t/2|0}}finally{i.deleteShader(e)}return t}let _h=null;class kh{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const i=this.textures[t];this.textures[t]=null,this.ids[i.uid]=null}this.count=0}}class Ch{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new kh,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const Sh=[];let Ph=0;function Eh(){return Ph>0?Sh[--Ph]:new Ch}function Rh(t){Sh[Ph++]=t}let Fh=0;const Oh=class t{constructor(i){this.uid=Pe("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this.Dr=[],(i={...t.defaultOptions,...i}).maxTextures||(Re(0,"maxTextures is a required option for Batcher now, please pass it in the options"),i.maxTextures=function(){var t;if(_h)return _h;const i=Ar();return _h=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),_h=Th(_h,i),null==(t=i.getExtension("WEBGL_lose_context"))||t.loseContext(),_h}());const{maxTextures:e,attributesInitialSize:n,indicesInitialSize:s}=i;this.attributeBuffer=new gh(4*n),this.indexBuffer=new Uint16Array(s),this.maxTextures=e}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)Rh(this.batches[t]);this.batchIndex=0,this.Lr=0,this.Nr=0,this.dirty=!0}add(t){this.Dr[this.elementSize++]=t,t.Vr=this.indexSize,t.Wr=this.attributeSize,t.Hr=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,i){const e=t.qr.textures.ids[i.di.uid];return!(!e&&0!==e)&&(t.Xr=e,t.texture=i,!0)}updateElement(t){this.dirty=!0;const i=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,i.float32View,i.uint32View,t.Wr,t.Xr):this.packAttributes(t,i.float32View,i.uint32View,t.Wr,t.Xr)}break(t){const i=this.Dr;if(!i[this.elementStart])return;let e=Eh(),n=e.textures;n.clear();const s=i[this.elementStart];let r=wh(s.blendMode,s.texture.di),o=s.topology;4*this.attributeSize>this.attributeBuffer.size&&this.Yr(4*this.attributeSize),this.indexSize>this.indexBuffer.length&&this.Kr(this.indexSize);const h=this.attributeBuffer.float32View,a=this.attributeBuffer.uint32View,u=this.indexBuffer;let c=this.Nr,l=this.Lr,f="startBatch";const d=this.maxTextures;for(let p=this.elementStart;p<this.elementSize;++p){const s=i[p];i[p]=null;const v=s.texture.di,m=wh(s.blendMode,v),g=r!==m||o!==s.topology;v.ri!==Fh||g?(v.ri=Fh,(n.count>=d||g)&&(this.Qr(e,l,c-l,n,r,o,t,f),f="renderBatch",l=c,r=m,o=s.topology,e=Eh(),n=e.textures,n.clear(),++Fh),s.Xr=v.oi=n.count,n.ids[v.uid]=n.count,n.textures[n.count++]=v,s.qr=e,c+=s.indexSize,s.packAsQuad?(this.packQuadAttributes(s,h,a,s.Wr,s.Xr),this.packQuadIndex(u,s.Vr,s.Wr/this.vertexSize)):(this.packAttributes(s,h,a,s.Wr,s.Xr),this.packIndex(s,u,s.Vr,s.Wr/this.vertexSize))):(s.Xr=v.oi,c+=s.indexSize,s.packAsQuad?(this.packQuadAttributes(s,h,a,s.Wr,s.Xr),this.packQuadIndex(u,s.Vr,s.Wr/this.vertexSize)):(this.packAttributes(s,h,a,s.Wr,s.Xr),this.packIndex(s,u,s.Vr,s.Wr/this.vertexSize)),s.qr=e)}n.count>0&&(this.Qr(e,l,c-l,n,r,o,t,f),l=c,++Fh),this.elementStart=this.elementSize,this.Lr=l,this.Nr=c}Qr(t,i,e,n,s,r,o,h){t.gpuBindGroup=null,t.bindGroup=null,t.action=h,t.batcher=this,t.textures=n,t.blendMode=s,t.topology=r,t.start=i,t.size=e,++Fh,this.batches[this.batchIndex++]=t,o.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){4*t<=this.attributeBuffer.size||this.Yr(4*t)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this.Kr(t)}Yr(t){const i=Math.max(t,2*this.attributeBuffer.size),e=new gh(i);bh(this.attributeBuffer.rawBinaryData,e.rawBinaryData),this.attributeBuffer=e}Kr(t){const i=this.indexBuffer;let e=Math.max(t,1.5*i.length);e+=e%2;const n=e>65535?new Uint32Array(e):new Uint16Array(e);if(n.BYTES_PER_ELEMENT!==i.BYTES_PER_ELEMENT)for(let s=0;s<i.length;s++)n[s]=i[s];else bh(i.buffer,n.buffer);this.indexBuffer=n}packQuadIndex(t,i,e){t[i]=e+0,t[i+1]=e+1,t[i+2]=e+2,t[i+3]=e+0,t[i+4]=e+2,t[i+5]=e+3}packIndex(t,i,e,n){const s=t.indices,r=t.indexSize,o=t.indexOffset,h=t.attributeOffset;for(let a=0;a<r;a++)i[e++]=n+s[a+o]-h}destroy(){for(let t=0;t<this.batches.length;t++)Rh(this.batches[t]);this.batches=null;for(let t=0;t<this.Dr.length;t++)this.Dr[t].qr=null;this.Dr=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}};Oh.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let $h=Oh;var Uh=(t=>(t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE",t[t.STATIC=1024]="STATIC",t))(Uh||{});class Bh extends ue{constructor(t){let{data:i,size:e}=t;const{usage:n,label:s,shrinkToFit:r}=t;super(),this.uid=Pe("buffer"),this.Zt="buffer",this.ii=Pe("resource"),this.Jt=0,this.li=1,this.Zr=null,this.shrinkToFit=!0,this.destroyed=!1,i instanceof Array&&(i=new Float32Array(i)),this.St=i,e??(e=null==i?void 0:i.byteLength);const o=!!i;this.descriptor={size:e,usage:n,mappedAtCreation:o,label:s},this.shrinkToFit=r??!0}get data(){return this.St}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this.Zr||(this.Zr=new Int32Array(this.data.buffer)),this.Zr}get static(){return!!(this.descriptor.usage&Uh.STATIC)}set static(t){t?this.descriptor.usage|=Uh.STATIC:this.descriptor.usage&=~Uh.STATIC}setDataWithSize(t,i,e){if(this.li++,this.Jr=i*t.BYTES_PER_ELEMENT,this.St===t)return void(e&&this.emit("update",this));const n=this.St;this.St=t,this.Zr=null,n&&n.length===t.length||!this.shrinkToFit&&n&&t.byteLength<n.byteLength?e&&this.emit("update",this):(this.descriptor.size=t.byteLength,this.ii=Pe("resource"),this.emit("change",this))}update(t){this.Jr=t??this.Jr,this.li++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.St=null,this.descriptor=null,this.removeAllListeners()}}function Ih(t,i){if(!(t instanceof Bh)){let e=i?Uh.INDEX:Uh.VERTEX;t instanceof Array&&(i?(t=new Uint32Array(t),e=Uh.INDEX|Uh.COPY_DST):(t=new Float32Array(t),e=Uh.VERTEX|Uh.COPY_DST)),t=new Bh({data:t,label:i?"index-mesh-buffer":"vertex-mesh-buffer",usage:e})}return t}class jh extends ue{constructor(t={}){super(),this.uid=Pe("geometry"),this.Is=0,this.instanceCount=1,this._e=new qe,this.ke=!0;const{attributes:i,indexBuffer:e,topology:n}=t;if(this.buffers=[],this.attributes={},i)for(const s in i)this.addAttribute(s,i[s]);this.instanceCount=t.instanceCount??1,e&&this.addIndex(e),this.topology=n||"triangle-list"}onBufferUpdate(){this.ke=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const i=this.attributes[t];return i.buffer.data.length/(i.stride/4||i.size)}return 0}addAttribute(t,i){const e=function(t){return(t instanceof Bh||Array.isArray(t)||t.BYTES_PER_ELEMENT)&&(t={buffer:t}),t.buffer=Ih(t.buffer,!1),t}(i);-1===this.buffers.indexOf(e.buffer)&&(this.buffers.push(e.buffer),e.buffer.on("update",this.onBufferUpdate,this),e.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=e}addIndex(t){this.indexBuffer=Ih(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this.ke?(this.ke=!1,function(t,i,e){const n=t.getAttribute(i);if(!n)return e.minX=0,e.minY=0,e.maxX=0,e.maxY=0,e;const s=n.buffer.data;let r=1/0,o=1/0,h=-1/0,a=-1/0;const u=s.BYTES_PER_ELEMENT,c=(n.offset||0)/u,l=(n.stride||8)/u;for(let f=c;f<s.length;f+=l){const t=s[f],i=s[f+1];t>h&&(h=t),i>a&&(a=i),t<r&&(r=t),i<o&&(o=i)}return e.minX=r,e.minY=o,e.maxX=h,e.maxY=a,e}(this,"aPosition",this._e)):this._e}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(t=>t.destroy()),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._e=null}}const Gh=new Float32Array(1),zh=new Uint32Array(1);class Dh extends jh{constructor(){const t=new Bh({data:Gh,label:"attribute-batch-buffer",usage:Uh.VERTEX|Uh.COPY_DST,shrinkToFit:!1});super({attributes:{aPosition:{buffer:t,format:"float32x2",stride:24,offset:0},aUV:{buffer:t,format:"float32x2",stride:24,offset:8},aColor:{buffer:t,format:"unorm8x4",stride:24,offset:16},aTextureIdAndRound:{buffer:t,format:"uint16x2",stride:24,offset:20}},indexBuffer:new Bh({data:zh,label:"index-batch-buffer",usage:Uh.INDEX|Uh.COPY_DST,shrinkToFit:!1})})}}function Lh(t,i,e){if(t)for(const n in t){const s=i[n.toLocaleLowerCase()];if(s){let i=t[n];"header"===n&&(i=i.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),e&&s.push(`//----${e}----//`),s.push(i)}else _n()}}const Nh=/\{\{(.*?)\}\}/g;function Vh(t){var i;const e={};return((null==(i=t.match(Nh))?void 0:i.map(t=>t.replace(/[{()}]/g,"")))??[]).forEach(t=>{e[t]=[]}),e}function Wh(t,i){let e;const n=/@in\s+([^;]+);/g;for(;null!==(e=n.exec(t));)i.push(e[1])}function Hh(t,i,e=!1){const n=[];Wh(i,n),t.forEach(t=>{t.header&&Wh(t.header,n)});const s=n;e&&s.sort();const r=s.map((t,i)=>`       @location(${i}) ${t},`).join("\n");let o=i.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`\n${r}\n`),o}function qh(t,i){let e;const n=/@out\s+([^;]+);/g;for(;null!==(e=n.exec(t));)i.push(e[1])}function Xh(t,i){let e=t;for(const n in i){const t=i[n];e=t.join("\n").length?e.replace(`{{${n}}}`,`//-----${n} START-----//\n${t.join("\n")}\n//----${n} FINISH----//`):e.replace(`{{${n}}}`,"")}return e}const Yh=Object.create(null),Kh=new Map;let Qh=0;function Zh({template:t,bits:i}){const e=ta(t,i);if(Yh[e])return Yh[e];const{vertex:n,fragment:s}=function(t,i){const e=i.map(t=>t.vertex).filter(t=>!!t),n=i.map(t=>t.fragment).filter(t=>!!t);let s=Hh(e,t.vertex,!0);s=function(t,i){const e=[];qh(i,e),t.forEach(t=>{t.header&&qh(t.header,e)});let n=0;const s=e.sort().map(t=>t.indexOf("builtin")>-1?t:`@location(${n++}) ${t}`).join(",\n"),r=e.sort().map(t=>{return`       var ${i=t,i.replace(/@.*?\s+/g,"")};`;var i}).join("\n"),o=`return VSOutput(\n            ${e.sort().map(t=>` ${function(t){const i=/\b(\w+)\s*:/g.exec(t);return i?i[1]:""}(t)}`).join(",\n")});`;let h=i.replace(/@out\s+[^;]+;\s*/g,"");return h=h.replace("{{struct}}",`\n${s}\n`),h=h.replace("{{start}}",`\n${r}\n`),h=h.replace("{{return}}",`\n${o}\n`),h}(e,s);const r=Hh(n,t.fragment,!0);return{vertex:s,fragment:r}}(t,i);return Yh[e]=ia(n,s,i),Yh[e]}function Jh({template:t,bits:i}){const e=ta(t,i);return Yh[e]||(Yh[e]=ia(t.vertex,t.fragment,i)),Yh[e]}function ta(t,i){return i.map(t=>(Kh.has(t)||Kh.set(t,Qh++),Kh.get(t))).sort((t,i)=>t-i).join("-")+t.vertex+t.fragment}function ia(t,i,e){const n=Vh(t),s=Vh(i);return e.forEach(t=>{Lh(t.vertex,n,t.name),Lh(t.fragment,s,t.name)}),{vertex:Xh(t,n),fragment:Xh(i,s)}}const ea={name:"global-uniforms-bit",vertex:{header:"\n        struct GlobalUniforms {\n            uProjectionMatrix:mat3x3<f32>,\n            uWorldTransformMatrix:mat3x3<f32>,\n            uWorldColorAlpha: vec4<f32>,\n            uResolution: vec2<f32>,\n        }\n\n        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;\n        "}},na={name:"global-uniforms-bit",vertex:{header:"\n          uniform mat3 uProjectionMatrix;\n          uniform mat3 uWorldTransformMatrix;\n          uniform vec4 uWorldColorAlpha;\n          uniform vec2 uResolution;\n        "}};function sa({bits:t,name:i}){const e=Zh({template:{fragment:"\n    @in vUV : vec2<f32>;\n    @in vColor : vec4<f32>;\n\n    {{header}}\n\n    @fragment\n    fn main(\n        {{in}}\n      ) -> @location(0) vec4<f32> {\n\n        {{start}}\n\n        var outColor:vec4<f32>;\n\n        {{main}}\n\n        var finalColor:vec4<f32> = outColor * vColor;\n\n        {{end}}\n\n        return finalColor;\n      };\n",vertex:"\n    @in aPosition: vec2<f32>;\n    @in aUV: vec2<f32>;\n\n    @out @builtin(position) vPosition: vec4<f32>;\n    @out vUV : vec2<f32>;\n    @out vColor : vec4<f32>;\n\n    {{header}}\n\n    struct VSOutput {\n        {{struct}}\n    };\n\n    @vertex\n    fn main( {{in}} ) -> VSOutput {\n\n        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;\n        var modelMatrix = mat3x3<f32>(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        var position = aPosition;\n        var uv = aUV;\n\n        {{start}}\n\n        vColor = vec4<f32>(1., 1., 1., 1.);\n\n        {{main}}\n\n        vUV = uv;\n\n        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);\n\n        vColor *= globalUniforms.uWorldColorAlpha;\n\n        {{end}}\n\n        {{return}}\n    };\n"},bits:[ea,...t]});return Ir.from({name:i,vertex:{source:e.vertex,entryPoint:"main"},fragment:{source:e.fragment,entryPoint:"main"}})}function ra({bits:t,name:i}){return new Er({name:i,...Jh({template:{vertex:"\n    in vec2 aPosition;\n    in vec2 aUV;\n\n    out vec4 vColor;\n    out vec2 vUV;\n\n    {{header}}\n\n    void main(void){\n\n        mat3 worldTransformMatrix = uWorldTransformMatrix;\n        mat3 modelMatrix = mat3(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        vec2 position = aPosition;\n        vec2 uv = aUV;\n\n        {{start}}\n\n        vColor = vec4(1.);\n\n        {{main}}\n\n        vUV = uv;\n\n        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n\n        vColor *= uWorldColorAlpha;\n\n        {{end}}\n    }\n",fragment:"\n\n    in vec4 vColor;\n    in vec2 vUV;\n\n    out vec4 finalColor;\n\n    {{header}}\n\n    void main(void) {\n\n        {{start}}\n\n        vec4 outColor;\n\n        {{main}}\n\n        finalColor = outColor * vColor;\n\n        {{end}}\n    }\n"},bits:[na,...t]})})}const oa={name:"color-bit",vertex:{header:"\n            @in aColor: vec4<f32>;\n        ",main:"\n            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);\n        "}},ha={name:"color-bit",vertex:{header:"\n            in vec4 aColor;\n        ",main:"\n            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);\n        "}},aa={};function ua(t){const i=[];if(1===t)i.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),i.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let e=0;for(let n=0;n<t;n++)i.push(`@group(1) @binding(${e++}) var textureSource${n+1}: texture_2d<f32>;`),i.push(`@group(1) @binding(${e++}) var textureSampler${n+1}: sampler;`)}return i.join("\n")}function ca(t){const i=[];if(1===t)i.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{i.push("switch vTextureId {");for(let e=0;e<t;e++)e===t-1?i.push("  default:{"):i.push(`  case ${e}:{`),i.push(`      outColor = textureSampleGrad(textureSource${e+1}, textureSampler${e+1}, vUV, uvDx, uvDy);`),i.push("      break;}");i.push("}")}return i.join("\n")}function la(t){return aa[t]||(aa[t]={name:"texture-batch-bit",vertex:{header:"\n                @in aTextureIdAndRound: vec2<u32>;\n                @out @interpolate(flat) vTextureId : u32;\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1)\n                {\n                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n                }\n            "},fragment:{header:`\n                @in @interpolate(flat) vTextureId: u32;\n\n                ${ua(t)}\n            `,main:`\n                var uvDx = dpdx(vUV);\n                var uvDy = dpdy(vUV);\n\n                ${ca(t)}\n            `}}),aa[t]}const fa={};function da(t){const i=[];for(let e=0;e<t;e++)e>0&&i.push("else"),e<t-1&&i.push(`if(vTextureId < ${e}.5)`),i.push("{"),i.push(`\toutColor = texture(uTextures[${e}], vUV);`),i.push("}");return i.join("\n")}function pa(t){return fa[t]||(fa[t]={name:"texture-batch-bit",vertex:{header:"\n                in vec2 aTextureIdAndRound;\n                out float vTextureId;\n\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1.)\n                {\n                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n                }\n            "},fragment:{header:`\n                in float vTextureId;\n\n                uniform sampler2D uTextures[${t}];\n\n            `,main:`\n\n                ${da(t)}\n            `}}),fa[t]}const va={name:"round-pixels-bit",vertex:{header:"\n            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>\n            {\n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}},ma={name:"round-pixels-bit",vertex:{header:"\n            vec2 roundPixels(vec2 position, vec2 targetSize)\n            {\n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}},ga={};function ba(t){let i=ga[t];if(i)return i;const e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=n;return i=ga[t]=new Lr({uTextures:{value:e,type:"i32",size:t}},{isStatic:!0}),i}class ya extends Wr{constructor(t){super({glProgram:ra({name:"batch",bits:[ha,pa(t),ma]}),gpuProgram:sa({name:"batch",bits:[oa,la(t),va]}),resources:{batchSamplers:ba(t)}})}}let xa=null;const wa=class t extends $h{constructor(i){super(i),this.geometry=new Dh,this.name=t.extension.name,this.vertexSize=6,xa??(xa=new ya(i.maxTextures)),this.shader=xa}packAttributes(t,i,e,n,s){const r=s<<16|65535&t.roundPixels,o=t.transform,h=o.a,a=o.b,u=o.c,c=o.d,l=o.tx,f=o.ty,{positions:d,uvs:p}=t,v=t.color,m=t.attributeOffset,g=m+t.attributeSize;for(let b=m;b<g;b++){const t=2*b,s=d[t],o=d[t+1];i[n++]=h*s+u*o+l,i[n++]=c*o+a*s+f,i[n++]=p[t],i[n++]=p[t+1],e[n++]=v,e[n++]=r}}packQuadAttributes(t,i,e,n,s){const r=t.texture,o=t.transform,h=o.a,a=o.b,u=o.c,c=o.d,l=o.tx,f=o.ty,d=t.bounds,p=d.maxX,v=d.minX,m=d.maxY,g=d.minY,b=r.uvs,y=t.color,x=s<<16|65535&t.roundPixels;i[n+0]=h*v+u*g+l,i[n+1]=c*g+a*v+f,i[n+2]=b.x0,i[n+3]=b.y0,e[n+4]=y,e[n+5]=x,i[n+6]=h*p+u*g+l,i[n+7]=c*g+a*p+f,i[n+8]=b.x1,i[n+9]=b.y1,e[n+10]=y,e[n+11]=x,i[n+12]=h*p+u*m+l,i[n+13]=c*m+a*p+f,i[n+14]=b.x2,i[n+15]=b.y2,e[n+16]=y,e[n+17]=x,i[n+18]=h*v+u*m+l,i[n+19]=c*m+a*v+f,i[n+20]=b.x3,i[n+21]=b.y3,e[n+22]=y,e[n+23]=x}};wa.extension={type:[ie.Batcher],name:"default"};let Ma=wa;function Aa(t,i,e,n,s){const r=i.a,o=i.b,h=i.c,a=i.d,u=i.tx,c=i.ty;e||(e=0),n||(n=2),s||(s=t.length/n-e);let l=e*n;for(let f=0;f<s;f++){const i=t[l],e=t[l+1];t[l]=r*i+h*e+u,t[l+1]=o*i+a*e+c,l+=n}}const Ta=new ve;class _a{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this.Hr=null,this.qr=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,i=t>>16|65280&t|(255&t)<<16,e=this.renderable;return e?Nn(i,e.groupColor)+(this.alpha*e.groupAlpha*255<<24):i+(255*this.alpha<<24)}get transform(){var t;return(null==(t=this.renderable)?void 0:t.groupTransform)||Ta}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}}const ka={extension:{type:ie.ShapeBuilder,name:"circle"},build(t,i){let e,n,s,r,o,h;if("circle"===t.type){const i=t;if(o=h=i.radius,o<=0)return!1;e=i.x,n=i.y,s=r=0}else if("ellipse"===t.type){const i=t;if(o=i.halfWidth,h=i.halfHeight,o<=0||h<=0)return!1;e=i.x,n=i.y,s=r=0}else{const i=t,a=i.width/2,u=i.height/2;e=i.x+a,n=i.y+u,o=h=Math.max(0,Math.min(i.radius,Math.min(a,u))),s=a-o,r=u-h}if(s<0||r<0)return!1;const a=Math.ceil(2.3*Math.sqrt(o+h)),u=8*a+(s?4:0)+(r?4:0);if(0===u)return!1;if(0===a)return i[0]=i[6]=e+s,i[1]=i[3]=n+r,i[2]=i[4]=e-s,i[5]=i[7]=n-r,!0;let c=0,l=4*a+(s?2:0)+2,f=l,d=u,p=s+o,v=r,m=e+p,g=e-p,b=n+v;if(i[c++]=m,i[c++]=b,i[--l]=b,i[--l]=g,r){const t=n-v;i[f++]=g,i[f++]=t,i[--d]=t,i[--d]=m}for(let x=1;x<a;x++){const t=Math.PI/2*(x/a),u=s+Math.cos(t)*o,p=r+Math.sin(t)*h,v=e+u,m=e-u,g=n+p,b=n-p;i[c++]=v,i[c++]=g,i[--l]=g,i[--l]=m,i[f++]=m,i[f++]=b,i[--d]=b,i[--d]=v}p=s,v=r+h,m=e+p,g=e-p,b=n+v;const y=n-v;return i[c++]=m,i[c++]=b,i[--d]=y,i[--d]=m,s&&(i[c++]=g,i[c++]=b,i[--d]=y,i[--d]=g),!0},triangulate(t,i,e,n,s,r){if(0===t.length)return;let o=0,h=0;for(let c=0;c<t.length;c+=2)o+=t[c],h+=t[c+1];o/=t.length/2,h/=t.length/2;let a=n;i[a*e]=o,i[a*e+1]=h;const u=a++;for(let c=0;c<t.length;c+=2)i[a*e]=t[c],i[a*e+1]=t[c+1],c>0&&(s[r++]=a,s[r++]=u,s[r++]=a-1),a++;s[r++]=u+1,s[r++]=u,s[r++]=a-1}},Ca={...ka,extension:{...ka.extension,name:"ellipse"}},Sa={...ka,extension:{...ka.extension,name:"roundedRectangle"}},Pa=1e-4;function Ea(t,i,e,n,s,r,o,h){let a,u;o?(a=n,u=-e):(a=-n,u=e);const c=t-e*s+a,l=i-n*s+u,f=t+e*r+a,d=i+n*r+u;return h.push(c,l),h.push(f,d),2}function Ra(t,i,e,n,s,r,o,h){const a=e-t,u=n-i;let c=Math.atan2(a,u),l=Math.atan2(s-t,r-i);h&&c<l?c+=2*Math.PI:!h&&c>l&&(l+=2*Math.PI);let f=c;const d=l-c,p=Math.abs(d),v=Math.sqrt(a*a+u*u),m=1+(15*p*Math.sqrt(v)/Math.PI|0),g=d/m;if(f+=g,h){o.push(t,i),o.push(e,n);for(let e=1,n=f;e<m;e++,n+=g)o.push(t,i),o.push(t+Math.sin(n)*v,i+Math.cos(n)*v);o.push(t,i),o.push(s,r)}else{o.push(e,n),o.push(t,i);for(let e=1,n=f;e<m;e++,n+=g)o.push(t+Math.sin(n)*v,i+Math.cos(n)*v),o.push(t,i);o.push(s,r),o.push(t,i)}return 2*m}function Fa(t,i,e,n,s,r,o){const h=Co(t,i,2);if(!h)return;for(let u=0;u<h.length;u+=3)r[o++]=h[u]+s,r[o++]=h[u+1]+s,r[o++]=h[u+2]+s;let a=s*n;for(let u=0;u<t.length;u+=2)e[a]=t[u],e[a+1]=t[u+1],a+=n}const Oa=[],$a={extension:{type:ie.ShapeBuilder,name:"polygon"},build(t,i){for(let e=0;e<t.points.length;e++)i[e]=t.points[e];return!0},triangulate(t,i,e,n,s,r){Fa(t,Oa,i,e,n,s,r)}},Ua={extension:{type:ie.ShapeBuilder,name:"rectangle"},build(t,i){const e=t,n=e.x,s=e.y,r=e.width,o=e.height;return r>0&&o>0&&(i[0]=n,i[1]=s,i[2]=n+r,i[3]=s,i[4]=n+r,i[5]=s+o,i[6]=n,i[7]=s+o,!0)},triangulate(t,i,e,n,s,r){let o=0;i[(n*=e)+o]=t[0],i[n+o+1]=t[1],o+=e,i[n+o]=t[2],i[n+o+1]=t[3],o+=e,i[n+o]=t[6],i[n+o+1]=t[7],o+=e,i[n+o]=t[4],i[n+o+1]=t[5],o+=e;const h=n/e;s[r++]=h,s[r++]=h+1,s[r++]=h+2,s[r++]=h+1,s[r++]=h+3,s[r++]=h+2}},Ba={extension:{type:ie.ShapeBuilder,name:"triangle"},build:(t,i)=>(i[0]=t.x,i[1]=t.y,i[2]=t.x2,i[3]=t.y2,i[4]=t.x3,i[5]=t.y3,!0),triangulate(t,i,e,n,s,r){let o=0;i[(n*=e)+o]=t[0],i[n+o+1]=t[1],o+=e,i[n+o]=t[2],i[n+o+1]=t[3],o+=e,i[n+o]=t[4],i[n+o+1]=t[5];const h=n/e;s[r++]=h,s[r++]=h+1,s[r++]=h+2}},Ia=new ve,ja=new Ce;const Ga={};se.handleByMap(ie.ShapeBuilder,Ga),se.add(Ua,$a,Ba,ka,Ca,Sa);const za=new Ce,Da=new ve;function La(t,i,e){const n=[],s=Ga.rectangle,r=za;r.x=t.dx,r.y=t.dy,r.width=t.dw,r.height=t.dh;const o=t.transform;if(!s.build(r,n))return;const{vertices:h,uvs:a,indices:u}=e,c=u.length,l=h.length/2;o&&Aa(n,o),s.triangulate(n,h,2,l,u,c);const f=t.image,d=f.uvs;a.push(d.x0,d.y0,d.x1,d.y1,d.x3,d.y3,d.x2,d.y2);const p=Cn.get(_a);p.indexOffset=c,p.indexSize=u.length-c,p.attributeOffset=l,p.attributeSize=h.length/2-l,p.baseColor=t.style,p.alpha=t.alpha,p.texture=f,p.geometryData=e,i.push(p)}function Na(t,i,e,n,s){const{vertices:r,uvs:o,indices:h}=s;t.shapePrimitives.forEach(({shape:t,transform:a,holes:u})=>{const c=[],l=Ga[t.type];if(!l.build(t,c))return;const f=h.length,d=r.length/2;let p="triangle-list";if(a&&Aa(c,a),e){const e=t.closePath??!0,n=i;n.pixelLine?(!function(t,i,e,n){const s=Pa;if(0===t.length)return;const r=t[0],o=t[1],h=t[t.length-2],a=t[t.length-1],u=i||Math.abs(r-h)<s&&Math.abs(o-a)<s,c=e,l=t.length/2,f=c.length/2;for(let d=0;d<l;d++)c.push(t[2*d]),c.push(t[2*d+1]);for(let d=0;d<l-1;d++)n.push(f+d,f+d+1);u&&n.push(f+l-1,f)}(c,e,r,h),p="line-list"):function(t,i,e,n,s,r){const o=Pa;if(0===t.length)return;const h=i;let a=h.alignment;if(.5!==i.alignment){let i=function(t){const i=t.length;if(i<6)return 1;let e=0;for(let n=0,s=t[i-2],r=t[i-1];n<i;n+=2){const i=t[n],o=t[n+1];e+=(i-s)*(o+r),s=i,r=o}return e<0?-1:1}(t);a=(a-.5)*i+.5}const u=new de(t[0],t[1]),c=new de(t[t.length-2],t[t.length-1]),l=n,f=Math.abs(u.x-c.x)<o&&Math.abs(u.y-c.y)<o;if(l){t=t.slice(),f&&(t.pop(),t.pop(),c.set(t[t.length-2],t[t.length-1]));const i=.5*(u.x+c.x),e=.5*(c.y+u.y);t.unshift(i,e),t.push(i,e)}const d=s,p=t.length/2;let v=t.length;const m=d.length/2,g=h.width/2,b=g*g,y=h.miterLimit*h.miterLimit;let x=t[0],w=t[1],M=t[2],A=t[3],T=0,_=0,k=-(w-A),C=x-M,S=0,P=0,E=Math.sqrt(k*k+C*C);k/=E,C/=E,k*=g,C*=g;const R=2*(1-a),F=2*a;l||("round"===h.cap?v+=Ra(x-k*(R-F)*.5,w-C*(R-F)*.5,x-k*R,w-C*R,x+k*F,w+C*F,d,!0)+2:"square"===h.cap&&(v+=Ea(x,w,k,C,R,F,!0,d))),d.push(x-k*R,w-C*R),d.push(x+k*F,w+C*F);for(let O=1;O<p-1;++O){x=t[2*(O-1)],w=t[2*(O-1)+1],M=t[2*O],A=t[2*O+1],T=t[2*(O+1)],_=t[2*(O+1)+1],k=-(w-A),C=x-M,E=Math.sqrt(k*k+C*C),k/=E,C/=E,k*=g,C*=g,S=-(A-_),P=M-T,E=Math.sqrt(S*S+P*P),S/=E,P/=E,S*=g,P*=g;const i=M-x,e=w-A,n=M-T,s=_-A,r=i*n+e*s,o=e*n-s*i,a=o<0;if(Math.abs(o)<.001*Math.abs(r)){d.push(M-k*R,A-C*R),d.push(M+k*F,A+C*F),r>=0&&("round"===h.join?v+=Ra(M,A,M-k*R,A-C*R,M-S*R,A-P*R,d,!1)+4:v+=2,d.push(M-S*F,A-P*F),d.push(M+S*R,A+P*R));continue}const u=(-k+x)*(-C+A)-(-k+M)*(-C+w),c=(-S+T)*(-P+A)-(-S+M)*(-P+_),l=(i*c-n*u)/o,f=(s*u-e*c)/o,p=(l-M)*(l-M)+(f-A)*(f-A),m=M+(l-M)*R,$=A+(f-A)*R,U=M-(l-M)*F,B=A-(f-A)*F,I=a?R:F;p<=Math.min(i*i+e*e,n*n+s*s)+I*I*b?"bevel"===h.join||p/b>y?(a?(d.push(m,$),d.push(M+k*F,A+C*F),d.push(m,$),d.push(M+S*F,A+P*F)):(d.push(M-k*R,A-C*R),d.push(U,B),d.push(M-S*R,A-P*R),d.push(U,B)),v+=2):"round"===h.join?a?(d.push(m,$),d.push(M+k*F,A+C*F),v+=Ra(M,A,M+k*F,A+C*F,M+S*F,A+P*F,d,!0)+4,d.push(m,$),d.push(M+S*F,A+P*F)):(d.push(M-k*R,A-C*R),d.push(U,B),v+=Ra(M,A,M-k*R,A-C*R,M-S*R,A-P*R,d,!1)+4,d.push(M-S*R,A-P*R),d.push(U,B)):(d.push(m,$),d.push(U,B)):(d.push(M-k*R,A-C*R),d.push(M+k*F,A+C*F),"round"===h.join?v+=a?Ra(M,A,M+k*F,A+C*F,M+S*F,A+P*F,d,!0)+2:Ra(M,A,M-k*R,A-C*R,M-S*R,A-P*R,d,!1)+2:"miter"===h.join&&p/b<=y&&(a?(d.push(U,B),d.push(U,B)):(d.push(m,$),d.push(m,$)),v+=2),d.push(M-S*R,A-P*R),d.push(M+S*F,A+P*F),v+=2)}x=t[2*(p-2)],w=t[2*(p-2)+1],M=t[2*(p-1)],A=t[2*(p-1)+1],k=-(w-A),C=x-M,E=Math.sqrt(k*k+C*C),k/=E,C/=E,k*=g,C*=g,d.push(M-k*R,A-C*R),d.push(M+k*F,A+C*F),l||("round"===h.cap?v+=Ra(M-k*(R-F)*.5,A-C*(R-F)*.5,M-k*R,A-C*R,M+k*F,A+C*F,d,!1)+2:"square"===h.cap&&(v+=Ea(M,A,k,C,R,F,!1,d)));for(let O=m;O<v+m-2;++O)x=d[2*O],w=d[2*O+1],M=d[2*(O+1)],A=d[2*(O+1)+1],T=d[2*(O+2)],_=d[2*(O+2)+1],Math.abs(x*(A-_)+M*(_-w)+T*(w-A))<1e-8||r.push(O,O+1,O+2)}(c,n,0,e,r,h)}else if(u){const t=[],i=c.slice();(function(t){const i=[];for(let e=0;e<t.length;e++){const n=t[e].shape,s=[];Ga[n.type].build(n,s)&&i.push(s)}return i})(u).forEach(e=>{t.push(i.length/2),i.push(...e)}),Fa(i,t,r,2,d,h,f)}else l.triangulate(c,r,2,d,h,f);const v=o.length/2,m=i.texture;if(m!==Ve.WHITE){const e=function(t,i,e,n){const s=i.matrix?t.copyFrom(i.matrix).invert():t.identity();if("local"===i.textureSpace){const t=e.getBounds(ja);i.width&&t.pad(i.width);const{x:n,y:r}=t,o=1/t.width,h=1/t.height,a=-n*o,u=-r*h,c=s.a,l=s.b,f=s.c,d=s.d;s.a*=o,s.b*=o,s.c*=h,s.d*=h,s.tx=a*c+u*f+s.tx,s.ty=a*l+u*d+s.ty}else s.translate(i.texture.frame.x,i.texture.frame.y),s.scale(1/i.texture.source.width,1/i.texture.source.height);const r=i.texture.source.style;return i.fill instanceof Jo||"clamp-to-edge"!==r.addressMode||(r.addressMode="repeat",r.update()),n&&s.append(Ia.copyFrom(n).invert()),s}(Da,i,t,a);!function(t,i,e,n,s,r,o,h=null){let a=0;e*=i,s*=r;const u=h.a,c=h.b,l=h.c,f=h.d,d=h.tx,p=h.ty;for(;a<o;){const o=t[e],h=t[e+1];n[s]=u*o+l*h+d,n[s+1]=c*o+f*h+p,s+=r,e+=i,a++}}(r,2,d,o,v,2,r.length/2-d,e)}else!function(t,i,e,n){let s=0;for(i*=e;s<n;)t[i]=0,t[i+1]=0,i+=e,s++}(o,v,2,r.length/2-d);const g=Cn.get(_a);g.indexOffset=f,g.indexSize=h.length-f,g.attributeOffset=d,g.attributeSize=r.length/2-d,g.baseColor=i.color,g.alpha=i.alpha,g.texture=m,g.geometryData=s,g.topology=p,n.push(g)})}class Va{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class Wa{constructor(){this.instructions=new ns}init(t){this.batcher=new Ma({maxTextures:t}),this.instructions.reset()}get geometry(){return Re(0,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}}const Ha=class t{constructor(t){this.io={},this.eo=Object.create(null),this.Yn=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(i){t.defaultOptions.bezierSmoothness=(null==i?void 0:i.bezierSmoothness)??t.defaultOptions.bezierSmoothness}getContextRenderData(t){return this.eo[t.uid]||this.no(t)}updateGpuContext(t){let i=this.io[t.uid]||this.so(t);if(t.dirty){i?this.ro(t):i=this.so(t),function(t,i){const{geometryData:e,batches:n}=i;n.length=0,e.indices.length=0,e.vertices.length=0,e.uvs.length=0;for(let s=0;s<t.instructions.length;s++){const i=t.instructions[s];if("texture"===i.action)La(i.data,n,e);else if("fill"===i.action||"stroke"===i.action){const t="stroke"===i.action,s=i.data.path.shapePath,r=i.data.style,o=i.data.hole;t&&o&&Na(o.shapePath,r,!0,n,e),o&&(s.shapePrimitives[s.shapePrimitives.length-1].holes=o.shapePath.shapePrimitives),Na(s,r,t,n,e)}}}(t,i);const e=t.batchMode;t.customShader||"no-batch"===e?i.isBatchable=!1:i.isBatchable="auto"!==e||i.geometryData.vertices.length<400,t.dirty=!1}return i}getGpuContext(t){return this.io[t.uid]||this.so(t)}no(t){const i=Cn.get(Wa,{maxTextures:this.Yn.limits.maxBatchableTextures}),{batches:e,geometryData:n}=this.io[t.uid],s=n.vertices.length,r=n.indices.length;for(let u=0;u<e.length;u++)e[u].applyTransform=!1;const o=i.batcher;o.ensureAttributeBuffer(s),o.ensureIndexBuffer(r),o.begin();for(let u=0;u<e.length;u++){const t=e[u];o.add(t)}o.finish(i.instructions);const h=o.geometry;h.indexBuffer.setDataWithSize(o.indexBuffer,o.indexSize,!0),h.buffers[0].setDataWithSize(o.attributeBuffer.float32View,o.attributeSize,!0);const a=o.batches;for(let u=0;u<a.length;u++){const t=a[u];t.bindGroup=mh(t.textures.textures,t.textures.count,this.Yn.limits.maxBatchableTextures)}return this.eo[t.uid]=i,i}so(t){const i=new Va;return i.context=t,this.io[t.uid]=i,t.on("destroy",this.onGraphicsContextDestroy,this),this.io[t.uid]}onGraphicsContextDestroy(t){this.ro(t),t.off("destroy",this.onGraphicsContextDestroy,this),this.io[t.uid]=null}ro(t){const i=this.io[t.uid];i.isBatchable||this.eo[t.uid]&&(Cn.return(this.getContextRenderData(t)),this.eo[t.uid]=null),i.batches&&i.batches.forEach(t=>{Cn.return(t)})}destroy(){for(const t in this.io)this.io[t]&&this.onGraphicsContextDestroy(this.io[t].context)}};Ha.extension={type:[ie.WebGLSystem,ie.WebGPUSystem,ie.CanvasSystem],name:"graphicsContext"},Ha.defaultOptions={bezierSmoothness:.5};let qa=Ha;const Xa=1.1920929e-7;function Ya(t,i,e,n,s,r,o,h,a,u){let c=(1-Math.min(.99,Math.max(0,u??qa.defaultOptions.bezierSmoothness)))/1;return c*=c,function(t,i,e,n,s,r,o,h,a,u){Ka(t,i,e,n,s,r,o,h,a,u,0),a.push(o,h)}(i,e,n,s,r,o,h,a,t,c),t}function Ka(t,i,e,n,s,r,o,h,a,u,c){if(c>8)return;const l=(t+e)/2,f=(i+n)/2,d=(e+s)/2,p=(n+r)/2,v=(s+o)/2,m=(r+h)/2,g=(l+d)/2,b=(f+p)/2,y=(d+v)/2,x=(p+m)/2,w=(g+y)/2,M=(b+x)/2;if(c>0){let c=o-t,l=h-i;const f=Math.abs((e-o)*l-(n-h)*c),d=Math.abs((s-o)*l-(r-h)*c);if(f>Xa&&d>Xa){if((f+d)*(f+d)<=u*(c*c+l*l))return void a.push(w,M)}else if(f>Xa){if(f*f<=u*(c*c+l*l))return void a.push(w,M)}else if(d>Xa){if(d*d<=u*(c*c+l*l))return void a.push(w,M)}else if(c=w-(t+o)/2,l=M-(i+h)/2,c*c+l*l<=u)return void a.push(w,M)}Ka(t,i,l,f,g,b,w,M,a,u,c+1),Ka(w,M,y,x,v,m,o,h,a,u,c+1)}function Qa(t,i,e,n,s,r,o,h){let a=(1-Math.min(.99,Math.max(0,h??qa.defaultOptions.bezierSmoothness)))/1;return a*=a,function(t,i,e,n,s,r,o,h){Za(o,t,i,e,n,s,r,h,0),o.push(s,r)}(i,e,n,s,r,o,t,a),t}function Za(t,i,e,n,s,r,o,h,a){if(a>8)return;const u=(i+n)/2,c=(e+s)/2,l=(n+r)/2,f=(s+o)/2,d=(u+l)/2,p=(c+f)/2;let v=r-i,m=o-e;const g=Math.abs((n-r)*m-(s-o)*v);if(g>1.1920929e-7){if(g*g<=h*(v*v+m*m))return void t.push(d,p)}else if(v=d-(i+r)/2,m=p-(e+o)/2,v*v+m*m<=h)return void t.push(d,p);Za(t,i,e,u,c,d,p,h,a+1),Za(t,d,p,l,f,r,o,h,a+1)}function Ja(t,i,e,n,s,r,o,h){let a=Math.abs(s-r);(!o&&s>r||o&&r>s)&&(a=2*Math.PI-a),h||(h=Math.max(6,Math.floor(6*Math.pow(n,1/3)*(a/Math.PI))));let u=a/(h=Math.max(h,3)),c=s;u*=o?-1:1;for(let l=0;l<h+1;l++){const s=i+Math.cos(c)*n,r=e+Math.sin(c)*n;t.push(s,r),c+=u}}const tu=2*Math.PI,iu={centerX:0,centerY:0,ang1:0,ang2:0},eu=({x:t,y:i},e,n,s,r,o,h,a)=>{const u=s*(t*=e)-r*(i*=n),c=r*t+s*i;return a.x=u+o,a.y=c+h,a};function nu(t,i){const e=-1.5707963267948966===i?-.551915024494:4/3*Math.tan(i/4),n=1.5707963267948966===i?.551915024494:e,s=Math.cos(t),r=Math.sin(t),o=Math.cos(t+i),h=Math.sin(t+i);return[{x:s-r*n,y:r+s*n},{x:o+h*n,y:h-o*n},{x:o,y:h}]}const su=(t,i,e,n)=>{let s=t*e+i*n;return s>1&&(s=1),s<-1&&(s=-1),(t*n-i*e<0?-1:1)*Math.acos(s)};function ru(t,i,e,n,s,r,o,h=0,a=0,u=0){if(0===r||0===o)return;const c=Math.sin(h*tu/360),l=Math.cos(h*tu/360),f=l*(i-n)/2+c*(e-s)/2,d=-c*(i-n)/2+l*(e-s)/2;if(0===f&&0===d)return;r=Math.abs(r),o=Math.abs(o);const p=Math.pow(f,2)/Math.pow(r,2)+Math.pow(d,2)/Math.pow(o,2);p>1&&(r*=Math.sqrt(p),o*=Math.sqrt(p)),((t,i,e,n,s,r,o,h,a,u,c,l,f)=>{const d=Math.pow(s,2),p=Math.pow(r,2),v=Math.pow(c,2),m=Math.pow(l,2);let g=d*p-d*m-p*v;g<0&&(g=0),g/=d*m+p*v,g=Math.sqrt(g)*(o===h?-1:1);const b=g*s/r*l,y=g*-r/s*c,x=u*b-a*y+(t+e)/2,w=a*b+u*y+(i+n)/2,M=(c-b)/s,A=(l-y)/r,T=(-c-b)/s,_=(-l-y)/r,k=su(1,0,M,A);let C=su(M,A,T,_);0===h&&C>0&&(C-=tu),1===h&&C<0&&(C+=tu),f.centerX=x,f.centerY=w,f.ang1=k,f.ang2=C})(i,e,n,s,r,o,a,u,c,l,f,d,iu);let{ang1:v,ang2:m}=iu;const{centerX:g,centerY:b}=iu;let y=Math.abs(m)/(tu/4);Math.abs(1-y)<1e-7&&(y=1);const x=Math.max(Math.ceil(y),1);m/=x;let w=t[t.length-2],M=t[t.length-1];const A={x:0,y:0};for(let T=0;T<x;T++){const i=nu(v,m),{x:e,y:n}=eu(i[0],r,o,l,c,g,b,A),{x:s,y:h}=eu(i[1],r,o,l,c,g,b,A),{x:a,y:u}=eu(i[2],r,o,l,c,g,b,A);Ya(t,w,M,e,n,s,h,a,u),w=a,M=u,v+=m}}const ou=new Ce;class hu{constructor(t){this.shapePrimitives=[],this.oo=null,this._e=new qe,this.ho=t,this.signed=t.checkForHoles}moveTo(t,i){return this.startPoly(t,i),this}lineTo(t,i){this.ao();const e=this.oo.points,n=e[e.length-2],s=e[e.length-1];return n===t&&s===i||e.push(t,i),this}arc(t,i,e,n,s,r){this.ao(!1);return Ja(this.oo.points,t,i,e,n,s,r),this}arcTo(t,i,e,n,s){this.ao();return function(t,i,e,n,s,r){const o=t[t.length-2],h=t[t.length-1]-e,a=o-i,u=s-e,c=n-i,l=Math.abs(h*c-a*u);if(l<1e-8||0===r)return void(t[t.length-2]===i&&t[t.length-1]===e||t.push(i,e));const f=h*h+a*a,d=u*u+c*c,p=h*u+a*c,v=r*Math.sqrt(f)/l,m=r*Math.sqrt(d)/l,g=v*p/f,b=m*p/d,y=v*c+m*a,x=v*u+m*h,w=a*(m+g),M=h*(m+g),A=c*(v+b),T=u*(v+b);Ja(t,y+i,x+e,r,Math.atan2(M-x,w-y),Math.atan2(T-x,A-y),a*u>c*h)}(this.oo.points,t,i,e,n,s),this}arcToSvg(t,i,e,n,s,r,o){return ru(this.oo.points,this.oo.lastX,this.oo.lastY,r,o,t,i,e,n,s),this}bezierCurveTo(t,i,e,n,s,r,o){this.ao();const h=this.oo;return Ya(this.oo.points,h.lastX,h.lastY,t,i,e,n,s,r,o),this}quadraticCurveTo(t,i,e,n,s){this.ao();const r=this.oo;return Qa(this.oo.points,r.lastX,r.lastY,t,i,e,n,s),this}closePath(){return this.endPoly(!0),this}addPath(t,i){this.endPoly(),i&&!i.isIdentity()&&(t=t.clone(!0)).transform(i);const e=this.shapePrimitives,n=e.length;for(let s=0;s<t.instructions.length;s++){const i=t.instructions[s];this[i.action](...i.data)}if(t.checkForHoles&&e.length-n>1){let t=null;for(let i=n;i<e.length;i++){const n=e[i];if("polygon"===n.shape.type){const s=n.shape,r=null==t?void 0:t.shape;r&&r.containsPolygon(s)?(t.holes||(t.holes=[]),t.holes.push(n),e.copyWithin(i,i+1),e.length--,i--):t=n}}}return this}finish(t=!1){this.endPoly(t)}rect(t,i,e,n,s){return this.drawShape(new Ce(t,i,e,n),s),this}circle(t,i,e,n){return this.drawShape(new uh(t,i,e),n),this}poly(t,i,e){const n=new fh(t);return n.closePath=i,this.drawShape(n,e),this}regularPoly(t,i,e,n,s=0,r){n=Math.max(0|n,3);const o=-1*Math.PI/2+s,h=2*Math.PI/n,a=[];for(let u=0;u<n;u++){const n=o-u*h;a.push(t+e*Math.cos(n),i+e*Math.sin(n))}return this.poly(a,!0,r),this}roundPoly(t,i,e,n,s,r=0,o){if(n=Math.max(0|n,3),s<=0)return this.regularPoly(t,i,e,n,r);const h=e*Math.sin(Math.PI/n)-.001;s=Math.min(s,h);const a=-1*Math.PI/2+r,u=2*Math.PI/n,c=(n-2)*Math.PI/n/2;for(let l=0;l<n;l++){const n=l*u+a,r=t+e*Math.cos(n),h=i+e*Math.sin(n),f=n+Math.PI+c,d=n-Math.PI-c,p=r+s*Math.cos(f),v=h+s*Math.sin(f),m=r+s*Math.cos(d),g=h+s*Math.sin(d);0===l?this.moveTo(p,v):this.lineTo(p,v),this.quadraticCurveTo(r,h,m,g,o)}return this.closePath()}roundShape(t,i,e=!1,n){return t.length<3?this:(e?function(t,i,e,n){const s=(t,i)=>Math.sqrt((t.x-i.x)**2+(t.y-i.y)**2),r=(t,i,e)=>({x:t.x+(i.x-t.x)*e,y:t.y+(i.y-t.y)*e}),o=i.length;for(let h=0;h<o;h++){const a=i[(h+1)%o],u=a.radius??e;if(u<=0){0===h?t.moveTo(a.x,a.y):t.lineTo(a.x,a.y);continue}const c=i[h],l=i[(h+2)%o],f=s(c,a);let d;d=f<1e-4?a:r(a,c,Math.min(f/2,u)/f);const p=s(l,a);let v;v=p<1e-4?a:r(a,l,Math.min(p/2,u)/p),0===h?t.moveTo(d.x,d.y):t.lineTo(d.x,d.y),t.quadraticCurveTo(a.x,a.y,v.x,v.y,n)}}(this,t,i,n):function(t,i,e){const n=(t,i)=>{const e=i.x-t.x,n=i.y-t.y,s=Math.sqrt(e*e+n*n);return{len:s,nx:e/s,ny:n/s}},s=(i,e)=>{0===i?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y)};let r=i[i.length-1];for(let o=0;o<i.length;o++){const h=i[o%i.length],a=h.radius??e;if(a<=0){s(o,h),r=h;continue}const u=i[(o+1)%i.length],c=n(h,r),l=n(h,u);if(c.len<1e-4||l.len<1e-4){s(o,h),r=h;continue}let f=Math.asin(c.nx*l.ny-c.ny*l.nx),d=1,p=!1;c.nx*l.nx-c.ny*-l.ny<0?f<0?f=Math.PI+f:(f=Math.PI-f,d=-1,p=!0):f>0&&(d=-1,p=!0);const v=f/2;let m,g=Math.abs(Math.cos(v)*a/Math.sin(v));g>Math.min(c.len/2,l.len/2)?(g=Math.min(c.len/2,l.len/2),m=Math.abs(g*Math.sin(v)/Math.cos(v))):m=a;const b=h.x+l.nx*g+-l.ny*m*d,y=h.y+l.ny*g+l.nx*m*d,x=Math.atan2(c.ny,c.nx)+Math.PI/2*d,w=Math.atan2(l.ny,l.nx)-Math.PI/2*d;0===o&&t.moveTo(b+Math.cos(x)*m,y+Math.sin(x)*m),t.arc(b,y,m,x,w,p),r=h}}(this,t,i),this.closePath())}filletRect(t,i,e,n,s){if(0===s)return this.rect(t,i,e,n);const r=Math.min(e,n)/2,o=Math.min(r,Math.max(-r,s)),h=t+e,a=i+n,u=o<0?-o:0,c=Math.abs(o);return this.moveTo(t,i+c).arcTo(t+u,i+u,t+c,i,c).lineTo(h-c,i).arcTo(h-u,i+u,h,i+c,c).lineTo(h,a-c).arcTo(h-u,a-u,t+e-c,a,c).lineTo(t+c,a).arcTo(t+u,a-u,t,a-c,c).closePath()}chamferRect(t,i,e,n,s,r){if(s<=0)return this.rect(t,i,e,n);const o=Math.min(s,Math.min(e,n)/2),h=t+e,a=i+n,u=[t+o,i,h-o,i,h,i+o,h,a-o,h-o,a,t+o,a,t,a-o,t,i+o];for(let c=u.length-1;c>=2;c-=2)u[c]===u[c-2]&&u[c-1]===u[c-3]&&u.splice(c-1,2);return this.poly(u,!0,r)}ellipse(t,i,e,n,s){return this.drawShape(new ch(t,i,e,n),s),this}roundRect(t,i,e,n,s,r){return this.drawShape(new ph(t,i,e,n,s),r),this}drawShape(t,i){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:i}),this}startPoly(t,i){let e=this.oo;return e&&this.endPoly(),e=new fh,e.points.push(t,i),this.oo=e,this}endPoly(t=!1){const i=this.oo;return i&&i.points.length>2&&(i.closePath=t,this.shapePrimitives.push({shape:i})),this.oo=null,this}ao(t=!0){if(!this.oo&&(this.oo=new fh,t)){const t=this.shapePrimitives[this.shapePrimitives.length-1];if(t){let i=t.shape.x,e=t.shape.y;if(t.transform&&!t.transform.isIdentity()){const n=t.transform,s=i;i=n.a*i+n.c*e+n.tx,e=n.b*s+n.d*e+n.ty}this.oo.points.push(i,e)}else this.oo.points.push(0,0)}}buildPath(){const t=this.ho;this.shapePrimitives.length=0,this.oo=null;for(let i=0;i<t.instructions.length;i++){const e=t.instructions[i];this[e.action](...e.data)}this.finish()}get bounds(){const t=this._e;t.clear();const i=this.shapePrimitives;for(let e=0;e<i.length;e++){const n=i[e],s=n.shape.getBounds(ou);n.transform?t.addRect(s,n.transform):t.addRect(s)}return t}}class au{constructor(t,i=!1){this.instructions=[],this.uid=Pe("graphicsPath"),this.Ls=!0,this.checkForHoles=i,"string"==typeof t?function(t,i){const e=ah(t),n=[];let s=null,r=0,o=0;for(let h=0;h<e.length;h++){const t=e[h],a=t[0],u=t;switch(a){case"M":r=u[1],o=u[2],i.moveTo(r,o);break;case"m":r+=u[1],o+=u[2],i.moveTo(r,o);break;case"H":r=u[1],i.lineTo(r,o);break;case"h":r+=u[1],i.lineTo(r,o);break;case"V":o=u[1],i.lineTo(r,o);break;case"v":o+=u[1],i.lineTo(r,o);break;case"L":r=u[1],o=u[2],i.lineTo(r,o);break;case"l":r+=u[1],o+=u[2],i.lineTo(r,o);break;case"C":r=u[5],o=u[6],i.bezierCurveTo(u[1],u[2],u[3],u[4],r,o);break;case"c":i.bezierCurveTo(r+u[1],o+u[2],r+u[3],o+u[4],r+u[5],o+u[6]),r+=u[5],o+=u[6];break;case"S":r=u[3],o=u[4],i.bezierCurveToShort(u[1],u[2],r,o);break;case"s":i.bezierCurveToShort(r+u[1],o+u[2],r+u[3],o+u[4]),r+=u[3],o+=u[4];break;case"Q":r=u[3],o=u[4],i.quadraticCurveTo(u[1],u[2],r,o);break;case"q":i.quadraticCurveTo(r+u[1],o+u[2],r+u[3],o+u[4]),r+=u[3],o+=u[4];break;case"T":r=u[1],o=u[2],i.quadraticCurveToShort(r,o);break;case"t":r+=u[1],o+=u[2],i.quadraticCurveToShort(r,o);break;case"A":r=u[6],o=u[7],i.arcToSvg(u[1],u[2],u[3],u[4],u[5],r,o);break;case"a":r+=u[6],o+=u[7],i.arcToSvg(u[1],u[2],u[3],u[4],u[5],r,o);break;case"Z":case"z":i.closePath(),n.length>0&&(s=n.pop(),s?(r=s.startX,o=s.startY):(r=0,o=0)),s=null;break;default:_n()}"Z"!==a&&"z"!==a&&null===s&&(s={startX:r,startY:o},n.push(s))}}(t,this):this.instructions=(null==t?void 0:t.slice())??[]}get shapePath(){return this.uo||(this.uo=new hu(this)),this.Ls&&(this.Ls=!1,this.uo.buildPath()),this.uo}addPath(t,i){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,i]}),this.Ls=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this.Ls=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this.Ls=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this.Ls=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this.Ls=!0,this}bezierCurveToShort(t,i,e,n,s){const r=this.instructions[this.instructions.length-1],o=this.getLastPoint(de.shared);let h=0,a=0;if(r&&"bezierCurveTo"===r.action){h=r.data[2],a=r.data[3];const t=o.x,i=o.y;h=t+(t-h),a=i+(i-a)}else h=o.x,a=o.y;return this.instructions.push({action:"bezierCurveTo",data:[h,a,t,i,e,n,s]}),this.Ls=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this.Ls=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this.Ls=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this.Ls=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this.Ls=!0,this}quadraticCurveToShort(t,i,e){const n=this.instructions[this.instructions.length-1],s=this.getLastPoint(de.shared);let r=0,o=0;if(n&&"quadraticCurveTo"===n.action){r=n.data[0],o=n.data[1];const t=s.x,i=s.y;r=t+(t-r),o=i+(i-o)}else r=s.x,o=s.y;return this.instructions.push({action:"quadraticCurveTo",data:[r,o,t,i,e]}),this.Ls=!0,this}rect(t,i,e,n,s){return this.instructions.push({action:"rect",data:[t,i,e,n,s]}),this.Ls=!0,this}circle(t,i,e,n){return this.instructions.push({action:"circle",data:[t,i,e,n]}),this.Ls=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this.Ls=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this.Ls=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this.Ls=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this.Ls=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this.Ls=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this.Ls=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this.Ls=!0,this}star(t,i,e,n,s,r,o){s||(s=n/2);const h=-1*Math.PI/2+r,a=2*e,u=2*Math.PI/a,c=[];for(let l=0;l<a;l++){const e=l%2?s:n,r=l*u+h;c.push(t+e*Math.cos(r),i+e*Math.sin(r))}return this.poly(c,!0,o),this}clone(t=!1){const i=new au;if(i.checkForHoles=this.checkForHoles,t)for(let e=0;e<this.instructions.length;e++){const t=this.instructions[e];i.instructions.push({action:t.action,data:t.data.slice()})}else i.instructions=this.instructions.slice();return i}clear(){return this.instructions.length=0,this.Ls=!0,this}transform(t){if(t.isIdentity())return this;const i=t.a,e=t.b,n=t.c,s=t.d,r=t.tx,o=t.ty;let h=0,a=0,u=0,c=0,l=0,f=0,d=0,p=0;for(let v=0;v<this.instructions.length;v++){const m=this.instructions[v],g=m.data;switch(m.action){case"moveTo":case"lineTo":h=g[0],a=g[1],g[0]=i*h+n*a+r,g[1]=e*h+s*a+o;break;case"bezierCurveTo":u=g[0],c=g[1],l=g[2],f=g[3],h=g[4],a=g[5],g[0]=i*u+n*c+r,g[1]=e*u+s*c+o,g[2]=i*l+n*f+r,g[3]=e*l+s*f+o,g[4]=i*h+n*a+r,g[5]=e*h+s*a+o;break;case"quadraticCurveTo":u=g[0],c=g[1],h=g[2],a=g[3],g[0]=i*u+n*c+r,g[1]=e*u+s*c+o,g[2]=i*h+n*a+r,g[3]=e*h+s*a+o;break;case"arcToSvg":h=g[5],a=g[6],d=g[0],p=g[1],g[0]=i*d+n*p,g[1]=e*d+s*p,g[5]=i*h+n*a+r,g[6]=e*h+s*a+o;break;case"circle":g[4]=uu(g[3],t);break;case"rect":g[4]=uu(g[4],t);break;case"ellipse":g[8]=uu(g[8],t);break;case"roundRect":g[5]=uu(g[5],t);break;case"addPath":g[0].transform(t);break;case"poly":g[2]=uu(g[2],t);break;default:_n(m.action)}}return this.Ls=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let i=this.instructions.length-1,e=this.instructions[i];if(!e)return t.x=0,t.y=0,t;for(;"closePath"===e.action;){if(i--,i<0)return t.x=0,t.y=0,t;e=this.instructions[i]}switch(e.action){case"moveTo":case"lineTo":t.x=e.data[0],t.y=e.data[1];break;case"quadraticCurveTo":t.x=e.data[2],t.y=e.data[3];break;case"bezierCurveTo":t.x=e.data[4],t.y=e.data[5];break;case"arc":case"arcToSvg":t.x=e.data[5],t.y=e.data[6];break;case"addPath":e.data[0].getLastPoint(t)}return t}}function uu(t,i){return t?t.prepend(i):i.clone()}function cu(t,i,e){const n=t.getAttribute(i);return n?Number(n):e}function lu(t){const i=cu(t,"x1",0),e=cu(t,"y1",0),n=cu(t,"x2",1),s=cu(t,"y2",0),r=t.getAttribute("gradientUnits")||"objectBoundingBox",o=new Jo(i,e,n,s,"objectBoundingBox"===r?"local":"global");for(let h=0;h<t.children.length;h++){const i=t.children[h],e=cu(i,"offset",0),n=An.shared.setValue(i.getAttribute("stop-color")).toNumber();o.addColorStop(e,n)}return o}function fu(t){return _n(),new Jo(0,0,1,0)}function du(t){const i=t.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return i?i[1]:""}const pu={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function vu(t,i){const e=t.getAttribute("style"),n={},s={},r={strokeStyle:n,fillStyle:s,useFill:!1,useStroke:!1};for(const o in pu){const e=t.getAttribute(o);e&&mu(i,r,o,e.trim())}if(e){const t=e.split(";");for(let e=0;e<t.length;e++){const n=t[e].trim(),[s,o]=n.split(":");pu[s]&&mu(i,r,s,o.trim())}}return{strokeStyle:r.useStroke?n:null,fillStyle:r.useFill?s:null,useFill:r.useFill,useStroke:r.useStroke}}function mu(t,i,e,n){switch(e){case"stroke":if("none"!==n){if(n.startsWith("url(")){const e=du(n);i.strokeStyle.fill=t.defs[e]}else i.strokeStyle.color=An.shared.setValue(n).toNumber();i.useStroke=!0}break;case"stroke-width":i.strokeStyle.width=Number(n);break;case"fill":if("none"!==n){if(n.startsWith("url(")){const e=du(n);i.fillStyle.fill=t.defs[e]}else i.fillStyle.color=An.shared.setValue(n).toNumber();i.useFill=!0}break;case"fill-opacity":i.fillStyle.alpha=Number(n);break;case"stroke-opacity":i.strokeStyle.alpha=Number(n);break;case"opacity":i.fillStyle.alpha=Number(n),i.strokeStyle.alpha=Number(n)}}function gu(t,i){if("string"==typeof t){const i=document.createElement("div");i.innerHTML=t.trim(),t=i.querySelector("svg")}const e={context:i,defs:{},path:new au};!function(t,i){const e=t.querySelectorAll("defs");for(let n=0;n<e.length;n++){const t=e[n];for(let e=0;e<t.children.length;e++){const n=t.children[e];switch(n.nodeName.toLowerCase()){case"lineargradient":i.defs[n.id]=lu(n);break;case"radialgradient":i.defs[n.id]=fu()}}}}(t,e);const n=t.children,{fillStyle:s,strokeStyle:r}=vu(t,e);for(let o=0;o<n.length;o++){const t=n[o];"defs"!==t.nodeName.toLowerCase()&&bu(t,e,s,r)}return i}function bu(t,i,e,n){const s=t.children,{fillStyle:r,strokeStyle:o}=vu(t,i);r&&e?e={...e,...r}:r&&(e=r),o&&n?n={...n,...o}:o&&(n=o);const h=!e&&!n;let a,u,c,l,f,d,p,v,m,g,b,y,x,w,M,A,T;switch(h&&(e={color:0}),t.nodeName.toLowerCase()){case"path":w=t.getAttribute("d"),"evenodd"===t.getAttribute("fill-rule")&&_n(),M=new au(w,!0),i.context.path(M),e&&i.context.fill(e),n&&i.context.stroke(n);break;case"circle":p=cu(t,"cx",0),v=cu(t,"cy",0),m=cu(t,"r",0),i.context.ellipse(p,v,m,m),e&&i.context.fill(e),n&&i.context.stroke(n);break;case"rect":a=cu(t,"x",0),u=cu(t,"y",0),A=cu(t,"width",0),T=cu(t,"height",0),g=cu(t,"rx",0),b=cu(t,"ry",0),g||b?i.context.roundRect(a,u,A,T,g||b):i.context.rect(a,u,A,T),e&&i.context.fill(e),n&&i.context.stroke(n);break;case"ellipse":p=cu(t,"cx",0),v=cu(t,"cy",0),g=cu(t,"rx",0),b=cu(t,"ry",0),i.context.beginPath(),i.context.ellipse(p,v,g,b),e&&i.context.fill(e),n&&i.context.stroke(n);break;case"line":c=cu(t,"x1",0),l=cu(t,"y1",0),f=cu(t,"x2",0),d=cu(t,"y2",0),i.context.beginPath(),i.context.moveTo(c,l),i.context.lineTo(f,d),n&&i.context.stroke(n);break;case"polygon":x=t.getAttribute("points"),y=x.match(/\d+/g).map(t=>parseInt(t,10)),i.context.poly(y,!0),e&&i.context.fill(e),n&&i.context.stroke(n);break;case"polyline":x=t.getAttribute("points"),y=x.match(/\d+/g).map(t=>parseInt(t,10)),i.context.poly(y,!1),n&&i.context.stroke(n);break;case"g":case"svg":break;default:_n(t.nodeName)}h&&(e=null);for(let _=0;_<s.length;_++)bu(s[_],i,e,n)}function yu(t){return t instanceof nh}function xu(t){return t instanceof Jo}function wu(t,i,e){return t.fill=i,t.color=16777215,t.texture=i.texture,t.matrix=i.transform,{...e,...t}}function Mu(t,i,e){return i.buildGradient(),t.fill=i,t.color=16777215,t.texture=i.texture,t.matrix=i.transform,t.textureSpace=i.textureSpace,{...e,...t}}function Au(t,i){if(null==t)return null;const e={},n=t;return function(t){return An.isColorLike(t)}(t)?function(t,i,e){const n=An.shared.setValue(i??0);return t.color=n.toNumber(),t.alpha=1===n.alpha?e.alpha:n.alpha,t.texture=Ve.WHITE,{...e,...t}}(e,t,i):function(t){return t instanceof Ve}(t)?function(t,i,e){return t.texture=i,{...e,...t}}(e,t,i):yu(t)?wu(e,t,i):xu(t)?Mu(e,t,i):n.fill&&yu(n.fill)?wu(n,n.fill,i):n.fill&&xu(n.fill)?Mu(n,n.fill,i):function(t,i){const e={...i,...t},n=An.shared.setValue(e.color);return e.alpha*=n.alpha,e.color=n.toNumber(),e}(n,i)}function Tu(t,i){const{width:e,alignment:n,miterLimit:s,cap:r,join:o,pixelLine:h,...a}=i,u=Au(t,a);return u?{width:e,alignment:n,miterLimit:s,cap:r,join:o,pixelLine:h,...u}:null}const _u=new de,ku=new ve,Cu=class t extends ue{constructor(){super(...arguments),this.uid=Pe("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this.co=new au,this.lo=new ve,this.fo={...t.defaultFillStyle},this.do={...t.defaultStrokeStyle},this.po=[],this.Le=0,this._e=new qe,this.ke=!0}clone(){const i=new t;return i.batchMode=this.batchMode,i.instructions=this.instructions.slice(),i.co=this.co.clone(),i.lo=this.lo.clone(),i.fo={...this.fo},i.do={...this.do},i.po=this.po.slice(),i._e=this._e.clone(),i.ke=!0,i}get fillStyle(){return this.fo}set fillStyle(i){this.fo=Au(i,t.defaultFillStyle)}get strokeStyle(){return this.do}set strokeStyle(i){this.do=Tu(i,t.defaultStrokeStyle)}setFillStyle(i){return this.fo=Au(i,t.defaultFillStyle),this}setStrokeStyle(i){return this.do=Au(i,t.defaultStrokeStyle),this}texture(t,i,e,n,s,r){return this.instructions.push({action:"texture",data:{image:t,dx:e||0,dy:n||0,dw:s||t.frame.width,dh:r||t.frame.height,transform:this.lo.clone(),alpha:this.fo.alpha,style:i?An.shared.setValue(i).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this.co=new au,this}fill(i,e){let n;const s=this.instructions[this.instructions.length-1];return n=0===this.Le&&s&&"stroke"===s.action?s.data.path:this.co.clone(),n?(null!=i&&(void 0!==e&&"number"==typeof i&&(Re(0,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),i={color:i,alpha:e}),this.fo=Au(i,t.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:n}}),this.onUpdate(),this.vo(),this.Le=0,this):this}vo(){const{x:t,y:i}=this.co.getLastPoint(de.shared);this.co.clear(),this.co.moveTo(t,i)}stroke(i){let e;const n=this.instructions[this.instructions.length-1];return e=0===this.Le&&n&&"fill"===n.action?n.data.path:this.co.clone(),e?(null!=i&&(this.do=Tu(i,t.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this.vo(),this.Le=0,this):this}cut(){for(let t=0;t<2;t++){const i=this.instructions[this.instructions.length-1-t],e=this.co.clone();if(i&&("stroke"===i.action||"fill"===i.action)){if(!i.data.hole){i.data.hole=e;break}i.data.hole.addPath(e)}}return this.vo(),this}arc(t,i,e,n,s,r){this.Le++;const o=this.lo;return this.co.arc(o.a*t+o.c*i+o.tx,o.b*t+o.d*i+o.ty,e,n,s,r),this}arcTo(t,i,e,n,s){this.Le++;const r=this.lo;return this.co.arcTo(r.a*t+r.c*i+r.tx,r.b*t+r.d*i+r.ty,r.a*e+r.c*n+r.tx,r.b*e+r.d*n+r.ty,s),this}arcToSvg(t,i,e,n,s,r,o){this.Le++;const h=this.lo;return this.co.arcToSvg(t,i,e,n,s,h.a*r+h.c*o+h.tx,h.b*r+h.d*o+h.ty),this}bezierCurveTo(t,i,e,n,s,r,o){this.Le++;const h=this.lo;return this.co.bezierCurveTo(h.a*t+h.c*i+h.tx,h.b*t+h.d*i+h.ty,h.a*e+h.c*n+h.tx,h.b*e+h.d*n+h.ty,h.a*s+h.c*r+h.tx,h.b*s+h.d*r+h.ty,o),this}closePath(){var t;return this.Le++,null==(t=this.co)||t.closePath(),this}ellipse(t,i,e,n){return this.Le++,this.co.ellipse(t,i,e,n,this.lo.clone()),this}circle(t,i,e){return this.Le++,this.co.circle(t,i,e,this.lo.clone()),this}path(t){return this.Le++,this.co.addPath(t,this.lo.clone()),this}lineTo(t,i){this.Le++;const e=this.lo;return this.co.lineTo(e.a*t+e.c*i+e.tx,e.b*t+e.d*i+e.ty),this}moveTo(t,i){this.Le++;const e=this.lo,n=this.co.instructions,s=e.a*t+e.c*i+e.tx,r=e.b*t+e.d*i+e.ty;return 1===n.length&&"moveTo"===n[0].action?(n[0].data[0]=s,n[0].data[1]=r,this):(this.co.moveTo(s,r),this)}quadraticCurveTo(t,i,e,n,s){this.Le++;const r=this.lo;return this.co.quadraticCurveTo(r.a*t+r.c*i+r.tx,r.b*t+r.d*i+r.ty,r.a*e+r.c*n+r.tx,r.b*e+r.d*n+r.ty,s),this}rect(t,i,e,n){return this.Le++,this.co.rect(t,i,e,n,this.lo.clone()),this}roundRect(t,i,e,n,s){return this.Le++,this.co.roundRect(t,i,e,n,s,this.lo.clone()),this}poly(t,i){return this.Le++,this.co.poly(t,i,this.lo.clone()),this}regularPoly(t,i,e,n,s=0,r){return this.Le++,this.co.regularPoly(t,i,e,n,s,r),this}roundPoly(t,i,e,n,s,r){return this.Le++,this.co.roundPoly(t,i,e,n,s,r),this}roundShape(t,i,e,n){return this.Le++,this.co.roundShape(t,i,e,n),this}filletRect(t,i,e,n,s){return this.Le++,this.co.filletRect(t,i,e,n,s),this}chamferRect(t,i,e,n,s,r){return this.Le++,this.co.chamferRect(t,i,e,n,s,r),this}star(t,i,e,n,s=0,r=0){return this.Le++,this.co.star(t,i,e,n,s,r,this.lo.clone()),this}svg(t){return this.Le++,gu(t,this),this}restore(){const t=this.po.pop();return t&&(this.lo=t.transform,this.fo=t.fillStyle,this.do=t.strokeStyle),this}save(){return this.po.push({transform:this.lo.clone(),fillStyle:{...this.fo},strokeStyle:{...this.do}}),this}getTransform(){return this.lo}resetTransform(){return this.lo.identity(),this}rotate(t){return this.lo.rotate(t),this}scale(t,i=t){return this.lo.scale(t,i),this}setTransform(t,i,e,n,s,r){return t instanceof ve?(this.lo.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this.lo.set(t,i,e,n,s,r),this)}transform(t,i,e,n,s,r){return t instanceof ve?(this.lo.append(t),this):(ku.set(t,i,e,n,s,r),this.lo.append(ku),this)}translate(t,i=t){return this.lo.translate(t,i),this}clear(){return this.co.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this.ke=!0)}get bounds(){if(!this.ke)return this._e;const t=this._e;t.clear();for(let i=0;i<this.instructions.length;i++){const e=this.instructions[i],n=e.action;if("fill"===n){const i=e.data;t.addBounds(i.path.bounds)}else if("texture"===n){const i=e.data;t.addFrame(i.dx,i.dy,i.dx+i.dw,i.dy+i.dh,i.transform)}if("stroke"===n){const i=e.data,n=i.style.alignment,s=i.style.width*(1-n),r=i.path.bounds;t.addFrame(r.minX-s,r.minY-s,r.maxX+s,r.maxY+s)}}return t}containsPoint(t){var i;if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let n=!1;for(let s=0;s<e.length;s++){const r=e[s],o=r.data,h=o.path;if(!r.action||!h)continue;const a=o.style,u=h.shapePath.shapePrimitives;for(let e=0;e<u.length;e++){const s=u[e].shape;if(!a||!s)continue;const h=u[e].transform,c=h?h.applyInverse(t,_u):t;if("fill"===r.action)n=s.contains(c.x,c.y);else{const t=a;n=s.strokeContains(c.x,c.y,t.width,t.alignment)}const l=o.hole;if(l){const t=null==(i=l.shapePath)?void 0:i.shapePrimitives;if(t)for(let i=0;i<t.length;i++)t[i].shape.contains(c.x,c.y)&&(n=!1)}if(n)return!0}}return n}destroy(t=!1){this.po.length=0,this.lo=null,this.emit("destroy",this),this.removeAllListeners();if("boolean"==typeof t?t:null==t?void 0:t.texture){const i="boolean"==typeof t?t:null==t?void 0:t.textureSource;this.fo.texture&&(this.fo.fill&&"uid"in this.fo.fill?this.fo.fill.destroy():this.fo.texture.destroy(i)),this.do.texture&&(this.do.fill&&"uid"in this.do.fill?this.do.fill.destroy():this.do.texture.destroy(i))}this.fo=null,this.do=null,this.instructions=null,this.co=null,this._e=null,this.po=null,this.customShader=null,this.lo=null}};Cu.defaultFillStyle={color:16777215,alpha:1,texture:Ve.WHITE,matrix:null,fill:null,textureSpace:"local"},Cu.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:Ve.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let Su=Cu;const Pu=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function Eu(t){const i=[];let e=0;for(let n=0;n<Pu.length;n++){const s=`_${Pu[n]}`;i[e++]=t[s]}return e=Ru(t.mo,i,e),e=function(t,i,e){return t?(e=Ru(t,i,e),i[e++]=t.width,i[e++]=t.alignment,i[e++]=t.cap,i[e++]=t.join,i[e++]=t.miterLimit,e):e}(t.yr,i,e),e=function(t,i,e){return t?(i[e++]=t.alpha,i[e++]=t.angle,i[e++]=t.blur,i[e++]=t.distance,i[e++]=An.shared.setValue(t.color).toNumber(),e):e}(t.dropShadow,i,e),e=function(t,i,e){if(!t)return e;for(const n of t)i[e++]=n.uid;return e}(t.filters,i,e),i.join("-")}function Ru(t,i,e){var n;return t?(i[e++]=t.color,i[e++]=t.alpha,i[e++]=null==(n=t.fill)?void 0:n.styleKey,e):e}const Fu=class t extends ue{constructor(i={}){super(),function(t){const i=t;if("boolean"==typeof i.dropShadow&&i.dropShadow){const e=Ou.defaultDropShadow;t.dropShadow={alpha:i.dropShadowAlpha??e.alpha,angle:i.dropShadowAngle??e.angle,blur:i.dropShadowBlur??e.blur,color:i.dropShadowColor??e.color,distance:i.dropShadowDistance??e.distance}}if(void 0!==i.strokeThickness){Re(0,"strokeThickness is now a part of stroke");const e=i.stroke;let n={};if(An.isColorLike(e))n.color=e;else if(e instanceof Jo||e instanceof nh)n.fill=e;else{if(!Object.hasOwnProperty.call(e,"color")&&!Object.hasOwnProperty.call(e,"fill"))throw new Error("Invalid stroke value.");n=e}t.stroke={...n,width:i.strokeThickness}}if(Array.isArray(i.fillGradientStops)){if(Re(0,"gradient fill is now a fill pattern: `new FillGradient(...)`"),!Array.isArray(i.fill)||0===i.fill.length)throw new Error("Invalid fill value. Expected an array of colors for gradient fill.");i.fill.length!==i.fillGradientStops.length&&_n();const e=new Jo({start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"}),n=i.fillGradientStops.slice(),s=i.fill.map(t=>An.shared.setValue(t).toNumber());n.forEach((t,i)=>{e.addColorStop(t,s[i])}),t.fill={fill:e}}}(i);const e={...t.defaultTextStyle,...i};for(const t in e){this[t]=e[t]}this.update()}get align(){return this.bo}set align(t){this.bo=t,this.update()}get breakWords(){return this.yo}set breakWords(t){this.yo=t,this.update()}get dropShadow(){return this.xo}set dropShadow(i){this.xo=null!==i&&"object"==typeof i?this.wo({...t.defaultDropShadow,...i}):i?this.wo({...t.defaultDropShadow}):null,this.update()}get fontFamily(){return this.Mo}set fontFamily(t){this.Mo=t,this.update()}get fontSize(){return this.Ao}set fontSize(t){this.Ao="string"==typeof t?parseInt(t,10):t,this.update()}get fontStyle(){return this.To}set fontStyle(t){this.To=t.toLowerCase(),this.update()}get fontVariant(){return this._o}set fontVariant(t){this._o=t,this.update()}get fontWeight(){return this.ko}set fontWeight(t){this.ko=t,this.update()}get leading(){return this.Co}set leading(t){this.Co=t,this.update()}get letterSpacing(){return this.So}set letterSpacing(t){this.So=t,this.update()}get lineHeight(){return this.Po}set lineHeight(t){this.Po=t,this.update()}get padding(){return this.Eo}set padding(t){this.Eo=t,this.update()}get filters(){return this.Ro}set filters(t){this.Ro=t,this.update()}get trim(){return this.Fo}set trim(t){this.Fo=t,this.update()}get textBaseline(){return this.Oo}set textBaseline(t){this.Oo=t,this.update()}get whiteSpace(){return this.$o}set whiteSpace(t){this.$o=t,this.update()}get wordWrap(){return this.gr}set wordWrap(t){this.gr=t,this.update()}get wordWrapWidth(){return this.Uo}set wordWrapWidth(t){this.Uo=t,this.update()}get fill(){return this.Bo}set fill(t){t!==this.Bo&&(this.Bo=t,this.Io(t)&&(this.Bo=this.wo({...Su.defaultFillStyle,...t},()=>{this.mo=Au({...this.Bo},Su.defaultFillStyle)})),this.mo=Au(0===t?"black":t,Su.defaultFillStyle),this.update())}get stroke(){return this.jo}set stroke(t){t!==this.jo&&(this.jo=t,this.Io(t)&&(this.jo=this.wo({...Su.defaultStrokeStyle,...t},()=>{this.yr=Tu({...this.jo},Su.defaultStrokeStyle)})),this.yr=Tu(t,Su.defaultStrokeStyle),this.update())}Go(){return this.$r=Eu(this),this.$r}update(){this.$r=null,this.emit("update",this)}reset(){const i=t.defaultTextStyle;for(const t in i)this[t]=i[t]}get styleKey(){return this.$r||this.Go()}clone(){return new t({align:this.align,breakWords:this.breakWords,dropShadow:this.xo?{...this.xo}:null,fill:this.mo,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this.yr,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this.Ro?[...this.Ro]:void 0})}zo(){let t=0;if(this.Ro)for(let i=0;i<this.Ro.length;i++)t+=this.Ro[i].padding;return Math.max(this.Eo,t)}destroy(t=!1){var i,e,n,s;this.removeAllListeners();if("boolean"==typeof t?t:null==t?void 0:t.texture){const r="boolean"==typeof t?t:null==t?void 0:t.textureSource;(null==(i=this.mo)?void 0:i.texture)&&this.mo.texture.destroy(r),(null==(e=this.Bo)?void 0:e.texture)&&this.Bo.texture.destroy(r),(null==(n=this.yr)?void 0:n.texture)&&this.yr.texture.destroy(r),(null==(s=this.jo)?void 0:s.texture)&&this.jo.texture.destroy(r)}this.mo=null,this.yr=null,this.dropShadow=null,this.jo=null,this.Bo=null}wo(t,i){return new Proxy(t,{set:(t,e,n)=>(t[e]=n,null==i||i(e,n),this.update(),!0)})}Io(t){return null!==(t??null)&&!(An.isColorLike(t)||t instanceof Jo||t instanceof nh)}};Fu.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5},Fu.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Ou=Fu;const $u=new class{constructor(t){this.Do=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}Lo(t,i){const e=Ms.get().createCanvas();e.width=t,e.height=i;const n=e.getContext("2d");return{canvas:e,context:n}}getOptimalCanvasAndContext(t,i,e=1){t=Math.ceil(t*e-1e-6),i=Math.ceil(i*e-1e-6);const n=((t=Oe(t))<<17)+((i=Oe(i))<<1);this.Do[n]||(this.Do[n]=[]);let s=this.Do[n].pop();return s||(s=this.Lo(t,i)),s}returnCanvasAndContext(t){const i=t.canvas,{width:e,height:n}=i,s=(e<<17)+(n<<1);t.context.resetTransform(),t.context.clearRect(0,0,e,n),this.Do[s].push(t)}clear(){this.Do={}}},Uu=1e5;function Bu(t,i,e,n=0){if(t.texture===Ve.WHITE&&!t.fill)return An.shared.setValue(t.color).setAlpha(t.alpha??1).toHexa();if(!t.fill){const e=i.createPattern(t.texture.source.resource,"repeat"),n=t.matrix.copyTo(ve.shared);return n.scale(t.texture.frame.width,t.texture.frame.height),e.setTransform(n),e}if(t.fill instanceof nh){const e=t.fill,n=i.createPattern(e.texture.source.resource,"repeat"),s=e.transform.copyTo(ve.shared);return s.scale(e.texture.frame.width,e.texture.frame.height),n.setTransform(s),n}if(t.fill instanceof Jo){const s=t.fill,r="linear"===s.type,o="local"===s.textureSpace;let h,a=1,u=1;o&&e&&(a=e.width+n,u=e.height+n);let c=!1;if(r){const{start:t,end:e}=s;h=i.createLinearGradient(t.x*a,t.y*u,e.x*a,e.y*u),c=Math.abs(e.x-t.x)<Math.abs(.1*(e.y-t.y))}else{const{center:t,innerRadius:e,outerCenter:n,outerRadius:r}=s;h=i.createRadialGradient(t.x*a,t.y*u,e*a,n.x*a,n.y*u,r*a)}if(c&&o&&e){const t=e.lineHeight/u;for(let i=0;i<e.lines.length;i++){const r=(i*e.lineHeight+n/2)/u;s.colorStops.forEach(i=>{const e=r+i.offset*t;h.addColorStop(Math.floor(e*Uu)/Uu,An.shared.setValue(i.color).toHex())})}}else s.colorStops.forEach(t=>{h.addColorStop(t.offset,An.shared.setValue(t.color).toHex())});return h}return _n(),"red"}const Iu=class t extends Wo{constructor(i){super(),this.resolution=1,this.pages=[],this.Eo=0,this.No=Object.create(null),this.Vo=[],this.Wo=0,this.Ho=0,this.qo=0,this.Xo=-1,this.Yo=!1;const e={...t.defaultOptions,...i};this.Fr=e.textureSize,this.Ko=e.mipmap;const n=e.style.clone();e.overrideFill&&(n.mo.color=16777215,n.mo.alpha=1,n.mo.texture=Ve.WHITE,n.mo.fill=null),this.applyFillAsTint=e.overrideFill;const s=n.fontSize;n.fontSize=this.baseMeasurementFontSize;const r=qo(n);e.overrideSize?n.yr&&(n.yr.width*=this.baseRenderedFontSize/s):n.fontSize=this.baseRenderedFontSize=s,this.ai=n,this.Yo=e.skipKerning??!1,this.resolution=e.resolution??1,this.Eo=e.padding??4,e.textureStyle&&(this.Qo=e.textureStyle instanceof je?e.textureStyle:new je(e.textureStyle)),this.fontMetrics=Ko.measureFont(r),this.lineHeight=n.lineHeight||this.fontMetrics.fontSize||n.fontSize}ensureCharacters(t){var i,e;const n=Ko.graphemeSegmenter(t).filter(t=>!this.Vo.includes(t)).filter((t,i,e)=>e.indexOf(t)===i);if(!n.length)return;let s;this.Vo=[...this.Vo,...n],s=-1===this.Xo?this.Zo():this.pages[this.Xo];let{canvas:r,context:o}=s.canvasAndContext,h=s.texture.source;const a=this.ai;let u=this.Wo,c=this.Ho,l=this.qo;const f=this.baseRenderedFontSize/this.baseMeasurementFontSize,d=this.Eo*f;let p=!1;const v=r.width/this.resolution,m=r.height/this.resolution;for(let g=0;g<n.length;g++){const t=n[g],s=Ko.measureText(t,a,r,!1);s.lineHeight=s.height;const b=s.width*f,y=Math.ceil(("italic"===a.fontStyle?2:1)*b)+2*d,x=s.height*f+2*d;if(p=!1,"\n"!==t&&"\r"!==t&&"\t"!==t&&" "!==t&&(p=!0,l=Math.ceil(Math.max(x,l))),u+y>v&&(c+=l,l=x,u=0,c+l>m)){h.update();const t=this.Zo();r=t.canvasAndContext.canvas,o=t.canvasAndContext.context,h=t.texture.source,u=0,c=0,l=0}const w=b/f-((null==(i=a.dropShadow)?void 0:i.distance)??0)-((null==(e=a.yr)?void 0:e.width)??0);if(this.chars[t]={id:t.codePointAt(0),xOffset:-this.Eo,yOffset:-this.Eo,xAdvance:w,kerning:{}},p){this.Jo(o,s,u+d,c+d,f,a);const i=h.width*f,e=h.height*f,n=new Ce(u/i*h.width,c/e*h.height,y/i*h.width,x/e*h.height);this.chars[t].texture=new Ve({source:h,frame:n}),u+=Math.ceil(y)}}h.update(),this.Wo=u,this.Ho=c,this.qo=l,this.Yo&&this.ih(n,o)}get pageTextures(){return Re(0,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}ih(t,i){const e=this.No;for(let n=0;n<t.length;n++){const s=t[n];for(let t=0;t<this.Vo.length;t++){const n=this.Vo[t];let r=e[s];r||(r=e[s]=i.measureText(s).width);let o=e[n];o||(o=e[n]=i.measureText(n).width);let h=i.measureText(s+n).width,a=h-(r+o);a&&(this.chars[s].kerning[n]=a),h=i.measureText(s+n).width,a=h-(r+o),a&&(this.chars[n].kerning[s]=a)}}}Zo(){this.Xo++;const t=this.resolution,i=$u.getOptimalCanvasAndContext(this.Fr,this.Fr,t);this.eh(i.context,this.ai,t);const e=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),n=new Ve({source:new Ts({resource:i.canvas,resolution:e,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this.Ko})});this.Qo&&(n.source.style=this.Qo);const s={canvasAndContext:i,texture:n};return this.pages[this.Xo]=s,s}eh(t,i,e){i.fontSize=this.baseRenderedFontSize,t.scale(e,e),t.font=qo(i),i.fontSize=this.baseMeasurementFontSize,t.textBaseline=i.textBaseline;const n=i.yr,s=(null==n?void 0:n.width)??0;if(n&&(t.lineWidth=s,t.lineJoin=n.join,t.miterLimit=n.miterLimit,t.strokeStyle=Bu(n,t)),i.mo&&(t.fillStyle=Bu(i.mo,t)),i.dropShadow){const n=i.dropShadow,s=An.shared.setValue(n.color).toArray(),r=n.blur*e,o=n.distance*e;t.shadowColor=`rgba(${255*s[0]},${255*s[1]},${255*s[2]},${n.alpha})`,t.shadowBlur=r,t.shadowOffsetX=Math.cos(n.angle)*o,t.shadowOffsetY=Math.sin(n.angle)*o}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}Jo(t,i,e,n,s,r){const o=i.text,h=i.fontProperties,a=r.yr,u=((null==a?void 0:a.width)??0)*s,c=e+u/2,l=n-u/2,f=h.descent*s,d=i.lineHeight*s;let p=!1;r.stroke&&u&&(p=!0,t.strokeText(o,c,l+d-f));const{shadowBlur:v,shadowOffsetX:m,shadowOffsetY:g}=t;r.mo&&(p&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillText(o,c,l+d-f)),p&&(t.shadowBlur=v,t.shadowOffsetX=m,t.shadowOffsetY=g)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:i,texture:e}=this.pages[t];$u.returnCanvasAndContext(i),e.destroy(!0)}this.pages=null}};Iu.defaultOptions={textureSize:512,style:new Ou,mipmap:!0};let ju=Iu;function Gu(t,i,e,n){const s={width:0,height:0,offsetY:0,scale:i.fontSize/e.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};s.offsetY=e.baseLineOffset;let r=s.lines[0],o=null,h=!0;const a={width:0,start:0,index:0,positions:[],chars:[]},u=e.baseMeasurementFontSize/i.fontSize,c=i.letterSpacing*u,l=i.wordWrapWidth*u,f=i.lineHeight?i.lineHeight*u:e.lineHeight,d=i.wordWrap&&i.breakWords,p=t=>{const i=r.width;for(let e=0;e<a.index;e++){const n=t.positions[e];r.chars.push(t.chars[e]),r.charPositions.push(n+i)}r.width+=t.width,h=!1,a.width=0,a.index=0,a.chars.length=0},v=()=>{let t=r.chars.length-1;if(n){let i=r.chars[t];for(;" "===i;)r.width-=e.chars[i].xAdvance,i=r.chars[--t]}s.width=Math.max(s.width,r.width),r={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},h=!0,s.lines.push(r),s.height+=f},m=t=>t-c>l;for(let g=0;g<t.length+1;g++){let n;const s=g===t.length;s||(n=t[g]);const u=e.chars[n]||e.chars[" "];if(/(?:\s)/.test(n)||"\r"===n||"\n"===n||s){if(!h&&i.wordWrap&&m(r.width+a.width)?(v(),p(a),s||r.charPositions.push(0)):(a.start=r.width,p(a),s||r.charPositions.push(0)),"\r"===n||"\n"===n)0!==r.width&&v();else if(!s){const t=u.xAdvance+(u.kerning[o]||0)+c;r.width+=t,r.spaceWidth=t,r.spacesIndex.push(r.charPositions.length),r.chars.push(n)}}else{const t=u.kerning[o]||0,i=u.xAdvance+t+c;d&&m(r.width+a.width+i)&&(p(a),v()),a.positions[a.index++]=a.width+t,a.chars.push(n),a.width+=i}o=n}return v(),"center"===i.align?function(t){for(let i=0;i<t.lines.length;i++){const e=t.lines[i],n=t.width/2-e.width/2;for(let t=0;t<e.charPositions.length;t++)e.charPositions[t]+=n}}(s):"right"===i.align?function(t){for(let i=0;i<t.lines.length;i++){const e=t.lines[i],n=t.width-e.width;for(let t=0;t<e.charPositions.length;t++)e.charPositions[t]+=n}}(s):"justify"===i.align&&function(t){const i=t.width;for(let e=0;e<t.lines.length;e++){const n=t.lines[e];let s=0,r=n.spacesIndex[s++],o=0;const h=n.spacesIndex.length,a=(i-n.width)/h;for(let t=0;t<n.charPositions.length;t++)t===r&&(r=n.spacesIndex[s++],o+=a),n.charPositions[t]+=o}}(s),s}let zu=0;const Du=new class{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null}}getFont(t,i){var e;let n=`${i.fontFamily}-bitmap`,s=!0;if(i.mo.fill&&!i.yr)n+=i.mo.fill.styleKey,s=!1;else if(i.yr||i.dropShadow){let t=i.styleKey;t=t.substring(0,t.lastIndexOf("-")),n=`${t}-bitmap`,s=!1}if(!Os.has(n)){const t=Object.create(i);t.lineHeight=0;const e=new ju({style:t,overrideFill:s,overrideSize:!0,...this.defaultOptions});zu++,zu>50&&_n(),e.once("destroy",()=>{zu--,Os.remove(n)}),Os.set(n,e)}const r=Os.get(n);return null==(e=r.ensureCharacters)||e.call(r,t),r}getLayout(t,i,e=!0){const n=this.getFont(t,i);return Gu(Ko.graphemeSegmenter(t),i,n,e)}measureText(t,i,e=!0){return this.getLayout(t,i,e)}install(...t){var i,e,n,s;let r=t[0];"string"==typeof r&&(r={name:r,style:t[1],chars:null==(i=t[2])?void 0:i.chars,resolution:null==(e=t[2])?void 0:e.resolution,padding:null==(n=t[2])?void 0:n.padding,skipKerning:null==(s=t[2])?void 0:s.skipKerning},Re(0,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const o=null==r?void 0:r.name;if(!o)throw new Error("[BitmapFontManager] Property `name` is required.");r={...this.defaultOptions,...r};const h=r.style,a=h instanceof Ou?h:new Ou(h),u=r.dynamicFill??this.nh(a),c=new ju({style:a,overrideFill:u,skipKerning:r.skipKerning,padding:r.padding,resolution:r.resolution,overrideSize:!1,textureStyle:r.textureStyle}),l=function(t){if(""===t)return[];"string"==typeof t&&(t=[t]);const i=[];for(let e=0,n=t.length;e<n;e++){const n=t[e];if(Array.isArray(n)){if(2!==n.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);if(0===n[0].length||0===n[1].length)throw new Error("[BitmapFont]: Invalid character delimiter.");const t=n[0].charCodeAt(0),e=n[1].charCodeAt(0);if(e<t)throw new Error("[BitmapFont]: Invalid character range.");for(let n=t,s=e;n<=s;n++)i.push(String.fromCharCode(n))}else i.push(...Array.from(n))}if(0===i.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return i}(r.chars);return c.ensureCharacters(l.join("")),Os.set(`${o}-bitmap`,c),c.once("destroy",()=>Os.remove(`${o}-bitmap`)),c}uninstall(t){const i=`${t}-bitmap`,e=Os.get(i);e&&e.destroy()}nh(t){return!(t.yr||t.dropShadow&&0!==t.dropShadow.color||t.mo.fill||16777215!==t.mo.color)}};class Lu{constructor(t){this.sh=[],this.Yn=t,this.Yn.runners.postrender.add(this),this.Yn.runners.init.add(this),this.Kn=document.createElement("div"),this.Kn.style.position="absolute",this.Kn.style.top="0",this.Kn.style.left="0",this.Kn.style.pointerEvents="none",this.Kn.style.zIndex="1000"}init(){this.bs=new Ks({domElement:this.Kn,renderer:this.Yn})}addRenderable(t,i){this.sh.includes(t)||this.sh.push(t)}updateRenderable(t){}validateRenderable(t){return!0}postrender(){const t=this.sh;if(0!==t.length){this.bs.ensureAttached();for(let i=0;i<t.length;i++){const e=t[i],n=e.element;if(!e.parent||e.globalDisplayStatus<7)null==n||n.remove(),t.splice(i,1),i--;else{this.Kn.contains(n)||(n.style.position="absolute",n.style.pointerEvents="auto",this.Kn.appendChild(n));const t=e.worldTransform,i=e.Se,s=e.width*i.x,r=e.height*i.y;n.style.transformOrigin=`${s}px ${r}px`,n.style.transform=`matrix(${t.a}, ${t.b}, ${t.c}, ${t.d}, ${t.tx-s}, ${t.ty-r})`,n.style.opacity=e.groupAlpha.toString()}}}else this.Kn.remove()}destroy(){var t;this.Yn.runners.postrender.remove(this);for(let i=0;i<this.sh.length;i++){null==(t=this.sh[i].element)||t.remove()}this.sh.length=0,this.Kn.remove(),this.bs.destroy(),this.Yn=null}}Lu.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"dom"};const Nu=new class{constructor(){this.interactionFrequency=10,this.rh=0,this.oh=!1,this.hh=!1,this.ah=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this.rh=0,this.oh=!1,this.hh=!1,this.ah=!0}get pauseUpdate(){return this.ah}set pauseUpdate(t){this.ah=t}addTickerListener(){!this.hh&&this.domElement&&(Ps.system.add(this.uh,this,_s.INTERACTION),this.hh=!0)}removeTickerListener(){this.hh&&(Ps.system.remove(this.uh,this),this.hh=!1)}pointerMoved(){this.oh=!0}fh(){if(!this.domElement||this.ah)return;if(this.oh)return void(this.oh=!1);const t=this.events.ph;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(this.events.supportsPointerEvents?new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,pointerId:t.pointerId}):new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY}))}uh(t){this.rh+=t.deltaTime,this.rh<this.interactionFrequency||(this.rh=0,this.fh())}};class Vu extends Qs{constructor(){super(...arguments),this.client=new de,this.movement=new de,this.offset=new de,this.global=new de,this.screen=new de}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,i,e){return t.worldTransform.applyInverse(e||this.global,i)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,i,e,n,s,r,o,h,a,u,c,l,f,d,p){throw new Error("Method not implemented.")}}class Wu extends Vu{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Hu extends Vu{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Hu.DOM_DELTA_PIXEL=0,Hu.DOM_DELTA_LINE=1,Hu.DOM_DELTA_PAGE=2;const qu=new de,Xu=new de;class Yu{constructor(t){this.dispatch=new ue,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this.mh=[],this.gh=[],this.bh=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,i){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:i,priority:0}),this.mappingTable[t].sort((t,i)=>t.priority-i.priority)}dispatchEvent(t,i){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,i),this.dispatch.emit(i||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const i=this.mappingTable[t.type];if(i)for(let e=0,n=i.length;e<n;e++)i[e].fn(t);else _n(t.type)}hitTest(t,i){Nu.pauseUpdate=!0;const e=this[this.bh&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,qu.set(t,i),this.hitTestFn,this.hitPruneFn);return e&&e[0]}propagate(t,i){if(!t.target)return;const e=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,s=e.length-1;n<s;n++)if(t.currentTarget=e[n],this.notifyTarget(t,i),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,i),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let n=e.length-2;n>=0;n--)if(t.currentTarget=e[n],this.notifyTarget(t,i),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,i,e=this.mh){if(0===e.length)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(i)?i:[i];for(let s=e.length-1;s>=0;s--)n.forEach(i=>{t.currentTarget=e[s],this.notifyTarget(t,i)})}propagationPath(t){const i=[t];for(let e=0;e<2048&&t!==this.rootTarget&&t.parent;e++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");i.push(t.parent),t=t.parent}return i.reverse(),i}hitTestMoveRecursive(t,i,e,n,s,r=!1){let o=!1;if(this.yh(t))return null;if("dynamic"!==t.eventMode&&"dynamic"!==i||(Nu.pauseUpdate=!1),t.interactiveChildren&&t.children){const h=t.children;for(let a=h.length-1;a>=0;a--){const u=h[a],c=this.hitTestMoveRecursive(u,this.xh(i)?i:u.eventMode,e,n,s,r||s(t,e));if(c){if(c.length>0&&!c[c.length-1].parent)continue;const i=t.isInteractive();(c.length>0||i)&&(i&&this.mh.push(t),c.push(t)),0===this.gh.length&&(this.gh=c),o=!0}}}const h=this.xh(i),a=t.isInteractive();return a&&a&&this.mh.push(t),r||this.gh.length>0?null:o?this.gh:h&&!s(t,e)&&n(t,e)?a?[t]:[]:null}hitTestRecursive(t,i,e,n,s){if(this.yh(t)||s(t,e))return null;if("dynamic"!==t.eventMode&&"dynamic"!==i||(Nu.pauseUpdate=!1),t.interactiveChildren&&t.children){const r=t.children,o=e;for(let e=r.length-1;e>=0;e--){const h=r[e],a=this.hitTestRecursive(h,this.xh(i)?i:h.eventMode,o,n,s);if(a){if(a.length>0&&!a[a.length-1].parent)continue;const i=t.isInteractive();return(a.length>0||i)&&a.push(t),a}}}const r=this.xh(i),o=t.isInteractive();return r&&n(t,e)?o?[t]:[]:null}xh(t){return"static"===t||"dynamic"===t}yh(t){return!(t&&t.visible&&t.renderable&&t.measurable)||("none"===t.eventMode||"passive"===t.eventMode&&!t.interactiveChildren)}hitPruneFn(t,i){if(t.hitArea&&(t.worldTransform.applyInverse(i,Xu),!t.hitArea.contains(Xu.x,Xu.y)))return!0;if(t.effects&&t.effects.length)for(let e=0;e<t.effects.length;e++){const n=t.effects[e];if(n.containsPoint){if(!n.containsPoint(i,this.hitTestFn))return!0}}return!1}hitTestFn(t,i){return!!t.hitArea||!!(null==t?void 0:t.containsPoint)&&(t.worldTransform.applyInverse(i,Xu),t.containsPoint(Xu))}notifyTarget(t,i){var e,n;if(!t.currentTarget.isInteractive())return;i??(i=t.type);const s=`on${i}`;null==(n=(e=t.currentTarget)[s])||n.call(e,t);const r=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${i}capture`:i;this.wh(t,r),t.eventPhase===t.AT_TARGET&&this.wh(t,i)}mapPointerDown(t){if(!(t instanceof Wu))return void _n();const i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerdown"),"touch"===i.pointerType)this.dispatchEvent(i,"touchstart");else if("mouse"===i.pointerType||"pen"===i.pointerType){const t=2===i.button;this.dispatchEvent(i,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=i.composedPath(),this.freeEvent(i)}mapPointerMove(t){var i,e;if(!(t instanceof Wu))return void _n();this.mh.length=0,this.gh.length=0,this.bh=!0;const n=this.createPointerEvent(t);this.bh=!1;const s="mouse"===n.pointerType||"pen"===n.pointerType,r=this.trackingData(t.pointerId),o=this.findMountedTarget(r.overTargets);if((null==(i=r.overTargets)?void 0:i.length)>0&&o!==n.target){const i="mousemove"===t.type?"mouseout":"pointerout",e=this.createPointerEvent(t,i,o);if(this.dispatchEvent(e,"pointerout"),s&&this.dispatchEvent(e,"mouseout"),!n.composedPath().includes(o)){const i=this.createPointerEvent(t,"pointerleave",o);for(i.eventPhase=i.AT_TARGET;i.target&&!n.composedPath().includes(i.target);)i.currentTarget=i.target,this.notifyTarget(i),s&&this.notifyTarget(i,"mouseleave"),i.target=i.target.parent;this.freeEvent(i)}this.freeEvent(e)}if(o!==n.target){const i="mousemove"===t.type?"mouseover":"pointerover",e=this.clonePointerEvent(n,i);this.dispatchEvent(e,"pointerover"),s&&this.dispatchEvent(e,"mouseover");let r=null==o?void 0:o.parent;for(;r&&r!==this.rootTarget.parent&&r!==n.target;)r=r.parent;if(!r||r===this.rootTarget.parent){const t=this.clonePointerEvent(n,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==o&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),s&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(e)}const h=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?h.push("pointermove"):this.dispatchEvent(n,"pointermove"),a&&h.push("globalpointermove"),"touch"===n.pointerType&&(this.moveOnAll?h.splice(1,0,"touchmove"):this.dispatchEvent(n,"touchmove"),a&&h.push("globaltouchmove")),s&&(this.moveOnAll?h.splice(1,0,"mousemove"):this.dispatchEvent(n,"mousemove"),a&&h.push("globalmousemove"),this.cursor=null==(e=n.target)?void 0:e.cursor),h.length>0&&this.all(n,h),this.mh.length=0,this.gh.length=0,r.overTargets=n.composedPath(),this.freeEvent(n)}mapPointerOver(t){var i;if(!(t instanceof Wu))return void _n();const e=this.trackingData(t.pointerId),n=this.createPointerEvent(t),s="mouse"===n.pointerType||"pen"===n.pointerType;this.dispatchEvent(n,"pointerover"),s&&this.dispatchEvent(n,"mouseover"),"mouse"===n.pointerType&&(this.cursor=null==(i=n.target)?void 0:i.cursor);const r=this.clonePointerEvent(n,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),s&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;e.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(r)}mapPointerOut(t){if(!(t instanceof Wu))return void _n();const i=this.trackingData(t.pointerId);if(i.overTargets){const e="mouse"===t.pointerType||"pen"===t.pointerType,n=this.findMountedTarget(i.overTargets),s=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(s),e&&this.dispatchEvent(s,"mouseout");const r=this.createPointerEvent(t,"pointerleave",n);for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),e&&this.notifyTarget(r,"mouseleave"),r.target=r.target.parent;i.overTargets=null,this.freeEvent(s),this.freeEvent(r)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Wu))return void _n();const i=performance.now(),e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerup"),"touch"===e.pointerType)this.dispatchEvent(e,"touchend");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let r=s;if(s&&!e.composedPath().includes(s)){let i=s;for(;i&&!e.composedPath().includes(i);){if(e.currentTarget=i,this.notifyTarget(e,"pointerupoutside"),"touch"===e.pointerType)this.notifyTarget(e,"touchendoutside");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.notifyTarget(e,t?"rightupoutside":"mouseupoutside")}i=i.parent}delete n.pressTargetsByButton[t.button],r=i}if(r){const s=this.clonePointerEvent(e,"click");s.target=r,s.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:s.target,timeStamp:i});const o=n.clicksByButton[t.button];if(o.target===s.target&&i-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=s.target,o.timeStamp=i,s.detail=o.clickCount,"mouse"===s.pointerType){const t=2===s.button;this.dispatchEvent(s,t?"rightclick":"click")}else"touch"===s.pointerType&&this.dispatchEvent(s,"tap");this.dispatchEvent(s,"pointertap"),this.freeEvent(s)}this.freeEvent(e)}mapPointerUpOutside(t){if(!(t instanceof Wu))return void _n();const i=this.trackingData(t.pointerId),e=this.findMountedTarget(i.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(e){let s=e;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType?this.notifyTarget(n,"touchendoutside"):"mouse"!==n.pointerType&&"pen"!==n.pointerType||this.notifyTarget(n,2===n.button?"rightupoutside":"mouseupoutside"),s=s.parent;delete i.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof Hu))return void _n();const i=this.createWheelEvent(t);this.dispatchEvent(i),this.freeEvent(i)}findMountedTarget(t){if(!t)return null;let i=t[0];for(let e=1;e<t.length&&t[e].parent===i;e++)i=t[e];return i}createPointerEvent(t,i,e){const n=this.allocateEvent(Wu);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=e??this.hitTest(n.global.x,n.global.y)??this.gh[0],"string"==typeof i&&(n.type=i),n}createWheelEvent(t){const i=this.allocateEvent(Hu);return this.copyWheelData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t,i.target=this.hitTest(i.global.x,i.global.y),i}clonePointerEvent(t,i){const e=this.allocateEvent(Wu);return e.nativeEvent=t.nativeEvent,e.originalEvent=t.originalEvent,this.copyPointerData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.target=t.target,e.path=t.composedPath().slice(),e.type=i??e.type,e}copyWheelData(t,i){i.deltaMode=t.deltaMode,i.deltaX=t.deltaX,i.deltaY=t.deltaY,i.deltaZ=t.deltaZ}copyPointerData(t,i){t instanceof Wu&&i instanceof Wu&&(i.pointerId=t.pointerId,i.width=t.width,i.height=t.height,i.isPrimary=t.isPrimary,i.pointerType=t.pointerType,i.pressure=t.pressure,i.tangentialPressure=t.tangentialPressure,i.tiltX=t.tiltX,i.tiltY=t.tiltY,i.twist=t.twist)}copyMouseData(t,i){t instanceof Vu&&i instanceof Vu&&(i.altKey=t.altKey,i.button=t.button,i.buttons=t.buttons,i.client.copyFrom(t.client),i.ctrlKey=t.ctrlKey,i.metaKey=t.metaKey,i.movement.copyFrom(t.movement),i.screen.copyFrom(t.screen),i.shiftKey=t.shiftKey,i.global.copyFrom(t.global))}copyData(t,i){i.isTrusted=t.isTrusted,i.srcElement=t.srcElement,i.timeStamp=performance.now(),i.type=t.type,i.detail=t.detail,i.view=t.view,i.which=t.which,i.layer.copyFrom(t.layer),i.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const i=this.eventPool.get(t).pop()||new t(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.defaultPrevented=!1,i.path=null,i.target=null,i}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const i=t.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),this.eventPool.get(i).push(t)}wh(t,i){const e=t.currentTarget.Kt[i];if(e)if("fn"in e)e.once&&t.currentTarget.removeListener(i,e.fn,void 0,!0),e.fn.call(e.context,t);else for(let n=0,s=e.length;n<s&&!t.propagationImmediatelyStopped;n++)e[n].once&&t.currentTarget.removeListener(i,e[n].fn,void 0,!0),e[n].fn.call(e[n].context,t)}}const Ku={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Qu=class t{constructor(i){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=i,this.rootBoundary=new Yu(null),Nu.init(this),this.autoPreventDefault=!0,this.Mh=!1,this.ph=new Wu(null),this.Ah=new Hu(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...t.defaultEventFeatures},{set:(t,i,e)=>("globalMove"===i&&(this.rootBoundary.enableGlobalMoveEvents=e),t[i]=e,!0)}),this.Th=this.Th.bind(this),this._h=this._h.bind(this),this.kh=this.kh.bind(this),this.Ch=this.Ch.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this.Sh}init(i){const{canvas:e,resolution:n}=this.renderer;this.setTargetElement(e),this.resolution=n,t.Sh=i.eventMode??"passive",Object.assign(this.features,i.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null,this.Ph=null}setCursor(t){t||(t="default");let i=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(i=!1),this.Ph===t)return;this.Ph=t;const e=this.cursorStyles[t];if(e)switch(typeof e){case"string":i&&(this.domElement.style.cursor=e);break;case"function":e(t);break;case"object":i&&Object.assign(this.domElement.style,e)}else i&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.ph}Th(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const i=this.Eh(t);if(this.autoPreventDefault&&i[0].isNormalized){(t.cancelable||!("cancelable"in t))&&t.preventDefault()}for(let e=0,n=i.length;e<n;e++){const t=i[e],n=this.Rh(this.ph,t);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}_h(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Nu.pointerMoved();const i=this.Eh(t);for(let e=0,n=i.length;e<n;e++){const t=this.Rh(this.ph,i[e]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}kh(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let i=t.target;t.composedPath&&t.composedPath().length>0&&(i=t.composedPath()[0]);const e=i!==this.domElement?"outside":"",n=this.Eh(t);for(let s=0,r=n.length;s<r;s++){const t=this.Rh(this.ph,n[s]);t.type+=e,this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}Ch(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const i=this.Eh(t);for(let e=0,n=i.length;e<n;e++){const t=this.Rh(this.ph,i[e]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const i=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(i)}setTargetElement(t){this.Fh(),this.domElement=t,Nu.domElement=t,this.Oh()}Oh(){if(this.Mh||!this.domElement)return;Nu.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this._h,!0),this.domElement.addEventListener("pointerdown",this.Th,!0),this.domElement.addEventListener("pointerleave",this.Ch,!0),this.domElement.addEventListener("pointerover",this.Ch,!0),globalThis.addEventListener("pointerup",this.kh,!0)):(globalThis.document.addEventListener("mousemove",this._h,!0),this.domElement.addEventListener("mousedown",this.Th,!0),this.domElement.addEventListener("mouseout",this.Ch,!0),this.domElement.addEventListener("mouseover",this.Ch,!0),globalThis.addEventListener("mouseup",this.kh,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.Th,!0),this.domElement.addEventListener("touchend",this.kh,!0),this.domElement.addEventListener("touchmove",this._h,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.Mh=!0}Fh(){if(!this.Mh||!this.domElement)return;Nu.removeTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction="")),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this._h,!0),this.domElement.removeEventListener("pointerdown",this.Th,!0),this.domElement.removeEventListener("pointerleave",this.Ch,!0),this.domElement.removeEventListener("pointerover",this.Ch,!0),globalThis.removeEventListener("pointerup",this.kh,!0)):(globalThis.document.removeEventListener("mousemove",this._h,!0),this.domElement.removeEventListener("mousedown",this.Th,!0),this.domElement.removeEventListener("mouseout",this.Ch,!0),this.domElement.removeEventListener("mouseover",this.Ch,!0),globalThis.removeEventListener("mouseup",this.kh,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.Th,!0),this.domElement.removeEventListener("touchend",this.kh,!0),this.domElement.removeEventListener("touchmove",this._h,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.Mh=!1}mapPositionToPoint(t,i,e){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;t.x=(i-n.left)*(this.domElement.width/n.width)*s,t.y=(e-n.top)*(this.domElement.height/n.height)*s}Eh(t){const i=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let e=0,n=t.changedTouches.length;e<n;e++){const n=t.changedTouches[e];void 0===n.button&&(n.button=0),void 0===n.buttons&&(n.buttons=1),void 0===n.isPrimary&&(n.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===n.width&&(n.width=n.radiusX||1),void 0===n.height&&(n.height=n.radiusY||1),void 0===n.tiltX&&(n.tiltX=0),void 0===n.tiltY&&(n.tiltY=0),void 0===n.pointerType&&(n.pointerType="touch"),void 0===n.pointerId&&(n.pointerId=n.identifier||0),void 0===n.pressure&&(n.pressure=n.force||.5),void 0===n.twist&&(n.twist=0),void 0===n.tangentialPressure&&(n.tangentialPressure=0),void 0===n.layerX&&(n.layerX=n.offsetX=n.clientX),void 0===n.layerY&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,i.push(n)}else if(globalThis.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof globalThis.PointerEvent))i.push(t);else{const e=t;void 0===e.isPrimary&&(e.isPrimary=!0),void 0===e.width&&(e.width=1),void 0===e.height&&(e.height=1),void 0===e.tiltX&&(e.tiltX=0),void 0===e.tiltY&&(e.tiltY=0),void 0===e.pointerType&&(e.pointerType="mouse"),void 0===e.pointerId&&(e.pointerId=1),void 0===e.pressure&&(e.pressure=.5),void 0===e.twist&&(e.twist=0),void 0===e.tangentialPressure&&(e.tangentialPressure=0),e.isNormalized=!0,i.push(e)}return i}normalizeWheelEvent(t){const i=this.Ah;return this.$h(i,t),i.deltaX=t.deltaX,i.deltaY=t.deltaY,i.deltaZ=t.deltaZ,i.deltaMode=t.deltaMode,this.mapPositionToPoint(i.screen,t.clientX,t.clientY),i.global.copyFrom(i.screen),i.offset.copyFrom(i.screen),i.nativeEvent=t,i.type=t.type,i}Rh(t,i){return t.originalEvent=null,t.nativeEvent=i,t.pointerId=i.pointerId,t.width=i.width,t.height=i.height,t.isPrimary=i.isPrimary,t.pointerType=i.pointerType,t.pressure=i.pressure,t.tangentialPressure=i.tangentialPressure,t.tiltX=i.tiltX,t.tiltY=i.tiltY,t.twist=i.twist,this.$h(t,i),this.mapPositionToPoint(t.screen,i.clientX,i.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=i.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Ku[t.type]||t.type),t}$h(t,i){t.isTrusted=i.isTrusted,t.srcElement=i.srcElement,t.timeStamp=performance.now(),t.type=i.type,t.altKey=i.altKey,t.button=i.button,t.buttons=i.buttons,t.client.x=i.clientX,t.client.y=i.clientY,t.ctrlKey=i.ctrlKey,t.metaKey=i.metaKey,t.movement.x=i.movementX,t.movement.y=i.movementY,t.page.x=i.pageX,t.page.y=i.pageY,t.relatedTarget=null,t.shiftKey=i.shiftKey}};Qu.extension={name:"events",type:[ie.WebGLSystem,ie.CanvasSystem,ie.WebGPUSystem],priority:-1},Qu.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let Zu=Qu;const Ju={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,get interactive(){return"dynamic"===this.eventMode||"static"===this.eventMode},set interactive(t){this.eventMode=t?"static":"passive"},Uh:void 0,get eventMode(){return this.Uh??Zu.defaultEventMode},set eventMode(t){this.Uh=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,i,e){const n="boolean"==typeof e&&e||"object"==typeof e&&e.capture,s="object"==typeof e?e.signal:void 0,r="object"==typeof e&&!0===e.once,o="function"==typeof i?void 0:i;t=n?`${t}capture`:t;const h="function"==typeof i?i:i.handleEvent,a=this;s&&s.addEventListener("abort",()=>{a.off(t,h,o)}),r?a.once(t,h,o):a.on(t,h,o)},removeEventListener(t,i,e){const n="function"==typeof i?void 0:i;t="boolean"==typeof e&&e||"object"==typeof e&&e.capture?`${t}capture`:t,i="function"==typeof i?i:i.handleEvent,this.off(t,i,n)},dispatchEvent(t){if(!(t instanceof Qs))throw new Error("Container cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};class tc{constructor(t){this.Yn=t}push(t,i,e){this.Yn.renderPipes.batch.break(e),e.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:i,filterEffect:t})}pop(t,i,e){this.Yn.renderPipes.batch.break(e),e.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(t){"pushFilter"===t.action?this.Yn.filter.push(t):"popFilter"===t.action&&this.Yn.filter.pop()}destroy(){this.Yn=null}}tc.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"filter"};const ic=new jh({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),format:"float32x2",stride:8,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class ec{constructor(){this.skip=!1,this.inputTexture=null,this.backTexture=null,this.filters=null,this.bounds=new qe,this.container=null,this.blendRequired=!1,this.outputRenderSurface=null,this.globalFrame={x:0,y:0,width:0,height:0}}}class nc{constructor(t){this.Bh=0,this.Ih=[],this.jh=new Lr({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this.Gh=new Nr({}),this.renderer=t}get activeBackTexture(){var t;return null==(t=this.zh)?void 0:t.backTexture}push(t){const i=this.renderer,e=t.filterEffect.filters,n=this.Dh();n.skip=!1,n.filters=e,n.container=t.container,n.outputRenderSurface=i.renderTarget.renderSurface;const s=i.renderTarget.renderTarget.colorTexture.source,r=s.resolution,o=s.antialias;if(0===e.length)return void(n.skip=!0);const h=n.bounds;if(this.Lh(t,h),this.Nh(n,i.renderTarget.rootViewPort,o,r,1),n.skip)return;const a=this.Vh(),u=this.Wh(r);let c=0,l=0;a&&(c=a.bounds.minX,l=a.bounds.minY),this.Hh(n,c,l,u,s.width,s.height),this.qh(n,h,i,a)}generateFilteredTexture({texture:t,filters:i}){const e=this.Dh();this.zh=e,e.skip=!1,e.filters=i;const n=t.source,s=n.resolution,r=n.antialias;if(0===i.length)return e.skip=!0,t;const o=e.bounds;if(o.addRect(t.frame),this.Nh(e,o.rectangle,r,s,0),e.skip)return t;const h=s;this.Hh(e,0,0,h,n.width,n.height),e.outputRenderSurface=rs.getOptimalTexture(o.width,o.height,e.resolution,e.antialias),e.backTexture=Ve.EMPTY,e.inputTexture=t;this.renderer.renderTarget.finishRenderPass(),this.Xh(e,!0);const a=e.outputRenderSurface;return a.source.alphaMode="premultiplied-alpha",a}pop(){const t=this.renderer,i=this.Yh();i.skip||(t.globalUniforms.pop(),t.renderTarget.finishRenderPass(),this.zh=i,this.Xh(i,!1),i.blendRequired&&rs.returnTexture(i.backTexture),rs.returnTexture(i.inputTexture))}getBackTexture(t,i,e){const n=t.colorTexture.source.si,s=rs.getOptimalTexture(i.width,i.height,n,!1);let r=i.minX,o=i.minY;e&&(r-=e.minX,o-=e.minY),r=Math.floor(r*n),o=Math.floor(o*n);const h=Math.ceil(i.width*n),a=Math.ceil(i.height*n);return this.renderer.renderTarget.copyToTexture(t,s,{x:r,y:o},{width:h,height:a},{x:0,y:0}),s}applyFilter(t,i,e,n){const s=this.renderer,r=this.zh,o=r.outputRenderSurface===e,h=s.renderTarget.rootRenderTarget.colorTexture.source.si,a=this.Wh(h);let u=0,c=0;if(o){const t=this.Kh();u=t.x,c=t.y}this.Qh(i,e,r,u,c,a,o,n),this.Zh(t,i,s)}calculateSpriteMatrix(t,i){const e=this.zh,n=t.set(e.inputTexture.di.width,0,0,e.inputTexture.di.height,e.bounds.minX,e.bounds.minY),s=i.worldTransform.copyTo(ve.shared),r=i.renderGroup||i.parentRenderGroup;return r&&r.cacheToLocalTransform&&s.prepend(r.cacheToLocalTransform),s.invert(),n.prepend(s),n.scale(1/i.texture.orig.width,1/i.texture.orig.height),n.translate(i.anchor.x,i.anchor.y),n}destroy(){}Zh(t,i,e){if(e.renderPipes.uniformBatch){const t=e.renderPipes.uniformBatch.getUboResource(this.jh);this.Gh.setResource(t,0)}else this.Gh.setResource(this.jh,0);this.Gh.setResource(i.source,1),this.Gh.setResource(i.source.style,2),t.groups[0]=this.Gh,e.encoder.draw({geometry:ic,shader:t,state:t.Qs,topology:"triangle-list"}),e.type===Vr.WEBGL&&e.renderTarget.finishRenderPass()}qh(t,i,e,n){if(t.backTexture=Ve.EMPTY,t.blendRequired){e.renderTarget.finishRenderPass();const s=e.renderTarget.getRenderTarget(t.outputRenderSurface);t.backTexture=this.getBackTexture(s,i,null==n?void 0:n.bounds)}t.inputTexture=rs.getOptimalTexture(i.width,i.height,t.resolution,t.antialias),e.renderTarget.bind(t.inputTexture,!0),e.globalUniforms.push({offset:i})}Hh(t,i,e,n,s,r){const o=t.globalFrame;o.x=i*n,o.y=e*n,o.width=s*n,o.height=r*n}Qh(t,i,e,n,s,r,o,h){const a=this.jh.uniforms,u=a.uOutputFrame,c=a.uInputSize,l=a.uInputPixel,f=a.uInputClamp,d=a.uGlobalFrame,p=a.uOutputTexture;o?(u[0]=e.bounds.minX-n,u[1]=e.bounds.minY-s):(u[0]=0,u[1]=0),u[2]=t.frame.width,u[3]=t.frame.height,c[0]=t.source.width,c[1]=t.source.height,c[2]=1/c[0],c[3]=1/c[1],l[0]=t.source.pixelWidth,l[1]=t.source.pixelHeight,l[2]=1/l[0],l[3]=1/l[1],f[0]=.5*l[2],f[1]=.5*l[3],f[2]=t.frame.width*c[2]-.5*l[2],f[3]=t.frame.height*c[3]-.5*l[3];const v=this.renderer.renderTarget.rootRenderTarget.colorTexture;d[0]=n*r,d[1]=s*r,d[2]=v.source.width*r,d[3]=v.source.height*r,i instanceof Ve&&(i.source.resource=null);const m=this.renderer.renderTarget.getRenderTarget(i);this.renderer.renderTarget.bind(i,!!h),i instanceof Ve?(p[0]=i.frame.width,p[1]=i.frame.height):(p[0]=m.width,p[1]=m.height),p[2]=m.isRoot?-1:1,this.jh.update()}Wh(t){let i=this.Bh-1;for(;i>0&&this.Ih[i].skip;)--i;return i>0&&this.Ih[i].inputTexture?this.Ih[i].inputTexture.source.si:t}Kh(){let t=0,i=0,e=this.Bh;for(;e>0;){e--;const n=this.Ih[e];if(!n.skip){t=n.bounds.minX,i=n.bounds.minY;break}}return{x:t,y:i}}Lh(t,i){if(t.renderables?function(t,i){i.clear();const e=i.matrix;for(let n=0;n<t.length;n++){const e=t[n];e.globalDisplayStatus<7||(i.matrix=e.worldTransform,i.addBounds(e.bounds))}i.matrix=e}(t.renderables,i):t.filterEffect.filterArea?(i.clear(),i.addRect(t.filterEffect.filterArea),i.applyMatrix(t.container.worldTransform)):t.container.getFastGlobalBounds(!0,i),t.container){const e=(t.container.renderGroup||t.container.parentRenderGroup).cacheToLocalTransform;e&&i.applyMatrix(e)}}Xh(t,i){const e=t.inputTexture,n=t.bounds,s=t.filters;if(this.Gh.setResource(e.source.style,2),this.Gh.setResource(t.backTexture.source,3),1===s.length)s[0].apply(this,e,t.outputRenderSurface,i);else{let e=t.inputTexture;const r=rs.getOptimalTexture(n.width,n.height,e.source.si,!1);let o=r,h=0;for(h=0;h<s.length-1;++h){s[h].apply(this,e,o,!0);const t=e;e=o,o=t}s[h].apply(this,e,t.outputRenderSurface,i),rs.returnTexture(r)}}Nh(t,i,e,n,s){var r;const o=this.renderer,h=t.bounds,a=t.filters;let u=1/0,c=0,l=!0,f=!1,d=!1,p=!0;for(let v=0;v<a.length;v++){const t=a[v];u=Math.min(u,"inherit"===t.resolution?n:t.resolution),c+=t.padding,"off"===t.antialias?l=!1:"inherit"===t.antialias&&l&&(l=e),t.clipToViewport||(p=!1);if(!!!(t.compatibleRenderers&o.type)){d=!1;break}if(t.blendRequired&&!((null==(r=o.backBuffer)?void 0:r.useBackBuffer)??1)){_n(),d=!1;break}d=t.enabled||d,f||(f=t.blendRequired)}d?(p&&h.fitBounds(0,i.width/n,0,i.height/n),h.scale(u).ceil().scale(1/u).pad((0|c)*s),h.isPositive?(t.antialias=l,t.resolution=u,t.blendRequired=f):t.skip=!0):t.skip=!0}Yh(){return this.Bh--,this.Ih[this.Bh]}Vh(){let t,i=this.Bh-1;for(;i>1&&(i--,t=this.Ih[i],t.skip););return t}Dh(){let t=this.Ih[this.Bh];return t||(t=this.Ih[this.Bh]=new ec),this.Bh++,t}}nc.extension={type:[ie.WebGLSystem,ie.WebGPUSystem],name:"filter"};var sc="struct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct MaskUniforms {\n  uFilterMatrix:mat3x3<f32>,\n  uMaskClamp:vec4<f32>,\n  uAlpha:f32,\n  uInverse:f32,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n\n@group(1) @binding(0) var<uniform> filterUniforms : MaskUniforms;\n@group(1) @binding(1) var uMaskTexture: texture_2d<f32>;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) filterUv : vec2<f32>,\n};\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);\n}\n\nfn getFilterCoord(aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return ( filterUniforms.uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;\n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n\n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>,\n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition),\n   getFilterCoord(aPosition)\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) filterUv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n\n    var maskClamp = filterUniforms.uMaskClamp;\n    var uAlpha = filterUniforms.uAlpha;\n\n    var clip = step(3.5,\n      step(maskClamp.x, filterUv.x) +\n      step(maskClamp.y, filterUv.y) +\n      step(filterUv.x, maskClamp.z) +\n      step(filterUv.y, maskClamp.w));\n\n    var mask = textureSample(uMaskTexture, uSampler, filterUv);\n    var source = textureSample(uTexture, uSampler, uv);\n    var alphaMul = 1.0 - uAlpha * (1.0 - mask.a);\n\n    var a: f32 = alphaMul * mask.r * uAlpha * clip;\n\n    if (filterUniforms.uInverse == 1.0) {\n        a = 1.0 - a;\n    }\n\n    return source * a;\n}\n";class rc extends Kr{constructor(t){const{sprite:i,...e}=t,n=new Ne(i.texture),s=new Lr({uFilterMatrix:{value:new ve,type:"mat3x3<f32>"},uMaskClamp:{value:n.uClampFrame,type:"vec4<f32>"},uAlpha:{value:1,type:"f32"},uInverse:{value:t.inverse?1:0,type:"f32"}});super({...e,gpuProgram:Ir.from({vertex:{source:sc,entryPoint:"mainVertex"},fragment:{source:sc,entryPoint:"mainFragment"}}),glProgram:Er.from({vertex:"in vec2 aPosition;\n\nout vec2 vTextureCoord;\nout vec2 vMaskCoord;\n\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\nuniform mat3 uFilterMatrix;\n\nvec4 filterVertexPosition(  vec2 aPosition )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n       \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord(  vec2 aPosition )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvec2 getFilterCoord( vec2 aPosition )\n{\n    return  ( uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;\n}   \n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition(aPosition);\n    vTextureCoord = filterTextureCoord(aPosition);\n    vMaskCoord = getFilterCoord(aPosition);\n}\n",fragment:"in vec2 vMaskCoord;\nin vec2 vTextureCoord;\n\nuniform sampler2D uTexture;\nuniform sampler2D uMaskTexture;\n\nuniform float uAlpha;\nuniform vec4 uMaskClamp;\nuniform float uInverse;\n\nout vec4 finalColor;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(uMaskClamp.x, vMaskCoord.x) +\n        step(uMaskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, uMaskClamp.z) +\n        step(vMaskCoord.y, uMaskClamp.w));\n\n    // TODO look into why this is needed\n    float npmAlpha = uAlpha;\n    vec4 original = texture(uTexture, vTextureCoord);\n    vec4 masky = texture(uMaskTexture, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    float a = alphaMul * masky.r * npmAlpha * clip;\n\n    if (uInverse == 1.0) {\n        a = 1.0 - a;\n    }\n\n    finalColor = original * a;\n}\n",name:"mask-filter"}),clipToViewport:!1,resources:{filterUniforms:s,uMaskTexture:i.texture.source}}),this.sprite=i,this.pi=n}set inverse(t){this.resources.filterUniforms.uniforms.uInverse=t?1:0}get inverse(){return 1===this.resources.filterUniforms.uniforms.uInverse}apply(t,i,e,n){this.pi.texture=this.sprite.texture,t.calculateSpriteMatrix(this.resources.filterUniforms.uniforms.uFilterMatrix,this.sprite).prepend(this.pi.mapCoord),this.resources.uMaskTexture=this.sprite.texture.source,t.applyFilter(this,i,e,n)}}class oc extends fs{constructor(t){t instanceof Su&&(t={context:t});const{context:i,roundPixels:e,...n}=t||{};super({label:"Graphics",...n}),this.renderPipeId="graphics",this.$e=i||(this.Jh=new Su),this.$e.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=e??!1}set context(t){t!==this.$e&&(this.$e.off("update",this.onViewUpdate,this),this.$e=t,this.$e.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this.$e}get bounds(){return this.$e.bounds}updateBounds(){}containsPoint(t){return this.$e.containsPoint(t)}destroy(t){this.Jh&&!t?this.Jh.destroy(t):!0!==t&&!0!==(null==t?void 0:t.context)||this.$e.destroy(t),this.Jh=null,this.$e=null,super.destroy(t)}ta(t,i){return this.context[t](...i),this}setFillStyle(...t){return this.ta("setFillStyle",t)}setStrokeStyle(...t){return this.ta("setStrokeStyle",t)}fill(...t){return this.ta("fill",t)}stroke(...t){return this.ta("stroke",t)}texture(...t){return this.ta("texture",t)}beginPath(){return this.ta("beginPath",[])}cut(){return this.ta("cut",[])}arc(...t){return this.ta("arc",t)}arcTo(...t){return this.ta("arcTo",t)}arcToSvg(...t){return this.ta("arcToSvg",t)}bezierCurveTo(...t){return this.ta("bezierCurveTo",t)}closePath(){return this.ta("closePath",[])}ellipse(...t){return this.ta("ellipse",t)}circle(...t){return this.ta("circle",t)}path(...t){return this.ta("path",t)}lineTo(...t){return this.ta("lineTo",t)}moveTo(...t){return this.ta("moveTo",t)}quadraticCurveTo(...t){return this.ta("quadraticCurveTo",t)}rect(...t){return this.ta("rect",t)}roundRect(...t){return this.ta("roundRect",t)}poly(...t){return this.ta("poly",t)}regularPoly(...t){return this.ta("regularPoly",t)}roundPoly(...t){return this.ta("roundPoly",t)}roundShape(...t){return this.ta("roundShape",t)}filletRect(...t){return this.ta("filletRect",t)}chamferRect(...t){return this.ta("chamferRect",t)}star(...t){return this.ta("star",t)}svg(...t){return this.ta("svg",t)}restore(...t){return this.ta("restore",t)}save(){return this.ta("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this.ta("resetTransform",[])}rotateTransform(...t){return this.ta("rotate",t)}scaleTransform(...t){return this.ta("scale",t)}setTransform(...t){return this.ta("setTransform",t)}transform(...t){return this.ta("transform",t)}translateTransform(...t){return this.ta("translate",t)}clear(){return this.ta("clear",[])}get fillStyle(){return this.$e.fillStyle}set fillStyle(t){this.$e.fillStyle=t}get strokeStyle(){return this.$e.strokeStyle}set strokeStyle(t){this.$e.strokeStyle=t}clone(t=!1){if(t)return new oc(this.$e.clone());this.Jh=null;return new oc(this.$e)}lineStyle(t,i,e){Re(0,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const n={};return t&&(n.width=t),i&&(n.color=i),e&&(n.alpha=e),this.context.strokeStyle=n,this}beginFill(t,i){Re(0,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const e={};return void 0!==t&&(e.color=t),void 0!==i&&(e.alpha=i),this.context.fillStyle=e,this}endFill(){Re(0,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return t.width===Su.defaultStrokeStyle.width&&t.color===Su.defaultStrokeStyle.color&&t.alpha===Su.defaultStrokeStyle.alpha||this.context.stroke(),this}drawCircle(...t){return Re(0,"Graphics#drawCircle has been renamed to Graphics#circle"),this.ta("circle",t)}drawEllipse(...t){return Re(0,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this.ta("ellipse",t)}drawPolygon(...t){return Re(0,"Graphics#drawPolygon has been renamed to Graphics#poly"),this.ta("poly",t)}drawRect(...t){return Re(0,"Graphics#drawRect has been renamed to Graphics#rect"),this.ta("rect",t)}drawRoundedRect(...t){return Re(0,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this.ta("roundRect",t)}drawStar(...t){return Re(0,"Graphics#drawStar has been renamed to Graphics#star"),this.ta("star",t)}}const hc=class t extends jh{constructor(...i){let e=i[0]??{};e instanceof Float32Array&&(Re(0,"use new MeshGeometry({ positions, uvs, indices }) instead"),e={positions:e,uvs:i[1],indices:i[2]}),e={...t.defaultOptions,...e};const n=e.positions||new Float32Array([0,0,1,0,1,1,0,1]);let s=e.uvs;s||(s=e.positions?new Float32Array(n.length):new Float32Array([0,0,1,0,1,1,0,1]));const r=e.indices||new Uint32Array([0,1,2,0,2,3]),o=e.shrinkBuffersToFit;super({attributes:{aPosition:{buffer:new Bh({data:n,label:"attribute-mesh-positions",shrinkToFit:o,usage:Uh.VERTEX|Uh.COPY_DST}),format:"float32x2",stride:8,offset:0},aUV:{buffer:new Bh({data:s,label:"attribute-mesh-uvs",shrinkToFit:o,usage:Uh.VERTEX|Uh.COPY_DST}),format:"float32x2",stride:8,offset:0}},indexBuffer:new Bh({data:r,label:"index-mesh-buffer",shrinkToFit:o,usage:Uh.INDEX|Uh.COPY_DST}),topology:e.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};hc.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let ac=hc;class uc extends fs{constructor(t,i){const{text:e,resolution:n,style:s,anchor:r,width:o,height:h,roundPixels:a,...u}=t;super({...u}),this.batched=!0,this.si=null,this.ia=!0,this.ea=!0,this.na=i,this.text=e??"",this.style=s,this.resolution=n??null,this.allowChildren=!1,this.Se=new he({Yt:()=>{this.onViewUpdate()}}),r&&(this.anchor=r),this.roundPixels=a??!1,void 0!==o&&(this.width=o),void 0!==h&&(this.height=h)}get anchor(){return this.Se}set anchor(t){"number"==typeof t?this.Se.set(t):this.Se.copyFrom(t)}set text(t){t=t.toString(),this.sa!==t&&(this.sa=t,this.onViewUpdate())}get text(){return this.sa}set resolution(t){this.ia=null===t,this.si=t,this.onViewUpdate()}get resolution(){return this.si}get style(){return this.ai}set style(t){var i;t||(t={}),null==(i=this.ai)||i.off("update",this.onViewUpdate,this),t instanceof this.na?this.ai=t:this.ai=new this.na(t),this.ai.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(t){this.qi(t,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(t){this.Xi(t,this.bounds.height)}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this.bounds.width,t.height=Math.abs(this.scale.y)*this.bounds.height,t}setSize(t,i){"object"==typeof t?(i=t.height??t.width,t=t.width):i??(i=t),void 0!==t&&this.qi(t,this.bounds.width),void 0!==i&&this.Xi(i,this.bounds.height)}containsPoint(t){const i=this.bounds.width,e=this.bounds.height,n=-i*this.anchor.x;let s=0;return t.x>=n&&t.x<=n+i&&(s=-e*this.anchor.y,t.y>=s&&t.y<=s+e)}onViewUpdate(){this.didViewUpdate||(this.ea=!0),super.onViewUpdate()}destroy(t=!1){super.destroy(t),this.owner=null,this._e=null,this.Se=null,("boolean"==typeof t?t:null==t?void 0:t.style)&&this.ai.destroy(t),this.ai=null,this.sa=null}}let cc=null,lc=null;function fc(t,i,e){for(let n=0,s=4*e*i;n<i;++n,s+=4)if(0!==t[s+3])return!1;return!0}function dc(t,i,e,n,s){const r=4*i;for(let o=n,h=n*r+4*e;o<=s;++o,h+=r)if(0!==t[h+3])return!1;return!0}function pc(...t){let i=t[0];i.canvas||(i={canvas:t[0],resolution:t[1]});const{canvas:e}=i,n=Math.min(i.resolution??1,1),s=i.width??e.width,r=i.height??e.height;let o=i.output;if(function(t,i){cc||(cc=Ms.get().createCanvas(256,128),lc=cc.getContext("2d",{willReadFrequently:!0}),lc.globalCompositeOperation="copy",lc.globalAlpha=1),(cc.width<t||cc.height<i)&&(cc.width=Oe(t),cc.height=Oe(i))}(s,r),!lc)throw new TypeError("Failed to get canvas 2D context");lc.drawImage(e,0,0,s,r,0,0,s*n,r*n);const h=lc.getImageData(0,0,s,r).data;let a=0,u=0,c=s-1,l=r-1;for(;u<r&&fc(h,s,u);)++u;if(u===r)return Ce.EMPTY;for(;fc(h,s,l);)--l;for(;dc(h,s,a,u,l);)++a;for(;dc(h,s,c,u,l);)--c;return++c,++l,lc.globalCompositeOperation="source-over",lc.strokeRect(a,u,c-a,l-u),lc.globalCompositeOperation="copy",o??(o=new Ce),o.set(a/n,u/n,(c-a)/n,(l-u)/n),o}const vc=new Ce;const mc=new class{getCanvasAndContext(t){const{text:i,style:e,resolution:n=1}=t,s=e.zo(),r=Ko.measureText(i||" ",e),o=Math.ceil(Math.ceil(Math.max(1,r.width)+2*s)*n),h=Math.ceil(Math.ceil(Math.max(1,r.height)+2*s)*n),a=$u.getOptimalCanvasAndContext(o,h);this.ra(i,e,s,n,a);return{canvasAndContext:a,frame:e.trim?pc({canvas:a.canvas,width:o,height:h,resolution:1,output:vc}):vc.set(0,0,o,h)}}returnCanvasAndContext(t){$u.returnCanvasAndContext(t)}ra(t,i,e,n,s){var r,o,h,a;const{canvas:u,context:c}=s,l=qo(i),f=Ko.measureText(t||" ",i),d=f.lines,p=f.lineHeight,v=f.lineWidths,m=f.maxLineWidth,g=f.fontProperties,b=u.height;if(c.resetTransform(),c.scale(n,n),c.textBaseline=i.textBaseline,null==(r=i.yr)?void 0:r.width){const t=i.yr;c.lineWidth=t.width,c.miterLimit=t.miterLimit,c.lineJoin=t.join,c.lineCap=t.cap}let y,x;c.font=l;const w=i.dropShadow?2:1;for(let M=0;M<w;++M){const t=i.dropShadow&&0===M,r=t?Math.ceil(Math.max(1,b)+2*e):0,u=r*n;if(t){c.fillStyle="black",c.strokeStyle="black";const t=i.dropShadow,e=t.color,s=t.alpha;c.shadowColor=An.shared.setValue(e).setAlpha(s).toRgbaString();const r=t.blur*n,o=t.distance*n;c.shadowBlur=r,c.shadowOffsetX=Math.cos(t.angle)*o,c.shadowOffsetY=Math.sin(t.angle)*o+u}else{if(c.fillStyle=i.mo?Bu(i.mo,c,f,2*e):null,null==(o=i.yr)?void 0:o.width){const t=.5*i.yr.width+2*e;c.strokeStyle=Bu(i.yr,c,f,t)}c.shadowColor="black"}let l=(p-g.fontSize)/2;p-g.fontSize<0&&(l=0);const w=(null==(h=i.yr)?void 0:h.width)??0;for(let n=0;n<d.length;n++)y=w/2,x=w/2+n*p+g.ascent+l,"right"===i.align?y+=m-v[n]:"center"===i.align&&(y+=(m-v[n])/2),(null==(a=i.yr)?void 0:a.width)&&this.oa(d[n],i,s,y+e,x+e-r,!0),void 0!==i.mo&&this.oa(d[n],i,s,y+e,x+e-r)}}oa(t,i,e,n,s,r=!1){const{context:o}=e,h=i.letterSpacing;let a=!1;if(Ko.experimentalLetterSpacingSupported&&(Ko.experimentalLetterSpacing?(o.letterSpacing=`${h}px`,o.textLetterSpacing=`${h}px`,a=!0):(o.letterSpacing="0px",o.textLetterSpacing="0px")),0===h||a)return void(r?o.strokeText(t,n,s):o.fillText(t,n,s));let u=n;const c=Ko.graphemeSegmenter(t);let l=o.measureText(t).width,f=0;for(let d=0;d<c.length;++d){const t=c[d];r?o.strokeText(t,u,s):o.fillText(t,u,s);let i="";for(let e=d+1;e<c.length;++e)i+=c[e];f=o.measureText(i).width,u+=l-f+h,l=f}}};class gc extends uc{constructor(...t){var i;const e=function(t,i){let e=t[0]??{};return("string"==typeof e||t[1])&&(Re(0,`use new ${i}({ text: "hi!", style }) instead`),e={text:e,style:t[1]}),e}(t,"BitmapText");e.style??(e.style=e.style||{}),(i=e.style).fill??(i.fill=16777215),super(e,Ou),this.renderPipeId="bitmapText"}updateBounds(){const t=this._e,i=this.Se,e=Du.measureText(this.text,this.ai),n=e.scale,s=e.offsetY*n;let r=e.width*n,o=e.height*n;const h=this.ai.yr;h&&(r+=h.width,o+=h.width),t.minX=-i.xt*r,t.maxX=t.minX+r,t.minY=-i.qt*(o+s),t.maxY=t.minY+o}set resolution(t){null!==t&&_n()}get resolution(){return this.si}}const bc="http://www.w3.org/2000/svg",yc="http://www.w3.org/1999/xhtml";class xc{constructor(){this.svgRoot=document.createElementNS(bc,"svg"),this.foreignObject=document.createElementNS(bc,"foreignObject"),this.domElement=document.createElementNS(yc,"div"),this.styleElement=document.createElementNS(yc,"style");const{foreignObject:t,svgRoot:i,styleElement:e,domElement:n}=this;t.setAttribute("width","10000"),t.setAttribute("height","10000"),t.style.overflow="hidden",i.appendChild(t),t.appendChild(e),t.appendChild(n),this.image=Ms.get().createImage()}}let wc;class Mc{constructor(){this.ha=Xr.for2d(),this.aa={}}init(t){t.renderer.runners.contextChange.add(this)}contextChange(){this.aa={}}start(t,i,e){const n=t.renderer,s=this.aa[e.uid];n.shader.bind(e,s),s||(this.aa[e.uid]=!0),n.shader.updateUniformGroup(n.globalUniforms.uniformGroup),n.geometry.bind(i,e.glProgram)}execute(t,i){const e=t.renderer;this.ha.blendMode=i.blendMode,e.state.set(this.ha);const n=i.textures.textures;for(let s=0;s<i.textures.count;s++)e.texture.bind(n[s],s);e.geometry.draw(i.topology,i.size,i.start)}}Mc.extension={type:[ie.WebGLPipesAdaptor],name:"batch"};const Ac=Xr.for2d();class Tc{start(t,i,e){const n=t.renderer,s=n.encoder,r=e.gpuProgram;this.ua=e,this.ca=i,s.setGeometry(i,r),Ac.blendMode="normal",n.pipeline.getPipeline(i,r,Ac);const o=n.globalUniforms.bindGroup;s.resetBindGroup(1),s.setBindGroup(0,o,r)}execute(t,i){const e=this.ua.gpuProgram,n=t.renderer,s=n.encoder;if(!i.bindGroup){const t=i.textures;i.bindGroup=mh(t.textures,t.count,n.limits.maxBatchableTextures)}Ac.blendMode=i.blendMode;const r=n.bindGroup.getBindGroup(i.bindGroup,e,1),o=n.pipeline.getPipeline(this.ca,e,Ac,i.topology);i.bindGroup.Vs(n.textureGC.count),s.setPipeline(o),s.renderPassEncoder.setBindGroup(1,r),s.renderPassEncoder.drawIndexed(i.size,1,i.start)}}Tc.extension={type:[ie.WebGPUPipesAdaptor],name:"batch"};const _c=class t{constructor(t,i){var e,n;this.state=Xr.for2d(),this.la=Object.create(null),this.fa=Object.create(null),this.renderer=t,this.da=i,null==(n=(e=this.da).init)||n.call(e,this)}static getBatcher(t){return new this.pa[t]}buildStart(t){let i=this.la[t.uid];i||(i=this.la[t.uid]=Object.create(null),i.default||(i.default=new Ma({maxTextures:this.renderer.limits.maxBatchableTextures}))),this.fa=i,this.va=this.fa.default;for(const e in this.fa)this.fa[e].begin()}addToBatch(i,e){if(this.va.name!==i.batcherName){this.va.break(e);let n=this.fa[i.batcherName];n||(n=this.fa[i.batcherName]=t.getBatcher(i.batcherName),n.begin()),this.va=n}this.va.add(i)}break(t){this.va.break(t)}buildEnd(t){this.va.break(t);const i=this.fa;for(const e in i){const t=i[e],n=t.geometry;n.indexBuffer.setDataWithSize(t.indexBuffer,t.indexSize,!0),n.buffers[0].setDataWithSize(t.attributeBuffer.float32View,t.attributeSize,!1)}}upload(t){const i=this.la[t.uid];for(const e in i){const t=i[e],n=t.geometry;t.dirty&&(t.dirty=!1,n.buffers[0].update(4*t.attributeSize))}}execute(t){if("startBatch"===t.action){const i=t.batcher,e=i.geometry,n=i.shader;this.da.start(this,e,n)}this.da.execute(this,t)}destroy(){this.state=null,this.renderer=null,this.da=null;for(const t in this.fa)this.fa[t].destroy();this.fa=null}};_c.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"batch"},_c.pa=Object.create(null);let kc=_c;se.handleByMap(ie.Batcher,kc.pa),se.add(Ma);const Cc={name:"local-uniform-bit",vertex:{header:"\n\n            struct LocalUniforms {\n                uTransformMatrix:mat3x3<f32>,\n                uColor:vec4<f32>,\n                uRound:f32,\n            }\n\n            @group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "}},Sc={...Cc,vertex:{...Cc.vertex,header:Cc.vertex.header.replace("group(1)","group(2)")}},Pc={name:"local-uniform-bit",vertex:{header:"\n\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix = uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "}},Ec={name:"texture-bit",vertex:{header:"\n\n        struct TextureUniforms {\n            uTextureMatrix:mat3x3<f32>,\n        }\n\n        @group(2) @binding(2) var<uniform> textureUniforms : TextureUniforms;\n        ",main:"\n            uv = (textureUniforms.uTextureMatrix * vec3(uv, 1.0)).xy;\n        "},fragment:{header:"\n            @group(2) @binding(0) var uTexture: texture_2d<f32>;\n            @group(2) @binding(1) var uSampler: sampler;\n\n\n        ",main:"\n            outColor = textureSample(uTexture, uSampler, vUV);\n        "}},Rc={name:"texture-bit",vertex:{header:"\n            uniform mat3 uTextureMatrix;\n        ",main:"\n            uv = (uTextureMatrix * vec3(uv, 1.0)).xy;\n        "},fragment:{header:"\n        uniform sampler2D uTexture;\n\n\n        ",main:"\n            outColor = texture(uTexture, vUV);\n        "}},Fc=new qe;class Oc extends Fn{constructor(){super(),this.filters=[new rc({sprite:new ds(Ve.EMPTY),inverse:!1,resolution:"inherit",antialias:"inherit"})]}get sprite(){return this.filters[0].sprite}set sprite(t){this.filters[0].sprite=t}get inverse(){return this.filters[0].inverse}set inverse(t){this.filters[0].inverse=t}}class $c{constructor(t){this.ma=[],this.Yn=t}push(t,i,e){const n=this.Yn;if(n.renderPipes.batch.break(e),e.add({renderPipeId:"alphaMask",action:"pushMaskBegin",mask:t,inverse:i.zi.inverse,canBundle:!1,maskedContainer:i}),t.inverse=i.zi.inverse,t.renderMaskToTexture){const i=t.mask;i.includeInBuild=!0,i.collectRenderables(e,n,null),i.includeInBuild=!1}n.renderPipes.batch.break(e),e.add({renderPipeId:"alphaMask",action:"pushMaskEnd",mask:t,maskedContainer:i,inverse:i.zi.inverse,canBundle:!1})}pop(t,i,e){this.Yn.renderPipes.batch.break(e),e.add({renderPipeId:"alphaMask",action:"popMaskEnd",mask:t,inverse:i.zi.inverse,canBundle:!1})}execute(t){const i=this.Yn,e=t.mask.renderMaskToTexture;if("pushMaskBegin"===t.action){const n=Cn.get(Oc);if(n.inverse=t.inverse,e){t.mask.mask.measurable=!0;const e=zn(t.mask.mask,!0,Fc);t.mask.mask.measurable=!1,e.ceil();const s=i.renderTarget.renderTarget.colorTexture.source,r=rs.getOptimalTexture(e.width,e.height,s.si,s.antialias);i.renderTarget.push(r,!0),i.globalUniforms.push({offset:e,worldColor:4294967295});const o=n.sprite;o.texture=r,o.worldTransform.tx=e.minX,o.worldTransform.ty=e.minY,this.ma.push({filterEffect:n,maskedContainer:t.maskedContainer,filterTexture:r})}else n.sprite=t.mask.mask,this.ma.push({filterEffect:n,maskedContainer:t.maskedContainer})}else if("pushMaskEnd"===t.action){const t=this.ma[this.ma.length-1];e&&(i.type===Vr.WEBGL&&i.renderTarget.finishRenderPass(),i.renderTarget.pop(),i.globalUniforms.pop()),i.filter.push({renderPipeId:"filter",action:"pushFilter",container:t.maskedContainer,filterEffect:t.filterEffect,canBundle:!1})}else if("popMaskEnd"===t.action){i.filter.pop();const t=this.ma.pop();e&&rs.returnTexture(t.filterTexture),Cn.return(t.filterEffect)}}destroy(){this.Yn=null,this.ma=null}}$c.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"alphaMask"};class Uc{constructor(t){this.ga=[],this.ba=0,this.ya=0,this.Yn=t}buildStart(){this.ga[0]=15,this.ba=1,this.ya=15}push(t,i,e){this.Yn.renderPipes.batch.break(e);const n=this.ga;n[this.ba]=n[this.ba-1]&t.mask;const s=this.ga[this.ba];s!==this.ya&&(this.ya=s,e.add({renderPipeId:"colorMask",colorMask:s,canBundle:!1})),this.ba++}pop(t,i,e){this.Yn.renderPipes.batch.break(e);const n=this.ga;this.ba--;const s=n[this.ba-1];s!==this.ya&&(this.ya=s,e.add({renderPipeId:"colorMask",colorMask:s,canBundle:!1}))}execute(t){this.Yn.colorMask.setMask(t.colorMask)}destroy(){this.ga=null}}Uc.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"colorMask"};class Bc{constructor(t){this.xa={},this.wa=new WeakMap,this.Yn=t}push(t,i,e){var n;const s=t,r=this.Yn;r.renderPipes.batch.break(e),r.renderPipes.blendMode.setBlendMode(s.mask,"none",e),e.add({renderPipeId:"stencilMask",action:"pushMaskBegin",mask:t,inverse:i.zi.inverse,canBundle:!1});const o=s.mask;o.includeInBuild=!0,this.wa.has(s)||this.wa.set(s,{instructionsStart:0,instructionsLength:0});const h=this.wa.get(s);h.instructionsStart=e.instructionSize,o.collectRenderables(e,r,null),o.includeInBuild=!1,r.renderPipes.batch.break(e),e.add({renderPipeId:"stencilMask",action:"pushMaskEnd",mask:t,inverse:i.zi.inverse,canBundle:!1});const a=e.instructionSize-h.instructionsStart-1;h.instructionsLength=a;const u=r.renderTarget.renderTarget.uid;(n=this.xa)[u]??(n[u]=0)}pop(t,i,e){const n=t,s=this.Yn;s.renderPipes.batch.break(e),s.renderPipes.blendMode.setBlendMode(n.mask,"none",e),e.add({renderPipeId:"stencilMask",action:"popMaskBegin",inverse:i.zi.inverse,canBundle:!1});const r=this.wa.get(t);for(let o=0;o<r.instructionsLength;o++)e.instructions[e.instructionSize++]=e.instructions[r.instructionsStart++];e.add({renderPipeId:"stencilMask",action:"popMaskEnd",canBundle:!1})}execute(t){var i;const e=this.Yn,n=e.renderTarget.renderTarget.uid;let s=(i=this.xa)[n]??(i[n]=0);"pushMaskBegin"===t.action?(e.renderTarget.ensureDepthStencil(),e.stencil.setStencilMode(xh.RENDERING_MASK_ADD,s),s++,e.colorMask.setMask(0)):"pushMaskEnd"===t.action?(t.inverse?e.stencil.setStencilMode(xh.INVERSE_MASK_ACTIVE,s):e.stencil.setStencilMode(xh.MASK_ACTIVE,s),e.colorMask.setMask(15)):"popMaskBegin"===t.action?(e.colorMask.setMask(0),0!==s?e.stencil.setStencilMode(xh.RENDERING_MASK_REMOVE,s):(e.renderTarget.clear(null,So.STENCIL),e.stencil.setStencilMode(xh.DISABLED,s)),s--):"popMaskEnd"===t.action&&(t.inverse?e.stencil.setStencilMode(xh.INVERSE_MASK_ACTIVE,s):e.stencil.setStencilMode(xh.MASK_ACTIVE,s),e.colorMask.setMask(15)),this.xa[n]=s}destroy(){this.Yn=null,this.xa=null,this.wa=null}}Bc.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"stencilMask"};var Ic=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(Ic||{});class jc{constructor(t,i){this.Ma=-1,this.Aa=-1,this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.type=i}}class Gc{constructor(t){this.Ta=Object.create(null),this._a=Object.create(null),this.ka=0,this.Ca=this.ka,this.Sa=0,this.Yn=t,this.Yn.renderableGC.addManagedHash(this,"_gpuBuffers")}destroy(){this.Yn=null,this.Pa=null,this.Ta=null,this._a=null}contextChange(){this.Pa=this.Yn.gl,this.Ta=Object.create(null),this.Ea=this.Yn.limits.maxUniformBindings}getGlBuffer(t){return this.Ta[t.uid]||this.createGLBuffer(t)}bind(t){const{Pa:i}=this,e=this.getGlBuffer(t);i.bindBuffer(e.type,e.buffer)}bindBufferBase(t,i){const{Pa:e}=this;this._a[i]!==t&&(this._a[i]=t,t.Ma=i,e.bindBufferBase(e.UNIFORM_BUFFER,i,t.buffer))}nextBindBase(t){this.Sa++,this.ka=0,t&&(this._a[0]=null,this.ka=1,this.Ca<1&&(this.Ca=1))}freeLocationForBufferBase(t){let i=this.getLastBindBaseLocation(t);if(i>=this.ka)return t.Aa=this.Sa,i;let e=0,n=this.Ca;for(;e<2;){n>=this.Ea&&(n=this.ka,e++);const t=this._a[n];if(!t||t.Aa!==this.Sa)break;n++}return i=n,this.Ca=n+1,e>=2?-1:(t.Aa=this.Sa,this._a[i]=null,i)}getLastBindBaseLocation(t){const i=t.Ma;return this._a[i]===t?i:-1}bindBufferRange(t,i,e,n){const{Pa:s}=this;e||(e=0),i||(i=0),this._a[i]=null,s.bindBufferRange(s.UNIFORM_BUFFER,i||0,t.buffer,256*e,n||256)}updateBuffer(t){const{Pa:i}=this,e=this.getGlBuffer(t);if(t.li===e.updateID)return e;e.updateID=t.li,i.bindBuffer(e.type,e.buffer);const n=t.data,s=t.descriptor.usage&Uh.STATIC?i.STATIC_DRAW:i.DYNAMIC_DRAW;return n?e.byteLength>=n.byteLength?i.bufferSubData(e.type,0,n,0,t.Jr/n.BYTES_PER_ELEMENT):(e.byteLength=n.byteLength,i.bufferData(e.type,n,s)):(e.byteLength=t.descriptor.size,i.bufferData(e.type,e.byteLength,s)),e}destroyAll(){const t=this.Pa;for(const i in this.Ta)t.deleteBuffer(this.Ta[i].buffer);this.Ta=Object.create(null)}onBufferDestroy(t,i){const e=this.Ta[t.uid],n=this.Pa;i||n.deleteBuffer(e.buffer),this.Ta[t.uid]=null}createGLBuffer(t){const{Pa:i}=this;let e=Ic.ARRAY_BUFFER;t.descriptor.usage&Uh.INDEX?e=Ic.ELEMENT_ARRAY_BUFFER:t.descriptor.usage&Uh.UNIFORM&&(e=Ic.UNIFORM_BUFFER);const n=new jc(i.createBuffer(),e);return this.Ta[t.uid]=n,t.on("destroy",this.onBufferDestroy,this),n}resetState(){this._a=Object.create(null)}}Gc.extension={type:[ie.WebGLSystem],name:"buffer"};const zc=class t{constructor(t){this.supports={uint32Indices:!0,uniformBufferObject:!0,vertexArrayObject:!0,srgbTextures:!0,nonPowOf2wrapping:!0,msaa:!0,nonPowOf2mipmaps:!0},this.Yn=t,this.extensions=Object.create(null),this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.Yn.gl=t}init(i){i={...t.defaultOptions,...i};let e=this.multiView=i.multiView;if(i.context&&e&&(_n(),e=!1),this.canvas=e?Ms.get().createCanvas(this.Yn.canvas.width,this.Yn.canvas.height):this.Yn.view.canvas,i.context)this.initFromContext(i.context);else{const t=this.Yn.background.alpha<1,e=i.premultipliedAlpha??!0,n=i.antialias&&!this.Yn.backBuffer.useBackBuffer;this.createContext(i.preferWebGLVersion,{alpha:t,premultipliedAlpha:e,antialias:n,stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer,powerPreference:i.powerPreference??"default"})}}ensureCanvasSize(t){if(!this.multiView)return void(t!==this.canvas&&_n());const{canvas:i}=this;(i.width<t.width||i.height<t.height)&&(i.width=Math.max(t.width,t.width),i.height=Math.max(t.height,t.height))}initFromContext(t){this.gl=t,this.webGLVersion=t instanceof Ms.get().getWebGLRenderingContext()?1:2,this.getExtensions(),this.validateContext(t),this.Yn.runners.contextChange.emit(t);const i=this.Yn.view.canvas;i.addEventListener("webglcontextlost",this.handleContextLost,!1),i.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}createContext(t,i){let e;const n=this.canvas;if(2===t&&(e=n.getContext("webgl2",i)),!e&&(e=n.getContext("webgl",i),!e))throw new Error("This browser does not support WebGL. Try using the canvas renderer");this.gl=e,this.initFromContext(this.gl)}getExtensions(){const{gl:t}=this,i={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc"),rgtc:t.getExtension("EXT_texture_compression_rgtc"),loseContext:t.getExtension("WEBGL_lose_context")};if(1===this.webGLVersion)this.extensions={...i,drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear"),vertexAttribDivisorANGLE:t.getExtension("ANGLE_instanced_arrays"),srgb:t.getExtension("EXT_sRGB")};else{this.extensions={...i,colorBufferFloat:t.getExtension("EXT_color_buffer_float")};const e=t.getExtension("WEBGL_provoking_vertex");e&&e.provokingVertexWEBGL(e.FIRST_VERTEX_CONVENTION_WEBGL)}}handleContextLost(t){t.preventDefault(),this.Ra&&(this.Ra=!1,setTimeout(()=>{var t;this.gl.isContextLost()&&(null==(t=this.extensions.loseContext)||t.restoreContext())},0))}handleContextRestored(){this.getExtensions(),this.Yn.runners.contextChange.emit(this.gl)}destroy(){var t;const i=this.Yn.view.canvas;this.Yn=null,i.removeEventListener("webglcontextlost",this.handleContextLost),i.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),null==(t=this.extensions.loseContext)||t.loseContext()}forceContextLoss(){var t;null==(t=this.extensions.loseContext)||t.loseContext(),this.Ra=!0}validateContext(t){const i=t.getContextAttributes();i&&!i.stencil&&_n();const e=this.supports,n=2===this.webGLVersion,s=this.extensions;e.uint32Indices=n||!!s.uint32ElementIndex,e.uniformBufferObject=n,e.vertexArrayObject=n||!!s.vertexArrayObject,e.srgbTextures=n||!!s.srgb,e.nonPowOf2wrapping=n,e.nonPowOf2mipmaps=n,e.msaa=n,e.uint32Indices||_n()}};zc.extension={type:[ie.WebGLSystem],name:"context"},zc.defaultOptions={context:null,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:void 0,preferWebGLVersion:2,multiView:!1};let Dc=zc;function Lc(t,i){for(const e in t.attributes){const n=t.attributes[e],s=i[e];s?(n.format??(n.format=s.format),n.offset??(n.offset=s.offset),n.instance??(n.instance=s.instance)):_n()}!function(t){const{buffers:i,attributes:e}=t,n={},s={};for(const r in i){const t=i[r];n[t.uid]=0,s[t.uid]=0}for(const r in e){const t=e[r];n[t.buffer.uid]+=Fr(t.format).stride}for(const r in e){const t=e[r];t.stride??(t.stride=n[t.buffer.uid]),t.start??(t.start=s[t.buffer.uid]),s[t.buffer.uid]+=Fr(t.format).stride}}(t)}var Nc=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(Nc||{}),Vc=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(Vc||{}),Wc=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(Wc||{});const Hc={uint8x2:Wc.UNSIGNED_BYTE,uint8x4:Wc.UNSIGNED_BYTE,sint8x2:Wc.BYTE,sint8x4:Wc.BYTE,unorm8x2:Wc.UNSIGNED_BYTE,unorm8x4:Wc.UNSIGNED_BYTE,snorm8x2:Wc.BYTE,snorm8x4:Wc.BYTE,uint16x2:Wc.UNSIGNED_SHORT,uint16x4:Wc.UNSIGNED_SHORT,sint16x2:Wc.SHORT,sint16x4:Wc.SHORT,unorm16x2:Wc.UNSIGNED_SHORT,unorm16x4:Wc.UNSIGNED_SHORT,snorm16x2:Wc.SHORT,snorm16x4:Wc.SHORT,float16x2:Wc.HALF_FLOAT,float16x4:Wc.HALF_FLOAT,float32:Wc.FLOAT,float32x2:Wc.FLOAT,float32x3:Wc.FLOAT,float32x4:Wc.FLOAT,uint32:Wc.UNSIGNED_INT,uint32x2:Wc.UNSIGNED_INT,uint32x3:Wc.UNSIGNED_INT,uint32x4:Wc.UNSIGNED_INT,sint32:Wc.INT,sint32x2:Wc.INT,sint32x3:Wc.INT,sint32x4:Wc.INT};function qc(t){return Hc[t]??Hc.float32}const Xc={"point-list":0,"line-list":1,"line-strip":3,"triangle-list":4,"triangle-strip":5};class Yc{constructor(t){this.Fa=Object.create(null),this.Yn=t,this.Oa=null,this.$a=null,this.hasVao=!0,this.hasInstance=!0,this.Yn.renderableGC.addManagedHash(this,"_geometryVaoHash")}contextChange(){const t=this.gl=this.Yn.gl;if(!this.Yn.context.supports.vertexArrayObject)throw new Error("[PixiJS] Vertex Array Objects are not supported on this device");const i=this.Yn.context.extensions.vertexArrayObject;i&&(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=t=>i.bindVertexArrayOES(t),t.deleteVertexArray=t=>i.deleteVertexArrayOES(t));const e=this.Yn.context.extensions.vertexAttribDivisorANGLE;e&&(t.drawArraysInstanced=(t,i,n,s)=>{e.drawArraysInstancedANGLE(t,i,n,s)},t.drawElementsInstanced=(t,i,n,s,r)=>{e.drawElementsInstancedANGLE(t,i,n,s,r)},t.vertexAttribDivisor=(t,i)=>e.vertexAttribDivisorANGLE(t,i)),this.Oa=null,this.$a=null,this.Fa=Object.create(null)}bind(t,i){const e=this.gl;this.Oa=t;const n=this.getVao(t,i);this.$a!==n&&(this.$a=n,e.bindVertexArray(n)),this.updateBuffers()}resetState(){this.unbind()}updateBuffers(){const t=this.Oa,i=this.Yn.buffer;for(let e=0;e<t.buffers.length;e++){const n=t.buffers[e];i.updateBuffer(n)}}checkCompatibility(t,i){const e=t.attributes,n=i.$s;for(const s in n)if(!e[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(t,i){const e=t.attributes,n=i.$s,s=["g",t.uid];for(const r in e)n[r]&&s.push(r,n[r].location);return s.join("-")}getVao(t,i){var e;return(null==(e=this.Fa[t.uid])?void 0:e[i.Os])||this.initGeometryVao(t,i)}initGeometryVao(t,i,e=!0){const n=this.Yn.gl,s=this.Yn.buffer;this.Yn.shader.Ua(i),this.checkCompatibility(t,i);const r=this.getSignature(t,i);this.Fa[t.uid]||(this.Fa[t.uid]=Object.create(null),t.on("destroy",this.onGeometryDestroy,this));const o=this.Fa[t.uid];let h=o[r];if(h)return o[i.Os]=h,h;Lc(t,i.$s);const a=t.buffers;h=n.createVertexArray(),n.bindVertexArray(h);for(let u=0;u<a.length;u++){const t=a[u];s.bind(t)}return this.activateVao(t,i),o[i.Os]=h,o[r]=h,n.bindVertexArray(null),h}onGeometryDestroy(t,i){const e=this.Fa[t.uid],n=this.gl;if(e){if(i)for(const t in e)this.$a!==e[t]&&this.unbind(),n.deleteVertexArray(e[t]);this.Fa[t.uid]=null}}destroyAll(t=!1){const i=this.gl;for(const e in this.Fa){if(t)for(const t in this.Fa[e]){const n=this.Fa[e];this.$a!==n&&this.unbind(),i.deleteVertexArray(n[t])}this.Fa[e]=null}}activateVao(t,i){var e;const n=this.Yn.gl,s=this.Yn.buffer,r=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let o=null;for(const h in r){const t=r[h],a=t.buffer,u=s.getGlBuffer(a),c=i.$s[h];if(c){o!==u&&(s.bind(a),o=u);const i=c.location;n.enableVertexAttribArray(i);const r=Fr(t.format),h=qc(t.format);if("int"===(null==(e=c.format)?void 0:e.substring(1,4))?n.vertexAttribIPointer(i,r.size,h,t.stride,t.offset):n.vertexAttribPointer(i,r.size,h,r.normalised,t.stride,t.offset),t.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");{const e=t.divisor??1;n.vertexAttribDivisor(i,e)}}}}}draw(t,i,e,n){const{gl:s}=this.Yn,r=this.Oa,o=Xc[t||r.topology];if(n??(n=r.instanceCount),r.indexBuffer){const t=r.indexBuffer.data.BYTES_PER_ELEMENT,h=2===t?s.UNSIGNED_SHORT:s.UNSIGNED_INT;n>1?s.drawElementsInstanced(o,i||r.indexBuffer.data.length,h,(e||0)*t,n):s.drawElements(o,i||r.indexBuffer.data.length,h,(e||0)*t)}else n>1?s.drawArraysInstanced(o,e||0,i||r.getSize(),n):s.drawArrays(o,e||0,i||r.getSize());return this}unbind(){this.gl.bindVertexArray(null),this.$a=null,this.Oa=null}destroy(){this.Yn=null,this.gl=null,this.$a=null,this.Oa=null}}Yc.extension={type:[ie.WebGLSystem],name:"geometry"};const Kc=new jh({attributes:{aPosition:[-1,-1,3,-1,-1,3]}}),Qc=class t{constructor(t){this.useBackBuffer=!1,this.Ba=!1,this.Yn=t}init(i={}){const{useBackBuffer:e,antialias:n}={...t.defaultOptions,...i};this.useBackBuffer=e,this.Ia=n,this.Yn.context.supports.msaa||(_n(),this.Ia=!1),this.Qs=Xr.for2d();const s=new Er({vertex:"\n                attribute vec2 aPosition;\n                out vec2 vUv;\n\n                void main() {\n                    gl_Position = vec4(aPosition, 0.0, 1.0);\n\n                    vUv = (aPosition + 1.0) / 2.0;\n\n                    // flip dem UVs\n                    vUv.y = 1.0 - vUv.y;\n                }",fragment:"\n                in vec2 vUv;\n                out vec4 finalColor;\n\n                uniform sampler2D uTexture;\n\n                void main() {\n                    finalColor = texture(uTexture, vUv);\n                }",name:"big-triangle"});this.ja=new Wr({glProgram:s,resources:{uTexture:Ve.WHITE.source}})}renderStart(t){const i=this.Yn.renderTarget.getRenderTarget(t.target);if(this.Ba=this.useBackBuffer&&!!i.isRoot,this.Ba){const i=this.Yn.renderTarget.getRenderTarget(t.target);this.Ga=i.colorTexture,t.target=this.za(i.colorTexture)}}renderEnd(){this.Da()}Da(){const t=this.Yn;t.renderTarget.finishRenderPass(),this.Ba&&(t.renderTarget.bind(this.Ga,!1),this.ja.resources.uTexture=this.La.source,t.encoder.draw({geometry:Kc,shader:this.ja,state:this.Qs}))}za(t){return this.La=this.La||new Ve({source:new ze({width:t.width,height:t.height,resolution:t.si,antialias:this.Ia})}),this.La.source.resize(t.width,t.height,t.si),this.La}destroy(){this.La&&(this.La.destroy(),this.La=null)}};Qc.extension={type:[ie.WebGLSystem],name:"backBuffer",priority:1},Qc.defaultOptions={useBackBuffer:!1};let Zc=Qc;class Jc{constructor(t){this.Na=15,this.Yn=t}setMask(t){this.Na!==t&&(this.Na=t,this.Yn.gl.colorMask(!!(8&t),!!(4&t),!!(2&t),!!(1&t)))}}Jc.extension={type:[ie.WebGLSystem],name:"colorMask"};class tl{constructor(t){this.commandFinished=Promise.resolve(),this.Yn=t}setGeometry(t,i){this.Yn.geometry.bind(t,i.glProgram)}finishRenderPass(){}draw(t){const i=this.Yn,{geometry:e,shader:n,state:s,skipSync:r,topology:o,size:h,start:a,instanceCount:u}=t;i.shader.bind(n,r),i.geometry.bind(e,i.shader.Va),s&&i.state.set(s),i.geometry.draw(o,h,a,u??e.instanceCount)}destroy(){this.Yn=null}}tl.extension={type:[ie.WebGLSystem],name:"encoder"};class il{constructor(t){this.Yn=t}contextChange(){const t=this.Yn.gl;this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxBatchableTextures=Th(this.maxTextures,t),this.maxUniformBindings=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS)}destroy(){}}il.extension={type:[ie.WebGLSystem],name:"limits"};class el{constructor(){this.width=-1,this.height=-1,this.msaa=!1,this.msaaRenderBuffer=[]}}const nl=[];nl[xh.NONE]=void 0,nl[xh.DISABLED]={stencilWriteMask:0,stencilReadMask:0},nl[xh.RENDERING_MASK_ADD]={stencilFront:{compare:"equal",passOp:"increment-clamp"},stencilBack:{compare:"equal",passOp:"increment-clamp"}},nl[xh.RENDERING_MASK_REMOVE]={stencilFront:{compare:"equal",passOp:"decrement-clamp"},stencilBack:{compare:"equal",passOp:"decrement-clamp"}},nl[xh.MASK_ACTIVE]={stencilWriteMask:0,stencilFront:{compare:"equal",passOp:"keep"},stencilBack:{compare:"equal",passOp:"keep"}},nl[xh.INVERSE_MASK_ACTIVE]={stencilWriteMask:0,stencilFront:{compare:"not-equal",passOp:"keep"},stencilBack:{compare:"not-equal",passOp:"keep"}};class sl{constructor(t){this.Wa={enabled:!1,stencilReference:0,stencilMode:xh.NONE},this.Ha=Object.create(null),t.renderTarget.onRenderTargetChange.add(this)}contextChange(t){this.Pa=t,this.qa={always:t.ALWAYS,never:t.NEVER,equal:t.EQUAL,"not-equal":t.NOTEQUAL,less:t.LESS,"less-equal":t.LEQUAL,greater:t.GREATER,"greater-equal":t.GEQUAL},this.Xa={keep:t.KEEP,zero:t.ZERO,replace:t.REPLACE,invert:t.INVERT,"increment-clamp":t.INCR,"decrement-clamp":t.DECR,"increment-wrap":t.INCR_WRAP,"decrement-wrap":t.DECR_WRAP},this.resetState()}onRenderTargetChange(t){if(this.Ya===t)return;this.Ya=t;let i=this.Ha[t.uid];i||(i=this.Ha[t.uid]={stencilMode:xh.DISABLED,stencilReference:0}),this.setStencilMode(i.stencilMode,i.stencilReference)}resetState(){this.Wa.enabled=!1,this.Wa.stencilMode=xh.NONE,this.Wa.stencilReference=0}setStencilMode(t,i){const e=this.Ha[this.Ya.uid],n=this.Pa,s=nl[t],r=this.Wa;e.stencilMode=t,e.stencilReference=i,t!==xh.DISABLED?(this.Wa.enabled||(this.Wa.enabled=!0,n.enable(n.STENCIL_TEST)),t===r.stencilMode&&r.stencilReference===i||(r.stencilMode=t,r.stencilReference=i,n.stencilFunc(this.qa[s.stencilBack.compare],i,255),n.stencilOp(n.KEEP,n.KEEP,this.Xa[s.stencilBack.passOp]))):this.Wa.enabled&&(this.Wa.enabled=!1,n.disable(n.STENCIL_TEST))}}sl.extension={type:[ie.WebGLSystem],name:"stencil"};class rl{constructor(t){this.Ka=Object.create(null),this.da=t,this.Qa()}Qa(){if(!Jr())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}ensureUniformGroup(t){const i=this.getUniformGroupData(t);t.buffer||(t.buffer=new Bh({data:new Float32Array(i.layout.size/4),usage:Uh.UNIFORM|Uh.COPY_DST}))}getUniformGroupData(t){return this.Ka[t.Ds]||this.Za(t)}Za(t){const i=t.Ds;let e=this.Ka[i];if(!e){const n=Object.keys(t.uniformStructures).map(i=>t.uniformStructures[i]),s=this.da.createUboElements(n),r=this.Ja(s.uboElements);e=this.Ka[i]={layout:s,syncFunction:r}}return this.Ka[i]}Ja(t){return this.da.generateUboSync(t)}syncUniformGroup(t,i,e){const n=this.getUniformGroupData(t);t.buffer||(t.buffer=new Bh({data:new Float32Array(n.layout.size/4),usage:Uh.UNIFORM|Uh.COPY_DST}));let s=null;return i||(i=t.buffer.data,s=t.buffer.dataInt32),e||(e=0),n.syncFunction(t.uniforms,i,s,e),!0}updateUniformGroup(t){if(t.isStatic&&!t.zs)return!1;t.zs=0;const i=this.syncUniformGroup(t);return t.buffer.update(),i}destroy(){this.Ka=null}}const ol={f32:4,i32:4,"vec2<f32>":8,"vec3<f32>":12,"vec4<f32>":16,"vec2<i32>":8,"vec3<i32>":12,"vec4<i32>":16,"mat2x2<f32>":32,"mat3x3<f32>":48,"mat4x4<f32>":64};function hl(t){const i=t.map(t=>({data:t,offset:0,size:0}));let e=0,n=0;for(let s=0;s<i.length;s++){const t=i[s];if(e=ol[t.data.type],!e)throw new Error(`Unknown type ${t.data.type}`);t.data.size>1&&(e=Math.max(e,16)*t.data.size);const r=12===e?16:e;t.size=e;const o=n%16;n+=o>0&&16-o<r?(16-o)%16:(e-o%e)%e,t.offset=n,n+=e}return n=16*Math.ceil(n/16),{uboElements:i,size:n}}const al=[{type:"mat3x3<f32>",test:t=>void 0!==t.value.a,ubo:"\n            var matrix = uv[name].toArray(true);\n            data[offset] = matrix[0];\n            data[offset + 1] = matrix[1];\n            data[offset + 2] = matrix[2];\n            data[offset + 4] = matrix[3];\n            data[offset + 5] = matrix[4];\n            data[offset + 6] = matrix[5];\n            data[offset + 8] = matrix[6];\n            data[offset + 9] = matrix[7];\n            data[offset + 10] = matrix[8];\n        ",uniform:"\n            gl.uniformMatrix3fv(ud[name].location, false, uv[name].toArray(true));\n        "},{type:"vec4<f32>",test:t=>"vec4<f32>"===t.type&&1===t.size&&void 0!==t.value.width,ubo:"\n            v = uv[name];\n            data[offset] = v.x;\n            data[offset + 1] = v.y;\n            data[offset + 2] = v.width;\n            data[offset + 3] = v.height;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height) {\n                cv[0] = v.x;\n                cv[1] = v.y;\n                cv[2] = v.width;\n                cv[3] = v.height;\n                gl.uniform4f(ud[name].location, v.x, v.y, v.width, v.height);\n            }\n        "},{type:"vec2<f32>",test:t=>"vec2<f32>"===t.type&&1===t.size&&void 0!==t.value.x,ubo:"\n            v = uv[name];\n            data[offset] = v.x;\n            data[offset + 1] = v.y;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.x || cv[1] !== v.y) {\n                cv[0] = v.x;\n                cv[1] = v.y;\n                gl.uniform2f(ud[name].location, v.x, v.y);\n            }\n        "},{type:"vec4<f32>",test:t=>"vec4<f32>"===t.type&&1===t.size&&void 0!==t.value.red,ubo:"\n            v = uv[name];\n            data[offset] = v.red;\n            data[offset + 1] = v.green;\n            data[offset + 2] = v.blue;\n            data[offset + 3] = v.alpha;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha) {\n                cv[0] = v.red;\n                cv[1] = v.green;\n                cv[2] = v.blue;\n                cv[3] = v.alpha;\n                gl.uniform4f(ud[name].location, v.red, v.green, v.blue, v.alpha);\n            }\n        "},{type:"vec3<f32>",test:t=>"vec3<f32>"===t.type&&1===t.size&&void 0!==t.value.red,ubo:"\n            v = uv[name];\n            data[offset] = v.red;\n            data[offset + 1] = v.green;\n            data[offset + 2] = v.blue;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue) {\n                cv[0] = v.red;\n                cv[1] = v.green;\n                cv[2] = v.blue;\n                gl.uniform3f(ud[name].location, v.red, v.green, v.blue);\n            }\n        "}];function ul(t,i,e,n){const s=["\n        var v = null;\n        var v2 = null;\n        var t = 0;\n        var index = 0;\n        var name = null;\n        var arrayOffset = null;\n    "];let r=0;for(let h=0;h<t.length;h++){const o=t[h],a=o.data.name;let u=!1,c=0;for(let t=0;t<al.length;t++){if(al[t].test(o.data)){c=o.offset/4,s.push(`name = "${a}";`,`offset += ${c-r};`,al[t][i]||al[t].ubo),u=!0;break}}if(!u)if(o.data.size>1)c=o.offset/4,s.push(e(o,c-r));else{const t=n[o.data.type];c=o.offset/4,s.push(`\n                    v = uv.${a};\n                    offset += ${c-r};\n                    ${t};\n                `)}r=c}const o=s.join("\n");return new Function("uv","data","dataInt32","offset",o)}function cl(t,i){return`\n        for (let i = 0; i < ${t*i}; i++) {\n            data[offset + (((i / ${t})|0) * 4) + (i % ${t})] = v[i];\n        }\n    `}const ll={f32:"\n        data[offset] = v;",i32:"\n        dataInt32[offset] = v;","vec2<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];","vec3<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];","vec4<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];\n        data[offset + 3] = v[3];","vec2<i32>":"\n        dataInt32[offset] = v[0];\n        dataInt32[offset + 1] = v[1];","vec3<i32>":"\n        dataInt32[offset] = v[0];\n        dataInt32[offset + 1] = v[1];\n        dataInt32[offset + 2] = v[2];","vec4<i32>":"\n        dataInt32[offset] = v[0];\n        dataInt32[offset + 1] = v[1];\n        dataInt32[offset + 2] = v[2];\n        dataInt32[offset + 3] = v[3];","mat2x2<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 4] = v[2];\n        data[offset + 5] = v[3];","mat3x3<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];","mat4x4<f32>":"\n        for (let i = 0; i < 16; i++) {\n            data[offset + i] = v[i];\n        }","mat3x2<f32>":cl(3,2),"mat4x2<f32>":cl(4,2),"mat2x3<f32>":cl(2,3),"mat4x3<f32>":cl(4,3),"mat2x4<f32>":cl(2,4),"mat3x4<f32>":cl(3,4)},fl={...ll,"mat2x2<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];\n        data[offset + 3] = v[3];\n    "};function dl(t,i){const e=Math.max(ol[t.data.type]/16,1),n=t.data.value.length/t.data.size,s=(4-n%4)%4,r=t.data.type.indexOf("i32")>=0?"dataInt32":"data";return`\n        v = uv.${t.data.name};\n        offset += ${i};\n\n        arrayOffset = offset;\n\n        t = 0;\n\n        for(var i=0; i < ${t.data.size*e}; i++)\n        {\n            for(var j = 0; j < ${n}; j++)\n            {\n                ${r}[arrayOffset++] = v[t++];\n            }\n            ${0!==s?`arrayOffset += ${s};`:""}\n        }\n    `}function pl(t){return ul(t,"uboStd40",dl,ll)}class vl extends rl{constructor(){super({createUboElements:hl,generateUboSync:pl})}}vl.extension={type:[ie.WebGLSystem],name:"ubo"};class ml{constructor(){this.tu=[0,0,0,0],this.iu=new Ce}init(t,i){this.Yn=t,this.eu=i,t.runners.contextChange.add(this)}contextChange(){this.tu=[0,0,0,0],this.iu=new Ce}copyToTexture(t,i,e,n,s){const r=this.eu,o=this.Yn,h=r.getGpuRenderTarget(t),a=o.gl;return this.finishRenderPass(t),a.bindFramebuffer(a.FRAMEBUFFER,h.resolveTargetFramebuffer),o.texture.bind(i,0),a.copyTexSubImage2D(a.TEXTURE_2D,0,s.x,s.y,e.x,e.y,n.width,n.height),i}startRenderPass(t,i=!0,e,n){const s=this.eu,r=t.colorTexture,o=s.getGpuRenderTarget(t);let h=n.y;t.isRoot&&(h=r.pixelHeight-n.height),t.colorTextures.forEach(t=>{this.Yn.texture.unbind(t)});const a=this.Yn.gl;a.bindFramebuffer(a.FRAMEBUFFER,o.framebuffer);const u=this.iu;u.x===n.x&&u.y===h&&u.width===n.width&&u.height===n.height||(u.x=n.x,u.y=h,u.width=n.width,u.height=n.height,a.viewport(n.x,h,n.width,n.height)),o.depthStencilRenderBuffer||!t.stencil&&!t.depth||this.nu(o),this.clear(t,i,e)}finishRenderPass(t){const i=this.eu.getGpuRenderTarget(t);if(!i.msaa)return;const e=this.Yn.gl;e.bindFramebuffer(e.FRAMEBUFFER,i.resolveTargetFramebuffer),e.bindFramebuffer(e.READ_FRAMEBUFFER,i.framebuffer),e.blitFramebuffer(0,0,i.width,i.height,0,0,i.width,i.height,e.COLOR_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(e.FRAMEBUFFER,i.framebuffer)}initGpuRenderTarget(t){const i=this.Yn.gl,e=new el;return t.colorTexture instanceof As?(this.Yn.context.ensureCanvasSize(t.colorTexture.resource),e.framebuffer=null,e):(this.su(t,e),i.bindFramebuffer(i.FRAMEBUFFER,null),e)}destroyGpuRenderTarget(t){const i=this.Yn.gl;t.framebuffer&&(i.deleteFramebuffer(t.framebuffer),t.framebuffer=null),t.resolveTargetFramebuffer&&(i.deleteFramebuffer(t.resolveTargetFramebuffer),t.resolveTargetFramebuffer=null),t.depthStencilRenderBuffer&&(i.deleteRenderbuffer(t.depthStencilRenderBuffer),t.depthStencilRenderBuffer=null),t.msaaRenderBuffer.forEach(t=>{i.deleteRenderbuffer(t)}),t.msaaRenderBuffer=null}clear(t,i,e){if(!i)return;const n=this.eu;"boolean"==typeof i&&(i=i?So.ALL:So.NONE);const s=this.Yn.gl;if(i&So.COLOR){e??(e=n.defaultClearColor);const t=this.tu,i=e;t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]&&t[3]===i[3]||(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],s.clearColor(i[0],i[1],i[2],i[3]))}s.clear(i)}resizeGpuRenderTarget(t){if(t.isRoot)return;const i=this.eu.getGpuRenderTarget(t);this.ru(t,i),(t.stencil||t.depth)&&this.ou(i)}su(t,i){const e=this.Yn,n=e.gl,s=n.createFramebuffer();if(i.resolveTargetFramebuffer=s,n.bindFramebuffer(n.FRAMEBUFFER,s),i.width=t.colorTexture.source.pixelWidth,i.height=t.colorTexture.source.pixelHeight,t.colorTextures.forEach((t,s)=>{const r=t.source;r.antialias&&(e.context.supports.msaa?i.msaa=!0:_n()),e.texture.bindSource(r,0);const o=e.texture.getGlSource(r).texture;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+s,3553,o,0)}),i.msaa){const e=n.createFramebuffer();i.framebuffer=e,n.bindFramebuffer(n.FRAMEBUFFER,e),t.colorTextures.forEach((t,e)=>{const s=n.createRenderbuffer();i.msaaRenderBuffer[e]=s})}else i.framebuffer=s;this.ru(t,i)}ru(t,i){const e=t.colorTexture.source;if(i.width=e.pixelWidth,i.height=e.pixelHeight,t.colorTextures.forEach((t,i)=>{0!==i&&t.source.resize(e.width,e.height,e.si)}),i.msaa){const e=this.Yn,n=e.gl,s=i.framebuffer;n.bindFramebuffer(n.FRAMEBUFFER,s),t.colorTextures.forEach((t,s)=>{const r=t.source;e.texture.bindSource(r,0);const o=e.texture.getGlSource(r).internalFormat,h=i.msaaRenderBuffer[s];n.bindRenderbuffer(n.RENDERBUFFER,h),n.renderbufferStorageMultisample(n.RENDERBUFFER,4,o,r.pixelWidth,r.pixelHeight),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+s,n.RENDERBUFFER,h)})}}nu(t){if(null===t.framebuffer)return;const i=this.Yn.gl,e=i.createRenderbuffer();t.depthStencilRenderBuffer=e,i.bindRenderbuffer(i.RENDERBUFFER,e),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e),this.ou(t)}ou(t){const i=this.Yn.gl;i.bindRenderbuffer(i.RENDERBUFFER,t.depthStencilRenderBuffer),t.msaa?i.renderbufferStorageMultisample(i.RENDERBUFFER,4,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,2===this.Yn.context.webGLVersion?i.DEPTH24_STENCIL8:i.DEPTH_STENCIL,t.width,t.height)}prerender(t){const i=t.colorTexture.resource;this.Yn.context.multiView&&As.test(i)&&this.Yn.context.ensureCanvasSize(i)}postrender(t){if(this.Yn.context.multiView&&As.test(t.colorTexture.resource)){const i=this.Yn.context.canvas,e=t.colorTexture;e.context2D.drawImage(i,0,e.pixelHeight-i.height)}}}const gl=new Map;function bl(t,i){if(!gl.has(t)){const e=new Ve({source:new As({resource:t,...i})}),n=()=>{gl.get(t)===e&&gl.delete(t)};e.once("destroy",n),e.source.once("destroy",n),gl.set(t,e)}return gl.get(t)}const yl=class t{constructor(i={}){if(this.uid=Pe("renderTarget"),this.colorTextures=[],this.dirtyId=0,this.isRoot=!1,this.hu=new Float32Array(2),this.au=!1,i={...t.defaultOptions,...i},this.stencil=i.stencil,this.depth=i.depth,this.isRoot=i.isRoot,"number"==typeof i.colorTextures){this.au=!0;for(let t=0;t<i.colorTextures;t++)this.colorTextures.push(new ze({width:i.width,height:i.height,resolution:i.resolution,antialias:i.antialias}))}else{this.colorTextures=[...i.colorTextures.map(t=>t.source)];const t=this.colorTexture.source;this.resize(t.width,t.height,t.si)}this.colorTexture.source.on("resize",this.onSourceResize,this),(i.depthStencilTexture||this.stencil)&&(i.depthStencilTexture instanceof Ve||i.depthStencilTexture instanceof ze?this.depthStencilTexture=i.depthStencilTexture.source:this.ensureDepthStencilTexture())}get size(){const t=this.hu;return t[0]=this.pixelWidth,t[1]=this.pixelHeight,t}get width(){return this.colorTexture.source.width}get height(){return this.colorTexture.source.height}get pixelWidth(){return this.colorTexture.source.pixelWidth}get pixelHeight(){return this.colorTexture.source.pixelHeight}get resolution(){return this.colorTexture.source.si}get colorTexture(){return this.colorTextures[0]}onSourceResize(t){this.resize(t.width,t.height,t.si,!0)}ensureDepthStencilTexture(){this.depthStencilTexture||(this.depthStencilTexture=new ze({width:this.width,height:this.height,resolution:this.resolution,format:"depth24plus-stencil8",autoGenerateMipmaps:!1,antialias:!1,mipLevelCount:1}))}resize(t,i,e=this.resolution,n=!1){this.dirtyId++,this.colorTextures.forEach((s,r)=>{n&&0===r||s.source.resize(t,i,e)}),this.depthStencilTexture&&this.depthStencilTexture.source.resize(t,i,e)}destroy(){this.colorTexture.source.off("resize",this.onSourceResize,this),this.au&&this.colorTextures.forEach(t=>{t.destroy()}),this.depthStencilTexture&&(this.depthStencilTexture.destroy(),delete this.depthStencilTexture)}};yl.defaultOptions={width:0,height:0,resolution:1,colorTextures:1,stencil:!1,depth:!1,antialias:!1,isRoot:!1};let xl=yl;class wl{constructor(t){this.rootViewPort=new Ce,this.viewport=new Ce,this.onRenderTargetChange=new Po("onRenderTargetChange"),this.projectionMatrix=new ve,this.defaultClearColor=[0,0,0,0],this.uu=new Map,this.cu=Object.create(null),this.lu=[],this.Yn=t,t.renderableGC.addManagedHash(this,"_gpuRenderTargetHash")}finishRenderPass(){this.adaptor.finishRenderPass(this.renderTarget)}renderStart({target:t,clear:i,clearColor:e,frame:n}){var s,r;this.lu.length=0,this.push(t,i,e,n),this.rootViewPort.copyFrom(this.viewport),this.rootRenderTarget=this.renderTarget,this.renderingToScreen=function(t){const i=t.colorTexture.source.resource;return globalThis.HTMLCanvasElement&&i instanceof HTMLCanvasElement&&document.body.contains(i)}(this.rootRenderTarget),null==(r=(s=this.adaptor).prerender)||r.call(s,this.rootRenderTarget)}postrender(){var t,i;null==(i=(t=this.adaptor).postrender)||i.call(t,this.rootRenderTarget)}bind(t,i=!0,e,n){const s=this.getRenderTarget(t),r=this.renderTarget!==s;this.renderTarget=s,this.renderSurface=t;const o=this.getGpuRenderTarget(s);s.pixelWidth===o.width&&s.pixelHeight===o.height||(this.adaptor.resizeGpuRenderTarget(s),o.width=s.pixelWidth,o.height=s.pixelHeight);const h=s.colorTexture,a=this.viewport,u=h.pixelWidth,c=h.pixelHeight;if(!n&&t instanceof Ve&&(n=t.frame),n){const t=h.si;a.x=n.x*t+.5|0,a.y=n.y*t+.5|0,a.width=n.width*t+.5|0,a.height=n.height*t+.5|0}else a.x=0,a.y=0,a.width=u,a.height=c;return function(t,i,e,n,s,r){const o=r?1:-1;t.identity(),t.a=1/n*2,t.d=o*(1/s*2),t.tx=-1-i*t.a,t.ty=-o-e*t.d}(this.projectionMatrix,0,0,a.width/h.resolution,a.height/h.resolution,!s.isRoot),this.adaptor.startRenderPass(s,i,e,a),r&&this.onRenderTargetChange.emit(s),s}clear(t,i=So.ALL,e){i&&(t&&(t=this.getRenderTarget(t)),this.adaptor.clear(t||this.renderTarget,i,e,this.viewport))}contextChange(){this.cu=Object.create(null)}push(t,i=So.ALL,e,n){const s=this.bind(t,i,e,n);return this.lu.push({renderTarget:s,frame:n}),s}pop(){this.lu.pop();const t=this.lu[this.lu.length-1];this.bind(t.renderTarget,!1,null,t.frame)}getRenderTarget(t){return t.isTexture&&(t=t.source),this.uu.get(t)??this.fu(t)}copyToTexture(t,i,e,n,s){e.x<0&&(n.width+=e.x,s.x-=e.x,e.x=0),e.y<0&&(n.height+=e.y,s.y-=e.y,e.y=0);const{pixelWidth:r,pixelHeight:o}=t;return n.width=Math.min(n.width,r-e.x),n.height=Math.min(n.height,o-e.y),this.adaptor.copyToTexture(t,i,e,n,s)}ensureDepthStencil(){this.renderTarget.stencil||(this.renderTarget.stencil=!0,this.adaptor.startRenderPass(this.renderTarget,!1,null,this.viewport))}destroy(){this.Yn=null,this.uu.forEach((t,i)=>{t!==i&&t.destroy()}),this.uu.clear(),this.cu=Object.create(null)}fu(t){let i=null;return As.test(t)&&(t=bl(t).source),t instanceof xl?i=t:t instanceof ze&&(i=new xl({colorTextures:[t]}),t.source instanceof As&&(i.isRoot=!0),t.once("destroy",()=>{i.destroy(),this.uu.delete(t);const e=this.cu[i.uid];e&&(this.cu[i.uid]=null,this.adaptor.destroyGpuRenderTarget(e))})),this.uu.set(t,i),i}getGpuRenderTarget(t){return this.cu[t.uid]||(this.cu[t.uid]=this.adaptor.initGpuRenderTarget(t))}resetState(){this.renderTarget=null,this.renderSurface=null}}class Ml extends wl{constructor(t){super(t),this.adaptor=new ml,this.adaptor.init(t,this)}}Ml.extension={type:[ie.WebGLSystem],name:"renderTarget"};class Al extends ue{constructor({buffer:t,offset:i,size:e}){super(),this.uid=Pe("buffer"),this.Zt="bufferResource",this.Jt=0,this.ii=Pe("resource"),this.du=!0,this.destroyed=!1,this.buffer=t,this.offset=0|i,this.size=e,this.buffer.on("change",this.onBufferChange,this)}onBufferChange(){this.ii=Pe("resource"),this.emit("change",this)}destroy(t=!1){this.destroyed=!0,t&&this.buffer.destroy(),this.emit("change",this),this.buffer=null}}class Tl{constructor(t,i){this.program=t,this.uniformData=i,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBlockBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBlockBindings=null,this.program=null}}function _l(t,i,e){const n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),n}function kl(t){const i=new Array(t);for(let e=0;e<i.length;e++)i[e]=!1;return i}function Cl(t,i){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*i);case"vec3":return new Float32Array(3*i);case"vec4":return new Float32Array(4*i);case"ivec2":return new Int32Array(2*i);case"ivec3":return new Int32Array(3*i);case"ivec4":return new Int32Array(4*i);case"uvec2":return new Uint32Array(2*i);case"uvec3":return new Uint32Array(3*i);case"uvec4":return new Uint32Array(4*i);case"bool":return!1;case"bvec2":return kl(2*i);case"bvec3":return kl(3*i);case"bvec4":return kl(4*i);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}let Sl=null;const Pl={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"},El={float:"float32",vec2:"float32x2",vec3:"float32x3",vec4:"float32x4",int:"sint32",ivec2:"sint32x2",ivec3:"sint32x3",ivec4:"sint32x4",uint:"uint32",uvec2:"uint32x2",uvec3:"uint32x3",uvec4:"uint32x4",bool:"uint32",bvec2:"uint32x2",bvec3:"uint32x3",bvec4:"uint32x4"};function Rl(t,i){if(!Sl){const i=Object.keys(Pl);Sl={};for(let e=0;e<i.length;++e){const n=i[e];Sl[t[n]]=Pl[n]}}return Sl[i]}function Fl(t,i){const e=Rl(t,i);return El[e]||"float32"}function Ol(t,i){const e=t.getShaderSource(i).split("\n").map((t,i)=>`${i}: ${t}`),n=t.getShaderInfoLog(i).split("\n"),s={},r=n.map(t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(t=>!(!t||s[t])&&(s[t]=!0,!0)),o=[""];r.forEach(t=>{e[t-1]=`%c${e[t-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=e.join("\n");o[0]=h}function $l(t,i){const e=_l(t,t.VERTEX_SHADER,i.vertex),n=_l(t,t.FRAGMENT_SHADER,i.fragment),s=t.createProgram();t.attachShader(s,e),t.attachShader(s,n);const r=i.transformFeedbackVaryings;r&&("function"!=typeof t.transformFeedbackVaryings?_n():t.transformFeedbackVaryings(s,r.names,"separate"===r.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||function(t,i,e,n){t.getProgramParameter(i,t.LINK_STATUS)||(t.getShaderParameter(e,t.COMPILE_STATUS)||Ol(t,e),t.getShaderParameter(n,t.COMPILE_STATUS)||Ol(t,n),t.getProgramInfoLog(i))}(t,s,e,n),i.$s=function(t,i,e=!1){const n={},s=i.getProgramParameter(t,i.ACTIVE_ATTRIBUTES);for(let o=0;o<s;o++){const e=i.getActiveAttrib(t,o);if(e.name.startsWith("gl_"))continue;const s=Fl(i,e.type);n[e.name]={location:0,format:s,stride:Fr(s).stride,offset:0,instance:!1,start:0}}const r=Object.keys(n);if(e){r.sort((t,i)=>t>i?1:-1);for(let e=0;e<r.length;e++)n[r[e]].location=e,i.bindAttribLocation(t,e,r[e]);i.linkProgram(t)}else for(let o=0;o<r.length;o++)n[r[o]].location=i.getAttribLocation(t,r[o]);return n}(s,t,!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(i.vertex)),i.Us=function(t,i){const e={},n=i.getProgramParameter(t,i.ACTIVE_UNIFORMS);for(let s=0;s<n;s++){const n=i.getActiveUniform(t,s),r=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),h=Rl(i,n.type);e[r]={name:r,index:s,type:h,size:n.size,isArray:o,value:Cl(h,n.size)}}return e}(s,t),i.Bs=function(t,i){if(!i.ACTIVE_UNIFORM_BLOCKS)return{};const e={},n=i.getProgramParameter(t,i.ACTIVE_UNIFORM_BLOCKS);for(let s=0;s<n;s++){const n=i.getActiveUniformBlockName(t,s),r=i.getUniformBlockIndex(t,n),o=i.getActiveUniformBlockParameter(t,s,i.UNIFORM_BLOCK_DATA_SIZE);e[n]={name:n,index:r,size:o}}return e}(s,t),t.deleteShader(e),t.deleteShader(n);const o={};for(const h in i.Us){const e=i.Us[h];o[h]={location:t.getUniformLocation(s,h),value:Cl(e.type,e.size)}}return new Tl(s,o)}const Ul={textureCount:0,blockIndex:0};class Bl{constructor(t){this.Va=null,this.pu=Object.create(null),this.vu=Object.create(null),this.Yn=t,this.Yn.renderableGC.addManagedHash(this,"_programDataHash")}contextChange(t){this.Pa=t,this.pu=Object.create(null),this.vu=Object.create(null),this.Va=null}bind(t,i){if(this.gu(t.glProgram),i)return;Ul.textureCount=0,Ul.blockIndex=0;let e=this.vu[t.glProgram.Os];e||(e=this.vu[t.glProgram.Os]=this.bu(t,this)),this.Yn.buffer.nextBindBase(!!t.glProgram.transformFeedbackVaryings),e(this.Yn,t,Ul)}updateUniformGroup(t){this.Yn.uniformGroup.updateUniformGroup(t,this.Va,Ul)}bindUniformBlock(t,i,e=0){const n=this.Yn.buffer,s=this.Ua(this.Va),r=t.du;r||this.Yn.ubo.updateUniformGroup(t);const o=t.buffer,h=n.updateBuffer(o),a=n.freeLocationForBufferBase(h);if(r){const{offset:i,size:e}=t;0===i&&e===o.data.byteLength?n.bindBufferBase(h,a):n.bindBufferRange(h,a,i)}else n.getLastBindBaseLocation(h)!==a&&n.bindBufferBase(h,a);const u=this.Va.Bs[i].index;s.uniformBlockBindings[e]!==a&&(s.uniformBlockBindings[e]=a,this.Yn.gl.uniformBlockBinding(s.program,u,a))}gu(t){if(this.Va===t)return;this.Va=t;const i=this.Ua(t);this.Pa.useProgram(i.program)}Ua(t){return this.pu[t.Os]||this.yu(t)}yu(t){const i=t.Os;return this.pu[i]=$l(this.Pa,t),this.pu[i]}destroy(){for(const t of Object.keys(this.pu)){this.pu[t].destroy(),this.pu[t]=null}this.pu=null}bu(t,i){return function(t,i){const e=[],n=["\n        var g = s.groups;\n        var sS = r.shader;\n        var p = s.glProgram;\n        var ugS = r.uniformGroup;\n        var resources;\n    "];let s=!1,r=0;const o=i.Ua(t.glProgram);for(const a in t.groups){const h=t.groups[a];e.push(`\n            resources = g[${a}].resources;\n        `);for(const u in h.resources){const c=h.resources[u];if(c instanceof Lr)if(c.ubo){const i=t.Ws[a][Number(u)];e.push(`\n                        sS.bindUniformBlock(\n                            resources[${u}],\n                            '${i}',\n                            ${t.glProgram.Bs[i].index}\n                        );\n                    `)}else e.push(`\n                        ugS.updateUniformGroup(resources[${u}], p, sD);\n                    `);else if(c instanceof Al){const i=t.Ws[a][Number(u)];e.push(`\n                    sS.bindUniformBlock(\n                        resources[${u}],\n                        '${i}',\n                        ${t.glProgram.Bs[i].index}\n                    );\n                `)}else if(c instanceof ze){const h=t.Ws[a][u],c=o.uniformData[h];c&&(s||(s=!0,n.push("\n                        var tS = r.texture;\n                        ")),i.Pa.uniform1i(c.location,r),e.push(`\n                        tS.bind(resources[${u}], ${r});\n                    `),r++)}}}const h=[...n,...e].join("\n");return new Function("r","s","sD",h)}(t,i)}resetState(){this.Va=null}}Bl.extension={type:[ie.WebGLSystem],name:"shader"};const Il={f32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1f(location, v);\n        }","vec2<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2f(location, v[0], v[1]);\n        }","vec3<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3f(location, v[0], v[1], v[2]);\n        }","vec4<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n        }",i32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1i(location, v);\n        }","vec2<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2i(location, v[0], v[1]);\n        }","vec3<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3i(location, v[0], v[1], v[2]);\n        }","vec4<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n        }",u32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1ui(location, v);\n        }","vec2<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2ui(location, v[0], v[1]);\n        }","vec3<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3ui(location, v[0], v[1], v[2]);\n        }","vec4<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n        }",bool:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1i(location, v);\n        }","vec2<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2i(location, v[0], v[1]);\n        }","vec3<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3i(location, v[0], v[1], v[2]);\n        }","vec4<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n        }","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);"},jl={f32:"gl.uniform1fv(location, v);","vec2<f32>":"gl.uniform2fv(location, v);","vec3<f32>":"gl.uniform3fv(location, v);","vec4<f32>":"gl.uniform4fv(location, v);","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);",i32:"gl.uniform1iv(location, v);","vec2<i32>":"gl.uniform2iv(location, v);","vec3<i32>":"gl.uniform3iv(location, v);","vec4<i32>":"gl.uniform4iv(location, v);",u32:"gl.uniform1iv(location, v);","vec2<u32>":"gl.uniform2iv(location, v);","vec3<u32>":"gl.uniform3iv(location, v);","vec4<u32>":"gl.uniform4iv(location, v);",bool:"gl.uniform1iv(location, v);","vec2<bool>":"gl.uniform2iv(location, v);","vec3<bool>":"gl.uniform3iv(location, v);","vec4<bool>":"gl.uniform4iv(location, v);"};class Gl{constructor(t){this.yn={},this.xu={},this.Yn=t,this.gl=null,this.yn={}}contextChange(t){this.gl=t}updateUniformGroup(t,i,e){const n=this.Yn.shader.Ua(i);if(!t.isStatic||t.zs!==n.uniformDirtyGroups[t.uid]){n.uniformDirtyGroups[t.uid]=t.zs;this.wu(t,i)(n.uniformData,t.uniforms,this.Yn,e)}}wu(t,i){var e;return(null==(e=this.xu[t.Ds])?void 0:e[i.Os])||this.Mu(t,i)}Mu(t,i){const e=this.xu[t.Ds]||(this.xu[t.Ds]={}),n=this.Au(t,i.Us,"u");return this.yn[n]||(this.yn[n]=this.Tu(t,i.Us)),e[i.Os]=this.yn[n],e[i.Os]}Tu(t,i){return function(t,i){const e=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n        var name = null;\n    "];for(const n in t.uniforms){if(!i[n]){t.uniforms[n]instanceof Lr?t.uniforms[n].ubo?e.push(`\n                        renderer.shader.bindUniformBlock(uv.${n}, "${n}");\n                    `):e.push(`\n                        renderer.shader.updateUniformGroup(uv.${n});\n                    `):t.uniforms[n]instanceof Al&&e.push(`\n                        renderer.shader.bindBufferResource(uv.${n}, "${n}");\n                    `);continue}const s=t.uniformStructures[n];let r=!1;for(let t=0;t<al.length;t++){const i=al[t];if(s.type===i.type&&i.test(s)){e.push(`name = "${n}";`,al[t].uniform),r=!0;break}}if(!r){const t=(1===s.size?Il:jl)[s.type].replace("location",`ud["${n}"].location`);e.push(`\n            cu = ud["${n}"];\n            cv = cu.value;\n            v = uv["${n}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",e.join("\n"))}(t,i)}Au(t,i,e){const n=t.uniforms,s=[`${e}-`];for(const r in n)s.push(r),i[r]&&s.push(i[r].type);return s.join("-")}destroy(){this.Yn=null,this.yn=null}}Gl.extension={type:[ie.WebGLSystem],name:"uniformGroup"};const zl=class t{constructor(t){this._u=!1,this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode="none",this.ku=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=Xr.for2d(),t.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(t){this._u=!t.isRoot,this.Cu?this.setFrontFace(this.Su):this.Pu=!0}contextChange(t){this.gl=t,this.blendModesMap=function(t){const i={};if(i.normal=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i.add=[t.ONE,t.ONE],i.multiply=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],i.screen=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],i.none=[0,0],i["normal-npm"]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],i["add-npm"]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],i["screen-npm"]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],i.erase=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],t instanceof Ms.get().getWebGLRenderingContext()){const e=t.getExtension("EXT_blend_minmax");e&&(i.min=[t.ONE,t.ONE,t.ONE,t.ONE,e.MIN_EXT,e.MIN_EXT],i.max=[t.ONE,t.ONE,t.ONE,t.ONE,e.MAX_EXT,e.MAX_EXT])}else i.min=[t.ONE,t.ONE,t.ONE,t.ONE,t.MIN,t.MIN],i.max=[t.ONE,t.ONE,t.ONE,t.ONE,t.MAX,t.MAX];return i}(t),this.resetState()}set(t){if(t||(t=this.defaultState),this.stateId!==t.data){let i=this.stateId^t.data,e=0;for(;i;)1&i&&this.map[e].call(this,!!(t.data&1<<e)),i>>=1,e++;this.stateId=t.data}for(let i=0;i<this.checks.length;i++)this.checks[i](this,t)}forceState(t){t||(t=this.defaultState);for(let i=0;i<this.map.length;i++)this.map[i].call(this,!!(t.data&1<<i));for(let i=0;i<this.checks.length;i++)this.checks[i](this,t);this.stateId=t.data}setBlend(i){this.Eu(t.Ru,i),this.gl[i?"enable":"disable"](this.gl.BLEND)}setOffset(i){this.Eu(t.Fu,i),this.gl[i?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.Cu=t,this.gl[t?"enable":"disable"](this.gl.CULL_FACE),this.Cu&&this.Pu&&this.setFrontFace(this.Su)}setFrontFace(t){this.Su=t,this.Pu=!1;const i=this._u?!t:t;this.Ou!==i&&(this.Ou=i,this.gl.frontFace(this.gl[i?"CW":"CCW"]))}setBlendMode(t){if(this.blendModesMap[t]||(t="normal"),t===this.blendMode)return;this.blendMode=t;const i=this.blendModesMap[t],e=this.gl;2===i.length?e.blendFunc(i[0],i[1]):e.blendFuncSeparate(i[0],i[1],i[2],i[3]),6===i.length?(this.ku=!0,e.blendEquationSeparate(i[4],i[5])):this.ku&&(this.ku=!1,e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD))}setPolygonOffset(t,i){this.gl.polygonOffset(t,i)}resetState(){this.Ou=!1,this.Su=!1,this.Cu=!1,this.Pu=!1,this._u=!1,this.gl.frontFace(this.gl.CCW),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this.ku=!0,this.blendMode="",this.setBlendMode("normal")}Eu(t,i){const e=this.checks.indexOf(t);i&&-1===e?this.checks.push(t):i||-1===e||this.checks.splice(e,1)}static Ru(t,i){t.setBlendMode(i.blendMode)}static Fu(t,i){t.setPolygonOffset(1,i.polygonOffset)}destroy(){this.gl=null,this.checks.length=0}};zl.extension={type:[ie.WebGLSystem],name:"state"};let Dl=zl;class Ll{constructor(t){this.target=Vc.TEXTURE_2D,this.texture=t,this.width=-1,this.height=-1,this.type=Wc.UNSIGNED_BYTE,this.internalFormat=Nc.RGBA,this.format=Nc.RGBA,this.samplerType=0}}const Nl={id:"buffer",upload(t,i,e){i.width===t.width||i.height===t.height?e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.width,t.height,i.format,i.type,t.resource):e.texImage2D(i.target,0,i.internalFormat,t.width,t.height,0,i.format,i.type,t.resource),i.width=t.width,i.height=t.height}},Vl={"bc1-rgba-unorm":!0,"bc1-rgba-unorm-srgb":!0,"bc2-rgba-unorm":!0,"bc2-rgba-unorm-srgb":!0,"bc3-rgba-unorm":!0,"bc3-rgba-unorm-srgb":!0,"bc4-r-unorm":!0,"bc4-r-snorm":!0,"bc5-rg-unorm":!0,"bc5-rg-snorm":!0,"bc6h-rgb-ufloat":!0,"bc6h-rgb-float":!0,"bc7-rgba-unorm":!0,"bc7-rgba-unorm-srgb":!0,"etc2-rgb8unorm":!0,"etc2-rgb8unorm-srgb":!0,"etc2-rgb8a1unorm":!0,"etc2-rgb8a1unorm-srgb":!0,"etc2-rgba8unorm":!0,"etc2-rgba8unorm-srgb":!0,"eac-r11unorm":!0,"eac-r11snorm":!0,"eac-rg11unorm":!0,"eac-rg11snorm":!0,"astc-4x4-unorm":!0,"astc-4x4-unorm-srgb":!0,"astc-5x4-unorm":!0,"astc-5x4-unorm-srgb":!0,"astc-5x5-unorm":!0,"astc-5x5-unorm-srgb":!0,"astc-6x5-unorm":!0,"astc-6x5-unorm-srgb":!0,"astc-6x6-unorm":!0,"astc-6x6-unorm-srgb":!0,"astc-8x5-unorm":!0,"astc-8x5-unorm-srgb":!0,"astc-8x6-unorm":!0,"astc-8x6-unorm-srgb":!0,"astc-8x8-unorm":!0,"astc-8x8-unorm-srgb":!0,"astc-10x5-unorm":!0,"astc-10x5-unorm-srgb":!0,"astc-10x6-unorm":!0,"astc-10x6-unorm-srgb":!0,"astc-10x8-unorm":!0,"astc-10x8-unorm-srgb":!0,"astc-10x10-unorm":!0,"astc-10x10-unorm-srgb":!0,"astc-12x10-unorm":!0,"astc-12x10-unorm-srgb":!0,"astc-12x12-unorm":!0,"astc-12x12-unorm-srgb":!0},Wl={id:"compressed",upload(t,i,e){e.pixelStorei(e.UNPACK_ALIGNMENT,4);let n=t.pixelWidth,s=t.pixelHeight;const r=!!Vl[t.format];for(let o=0;o<t.resource.length;o++){const h=t.resource[o];r?e.compressedTexImage2D(e.TEXTURE_2D,o,i.internalFormat,n,s,0,h):e.texImage2D(e.TEXTURE_2D,o,i.internalFormat,n,s,0,i.format,i.type,h),n=Math.max(n>>1,1),s=Math.max(s>>1,1)}}},Hl={id:"image",upload(t,i,e,n){const s=i.width,r=i.height,o=t.pixelWidth,h=t.pixelHeight,a=t.resourceWidth,u=t.resourceHeight;a<o||u<h?(s===o&&r===h||e.texImage2D(i.target,0,i.internalFormat,o,h,0,i.format,i.type,null),2===n?e.texSubImage2D(e.TEXTURE_2D,0,0,0,a,u,i.format,i.type,t.resource):e.texSubImage2D(e.TEXTURE_2D,0,0,0,i.format,i.type,t.resource)):s===o&&r===h?e.texSubImage2D(e.TEXTURE_2D,0,0,0,i.format,i.type,t.resource):2===n?e.texImage2D(i.target,0,i.internalFormat,o,h,0,i.format,i.type,t.resource):e.texImage2D(i.target,0,i.internalFormat,i.format,i.type,t.resource),i.width=o,i.height=h}},ql={id:"video",upload(t,i,e,n){t.isValid?Hl.upload(t,i,e,n):e.texImage2D(i.target,0,i.internalFormat,1,1,0,i.format,i.type,null)}},Xl={linear:9729,nearest:9728},Yl={linear:{linear:9987,nearest:9985},nearest:{linear:9986,nearest:9984}},Kl={"clamp-to-edge":33071,repeat:10497,"mirror-repeat":33648},Ql={never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519};function Zl(t,i,e,n,s,r,o,h){const a=r;if(!h||"repeat"!==t.addressModeU||"repeat"!==t.addressModeV||"repeat"!==t.addressModeW){const e=Kl[o?"clamp-to-edge":t.addressModeU],n=Kl[o?"clamp-to-edge":t.addressModeV],r=Kl[o?"clamp-to-edge":t.addressModeW];i[s](a,i.TEXTURE_WRAP_S,e),i[s](a,i.TEXTURE_WRAP_T,n),i.TEXTURE_WRAP_R&&i[s](a,i.TEXTURE_WRAP_R,r)}if(h&&"linear"===t.magFilter||i[s](a,i.TEXTURE_MAG_FILTER,Xl[t.magFilter]),e){if(!h||"linear"!==t.mipmapFilter){const e=Yl[t.minFilter][t.mipmapFilter];i[s](a,i.TEXTURE_MIN_FILTER,e)}}else i[s](a,i.TEXTURE_MIN_FILTER,Xl[t.minFilter]);if(n&&t.maxAnisotropy>1){const e=Math.min(t.maxAnisotropy,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i[s](a,n.TEXTURE_MAX_ANISOTROPY_EXT,e)}t.compare&&i[s](a,i.TEXTURE_COMPARE_FUNC,Ql[t.compare])}class Jl{constructor(t){this.managedTextures=[],this.$u=Object.create(null),this.Uu=Object.create(null),this.Bu=[],this.Iu=-1,this.ju=Object.create(null),this.Gu={image:Hl,buffer:Nl,video:ql,compressed:Wl},this.zu=!1,this.Du=!1,this.Yn=t,this.Yn.renderableGC.addManagedHash(this,"_glTextures"),this.Yn.renderableGC.addManagedHash(this,"_glSamplers")}contextChange(t){this.Pa=t,this.Lu||(this.Lu=function(t,i){let e={},n=t.RGBA;return t instanceof Ms.get().getWebGLRenderingContext()?i.srgb&&(e={"rgba8unorm-srgb":i.srgb.SRGB8_ALPHA8_EXT,"bgra8unorm-srgb":i.srgb.SRGB8_ALPHA8_EXT}):(e={"rgba8unorm-srgb":t.SRGB8_ALPHA8,"bgra8unorm-srgb":t.SRGB8_ALPHA8},n=t.RGBA8),{r8unorm:t.R8,r8snorm:t.R8_SNORM,r8uint:t.R8UI,r8sint:t.R8I,r16uint:t.R16UI,r16sint:t.R16I,r16float:t.R16F,rg8unorm:t.RG8,rg8snorm:t.RG8_SNORM,rg8uint:t.RG8UI,rg8sint:t.RG8I,r32uint:t.R32UI,r32sint:t.R32I,r32float:t.R32F,rg16uint:t.RG16UI,rg16sint:t.RG16I,rg16float:t.RG16F,rgba8unorm:t.RGBA,...e,rgba8snorm:t.RGBA8_SNORM,rgba8uint:t.RGBA8UI,rgba8sint:t.RGBA8I,bgra8unorm:n,rgb9e5ufloat:t.RGB9_E5,rgb10a2unorm:t.RGB10_A2,rg11b10ufloat:t.R11F_G11F_B10F,rg32uint:t.RG32UI,rg32sint:t.RG32I,rg32float:t.RG32F,rgba16uint:t.RGBA16UI,rgba16sint:t.RGBA16I,rgba16float:t.RGBA16F,rgba32uint:t.RGBA32UI,rgba32sint:t.RGBA32I,rgba32float:t.RGBA32F,stencil8:t.STENCIL_INDEX8,depth16unorm:t.DEPTH_COMPONENT16,depth24plus:t.DEPTH_COMPONENT24,"depth24plus-stencil8":t.DEPTH24_STENCIL8,depth32float:t.DEPTH_COMPONENT32F,"depth32float-stencil8":t.DEPTH32F_STENCIL8,...i.s3tc?{"bc1-rgba-unorm":i.s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT,"bc2-rgba-unorm":i.s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT,"bc3-rgba-unorm":i.s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT}:{},...i.s3tc_sRGB?{"bc1-rgba-unorm-srgb":i.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,"bc2-rgba-unorm-srgb":i.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,"bc3-rgba-unorm-srgb":i.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}:{},...i.rgtc?{"bc4-r-unorm":i.rgtc.COMPRESSED_RED_RGTC1_EXT,"bc4-r-snorm":i.rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT,"bc5-rg-unorm":i.rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT,"bc5-rg-snorm":i.rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}:{},...i.bptc?{"bc6h-rgb-float":i.bptc.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,"bc6h-rgb-ufloat":i.bptc.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,"bc7-rgba-unorm":i.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT,"bc7-rgba-unorm-srgb":i.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT}:{},...i.etc?{"etc2-rgb8unorm":i.etc.COMPRESSED_RGB8_ETC2,"etc2-rgb8unorm-srgb":i.etc.COMPRESSED_SRGB8_ETC2,"etc2-rgb8a1unorm":i.etc.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgb8a1unorm-srgb":i.etc.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgba8unorm":i.etc.COMPRESSED_RGBA8_ETC2_EAC,"etc2-rgba8unorm-srgb":i.etc.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,"eac-r11unorm":i.etc.COMPRESSED_R11_EAC,"eac-rg11unorm":i.etc.COMPRESSED_SIGNED_RG11_EAC}:{},...i.astc?{"astc-4x4-unorm":i.astc.COMPRESSED_RGBA_ASTC_4x4_KHR,"astc-4x4-unorm-srgb":i.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,"astc-5x4-unorm":i.astc.COMPRESSED_RGBA_ASTC_5x4_KHR,"astc-5x4-unorm-srgb":i.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR,"astc-5x5-unorm":i.astc.COMPRESSED_RGBA_ASTC_5x5_KHR,"astc-5x5-unorm-srgb":i.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,"astc-6x5-unorm":i.astc.COMPRESSED_RGBA_ASTC_6x5_KHR,"astc-6x5-unorm-srgb":i.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,"astc-6x6-unorm":i.astc.COMPRESSED_RGBA_ASTC_6x6_KHR,"astc-6x6-unorm-srgb":i.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,"astc-8x5-unorm":i.astc.COMPRESSED_RGBA_ASTC_8x5_KHR,"astc-8x5-unorm-srgb":i.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,"astc-8x6-unorm":i.astc.COMPRESSED_RGBA_ASTC_8x6_KHR,"astc-8x6-unorm-srgb":i.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,"astc-8x8-unorm":i.astc.COMPRESSED_RGBA_ASTC_8x8_KHR,"astc-8x8-unorm-srgb":i.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,"astc-10x5-unorm":i.astc.COMPRESSED_RGBA_ASTC_10x5_KHR,"astc-10x5-unorm-srgb":i.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,"astc-10x6-unorm":i.astc.COMPRESSED_RGBA_ASTC_10x6_KHR,"astc-10x6-unorm-srgb":i.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,"astc-10x8-unorm":i.astc.COMPRESSED_RGBA_ASTC_10x8_KHR,"astc-10x8-unorm-srgb":i.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,"astc-10x10-unorm":i.astc.COMPRESSED_RGBA_ASTC_10x10_KHR,"astc-10x10-unorm-srgb":i.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,"astc-12x10-unorm":i.astc.COMPRESSED_RGBA_ASTC_12x10_KHR,"astc-12x10-unorm-srgb":i.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,"astc-12x12-unorm":i.astc.COMPRESSED_RGBA_ASTC_12x12_KHR,"astc-12x12-unorm-srgb":i.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR}:{}}}(t,this.Yn.context.extensions),this.Nu=function(t){return{r8unorm:t.UNSIGNED_BYTE,r8snorm:t.BYTE,r8uint:t.UNSIGNED_BYTE,r8sint:t.BYTE,r16uint:t.UNSIGNED_SHORT,r16sint:t.SHORT,r16float:t.HALF_FLOAT,rg8unorm:t.UNSIGNED_BYTE,rg8snorm:t.BYTE,rg8uint:t.UNSIGNED_BYTE,rg8sint:t.BYTE,r32uint:t.UNSIGNED_INT,r32sint:t.INT,r32float:t.FLOAT,rg16uint:t.UNSIGNED_SHORT,rg16sint:t.SHORT,rg16float:t.HALF_FLOAT,rgba8unorm:t.UNSIGNED_BYTE,"rgba8unorm-srgb":t.UNSIGNED_BYTE,rgba8snorm:t.BYTE,rgba8uint:t.UNSIGNED_BYTE,rgba8sint:t.BYTE,bgra8unorm:t.UNSIGNED_BYTE,"bgra8unorm-srgb":t.UNSIGNED_BYTE,rgb9e5ufloat:t.UNSIGNED_INT_5_9_9_9_REV,rgb10a2unorm:t.UNSIGNED_INT_2_10_10_10_REV,rg11b10ufloat:t.UNSIGNED_INT_10F_11F_11F_REV,rg32uint:t.UNSIGNED_INT,rg32sint:t.INT,rg32float:t.FLOAT,rgba16uint:t.UNSIGNED_SHORT,rgba16sint:t.SHORT,rgba16float:t.HALF_FLOAT,rgba32uint:t.UNSIGNED_INT,rgba32sint:t.INT,rgba32float:t.FLOAT,stencil8:t.UNSIGNED_BYTE,depth16unorm:t.UNSIGNED_SHORT,depth24plus:t.UNSIGNED_INT,"depth24plus-stencil8":t.UNSIGNED_INT_24_8,depth32float:t.FLOAT,"depth32float-stencil8":t.FLOAT_32_UNSIGNED_INT_24_8_REV}}(t),this.Vu=function(t){return{r8unorm:t.RED,r8snorm:t.RED,r8uint:t.RED,r8sint:t.RED,r16uint:t.RED,r16sint:t.RED,r16float:t.RED,rg8unorm:t.RG,rg8snorm:t.RG,rg8uint:t.RG,rg8sint:t.RG,r32uint:t.RED,r32sint:t.RED,r32float:t.RED,rg16uint:t.RG,rg16sint:t.RG,rg16float:t.RG,rgba8unorm:t.RGBA,"rgba8unorm-srgb":t.RGBA,rgba8snorm:t.RGBA,rgba8uint:t.RGBA,rgba8sint:t.RGBA,bgra8unorm:t.RGBA,"bgra8unorm-srgb":t.RGBA,rgb9e5ufloat:t.RGB,rgb10a2unorm:t.RGBA,rg11b10ufloat:t.RGB,rg32uint:t.RG,rg32sint:t.RG,rg32float:t.RG,rgba16uint:t.RGBA,rgba16sint:t.RGBA,rgba16float:t.RGBA,rgba32uint:t.RGBA,rgba32sint:t.RGBA,rgba32float:t.RGBA,stencil8:t.STENCIL_INDEX8,depth16unorm:t.DEPTH_COMPONENT,depth24plus:t.DEPTH_COMPONENT,"depth24plus-stencil8":t.DEPTH_STENCIL,depth32float:t.DEPTH_COMPONENT,"depth32float-stencil8":t.DEPTH_STENCIL}}(t)),this.$u=Object.create(null),this.Uu=Object.create(null),this.ju=Object.create(null),this.zu=!1;for(let i=0;i<16;i++)this.bind(Ve.EMPTY,i)}initSource(t){this.bind(t)}bind(t,i=0){const e=t.source;t?(this.bindSource(e,i),this.Du&&this.Wu(e.style,i)):(this.bindSource(null,i),this.Du&&this.Wu(null,i))}bindSource(t,i=0){const e=this.Pa;if(t.Jt=this.Yn.textureGC.count,this.Bu[i]!==t){this.Bu[i]=t,this.Hu(i),t||(t=Ve.EMPTY.source);const n=this.getGlSource(t);e.bindTexture(n.target,n.texture)}}Wu(t,i=0){const e=this.Pa;if(!t)return this.ju[i]=null,void e.bindSampler(i,null);const n=this.qu(t);this.ju[i]!==n&&(this.ju[i]=n,e.bindSampler(i,n))}unbind(t){const i=t.source,e=this.Bu,n=this.Pa;for(let s=0;s<e.length;s++)if(e[s]===i){this.Hu(s);const t=this.getGlSource(i);n.bindTexture(t.target,null),e[s]=null}}Hu(t){this.Iu!==t&&(this.Iu=t,this.Pa.activeTexture(this.Pa.TEXTURE0+t))}Xu(t){const i=this.Pa,e=new Ll(i.createTexture());if(e.type=this.Nu[t.format],e.internalFormat=this.Lu[t.format],e.format=this.Vu[t.format],t.autoGenerateMipmaps&&(this.Yn.context.supports.nonPowOf2mipmaps||t.isPowerOfTwo)){const i=Math.max(t.width,t.height);t.mipLevelCount=Math.floor(Math.log2(i))+1}return this.$u[t.uid]=e,this.managedTextures.includes(t)||(t.on("update",this.onSourceUpdate,this),t.on("resize",this.onSourceUpdate,this),t.on("styleChange",this.onStyleChange,this),t.on("destroy",this.onSourceDestroy,this),t.on("unload",this.onSourceUnload,this),t.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(t)),this.onSourceUpdate(t),this.updateStyle(t,!1),e}onStyleChange(t){this.updateStyle(t,!1)}updateStyle(t,i){const e=this.Pa,n=this.getGlSource(t);e.bindTexture(e.TEXTURE_2D,n.texture),this.Bu[this.Iu]=t,Zl(t.style,e,t.mipLevelCount>1,this.Yn.context.extensions.anisotropicFiltering,"texParameteri",e.TEXTURE_2D,!this.Yn.context.supports.nonPowOf2wrapping&&!t.isPowerOfTwo,i)}onSourceUnload(t){const i=this.$u[t.uid];i&&(this.unbind(t),this.$u[t.uid]=null,this.Pa.deleteTexture(i.texture))}onSourceUpdate(t){const i=this.Pa,e=this.getGlSource(t);i.bindTexture(i.TEXTURE_2D,e.texture),this.Bu[this.Iu]=t;const n="premultiply-alpha-on-upload"===t.alphaMode;this.zu!==n&&(this.zu=n,i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n)),this.Gu[t.uploadMethodId]?this.Gu[t.uploadMethodId].upload(t,e,i,this.Yn.context.webGLVersion):i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t.pixelWidth,t.pixelHeight,0,i.RGBA,i.UNSIGNED_BYTE,null),t.autoGenerateMipmaps&&t.mipLevelCount>1&&this.onUpdateMipmaps(t,!1)}onUpdateMipmaps(t,i=!0){i&&this.bindSource(t,0);const e=this.getGlSource(t);this.Pa.generateMipmap(e.target)}onSourceDestroy(t){t.off("destroy",this.onSourceDestroy,this),t.off("update",this.onSourceUpdate,this),t.off("resize",this.onSourceUpdate,this),t.off("unload",this.onSourceUnload,this),t.off("styleChange",this.onStyleChange,this),t.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(t),1),this.onSourceUnload(t)}Yu(t){const i=this.Pa,e=this.Pa.createSampler();return this.Uu[t.ii]=e,Zl(t,i,this.Bu[this.Iu].mipLevelCount>1,this.Yn.context.extensions.anisotropicFiltering,"samplerParameteri",e,!1,!0),this.Uu[t.ii]}qu(t){return this.Uu[t.ii]||this.Yu(t)}getGlSource(t){return this.$u[t.uid]||this.Xu(t)}generateCanvas(t){const{pixels:i,width:e,height:n}=this.getPixels(t),s=Ms.get().createCanvas();s.width=e,s.height=n;const r=s.getContext("2d");if(r){const t=r.createImageData(e,n);t.data.set(i),r.putImageData(t,0,0)}return s}getPixels(t){const i=t.source.resolution,e=t.frame,n=Math.max(Math.round(e.width*i),1),s=Math.max(Math.round(e.height*i),1),r=new Uint8Array(4*n*s),o=this.Yn,h=o.renderTarget.getRenderTarget(t),a=o.renderTarget.getGpuRenderTarget(h),u=o.gl;return u.bindFramebuffer(u.FRAMEBUFFER,a.resolveTargetFramebuffer),u.readPixels(Math.round(e.x*i),Math.round(e.y*i),n,s,u.RGBA,u.UNSIGNED_BYTE,r),{pixels:new Uint8ClampedArray(r.buffer),width:n,height:s}}destroy(){this.managedTextures.slice().forEach(t=>this.onSourceDestroy(t)),this.managedTextures=null,this.Yn=null}resetState(){this.Iu=-1,this.Bu.fill(Ve.EMPTY.source),this.ju=Object.create(null);const t=this.Pa;this.zu=!1,t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.zu)}}Jl.extension={type:[ie.WebGLSystem],name:"texture"};class tf{contextChange(t){const i=new Lr({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new ve,type:"mat3x3<f32>"},uRound:{value:0,type:"f32"}}),e=t.limits.maxBatchableTextures,n=ra({name:"graphics",bits:[ha,pa(e),Pc,ma]});this.shader=new Wr({glProgram:n,resources:{localUniforms:i,batchSamplers:ba(e)}})}execute(t,i){const e=i.context,n=e.customShader||this.shader,s=t.renderer,r=s.graphicsContext,{batcher:o,instructions:h}=r.getContextRenderData(e);n.groups[0]=s.globalUniforms.bindGroup,s.state.set(t.state),s.shader.bind(n),s.geometry.bind(o.geometry,n.glProgram);const a=h.instructions;for(let u=0;u<h.instructionSize;u++){const t=a[u];if(t.size){for(let i=0;i<t.textures.count;i++)s.texture.bind(t.textures.textures[i],i);s.geometry.draw(t.topology,t.size,t.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}}tf.extension={type:[ie.WebGLPipesAdaptor],name:"graphics"};class ef{init(){const t=ra({name:"mesh",bits:[Pc,Rc,ma]});this.ua=new Wr({glProgram:t,resources:{uTexture:Ve.EMPTY.source,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new ve}}}})}execute(t,i){const e=t.renderer;let n=i.ua;if(n){if(!n.glProgram)return void _n(i.shader)}else{n=this.ua;const t=i.texture,e=t.source;n.resources.uTexture=e,n.resources.uSampler=e.style,n.resources.textureUniforms.uniforms.uTextureMatrix=t.textureMatrix.mapCoord}n.groups[100]=e.globalUniforms.bindGroup,n.groups[101]=t.localUniformsBindGroup,e.encoder.draw({geometry:i.ca,shader:n,state:i.state})}destroy(){this.ua.destroy(!0),this.ua=null}}ef.extension={type:[ie.WebGLPipesAdaptor],name:"mesh"};class nf{constructor(t){this.Yn=t}updateRenderable(){}destroyRenderable(){}validateRenderable(){return!1}addRenderable(t,i){this.Yn.renderPipes.batch.break(i),i.add(t)}execute(t){t.isRenderable&&t.render(this.Yn)}destroy(){this.Yn=null}}nf.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"customRender"};class sf{constructor(){this.batcherName="default",this.topology="triangle-list",this.attributeSize=4,this.indexSize=6,this.packAsQuad=!0,this.roundPixels=0,this.Wr=0,this.Hr=null,this.qr=null}get blendMode(){return this.renderable.groupBlendMode}get color(){return this.renderable.groupColorAlpha}reset(){this.renderable=null,this.texture=null,this.Hr=null,this.qr=null,this.bounds=null}destroy(){}}function rf(t,i){const e=t.instructionSet,n=e.instructions;for(let s=0;s<e.instructionSize;s++){const t=n[s];i[t.renderPipeId].execute(t)}}const of=new ve;class hf{constructor(t){this.Yn=t}addRenderGroup(t,i){t.isCachedAsTexture?this.Ku(t,i):this.Qu(t,i)}execute(t){t.isRenderable&&(t.isCachedAsTexture?this.Zu(t):this.Ju(t))}destroy(){this.Yn=null}Qu(t,i){this.Yn.renderPipes.batch.break(i),t.tc&&(Cn.return(t.tc),t.tc=null),i.add(t)}Ku(t,i){const e=t.tc??(t.tc=Cn.get(sf));e.renderable=t.root,e.transform=t.root.relativeGroupTransform,e.texture=t.texture,e.bounds=t.oe,i.add(t),this.Yn.renderPipes.batch.addToBatch(e,i)}Zu(t){if(t.textureNeedsUpdate){t.textureNeedsUpdate=!1;const i=of.identity().translate(-t.oe.x,-t.oe.y);this.Yn.renderTarget.push(t.texture,!0,null,t.texture.frame),this.Yn.globalUniforms.push({worldTransformMatrix:i,worldColor:4294967295}),rf(t,this.Yn.renderPipes),this.Yn.renderTarget.finishRenderPass(),this.Yn.renderTarget.pop(),this.Yn.globalUniforms.pop()}t.tc.Hr.updateElement(t.tc),t.tc.Hr.geometry.buffers[0].update()}Ju(t){this.Yn.globalUniforms.push({worldTransformMatrix:t.inverseParentTextureTransform,worldColor:t.worldColorAlpha}),rf(t,this.Yn.renderPipes),this.Yn.globalUniforms.pop()}}function af(t,i){i||(i=0);for(let e=i;e<t.length&&t[e];e++)t[e]=null}hf.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"renderGroup"};const uf=new ls;function cf(t,i=!1){!function(t){const i=t.root;let e;if(t.renderGroupParent){const n=t.renderGroupParent;t.worldTransform.appendFrom(i.relativeGroupTransform,n.worldTransform),t.worldColor=Wn(i.groupColor,n.worldColor),e=i.groupAlpha*n.worldAlpha}else t.worldTransform.copyFrom(i.localTransform),t.worldColor=i.localColor,e=i.localAlpha;e=e<0?0:e>1?1:e,t.worldAlpha=e,t.worldColorAlpha=t.worldColor+(255*e<<24)}(t);const e=t.childrenToUpdate,n=t.updateTick++;for(const s in e){const i=Number(s),r=e[s],o=r.list,h=r.index;for(let e=0;e<h;e++){const s=o[e];s.parentRenderGroup===t&&s.relativeRenderGroupDepth===i&&lf(s,n,0)}af(o,h),r.index=0}if(i)for(let s=0;s<t.renderGroupChildren.length;s++)cf(t.renderGroupChildren[s],i)}function lf(t,i,e){if(i===t.updateTick)return;t.updateTick=i,t.didChange=!1;const n=t.localTransform;t.updateLocalTransform();const s=t.parent;if(s&&!s.renderGroup?(e|=t.$i,t.relativeGroupTransform.appendFrom(n,s.relativeGroupTransform),7&e&&ff(t,s,e)):(e=t.$i,t.relativeGroupTransform.copyFrom(n),7&e&&ff(t,uf,e)),!t.renderGroup){const n=t.children,s=n.length;for(let t=0;t<s;t++)lf(n[t],i,e);const r=t.parentRenderGroup,o=t;o.renderPipeId&&!r.structureDidChange&&r.updateRenderable(o)}}function ff(t,i,e){if(1&e){t.groupColor=Wn(t.localColor,i.groupColor);let e=t.localAlpha*i.groupAlpha;e=e<0?0:e>1?1:e,t.groupAlpha=e,t.groupColorAlpha=t.groupColor+(255*e<<24)}2&e&&(t.groupBlendMode="inherit"===t.localBlendMode?i.groupBlendMode:t.localBlendMode),4&e&&(t.globalDisplayStatus=t.localDisplayStatus&i.globalDisplayStatus),t.$i=0}const df=new ve;class pf{constructor(t){this.Yn=t}render({container:t,transform:i}){const e=t.parent,n=t.renderGroup.renderGroupParent;t.parent=null,t.renderGroup.renderGroupParent=null;const s=this.Yn;let r=df;i&&(r=r.copyFrom(t.renderGroup.localTransform),t.renderGroup.localTransform.copyFrom(i));const o=s.renderPipes;this.ec(t.renderGroup,null),this.nc(t.renderGroup),s.globalUniforms.start({worldTransformMatrix:i?t.renderGroup.localTransform:t.renderGroup.worldTransform,worldColor:t.renderGroup.worldColorAlpha}),rf(t.renderGroup,o),o.uniformBatch&&o.uniformBatch.renderEnd(),i&&t.renderGroup.localTransform.copyFrom(r),t.parent=e,t.renderGroup.renderGroupParent=n}destroy(){this.Yn=null}ec(t,i){if(t.isCachedAsTexture){if(!t.updateCacheTexture)return;i=t}t.ae=i;for(let e=t.renderGroupChildren.length-1;e>=0;e--)this.ec(t.renderGroupChildren[e],i);if(t.invalidateMatrices(),t.isCachedAsTexture){if(t.textureNeedsUpdate){const i=t.root.getLocalBounds();i.ceil();const e=t.texture;t.texture&&rs.returnTexture(t.texture,!0);const n=this.Yn,s=t.textureOptions.resolution||n.view.resolution,r=t.textureOptions.antialias??n.view.antialias,o=t.textureOptions.scaleMode??"linear",h=rs.getOptimalTexture(i.width,i.height,s,r);h.di.style=new je({scaleMode:o}),t.texture=h,t.oe||(t.oe=new qe),t.oe.copyFrom(i),e!==t.texture&&t.renderGroupParent&&(t.renderGroupParent.structureDidChange=!0)}}else t.texture&&(rs.returnTexture(t.texture,!0),t.texture=null)}nc(t){const i=this.Yn,e=i.renderPipes;if(t.runOnRender(i),t.instructionSet.renderPipes=e,t.structureDidChange?af(t.childrenRenderablesToUpdate.list,0):function(t,i){const{list:e,index:n}=t.childrenRenderablesToUpdate;let s=!1;for(let r=0;r<n;r++){const t=e[r];if(s=i[t.renderPipeId].validateRenderable(t),s)break}t.structureDidChange=s}(t,e),cf(t),t.structureDidChange?(t.structureDidChange=!1,this.sc(t,i)):this.rc(t),t.childrenRenderablesToUpdate.index=0,i.renderPipes.batch.upload(t.instructionSet),!t.isCachedAsTexture||t.textureNeedsUpdate)for(let n=0;n<t.renderGroupChildren.length;n++)this.nc(t.renderGroupChildren[n])}rc(t){const{list:i,index:e}=t.childrenRenderablesToUpdate;for(let n=0;n<e;n++){const e=i[n];e.didViewUpdate&&t.updateRenderable(e)}af(i,e)}sc(t,i){const e=t.root,n=t.instructionSet;n.reset();const s=i.renderPipes?i:i.batch.renderer,r=s.renderPipes;r.batch.buildStart(n),r.blendMode.buildStart(),r.colorMask.buildStart(),e.sortableChildren&&e.sortChildren(),e.collectRenderablesWithEffects(n,s,null),r.batch.buildEnd(n),r.blendMode.buildEnd(n)}}pf.extension={type:[ie.WebGLSystem,ie.WebGPUSystem,ie.CanvasSystem],name:"renderGroup"};class vf{constructor(t){this.Yn=t}addRenderable(t,i){const e=this.oc(t);t.didViewUpdate&&this.hc(t,e),this.Yn.renderPipes.batch.addToBatch(e,i)}updateRenderable(t){const i=this.oc(t);t.didViewUpdate&&this.hc(t,i),i.Hr.updateElement(i)}validateRenderable(t){const i=this.oc(t);return!i.Hr.checkAndUpdateTexture(i,t.fi)}hc(t,i){i.bounds=t.visualBounds,i.texture=t.fi}oc(t){return t.Te[this.Yn.uid]||this.uc(t)}uc(t){const i=new sf;return i.renderable=t,i.transform=t.groupTransform,i.texture=t.fi,i.bounds=t.visualBounds,i.roundPixels=this.Yn.Me|t.Me,t.Te[this.Yn.uid]=i,i}destroy(){this.Yn=null}}vf.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"sprite"};const mf=class t{constructor(){this.clearBeforeRender=!0,this.cc=new An(0),this.color=this.cc,this.alpha=1}init(i){i={...t.defaultOptions,...i},this.clearBeforeRender=i.clearBeforeRender,this.color=i.background||i.backgroundColor||this.cc,this.alpha=i.backgroundAlpha,this.cc.setAlpha(i.backgroundAlpha)}get color(){return this.cc}set color(t){An.shared.setValue(t).alpha<1&&1===this.cc.alpha&&_n(),this.cc.setValue(t)}get alpha(){return this.cc.alpha}set alpha(t){this.cc.setAlpha(t)}get colorRgba(){return this.cc.toArray()}destroy(){}};mf.extension={type:[ie.WebGLSystem,ie.WebGPUSystem,ie.CanvasSystem],name:"background",priority:0},mf.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};let gf=mf;const bf={};se.handle(ie.BlendMode,t=>{if(!t.name)throw new Error("BlendMode extension must have a name property");bf[t.name]=t.ref},t=>{delete bf[t.name]});class yf{constructor(t){this.lc=!1,this.fc=Object.create(null),this.Yn=t,this.Yn.runners.prerender.add(this)}prerender(){this.dc="normal",this.lc=!1}setBlendMode(t,i,e){this.dc!==i?(this.dc=i,this.lc&&this.vc(e),this.lc=!!bf[i],this.lc&&(this.mc(e),this.gc.push(t))):this.lc&&this.gc.push(t)}mc(t){this.Yn.renderPipes.batch.break(t);const i=this.dc;if(!bf[i])return void _n();let e=this.fc[i];e||(e=this.fc[i]=new Fn,e.filters=[new bf[i]]);const n={renderPipeId:"filter",action:"pushFilter",renderables:[],filterEffect:e,canBundle:!1};this.gc=n.renderables,t.add(n)}vc(t){this.gc=null,this.Yn.renderPipes.batch.break(t),t.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}buildStart(){this.lc=!1}buildEnd(t){this.lc&&this.vc(t)}destroy(){this.Yn=null,this.gc=null;for(const t in this.fc)this.fc[t].destroy();this.fc=null}}yf.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"blendMode"};const xf={png:"image/png",jpg:"image/jpeg",webp:"image/webp"},wf=class t{constructor(t){this.Yn=t}bc(t,i={}){return t instanceof ls||t instanceof Ve?{target:t,...i}:{...i,...t}}async image(t){const i=Ms.get().createImage();return i.src=await this.base64(t),i}async base64(i){i=this.bc(i,t.defaultImageOptions);const{format:e,quality:n}=i,s=this.canvas(i);if(void 0!==s.toBlob)return new Promise((t,i)=>{s.toBlob(e=>{if(!e)return void i(new Error("ICanvas.toBlob failed!"));const n=new FileReader;n.onload=()=>t(n.result),n.onerror=i,n.readAsDataURL(e)},xf[e],n)});if(void 0!==s.toDataURL)return s.toDataURL(xf[e],n);if(void 0!==s.convertToBlob){const t=await s.convertToBlob({type:xf[e],quality:n});return new Promise((i,e)=>{const n=new FileReader;n.onload=()=>i(n.result),n.onerror=e,n.readAsDataURL(t)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t){const i=(t=this.bc(t)).target,e=this.Yn;if(i instanceof Ve)return e.texture.generateCanvas(i);const n=e.textureGenerator.generateTexture(t),s=e.texture.generateCanvas(n);return n.destroy(!0),s}pixels(t){const i=(t=this.bc(t)).target,e=this.Yn,n=i instanceof Ve?i:e.textureGenerator.generateTexture(t),s=e.texture.getPixels(n);return i instanceof ls&&n.destroy(!0),s}texture(t){return(t=this.bc(t)).target instanceof Ve?t.target:this.Yn.textureGenerator.generateTexture(t)}download(t){t=this.bc(t);const i=this.canvas(t),e=document.createElement("a");e.download=t.filename??"image.png",e.href=i.toDataURL("image/png"),document.body.appendChild(e),e.click(),document.body.removeChild(e)}log(t){const i=t.width??200;t=this.bc(t);["font-size: 1px;",`padding: ${i}px 300px;`,`background: url(${this.canvas(t).toDataURL()}) no-repeat;`,"background-size: contain;"].join(" ")}destroy(){this.Yn=null}};wf.extension={type:[ie.WebGLSystem,ie.WebGPUSystem],name:"extract"},wf.defaultImageOptions={format:"png",quality:1};let Mf=wf;class Af extends Ve{static create(t){return new Af({source:new ze(t)})}resize(t,i,e){return this.source.resize(t,i,e),this}}const Tf=new Ce,_f=new qe,kf=[0,0,0,0];class Cf{constructor(t){this.Yn=t}generateTexture(t){var i;t instanceof ls&&(t={target:t,frame:void 0,textureSourceOptions:{},resolution:void 0});const e=t.resolution||this.Yn.resolution,n=t.antialias||this.Yn.view.antialias,s=t.target;let r=t.clearColor;if(r){r=Array.isArray(r)&&4===r.length?r:An.shared.setValue(r).toArray()}else r=kf;const o=(null==(i=t.frame)?void 0:i.copyTo(Tf))||Xn(s,_f).rectangle;o.width=0|Math.max(o.width,1/e),o.height=0|Math.max(o.height,1/e);const h=Af.create({...t.textureSourceOptions,width:o.width,height:o.height,resolution:e,antialias:n}),a=ve.shared.translate(-o.x,-o.y);return this.Yn.render({container:s,transform:a,target:h,clearColor:r}),h.source.updateMipmaps(),h}destroy(){this.Yn=null}}function Sf(t,i,e){const n=(t>>24&255)/255;i[e++]=(255&t)/255*n,i[e++]=(t>>8&255)/255*n,i[e++]=(t>>16&255)/255*n,i[e++]=n}Cf.extension={type:[ie.WebGLSystem,ie.WebGPUSystem],name:"textureGenerator"};class Pf{constructor(t){this.yc=0,this.xc=[],this.wc=[],this.Mc=[],this.Ac=[],this.Tc=[],this.Yn=t}reset(){this.yc=0;for(let t=0;t<this.Mc.length;t++)this.wc.push(this.Mc[t]);for(let t=0;t<this.Tc.length;t++)this.Ac.push(this.Tc[t]);this.Mc.length=0,this.Tc.length=0}start(t){this.reset(),this.push(t)}bind({size:t,projectionMatrix:i,worldTransformMatrix:e,worldColor:n,offset:s}){const r=this.Yn.renderTarget.renderTarget,o=this.yc?this.xc[this.yc-1]:{worldTransformMatrix:new ve,worldColor:4294967295,offset:new de},h={projectionMatrix:i||this.Yn.renderTarget.projectionMatrix,resolution:t||r.size,worldTransformMatrix:e||o.worldTransformMatrix,worldColor:n||o.worldColor,offset:s||o.offset,bindGroup:null},a=this.wc.pop()||this._c();this.Mc.push(a);const u=a.uniforms;let c;u.uProjectionMatrix=h.projectionMatrix,u.uResolution=h.resolution,u.uWorldTransformMatrix.copyFrom(h.worldTransformMatrix),u.uWorldTransformMatrix.tx-=h.offset.x,u.uWorldTransformMatrix.ty-=h.offset.y,Sf(h.worldColor,u.uWorldColorAlpha,0),a.update(),this.Yn.renderPipes.uniformBatch?c=this.Yn.renderPipes.uniformBatch.getUniformBindGroup(a,!1):(c=this.Ac.pop()||new Nr,this.Tc.push(c),c.setResource(a,0)),h.bindGroup=c,this.kc=h}push(t){this.bind(t),this.xc[this.yc++]=this.kc}pop(){this.kc=this.xc[--this.yc-1],this.Yn.type===Vr.WEBGL&&this.kc.bindGroup.resources[0].update()}get bindGroup(){return this.kc.bindGroup}get globalUniformData(){return this.kc}get uniformGroup(){return this.kc.bindGroup.resources[0]}_c(){return new Lr({uProjectionMatrix:{value:new ve,type:"mat3x3<f32>"},uWorldTransformMatrix:{value:new ve,type:"mat3x3<f32>"},uWorldColorAlpha:{value:new Float32Array(4),type:"vec4<f32>"},uResolution:{value:[0,0],type:"vec2<f32>"}},{isStatic:!0})}destroy(){this.Yn=null}}Pf.extension={type:[ie.WebGLSystem,ie.WebGPUSystem,ie.CanvasSystem],name:"globalUniforms"};let Ef=1;class Rf{constructor(){this.Cc=[],this.Sc=0}init(){Ps.system.add(this.fh,this)}repeat(t,i,e=!0){const n=Ef++;let s=0;return e&&(this.Sc+=1e3,s=this.Sc),this.Cc.push({func:t,duration:i,start:performance.now(),offset:s,last:performance.now(),repeat:!0,id:n}),n}cancel(t){for(let i=0;i<this.Cc.length;i++)if(this.Cc[i].id===t)return void this.Cc.splice(i,1)}fh(){const t=performance.now();for(let i=0;i<this.Cc.length;i++){const e=this.Cc[i];if(t-e.offset-e.last>=e.duration){const i=t-e.start;e.func(i),e.last=t}}}destroy(){Ps.system.remove(this.fh,this),this.Cc.length=0}}Rf.extension={type:[ie.WebGLSystem,ie.WebGPUSystem,ie.CanvasSystem],name:"scheduler",priority:0};let Ff=!1;class Of{constructor(t){this.Yn=t}init(t){if(t.hello){let t=this.Yn.name;this.Yn.type===Vr.WEBGL&&(t+=` ${this.Yn.context.webGLVersion}`),function(t){if(!Ff){if(Ms.get().getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){const i=[`%c  %c  %c  %c  %c PixiJS %c v${jo} (${t}) http://www.pixijs.com/\n\n`,"background: #E72264; padding:5px 0;","background: #6CA2EA; padding:5px 0;","background: #B5D33D; padding:5px 0;","background: #FED23F; padding:5px 0;","color: #FFFFFF; background: #E72264; padding:5px 0;","color: #E72264; background: #FFFFFF; padding:5px 0;"];globalThis.console.log(...i)}else globalThis.console&&globalThis.console.log(`PixiJS ${jo} - ${t} - http://www.pixijs.com/`);Ff=!0}}(t)}}}function $f(t){let i=!1;for(const n in t)if(null==t[n]){i=!0;break}if(!i)return t;const e=Object.create(null);for(const n in t){const i=t[n];i&&(e[n]=i)}return e}function Uf(t){let i=0;for(let e=0;e<t.length;e++)null==t[e]?i++:t[e-i]=t[e];return t.length-=i,t}Of.extension={type:[ie.WebGLSystem,ie.WebGPUSystem,ie.CanvasSystem],name:"hello",priority:-2},Of.defaultOptions={hello:!1};let Bf=0;const If=class t{constructor(t){this.Pc=[],this.Ec=[],this.Rc=[],this.Yn=t}init(i){i={...t.defaultOptions,...i},this.maxUnusedTime=i.renderableGCMaxUnusedTime,this.Fc=i.renderableGCFrequency,this.enabled=i.renderableGCActive}get enabled(){return!!this.Oc}set enabled(t){this.enabled!==t&&(t?(this.Oc=this.Yn.scheduler.repeat(()=>this.run(),this.Fc,!1),this.$c=this.Yn.scheduler.repeat(()=>{for(const t of this.Ec)t.context[t.hash]=$f(t.context[t.hash])},this.Fc),this.Uc=this.Yn.scheduler.repeat(()=>{for(const t of this.Rc)Uf(t.context[t.hash])},this.Fc)):(this.Yn.scheduler.cancel(this.Oc),this.Yn.scheduler.cancel(this.$c),this.Yn.scheduler.cancel(this.Uc)))}addManagedHash(t,i){this.Ec.push({context:t,hash:i})}addManagedArray(t,i){this.Rc.push({context:t,hash:i})}prerender({container:t}){this.Bc=performance.now(),t.renderGroup.gcTick=Bf++,this.Ic(t.renderGroup,t.renderGroup.gcTick)}addRenderable(t){this.enabled&&(-1===t.Ae&&(this.Pc.push(t),t.once("destroyed",this.jc,this)),t.Ae=this.Bc)}run(){var t;const i=this.Bc,e=this.Pc,n=this.Yn.renderPipes;let s=0;for(let r=0;r<e.length;r++){const o=e[r];if(null===o){s++;continue}const h=o.renderGroup??o.parentRenderGroup,a=(null==(t=null==h?void 0:h.instructionSet)?void 0:t.gcTick)??-1;if(((null==h?void 0:h.gcTick)??0)===a&&(o.Ae=i),i-o.Ae>this.maxUnusedTime){if(!o.destroyed){const t=n;h&&(h.structureDidChange=!0),t[o.renderPipeId].destroyRenderable(o)}o.Ae=-1,s++,o.off("destroyed",this.jc,this)}else e[r-s]=o}e.length-=s}destroy(){this.enabled=!1,this.Yn=null,this.Pc.length=0,this.Ec.length=0,this.Rc.length=0}jc(t){const i=this.Pc.indexOf(t);i>=0&&(t.off("destroyed",this.jc,this),this.Pc[i]=null)}Ic(t,i){t.instructionSet.gcTick=i;for(const e of t.renderGroupChildren)this.Ic(e,i)}};If.extension={type:[ie.WebGLSystem,ie.WebGPUSystem],name:"renderableGC",priority:0},If.defaultOptions={renderableGCActive:!0,renderableGCMaxUnusedTime:6e4,renderableGCFrequency:3e4};let jf=If;const Gf=class t{constructor(t){this.Yn=t,this.count=0,this.checkCount=0}init(i){i={...t.defaultOptions,...i},this.checkCountMax=i.textureGCCheckCountMax,this.maxIdle=i.textureGCAMaxIdle??i.textureGCMaxIdle,this.active=i.textureGCActive}postrender(){this.Yn.renderingToScreen&&(this.count++,this.active&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.Yn.texture.managedTextures;for(let i=0;i<t.length;i++){const e=t[i];e.autoGarbageCollect&&e.resource&&e.Jt>-1&&this.count-e.Jt>this.maxIdle&&(e.Jt=-1,e.unload())}}destroy(){this.Yn=null}};Gf.extension={type:[ie.WebGLSystem,ie.WebGPUSystem],name:"textureGC"},Gf.defaultOptions={textureGCActive:!0,textureGCAMaxIdle:null,textureGCMaxIdle:3600,textureGCCheckCountMax:600};let zf=Gf;const Df=class t{get autoDensity(){return this.texture.source.autoDensity}set autoDensity(t){this.texture.source.autoDensity=t}get resolution(){return this.texture.source.si}set resolution(t){this.texture.source.resize(this.texture.source.width,this.texture.source.height,t)}init(i){(i={...t.defaultOptions,...i}).view&&(Re(0,"ViewSystem.view has been renamed to ViewSystem.canvas"),i.canvas=i.view),this.screen=new Ce(0,0,i.width,i.height),this.canvas=i.canvas||Ms.get().createCanvas(),this.antialias=!!i.antialias,this.texture=bl(this.canvas,i),this.renderTarget=new xl({colorTextures:[this.texture],depth:!!i.depth,isRoot:!0}),this.texture.source.transparent=i.backgroundAlpha<1,this.resolution=i.resolution}resize(t,i,e){this.texture.source.resize(t,i,e),this.screen.width=this.texture.frame.width,this.screen.height=this.texture.frame.height}destroy(t=!1){("boolean"==typeof t?t:!!(null==t?void 0:t.removeView))&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}};Df.extension={type:[ie.WebGLSystem,ie.WebGPUSystem,ie.CanvasSystem],name:"view",priority:0},Df.defaultOptions={width:800,height:600,autoDensity:!1,antialias:!1};const Lf=[gf,Pf,Of,Df,pf,zf,Cf,Mf,zo,jf,Rf],Nf=[yf,kc,vf,hf,$c,Bc,Uc,nf],Vf=[...Lf,vl,Zc,Dc,il,Gc,Jl,Ml,Yc,Gl,Bl,tl,Dl,sl,Jc],Wf=[...Nf],Hf=[Mc,ef,tf],qf=[],Xf=[],Yf=[];se.handleByNamedList(ie.WebGLSystem,qf),se.handleByNamedList(ie.WebGLPipes,Xf),se.handleByNamedList(ie.WebGLPipesAdaptor,Yf),se.add(...Vf,...Wf,...Hf);const Kf=Object.freeze(Object.defineProperty({__proto__:null,WebGLRenderer:class extends $o{constructor(){super({name:"webgl",type:Vr.WEBGL,systems:qf,renderPipes:Xf,renderPipeAdaptors:Yf})}}},Symbol.toStringTag,{value:"Module"}));class Qf{constructor(t){this.Gc=Object.create(null),this.Yn=t,this.Yn.renderableGC.addManagedHash(this,"_hash")}contextChange(t){this.zc=t}getBindGroup(t,i,e){t.Ns();return this.Gc[t.Os]||this.Dc(t,i,e)}Dc(t,i,e){const n=this.zc.device,s=i.layout[e],r=[],o=this.Yn;for(const u in s){const i=t.resources[u]??t.resources[s[u]];let e;if("uniformGroup"===i.Zt){const t=i;o.ubo.updateUniformGroup(t);const n=t.buffer;e={buffer:o.buffer.getGPUBuffer(n),offset:0,size:n.descriptor.size}}else if("buffer"===i.Zt){const t=i;e={buffer:o.buffer.getGPUBuffer(t),offset:0,size:t.descriptor.size}}else if("bufferResource"===i.Zt){const t=i;e={buffer:o.buffer.getGPUBuffer(t.buffer),offset:t.offset,size:t.size}}else if("textureSampler"===i.Zt){const t=i;e=o.texture.getGpuSampler(t)}else if("textureSource"===i.Zt){const t=i;e=o.texture.getGpuSource(t).createView({})}r.push({binding:s[u],resource:e})}const h=o.shader.getProgramData(i).bindGroups[e],a=n.createBindGroup({layout:h,entries:r});return this.Gc[t.Os]=a,a}destroy(){for(const t of Object.keys(this.Gc))this.Gc[t]=null;this.Gc=null,this.Yn=null}}Qf.extension={type:[ie.WebGPUSystem],name:"bindGroup"};class Zf{constructor(t){this.Ta=Object.create(null),this.Lc=[],t.renderableGC.addManagedHash(this,"_gpuBuffers")}contextChange(t){this.zc=t}getGPUBuffer(t){return this.Ta[t.uid]||this.createGPUBuffer(t)}updateBuffer(t){const i=this.Ta[t.uid]||this.createGPUBuffer(t),e=t.data;return t.li&&e&&(t.li=0,this.zc.device.queue.writeBuffer(i,0,e.buffer,0,(t.Jr||e.byteLength)+3&-4)),i}destroyAll(){for(const t in this.Ta)this.Ta[t].destroy();this.Ta={}}createGPUBuffer(t){this.Ta[t.uid]||(t.on("update",this.updateBuffer,this),t.on("change",this.onBufferChange,this),t.on("destroy",this.onBufferDestroy,this),this.Lc.push(t));const i=this.zc.device.createBuffer(t.descriptor);return t.li=0,t.data&&(bh(t.data.buffer,i.getMappedRange()),i.unmap()),this.Ta[t.uid]=i,i}onBufferChange(t){this.Ta[t.uid].destroy(),t.li=0,this.Ta[t.uid]=this.createGPUBuffer(t)}onBufferDestroy(t){this.Lc.splice(this.Lc.indexOf(t),1),this.Vc(t)}destroy(){this.Lc.forEach(t=>this.Vc(t)),this.Lc=null,this.Ta=null}Vc(t){this.Ta[t.uid].destroy(),t.off("update",this.updateBuffer,this),t.off("change",this.onBufferChange,this),t.off("destroy",this.onBufferDestroy,this),this.Ta[t.uid]=null}}Zf.extension={type:[ie.WebGPUSystem],name:"buffer"};class Jf{constructor({minUniformOffsetAlignment:t}){this.Wc=256,this.byteIndex=0,this.Wc=t,this.data=new Float32Array(65535)}clear(){this.byteIndex=0}addEmptyGroup(t){if(t>this.Wc/4)throw new Error("UniformBufferBatch: array is too large: "+4*t);const i=this.byteIndex;let e=i+4*t;if(e=Math.ceil(e/this.Wc)*this.Wc,e>4*this.data.length)throw new Error("UniformBufferBatch: ubo batch got too big");return this.byteIndex=e,i}addGroup(t){const i=this.addEmptyGroup(t.length);for(let e=0;e<t.length;e++)this.data[i/4+e]=t[e];return i}destroy(){this.data=null}}class td{constructor(t){this.Na=15,this.Yn=t}setMask(t){this.Na!==t&&(this.Na=t,this.Yn.pipeline.setColorMask(t))}destroy(){this.Yn=null,this.Na=null}}td.extension={type:[ie.WebGPUSystem],name:"colorMask"};class id{constructor(t){this.Yn=t}async init(t){return this.Hc||(this.Hc=(t.gpu?Promise.resolve(t.gpu):this.qc(t)).then(t=>{this.gpu=t,this.Yn.runners.contextChange.emit(this.gpu)})),this.Hc}contextChange(t){this.Yn.gpu=t}async qc(t){const i=await Ms.get().getNavigator().gpu.requestAdapter({powerPreference:t.powerPreference,forceFallbackAdapter:t.forceFallbackAdapter}),e=["texture-compression-bc","texture-compression-astc","texture-compression-etc2"].filter(t=>i.features.has(t)),n=await i.requestDevice({requiredFeatures:e});return{adapter:i,device:n}}destroy(){this.gpu=null,this.Yn=null}}id.extension={type:[ie.WebGPUSystem],name:"device"},id.defaultOptions={powerPreference:void 0,forceFallbackAdapter:!1};class ed{constructor(t){this.Xc=Object.create(null),this.Yc=Object.create(null),this.Yn=t}renderStart(){this.commandFinished=new Promise(t=>{this.Kc=t}),this.commandEncoder=this.Yn.gpu.device.createCommandEncoder()}beginRenderPass(t){this.endRenderPass(),this.Qc(),this.renderPassEncoder=this.commandEncoder.beginRenderPass(t.descriptor)}endRenderPass(){this.renderPassEncoder&&this.renderPassEncoder.end(),this.renderPassEncoder=null}setViewport(t){this.renderPassEncoder.setViewport(t.x,t.y,t.width,t.height,0,1)}setPipelineFromGeometryProgramAndState(t,i,e,n){const s=this.Yn.pipeline.getPipeline(t,i,e,n);this.setPipeline(s)}setPipeline(t){this.Zc!==t&&(this.Zc=t,this.renderPassEncoder.setPipeline(t))}Jc(t,i){this.Yc[t]!==i&&(this.Yc[t]=i,this.renderPassEncoder.setVertexBuffer(t,this.Yn.buffer.updateBuffer(i)))}tl(t){if(this.el===t)return;this.el=t;const i=2===t.data.BYTES_PER_ELEMENT?"uint16":"uint32";this.renderPassEncoder.setIndexBuffer(this.Yn.buffer.updateBuffer(t),i)}resetBindGroup(t){this.Xc[t]=null}setBindGroup(t,i,e){if(this.Xc[t]===i)return;this.Xc[t]=i,i.Vs(this.Yn.textureGC.count);const n=this.Yn.bindGroup.getBindGroup(i,e,t);this.renderPassEncoder.setBindGroup(t,n)}setGeometry(t,i){const e=this.Yn.pipeline.getBufferNamesToBind(t,i);for(const n in e)this.Jc(n,t.attributes[e[n]].buffer);t.indexBuffer&&this.tl(t.indexBuffer)}nl(t,i){for(const e in t.groups){const n=t.groups[e];i||this.sl(n),this.setBindGroup(e,n,t.gpuProgram)}}sl(t){for(const i in t.resources){const e=t.resources[i];e.isUniformGroup&&this.Yn.ubo.updateUniformGroup(e)}}draw(t){const{geometry:i,shader:e,state:n,topology:s,size:r,start:o,instanceCount:h,skipSync:a}=t;this.setPipelineFromGeometryProgramAndState(i,e.gpuProgram,n,s),this.setGeometry(i,e.gpuProgram),this.nl(e,a),i.indexBuffer?this.renderPassEncoder.drawIndexed(r||i.indexBuffer.data.length,h??i.instanceCount,o||0):this.renderPassEncoder.draw(r||i.getSize(),h??i.instanceCount,o||0)}finishRenderPass(){this.renderPassEncoder&&(this.renderPassEncoder.end(),this.renderPassEncoder=null)}postrender(){this.finishRenderPass(),this.zc.device.queue.submit([this.commandEncoder.finish()]),this.Kc(),this.commandEncoder=null}restoreRenderPass(){const t=this.Yn.renderTarget.adaptor.getDescriptor(this.Yn.renderTarget.renderTarget,!1,[0,0,0,1]);this.renderPassEncoder=this.commandEncoder.beginRenderPass(t);const i=this.Zc,e={...this.Yc},n=this.el,s={...this.Xc};this.Qc();const r=this.Yn.renderTarget.viewport;this.renderPassEncoder.setViewport(r.x,r.y,r.width,r.height,0,1),this.setPipeline(i);for(const o in e)this.Jc(o,e[o]);for(const o in s)this.setBindGroup(o,s[o],null);this.tl(n)}Qc(){for(let t=0;t<16;t++)this.Xc[t]=null,this.Yc[t]=null;this.el=null,this.Zc=null}destroy(){this.Yn=null,this.zc=null,this.Xc=null,this.Yc=null,this.el=null,this.Zc=null}contextChange(t){this.zc=t}}ed.extension={type:[ie.WebGPUSystem],name:"encoder",priority:1};class nd{constructor(t){this.Yn=t}contextChange(){this.maxTextures=this.Yn.device.gpu.device.limits.maxSampledTexturesPerShaderStage,this.maxBatchableTextures=this.maxTextures}destroy(){}}nd.extension={type:[ie.WebGPUSystem],name:"limits"};class sd{constructor(t){this.Ha=Object.create(null),this.Yn=t,t.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(t){let i=this.Ha[t.uid];i||(i=this.Ha[t.uid]={stencilMode:xh.DISABLED,stencilReference:0}),this.Ya=t,this.setStencilMode(i.stencilMode,i.stencilReference)}setStencilMode(t,i){const e=this.Ha[this.Ya.uid];e.stencilMode=t,e.stencilReference=i;const n=this.Yn;n.pipeline.setStencilMode(t),n.encoder.renderPassEncoder.setStencilReference(i)}destroy(){this.Yn.renderTarget.onRenderTargetChange.remove(this),this.Yn=null,this.Ya=null,this.Ha=null}}sd.extension={type:[ie.WebGPUSystem],name:"stencil"};const rd={i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},f16:{align:2,size:2},"vec2<i32>":{align:8,size:8},"vec2<u32>":{align:8,size:8},"vec2<f32>":{align:8,size:8},"vec2<f16>":{align:4,size:4},"vec3<i32>":{align:16,size:12},"vec3<u32>":{align:16,size:12},"vec3<f32>":{align:16,size:12},"vec3<f16>":{align:8,size:6},"vec4<i32>":{align:16,size:16},"vec4<u32>":{align:16,size:16},"vec4<f32>":{align:16,size:16},"vec4<f16>":{align:8,size:8},"mat2x2<f32>":{align:8,size:16},"mat2x2<f16>":{align:4,size:8},"mat3x2<f32>":{align:8,size:24},"mat3x2<f16>":{align:4,size:12},"mat4x2<f32>":{align:8,size:32},"mat4x2<f16>":{align:4,size:16},"mat2x3<f32>":{align:16,size:32},"mat2x3<f16>":{align:8,size:16},"mat3x3<f32>":{align:16,size:48},"mat3x3<f16>":{align:8,size:24},"mat4x3<f32>":{align:16,size:64},"mat4x3<f16>":{align:8,size:32},"mat2x4<f32>":{align:16,size:32},"mat2x4<f16>":{align:8,size:16},"mat3x4<f32>":{align:16,size:48},"mat3x4<f16>":{align:8,size:24},"mat4x4<f32>":{align:16,size:64},"mat4x4<f16>":{align:8,size:32}};function od(t){const i=t.map(t=>({data:t,offset:0,size:0}));let e=0;for(let n=0;n<i.length;n++){const t=i[n];let s=rd[t.data.type].size;const r=rd[t.data.type].align;if(!rd[t.data.type])throw new Error(`[Pixi.js] WebGPU UniformBuffer: Unknown type ${t.data.type}`);t.data.size>1&&(s=Math.max(s,r)*t.data.size),e=Math.ceil(e/r)*r,t.size=s,t.offset=e,e+=s}return e=16*Math.ceil(e/16),{uboElements:i,size:e}}function hd(t,i){const{size:e,align:n}=rd[t.data.type],s=(n-e)/4,r=t.data.type.indexOf("i32")>=0?"dataInt32":"data";return`\n         v = uv.${t.data.name};\n         ${0!==i?`offset += ${i};`:""}\n\n         arrayOffset = offset;\n\n         t = 0;\n\n         for(var i=0; i < ${t.data.size*(e/4)}; i++)\n         {\n             for(var j = 0; j < ${e/4}; j++)\n             {\n                 ${r}[arrayOffset++] = v[t++];\n             }\n             ${0!==s?`arrayOffset += ${s};`:""}\n         }\n     `}function ad(t){return ul(t,"uboWgsl",hd,fl)}class ud extends rl{constructor(){super({createUboElements:od,generateUboSync:ad})}}ud.extension={type:[ie.WebGPUSystem],name:"ubo"};const cd=128;class ld{constructor(t){this.rl=Object.create(null),this.ol=[],this.hl=[],this.al=[],this.Yn=t,this.Yn.renderableGC.addManagedHash(this,"_bindGroupHash"),this.ul=new Jf({minUniformOffsetAlignment:cd});for(let i=0;i<2;i++){let t=Uh.UNIFORM|Uh.COPY_DST;0===i&&(t|=Uh.COPY_SRC),this.ol.push(new Bh({data:this.ul.data,usage:t}))}}renderEnd(){this.cl(),this.ll()}ll(){for(const t in this.rl)this.rl[t]=null;this.ul.clear()}getUniformBindGroup(t,i){if(!i&&this.rl[t.uid])return this.rl[t.uid];this.Yn.ubo.ensureUniformGroup(t);const e=t.buffer.data,n=this.ul.addEmptyGroup(e.length);return this.Yn.ubo.syncUniformGroup(t,this.ul.data,n/4),this.rl[t.uid]=this.fl(n/cd),this.rl[t.uid]}getUboResource(t){this.Yn.ubo.updateUniformGroup(t);const i=t.buffer.data,e=this.ul.addGroup(i);return this.dl(e/cd)}getArrayBindGroup(t){const i=this.ul.addGroup(t);return this.fl(i/cd)}getArrayBufferResource(t){const i=this.ul.addGroup(t)/cd;return this.dl(i)}dl(t){if(!this.al[t]){const i=this.ol[t%2];this.al[t]=new Al({buffer:i,offset:256*(t/2|0),size:cd})}return this.al[t]}fl(t){if(!this.hl[t]){const i=new Nr({0:this.dl(t)});this.hl[t]=i}return this.hl[t]}cl(){const t=this.Yn.buffer,i=this.ol[0];i.update(this.ul.byteIndex),t.updateBuffer(i);const e=this.Yn.gpu.device.createCommandEncoder();for(let n=1;n<this.ol.length;n++){const s=this.ol[n];e.copyBufferToBuffer(t.getGPUBuffer(i),cd,t.getGPUBuffer(s),0,this.ul.byteIndex)}this.Yn.gpu.device.queue.submit([e.finish()])}destroy(){for(let t=0;t<this.hl.length;t++)this.hl[t].destroy();this.hl=null,this.rl=null;for(let t=0;t<this.ol.length;t++)this.ol[t].destroy();this.ol=null;for(let t=0;t<this.al.length;t++)this.al[t].destroy();this.al=null,this.ul.destroy(),this.rl=null,this.Yn=null}}ld.extension={type:[ie.WebGPUPipes],name:"uniformBatch"};const fd={"point-list":0,"line-list":1,"line-strip":2,"triangle-list":3,"triangle-strip":4};class dd{constructor(t){this.pl=Object.create(null),this.vl=Object.create(null),this.ml=Object.create(null),this.bl=Object.create(null),this.yl=Object.create(null),this.xl=15,this.wl=1,this.Yn=t}contextChange(t){this.zc=t,this.setStencilMode(xh.DISABLED),this.Ml()}setMultisampleCount(t){this.wl!==t&&(this.wl=t,this.Ml())}setRenderTarget(t){this.wl=t.msaaSamples,this.Al=t.descriptor.depthStencilAttachment?1:0,this.Ml()}setColorMask(t){this.xl!==t&&(this.xl=t,this.Ml())}setStencilMode(t){this.Tl!==t&&(this.Tl=t,this._l=nl[t],this.Ml())}setPipeline(t,i,e,n){const s=this.getPipeline(t,i,e);n.setPipeline(s)}getPipeline(t,i,e,n){t.Is||(Lc(t,i.attributeData),this.kl(t)),n||(n=t.topology);const s=function(t,i,e,n,s){return t<<24|i<<16|e<<10|n<<5|s}(t.Is,i.Is,e.data,e.Ys,fd[n]);return this.bl[s]||(this.bl[s]=this.Cl(t,i,e,n)),this.bl[s]}Cl(t,i,e,n){const s=this.zc.device,r=this.Sl(t,i),o=this.Yn.state.getColorTargets(e);o[0].writeMask=this.Tl===xh.RENDERING_MASK_ADD?0:this.xl;const h=this.Yn.shader.getProgramData(i).pipeline,a={vertex:{module:this.Pl(i.vertex.source),entryPoint:i.vertex.entryPoint,buffers:r},fragment:{module:this.Pl(i.fragment.source),entryPoint:i.fragment.entryPoint,targets:o},primitive:{topology:n,cullMode:e.cullMode},layout:h,multisample:{count:this.wl},label:"PIXI Pipeline"};this.Al&&(a.depthStencil={...this._l,format:"depth24plus-stencil8",depthWriteEnabled:e.depthTest,depthCompare:e.depthTest?"less":"always"});return s.createRenderPipeline(a)}Pl(t){return this.pl[t]||this.El(t)}El(t){const i=this.zc.device;return this.pl[t]=i.createShaderModule({code:t}),this.pl[t]}kl(t){const i=[];let e=0;const n=Object.keys(t.attributes).sort();for(let r=0;r<n.length;r++){const s=t.attributes[n[r]];i[e++]=s.offset,i[e++]=s.format,i[e++]=s.stride,i[e++]=s.instance}const s=i.join("|");return t.Is=xr(s,"geometry"),t.Is}Rl(t){const i=[];let e=0;const n=Object.keys(t.attributeData).sort();for(let r=0;r<n.length;r++){const s=t.attributeData[n[r]];i[e++]=s.location}const s=i.join("|");return t.js=xr(s,"programAttributes"),t.js}getBufferNamesToBind(t,i){const e=t.Is<<16|i.js;if(this.ml[e])return this.ml[e];const n=this.Sl(t,i),s=Object.create(null),r=i.attributeData;for(let o=0;o<n.length;o++){const t=Object.values(n[o].attributes)[0].shaderLocation;for(const i in r)if(r[i].location===t){s[o]=i;break}}return this.ml[e]=s,s}Sl(t,i){i.js||this.Rl(i);const e=t.Is<<16|i.js;if(this.vl[e])return this.vl[e];const n=[];return t.buffers.forEach(e=>{const s={arrayStride:0,stepMode:"vertex",attributes:[]},r=s.attributes;for(const n in i.attributeData){const o=t.attributes[n];1!==(o.divisor??1)&&_n(o.divisor),o.buffer===e&&(s.arrayStride=o.stride,s.stepMode=o.instance?"instance":"vertex",r.push({shaderLocation:i.attributeData[n].location,offset:o.offset,format:o.format}))}r.length&&n.push(s)}),this.vl[e]=n,n}Ml(){const t=(i=this.Tl,e=this.wl,n=this.xl,s=this.Al,n<<6|i<<3|s<<1|e);var i,e,n,s;this.yl[t]||(this.yl[t]=Object.create(null)),this.bl=this.yl[t]}destroy(){this.Yn=null,this.vl=null}}dd.extension={type:[ie.WebGPUSystem],name:"pipeline"};class pd{constructor(){this.contexts=[],this.msaaTextures=[],this.msaaSamples=1}}class vd{init(t,i){this.Yn=t,this.eu=i}copyToTexture(t,i,e,n,s){const r=this.Yn,o=this.Fl(t),h=r.texture.getGpuSource(i.source);return r.encoder.commandEncoder.copyTextureToTexture({texture:o,origin:e},{texture:h,origin:s},n),i}startRenderPass(t,i=!0,e,n){const s=this.eu.getGpuRenderTarget(t),r=this.getDescriptor(t,i,e);s.descriptor=r,this.Yn.pipeline.setRenderTarget(s),this.Yn.encoder.beginRenderPass(s),this.Yn.encoder.setViewport(n)}finishRenderPass(){this.Yn.encoder.endRenderPass()}Fl(t){const i=this.eu.getGpuRenderTarget(t);return i.contexts[0]?i.contexts[0].getCurrentTexture():this.Yn.texture.getGpuSource(t.colorTextures[0].source)}getDescriptor(t,i,e){"boolean"==typeof i&&(i=i?So.ALL:So.NONE);const n=this.eu,s=n.getGpuRenderTarget(t),r=t.colorTextures.map((t,r)=>{const o=s.contexts[r];let h,a;if(o){h=o.getCurrentTexture().createView()}else h=this.Yn.texture.getGpuSource(t).createView({mipLevelCount:1});s.msaaTextures[r]&&(a=h,h=this.Yn.texture.getTextureView(s.msaaTextures[r]));const u=i&So.COLOR?"clear":"load";return e??(e=n.defaultClearColor),{view:h,resolveTarget:a,clearValue:e,storeOp:"store",loadOp:u}});let o;if(!t.stencil&&!t.depth||t.depthStencilTexture||(t.ensureDepthStencilTexture(),t.depthStencilTexture.source.sampleCount=s.msaa?4:1),t.depthStencilTexture){const e=i&So.STENCIL?"clear":"load",n=i&So.DEPTH?"clear":"load";o={view:this.Yn.texture.getGpuSource(t.depthStencilTexture.source).createView(),stencilStoreOp:"store",stencilLoadOp:e,depthClearValue:1,depthLoadOp:n,depthStoreOp:"store"}}return{colorAttachments:r,depthStencilAttachment:o}}clear(t,i=!0,e,n){if(!i)return;const{gpu:s,encoder:r}=this.Yn,o=s.device;if(null===r.commandEncoder){const s=o.createCommandEncoder(),r=this.getDescriptor(t,i,e),h=s.beginRenderPass(r);h.setViewport(n.x,n.y,n.width,n.height,0,1),h.end();const a=s.finish();o.queue.submit([a])}else this.startRenderPass(t,i,e,n)}initGpuRenderTarget(t){t.isRoot=!0;const i=new pd;return t.colorTextures.forEach((t,e)=>{if(t instanceof As){const n=t.resource.getContext("webgpu"),s=t.transparent?"premultiplied":"opaque";try{n.configure({device:this.Yn.gpu.device,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,format:"bgra8unorm",alphaMode:s})}catch(Qv){}i.contexts[e]=n}if(i.msaa=t.source.antialias,t.source.antialias){const t=new ze({width:0,height:0,sampleCount:4});i.msaaTextures[e]=t}}),i.msaa&&(i.msaaSamples=4,t.depthStencilTexture&&(t.depthStencilTexture.source.sampleCount=4)),i}destroyGpuRenderTarget(t){t.contexts.forEach(t=>{t.unconfigure()}),t.msaaTextures.forEach(t=>{t.destroy()}),t.msaaTextures.length=0,t.contexts.length=0}ensureDepthStencilTexture(t){const i=this.eu.getGpuRenderTarget(t);t.depthStencilTexture&&i.msaa&&(t.depthStencilTexture.source.sampleCount=4)}resizeGpuRenderTarget(t){const i=this.eu.getGpuRenderTarget(t);i.width=t.width,i.height=t.height,i.msaa&&t.colorTextures.forEach((t,e)=>{const n=i.msaaTextures[e];null==n||n.resize(t.source.width,t.source.height,t.source.si)})}}class md extends wl{constructor(t){super(t),this.adaptor=new vd,this.adaptor.init(t,this)}}md.extension={type:[ie.WebGPUSystem],name:"renderTarget"};class gd{constructor(){this.Ol=Object.create(null)}contextChange(t){this.zc=t}getProgramData(t){return this.Ol[t.Is]||this.$l(t)}$l(t){const i=this.zc.device,e=t.gpuLayout.map(t=>i.createBindGroupLayout({entries:t})),n={bindGroupLayouts:e};return this.Ol[t.Is]={bindGroups:e,pipeline:i.createPipelineLayout(n)},this.Ol[t.Is]}destroy(){this.zc=null,this.Ol=null}}gd.extension={type:[ie.WebGPUSystem],name:"shader"};const bd={normal:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}},add:{alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one",operation:"add"}},multiply:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"dst",dstFactor:"one-minus-src-alpha",operation:"add"}},screen:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}},overlay:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}},none:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"zero",operation:"add"}},"normal-npm":{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}},"add-npm":{alpha:{srcFactor:"one",dstFactor:"one",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one",operation:"add"}},"screen-npm":{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src",operation:"add"}},erase:{alpha:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"one-minus-src",operation:"add"}},min:{alpha:{srcFactor:"one",dstFactor:"one",operation:"min"},color:{srcFactor:"one",dstFactor:"one",operation:"min"}},max:{alpha:{srcFactor:"one",dstFactor:"one",operation:"max"},color:{srcFactor:"one",dstFactor:"one",operation:"max"}}};class yd{constructor(){this.defaultState=new Xr,this.defaultState.blend=!0}contextChange(t){this.gpu=t}getColorTargets(t){return[{format:"bgra8unorm",writeMask:0,blend:bd[t.blendMode]||bd.normal}]}destroy(){this.gpu=null}}yd.extension={type:[ie.WebGPUSystem],name:"state"};const xd={type:"image",upload(t,i,e){const n=t.resource,s=(0|t.pixelWidth)*(0|t.pixelHeight),r=n.byteLength/s;e.device.queue.writeTexture({texture:i},n,{offset:0,rowsPerImage:t.pixelHeight,bytesPerRow:t.pixelHeight*r},{width:t.pixelWidth,height:t.pixelHeight,depthOrArrayLayers:1})}},wd={"bc1-rgba-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"bc2-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc3-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc7-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"etc1-rgb-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"etc2-rgba8unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"astc-4x4-unorm":{blockBytes:16,blockWidth:4,blockHeight:4}},Md={blockBytes:4,blockWidth:1,blockHeight:1},Ad={type:"compressed",upload(t,i,e){let n=t.pixelWidth,s=t.pixelHeight;const r=wd[t.format]||Md;for(let o=0;o<t.resource.length;o++){const h=t.resource[o],a=Math.ceil(n/r.blockWidth)*r.blockBytes;e.device.queue.writeTexture({texture:i,mipLevel:o},h,{offset:0,bytesPerRow:a},{width:Math.ceil(n/r.blockWidth)*r.blockWidth,height:Math.ceil(s/r.blockHeight)*r.blockHeight,depthOrArrayLayers:1}),n=Math.max(n>>1,1),s=Math.max(s>>1,1)}}},Td={type:"image",upload(t,i,e){const n=t.resource;if(!n)return;if(globalThis.HTMLImageElement&&n instanceof HTMLImageElement){const i=Ms.get().createCanvas(n.width,n.height);i.getContext("2d").drawImage(n,0,0,n.width,n.height),t.resource=i,_n()}const s=Math.min(i.width,t.resourceWidth||t.pixelWidth),r=Math.min(i.height,t.resourceHeight||t.pixelHeight),o="premultiply-alpha-on-upload"===t.alphaMode;e.device.queue.copyExternalImageToTexture({source:n},{texture:i,premultipliedAlpha:o},{width:s,height:r})}},_d={type:"video",upload(t,i,e){Td.upload(t,i,e)}};class kd{constructor(t){this.device=t,this.sampler=t.createSampler({minFilter:"linear"}),this.pipelines={}}Ul(t){let i=this.pipelines[t];return i||(this.mipmapShaderModule||(this.mipmapShaderModule=this.device.createShaderModule({code:"\n                        var<private> pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(\n                        vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 3.0), vec2<f32>(3.0, -1.0));\n\n                        struct VertexOutput {\n                        @builtin(position) position : vec4<f32>,\n                        @location(0) texCoord : vec2<f32>,\n                        };\n\n                        @vertex\n                        fn vertexMain(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {\n                        var output : VertexOutput;\n                        output.texCoord = pos[vertexIndex] * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5);\n                        output.position = vec4<f32>(pos[vertexIndex], 0.0, 1.0);\n                        return output;\n                        }\n\n                        @group(0) @binding(0) var imgSampler : sampler;\n                        @group(0) @binding(1) var img : texture_2d<f32>;\n\n                        @fragment\n                        fn fragmentMain(@location(0) texCoord : vec2<f32>) -> @location(0) vec4<f32> {\n                        return textureSample(img, imgSampler, texCoord);\n                        }\n                    "})),i=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.mipmapShaderModule,entryPoint:"vertexMain"},fragment:{module:this.mipmapShaderModule,entryPoint:"fragmentMain",targets:[{format:t}]}}),this.pipelines[t]=i),i}generateMipmap(t){const i=this.Ul(t.format);if("3d"===t.dimension||"1d"===t.dimension)throw new Error("Generating mipmaps for non-2d textures is currently unsupported!");let e=t;const n=t.depthOrArrayLayers||1,s=t.usage&GPUTextureUsage.RENDER_ATTACHMENT;if(!s){const i={size:{width:Math.ceil(t.width/2),height:Math.ceil(t.height/2),depthOrArrayLayers:n},format:t.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT,mipLevelCount:t.mipLevelCount-1};e=this.device.createTexture(i)}const r=this.device.createCommandEncoder({}),o=i.getBindGroupLayout(0);for(let h=0;h<n;++h){let n=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:"2d",baseArrayLayer:h,arrayLayerCount:1}),a=s?1:0;for(let s=1;s<t.mipLevelCount;++s){const t=e.createView({baseMipLevel:a++,mipLevelCount:1,dimension:"2d",baseArrayLayer:h,arrayLayerCount:1}),s=r.beginRenderPass({colorAttachments:[{view:t,storeOp:"store",loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0}}]}),u=this.device.createBindGroup({layout:o,entries:[{binding:0,resource:this.sampler},{binding:1,resource:n}]});s.setPipeline(i),s.setBindGroup(0,u),s.draw(3,1,0,0),s.end(),n=t}}if(!s){const i={width:Math.ceil(t.width/2),height:Math.ceil(t.height/2),depthOrArrayLayers:n};for(let n=1;n<t.mipLevelCount;++n)r.copyTextureToTexture({texture:e,mipLevel:n-1},{texture:t,mipLevel:n},i),i.width=Math.ceil(i.width/2),i.height=Math.ceil(i.height/2)}return this.device.queue.submit([r.finish()]),s||e.destroy(),t}}class Cd{constructor(t){this.managedTextures=[],this.Bl=Object.create(null),this.Il=Object.create(null),this.rl=Object.create(null),this.jl=Object.create(null),this.Gu={image:Td,buffer:xd,video:_d,compressed:Ad},this.Yn=t,t.renderableGC.addManagedHash(this,"_gpuSources"),t.renderableGC.addManagedHash(this,"_gpuSamplers"),t.renderableGC.addManagedHash(this,"_bindGroupHash"),t.renderableGC.addManagedHash(this,"_textureViewHash")}contextChange(t){this.zc=t}initSource(t){return this.Bl[t.uid]?this.Bl[t.uid]:this.Xu(t)}Xu(t){if(t.autoGenerateMipmaps){const i=Math.max(t.pixelWidth,t.pixelHeight);t.mipLevelCount=Math.floor(Math.log2(i))+1}let i=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST;"compressed"!==t.uploadMethodId&&(i|=GPUTextureUsage.RENDER_ATTACHMENT,i|=GPUTextureUsage.COPY_SRC);const e=wd[t.format]||{blockWidth:1,blockHeight:1},n=Math.ceil(t.pixelWidth/e.blockWidth)*e.blockWidth,s=Math.ceil(t.pixelHeight/e.blockHeight)*e.blockHeight,r={label:t.label,size:{width:n,height:s},format:t.format,sampleCount:t.sampleCount,mipLevelCount:t.mipLevelCount,dimension:t.dimension,usage:i},o=this.Bl[t.uid]=this.zc.device.createTexture(r);return this.managedTextures.includes(t)||(t.on("update",this.onSourceUpdate,this),t.on("resize",this.onSourceResize,this),t.on("destroy",this.onSourceDestroy,this),t.on("unload",this.onSourceUnload,this),t.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(t)),this.onSourceUpdate(t),o}onSourceUpdate(t){const i=this.getGpuSource(t);i&&(this.Gu[t.uploadMethodId]&&this.Gu[t.uploadMethodId].upload(t,i,this.zc),t.autoGenerateMipmaps&&t.mipLevelCount>1&&this.onUpdateMipmaps(t))}onSourceUnload(t){const i=this.Bl[t.uid];i&&(this.Bl[t.uid]=null,i.destroy())}onUpdateMipmaps(t){this.Gl||(this.Gl=new kd(this.zc.device));const i=this.getGpuSource(t);this.Gl.generateMipmap(i)}onSourceDestroy(t){t.off("update",this.onSourceUpdate,this),t.off("unload",this.onSourceUnload,this),t.off("destroy",this.onSourceDestroy,this),t.off("resize",this.onSourceResize,this),t.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(t),1),this.onSourceUnload(t)}onSourceResize(t){const i=this.Bl[t.uid];i?i.width===t.pixelWidth&&i.height===t.pixelHeight||(this.jl[t.uid]=null,this.rl[t.uid]=null,this.onSourceUnload(t),this.initSource(t)):this.initSource(t)}Yu(t){return this.Il[t.ii]=this.zc.device.createSampler(t),this.Il[t.ii]}getGpuSampler(t){return this.Il[t.ii]||this.Yu(t)}getGpuSource(t){return this.Bl[t.uid]||this.initSource(t)}getTextureBindGroup(t){return this.rl[t.uid]??this.zl(t)}zl(t){const i=t.source;return this.rl[t.uid]=new Nr({0:i,1:i.style,2:new Lr({uTextureMatrix:{type:"mat3x3<f32>",value:t.textureMatrix.mapCoord}})}),this.rl[t.uid]}getTextureView(t){const i=t.source;return this.jl[i.uid]??this.Dl(i)}Dl(t){return this.jl[t.uid]=this.getGpuSource(t).createView(),this.jl[t.uid]}generateCanvas(t){const i=this.Yn,e=i.gpu.device.createCommandEncoder(),n=Ms.get().createCanvas();n.width=t.source.pixelWidth,n.height=t.source.pixelHeight;const s=n.getContext("webgpu");return s.configure({device:i.gpu.device,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,format:Ms.get().getNavigator().gpu.getPreferredCanvasFormat(),alphaMode:"premultiplied"}),e.copyTextureToTexture({texture:i.texture.getGpuSource(t.source),origin:{x:0,y:0}},{texture:s.getCurrentTexture()},{width:n.width,height:n.height}),i.gpu.device.queue.submit([e.finish()]),n}getPixels(t){const i=this.generateCanvas(t),e=$u.getOptimalCanvasAndContext(i.width,i.height),n=e.context;n.drawImage(i,0,0);const{width:s,height:r}=i,o=n.getImageData(0,0,s,r),h=new Uint8ClampedArray(o.data.buffer);return $u.returnCanvasAndContext(e),{pixels:h,width:s,height:r}}destroy(){this.managedTextures.slice().forEach(t=>this.onSourceDestroy(t)),this.managedTextures=null;for(const t of Object.keys(this.rl)){const i=Number(t),e=this.rl[i];null==e||e.destroy(),this.rl[i]=null}this.zc=null,this.Gl=null,this.Bl=null,this.rl=null,this.jl=null,this.Il=null}}Cd.extension={type:[ie.WebGPUSystem],name:"texture"};class Sd{constructor(){this.Ll=0}contextChange(t){const i=new Lr({uTransformMatrix:{value:new ve,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}});this.Ll=t.limits.maxBatchableTextures;const e=sa({name:"graphics",bits:[oa,la(this.Ll),Sc,va]});this.shader=new Wr({gpuProgram:e,resources:{localUniforms:i}})}execute(t,i){const e=i.context,n=e.customShader||this.shader,s=t.renderer,r=s.graphicsContext,{batcher:o,instructions:h}=r.getContextRenderData(e),a=s.encoder;a.setGeometry(o.geometry,n.gpuProgram);const u=s.globalUniforms.bindGroup;a.setBindGroup(0,u,n.gpuProgram);const c=s.renderPipes.uniformBatch.getUniformBindGroup(n.resources.localUniforms,!0);a.setBindGroup(2,c,n.gpuProgram);const l=h.instructions;let f=null;for(let d=0;d<h.instructionSize;d++){const i=l[d];if(i.topology!==f&&(f=i.topology,a.setPipelineFromGeometryProgramAndState(o.geometry,n.gpuProgram,t.state,i.topology)),n.groups[1]=i.bindGroup,!i.gpuBindGroup){const t=i.textures;i.bindGroup=mh(t.textures,t.count,this.Ll),i.gpuBindGroup=s.bindGroup.getBindGroup(i.bindGroup,n.gpuProgram,1)}a.setBindGroup(1,i.bindGroup,n.gpuProgram),a.renderPassEncoder.drawIndexed(i.size,1,i.start)}}destroy(){this.shader.destroy(!0),this.shader=null}}Sd.extension={type:[ie.WebGPUPipesAdaptor],name:"graphics"};class Pd{init(){const t=sa({name:"mesh",bits:[Cc,Ec,va]});this.ua=new Wr({gpuProgram:t,resources:{uTexture:Ve.EMPTY.di,uSampler:Ve.EMPTY.di.style,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new ve}}}})}execute(t,i){const e=t.renderer;let n=i.ua;if(n){if(!n.gpuProgram)return void _n(i.shader)}else n=this.ua,n.groups[2]=e.texture.getTextureBindGroup(i.texture);const s=n.gpuProgram;if(s.autoAssignGlobalUniforms&&(n.groups[0]=e.globalUniforms.bindGroup),s.autoAssignLocalUniforms){const i=t.localUniforms;n.groups[1]=e.renderPipes.uniformBatch.getUniformBindGroup(i,!0)}e.encoder.draw({geometry:i.ca,shader:n,state:i.state})}destroy(){this.ua.destroy(!0),this.ua=null}}Pd.extension={type:[ie.WebGPUPipesAdaptor],name:"mesh"};const Ed=[...Lf,ud,ed,id,nd,Zf,Cd,md,gd,yd,dd,td,sd,Qf],Rd=[...Nf,ld],Fd=[Tc,Pd,Sd],Od=[],$d=[],Ud=[];se.handleByNamedList(ie.WebGPUSystem,Od),se.handleByNamedList(ie.WebGPUPipes,$d),se.handleByNamedList(ie.WebGPUPipesAdaptor,Ud),se.add(...Ed,...Rd,...Fd);const Bd=Object.freeze(Object.defineProperty({__proto__:null,WebGPURenderer:class extends $o{constructor(){super({name:"webgpu",type:Vr.WEBGPU,systems:Od,renderPipes:$d,renderPipeAdaptors:Ud})}}},Symbol.toStringTag,{value:"Module"}));class Id{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach(t=>{Cn.return(t)}),this.batches.length=0}}class jd{constructor(t,i){this.state=Xr.for2d(),this.renderer=t,this.da=i,this.renderer.runners.contextChange.add(this)}contextChange(){this.da.contextChange(this.renderer)}validateRenderable(t){const i=t.context,e=!!t.Te,n=this.renderer.graphicsContext.updateGpuContext(i);return!(!n.isBatchable&&e===n.isBatchable)}addRenderable(t,i){const e=this.renderer.graphicsContext.updateGpuContext(t.context);t.didViewUpdate&&this.Nl(t),e.isBatchable?this.Vl(t,i):(this.renderer.renderPipes.batch.break(i),i.add(t))}updateRenderable(t){const i=this.Wl(t).batches;for(let e=0;e<i.length;e++){const t=i[e];t.Hr.updateElement(t)}}execute(t){if(!t.isRenderable)return;const i=this.renderer,e=t.context;if(!i.graphicsContext.getGpuContext(e).batches.length)return;const n=e.customShader||this.da.shader;this.state.blendMode=t.groupBlendMode;const s=n.resources.localUniforms.uniforms;s.uTransformMatrix=t.groupTransform,s.uRound=i.Me|t.Me,Sf(t.groupColorAlpha,s.uColor,0),this.da.execute(this,t)}Nl(t){const i=this.Wl(t),e=this.renderer.graphicsContext.updateGpuContext(t.context);i.destroy(),e.isBatchable&&this.Hl(t,i)}Vl(t,i){const e=this.renderer.renderPipes.batch,n=this.Wl(t).batches;for(let s=0;s<n.length;s++){const t=n[s];e.addToBatch(t,i)}}Wl(t){return t.Te[this.renderer.uid]||this.ql(t)}ql(t){const i=new Id;return t.Te[this.renderer.uid]=i,i}Hl(t,i){const e=t.context,n=this.renderer.graphicsContext.getGpuContext(e),s=this.renderer.Me|t.Me;i.batches=n.batches.map(i=>{const e=Cn.get(_a);return i.copyTo(e),e.renderable=t,e.roundPixels=s,e})}destroy(){this.renderer=null,this.da.destroy(),this.da=null,this.state=null}}jd.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"graphics"};const Gd=class t extends ac{constructor(...t){super({});let i=t[0]??{};"number"==typeof i&&(Re(0,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),i={width:i,height:t[1],verticesX:t[2],verticesY:t[3]}),this.build(i)}build(i){i={...t.defaultOptions,...i},this.verticesX=this.verticesX??i.verticesX,this.verticesY=this.verticesY??i.verticesY,this.width=this.width??i.width,this.height=this.height??i.height;const e=this.verticesX*this.verticesY,n=[],s=[],r=[],o=this.verticesX-1,h=this.verticesY-1,a=this.width/o,u=this.height/h;for(let t=0;t<e;t++){const i=t%this.verticesX,e=t/this.verticesX|0;n.push(i*a,e*u),s.push(i/o,e/h)}const c=o*h;for(let t=0;t<c;t++){const i=t%o,e=t/o|0,n=e*this.verticesX+i,s=e*this.verticesX+i+1,h=(e+1)*this.verticesX+i,a=(e+1)*this.verticesX+i+1;r.push(n,s,h,s,a,h)}this.buffers[0].data=new Float32Array(n),this.buffers[1].data=new Float32Array(s),this.indexBuffer.data=new Uint32Array(r),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};Gd.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let zd=Gd;class Dd{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this.Hr=null,this.qr=null,this.Xl=-1,this.Yl=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this.Kl||this.geometry.topology}set topology(t){this.Kl=t}reset(){this.renderable=null,this.texture=null,this.Hr=null,this.qr=null,this.geometry=null,this.Yl=-1,this.Xl=-1}setTexture(t){this.texture!==t&&(this.texture=t,this.Xl=-1)}get uvs(){const t=this.geometry.getBuffer("aUV"),i=t.data;let e=i;const n=this.texture.textureMatrix;return n.isSimple||(e=this.Ql,this.Xl===n.li&&this.Yl===t.li||((!e||e.length<i.length)&&(e=this.Ql=new Float32Array(i.length)),this.Xl=n.li,this.Yl=t.li,n.multiplyUvs(i,e))),e}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}class Ld{destroy(){}}class Nd{constructor(t,i){this.localUniforms=new Lr({uTransformMatrix:{value:new ve,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new Nr({0:this.localUniforms}),this.renderer=t,this.da=i,this.da.init()}validateRenderable(t){const i=this.Zl(t),e=i.batched,n=t.batched;if(i.batched=n,e!==n)return!0;if(n){const e=t.ca;if(e.indices.length!==i.indexSize||e.positions.length!==i.vertexSize)return i.indexSize=e.indices.length,i.vertexSize=e.positions.length,!0;const n=this.Jl(t);return n.texture.uid!==t.fi.uid&&(n.Xl=-1),!n.Hr.checkAndUpdateTexture(n,t.fi)}return!1}addRenderable(t,i){var e,n;const s=this.renderer.renderPipes.batch,r=this.Zl(t);if(t.didViewUpdate&&(r.indexSize=null==(e=t.ca.indices)?void 0:e.length,r.vertexSize=null==(n=t.ca.positions)?void 0:n.length),r.batched){const e=this.Jl(t);e.setTexture(t.fi),e.geometry=t.ca,s.addToBatch(e,i)}else s.break(i),i.add(t)}updateRenderable(t){if(t.batched){const i=this.Jl(t);i.setTexture(t.fi),i.geometry=t.ca,i.Hr.updateElement(i)}}execute(t){if(!t.isRenderable)return;t.state.blendMode=wh(t.groupBlendMode,t.texture.di);const i=this.localUniforms;i.uniforms.uTransformMatrix=t.groupTransform,i.uniforms.uRound=this.renderer.Me|t.Me,i.update(),Sf(t.groupColorAlpha,i.uniforms.uColor,0),this.da.execute(this,t)}Zl(t){var i,e;return(i=t.Te)[e=this.renderer.uid]||(i[e]=new Ld),t.Te[this.renderer.uid].meshData||this.tf(t)}tf(t){return t.Te[this.renderer.uid].meshData={batched:t.batched,indexSize:0,vertexSize:0},t.Te[this.renderer.uid].meshData}Jl(t){var i,e;return(i=t.Te)[e=this.renderer.uid]||(i[e]=new Ld),t.Te[this.renderer.uid].batchableMesh||this.if(t)}if(t){const i=new Dd;return i.renderable=t,i.setTexture(t.fi),i.transform=t.groupTransform,i.roundPixels=this.renderer.Me|t.Me,t.Te[this.renderer.uid].batchableMesh=i,i}destroy(){this.localUniforms=null,this.localUniformsBindGroup=null,this.da.destroy(),this.da=null,this.renderer=null}}Nd.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"mesh"};class Vd{execute(t,i){const e=t.state,n=t.renderer,s=i.shader||t.defaultShader;s.resources.uTexture=i.texture.di,s.resources.uniforms=t.localUniforms;const r=n.gl,o=t.getBuffers(i);n.shader.bind(s),n.state.set(e),n.geometry.bind(o.geometry,s.glProgram);const h=2===o.geometry.indexBuffer.data.BYTES_PER_ELEMENT?r.UNSIGNED_SHORT:r.UNSIGNED_INT;r.drawElements(r.TRIANGLES,6*i.particleChildren.length,h,0)}}class Wd{execute(t,i){const e=t.renderer,n=i.shader||t.defaultShader;n.groups[0]=e.renderPipes.uniformBatch.getUniformBindGroup(t.localUniforms,!0),n.groups[1]=e.texture.getTextureBindGroup(i.texture);const s=t.state,r=t.getBuffers(i);e.encoder.draw({geometry:r.geometry,shader:i.shader||t.defaultShader,state:s,size:6*i.particleChildren.length})}}function Hd(t,i=null){const e=6*t;if(e>65535?i||(i=new Uint32Array(e)):i||(i=new Uint16Array(e)),i.length!==e)throw new Error(`Out buffer length is incorrect, got ${i.length} and expected ${e}`);for(let n=0,s=0;n<e;n+=6,s+=4)i[n+0]=s+0,i[n+1]=s+1,i[n+2]=s+2,i[n+3]=s+0,i[n+4]=s+2,i[n+5]=s+3;return i}function qd(t,i){const e=[];e.push("\n\n        var index = 0;\n\n        for (let i = 0; i < ps.length; ++i)\n        {\n            const p = ps[i];\n\n            ");let n=0;for(const r in t){const s=t[r];if(i!==s.dynamic)continue;e.push(`offset = index + ${n}`),e.push(s.code);n+=Fr(s.format).stride/4}e.push("\n            index += stride * 4;\n        }\n    "),e.unshift(`\n        var stride = ${n};\n    `);const s=e.join("\n");return new Function("ps","f32v","u32v",s)}class Xd{constructor(t){this.hu=0,this.ef={};const i=this.hu=t.size??1e3,e=t.properties;let n=0,s=0;for(const u in e){const t=e[u],i=Fr(t.format);t.dynamic?s+=i.stride:n+=i.stride}this.nf=s/4,this.sf=n/4,this.staticAttributeBuffer=new gh(4*i*n),this.dynamicAttributeBuffer=new gh(4*i*s),this.indexBuffer=Hd(i);const r=new jh;let o=0,h=0;this.rf=new Bh({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:Uh.VERTEX|Uh.COPY_DST}),this.hf=new Bh({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:Uh.VERTEX|Uh.COPY_DST});for(const u in e){const t=e[u],i=Fr(t.format);t.dynamic?(r.addAttribute(t.attributeName,{buffer:this.hf,stride:4*this.nf,offset:4*o,format:t.format}),o+=i.size):(r.addAttribute(t.attributeName,{buffer:this.rf,stride:4*this.sf,offset:4*h,format:t.format}),h+=i.size)}r.addIndex(this.indexBuffer);const a=this.getParticleUpdate(e);this.af=a.dynamicUpdate,this.uf=a.staticUpdate,this.geometry=r}getParticleUpdate(t){const i=function(t){const i=[];for(const e in t){const n=t[e];i.push(e,n.code,n.dynamic?"d":"s")}return i.join("_")}(t);return this.ef[i]||(this.ef[i]=this.generateParticleUpdate(t)),this.ef[i]}generateParticleUpdate(t){return function(t){return{dynamicUpdate:qd(t,!0),staticUpdate:qd(t,!1)}}(t)}update(t,i){t.length>this.hu&&(i=!0,this.hu=Math.max(t.length,1.5*this.hu|0),this.staticAttributeBuffer=new gh(this.hu*this.sf*4*4),this.dynamicAttributeBuffer=new gh(this.hu*this.nf*4*4),this.indexBuffer=Hd(this.hu),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));const e=this.dynamicAttributeBuffer;if(this.af(t,e.float32View,e.uint32View),this.hf.setDataWithSize(this.dynamicAttributeBuffer.float32View,t.length*this.nf*4,!0),i){const i=this.staticAttributeBuffer;this.uf(t,i.float32View,i.uint32View),this.rf.setDataWithSize(i.float32View,t.length*this.sf*4,!0)}}destroy(){this.rf.destroy(),this.hf.destroy(),this.geometry.destroy()}}var Yd="\nstruct ParticleUniforms {\n  uProjectionMatrix:mat3x3<f32>,\n  uColor:vec4<f32>,\n  uResolution:vec2<f32>,\n  uRoundPixels:f32,\n};\n\n@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;\n\n@group(1) @binding(0) var uTexture: texture_2d<f32>;\n@group(1) @binding(1) var uSampler : sampler;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) color : vec4<f32>,\n  };\n@vertex\nfn mainVertex(\n  @location(0) aVertex: vec2<f32>,\n  @location(1) aPosition: vec2<f32>,\n  @location(2) aUV: vec2<f32>,\n  @location(3) aColor: vec4<f32>,\n  @location(4) aRotation: f32,\n) -> VSOutput {\n  \n   let v = vec2(\n       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),\n       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)\n   ) + aPosition;\n\n   let position = vec4((uniforms.uProjectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;\n\n  return VSOutput(\n   position,\n   aUV,\n   vColor,\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) color: vec4<f32>,\n  @builtin(position) position: vec4<f32>,\n) -> @location(0) vec4<f32> {\n\n    var sample = textureSample(uTexture, uSampler, uv) * color;\n   \n    return sample;\n}";class Kd extends Wr{constructor(){super({glProgram:Er.from({vertex:"attribute vec2 aVertex;\nattribute vec2 aUV;\nattribute vec4 aColor;\n\nattribute vec2 aPosition;\nattribute float aRotation;\n\nuniform mat3 uTranslationMatrix;\nuniform float uRound;\nuniform vec2 uResolution;\nuniform vec4 uColor;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n\nvec2 roundPixels(vec2 position, vec2 targetSize)\n{       \n    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\nvoid main(void){\n    float cosRotation = cos(aRotation);\n    float sinRotation = sin(aRotation);\n    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;\n    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;\n\n    vec2 v = vec2(x, y);\n    v = v + aPosition;\n\n    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    if(uRound == 1.0)\n    {\n        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n    }\n\n    vUV = aUV;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;\n}\n",fragment:"varying vec2 vUV;\nvarying vec4 vColor;\n\nuniform sampler2D uTexture;\n\nvoid main(void){\n    vec4 color = texture2D(uTexture, vUV) * vColor;\n    gl_FragColor = color;\n}"}),gpuProgram:Ir.from({fragment:{source:Yd,entryPoint:"mainFragment"},vertex:{source:Yd,entryPoint:"mainVertex"}}),resources:{uTexture:Ve.WHITE.source,uSampler:new je({}),uniforms:{uTranslationMatrix:{value:new ve,type:"mat3x3<f32>"},uColor:{value:new An(16777215),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}class Qd{constructor(t,i){this.state=Xr.for2d(),this.localUniforms=new Lr({uTranslationMatrix:{value:new ve,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=t,this.adaptor=i,this.defaultShader=new Kd,this.state=Xr.for2d()}validateRenderable(t){return!1}addRenderable(t,i){this.renderer.renderPipes.batch.break(i),i.add(t)}getBuffers(t){return t.Te[this.renderer.uid]||this.cf(t)}cf(t){return t.Te[this.renderer.uid]=new Xd({size:t.particleChildren.length,properties:t.lf}),t.Te[this.renderer.uid]}updateRenderable(t){}execute(t){const i=t.particleChildren;if(0===i.length)return;const e=this.renderer,n=this.getBuffers(t);t.texture||(t.texture=i[0].texture);const s=this.state;n.update(i,t.ff),t.ff=!1,s.blendMode=wh(t.blendMode,t.texture.di);const r=this.localUniforms.uniforms,o=r.uTranslationMatrix;t.worldTransform.copyTo(o),o.prepend(e.globalUniforms.globalUniformData.projectionMatrix),r.uResolution=e.globalUniforms.globalUniformData.resolution,r.uRound=e.Me|t.Me,Sf(t.groupColorAlpha,r.uColor,0),this.adaptor.execute(this,t)}destroy(){this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}class Zd extends Qd{constructor(t){super(t,new Vd)}}Zd.extension={type:[ie.WebGLPipes],name:"particle"};class Jd extends Qd{constructor(t){super(t,new Wd)}}Jd.extension={type:[ie.WebGPUPipes],name:"particle"};const tp=class t extends zd{constructor(i={}){super({width:(i={...t.defaultOptions,...i}).width,height:i.height,verticesX:4,verticesY:4}),this.update(i)}update(t){var i,e;this.width=t.width??this.width,this.height=t.height??this.height,this.df=t.originalWidth??this.df,this.pf=t.originalHeight??this.pf,this.vf=t.leftWidth??this.vf,this.mf=t.rightWidth??this.mf,this.gf=t.topHeight??this.gf,this.bf=t.bottomHeight??this.bf,this.yf=null==(i=t.anchor)?void 0:i.x,this.xf=null==(e=t.anchor)?void 0:e.y,this.updateUvs(),this.updatePositions()}updatePositions(){const t=this.positions,{width:i,height:e,vf:n,mf:s,gf:r,bf:o,yf:h,xf:a}=this,u=n+s,c=i>u?1:i/u,l=r+o,f=e>l?1:e/l,d=Math.min(c,f),p=h*i,v=a*e;t[0]=t[8]=t[16]=t[24]=-p,t[2]=t[10]=t[18]=t[26]=n*d-p,t[4]=t[12]=t[20]=t[28]=i-s*d-p,t[6]=t[14]=t[22]=t[30]=i-p,t[1]=t[3]=t[5]=t[7]=-v,t[9]=t[11]=t[13]=t[15]=r*d-v,t[17]=t[19]=t[21]=t[23]=e-o*d-v,t[25]=t[27]=t[29]=t[31]=e-v,this.getBuffer("aPosition").update()}updateUvs(){const t=this.uvs;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1;const i=1/this.df,e=1/this.pf;t[2]=t[10]=t[18]=t[26]=i*this.vf,t[9]=t[11]=t[13]=t[15]=e*this.gf,t[4]=t[12]=t[20]=t[28]=1-i*this.mf,t[17]=t[19]=t[21]=t[23]=1-e*this.bf,this.getBuffer("aUV").update()}};tp.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};let ip=tp;class ep extends Dd{constructor(){super(),this.geometry=new ip}destroy(){this.geometry.destroy()}}class np{constructor(t){this.Yn=t}addRenderable(t,i){const e=this.oc(t);t.didViewUpdate&&this.hc(t,e),this.Yn.renderPipes.batch.addToBatch(e,i)}updateRenderable(t){const i=this.oc(t);t.didViewUpdate&&this.hc(t,i),i.Hr.updateElement(i)}validateRenderable(t){const i=this.oc(t);return!i.Hr.checkAndUpdateTexture(i,t.fi)}hc(t,i){i.geometry.update(t),i.setTexture(t.fi)}oc(t){return t.Te[this.Yn.uid]||this.uc(t)}uc(t){const i=t.Te[this.Yn.uid]=new ep,e=i;return e.renderable=t,e.transform=t.groupTransform,e.texture=t.fi,e.roundPixels=this.Yn.Me|t.Me,t.didViewUpdate||this.hc(t,e),i}destroy(){this.Yn=null}}np.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"nineSliceSprite"};const sp={name:"tiling-bit",vertex:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;\n\n            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;\n        "},fragment:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n\n            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);\n            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;\n            var unclamped = coord;\n            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);\n\n            var bias = 0.;\n\n            if(unclamped.x == coord.x && unclamped.y == coord.y)\n            {\n                bias = -32.;\n            }\n\n            outColor = textureSampleBias(uTexture, uSampler, coord, bias);\n        "}},rp={name:"tiling-bit",vertex:{header:"\n            uniform mat3 uTextureTransform;\n            uniform vec4 uSizeAnchor;\n\n        ",main:"\n            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;\n\n            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;\n        "},fragment:{header:"\n            uniform sampler2D uTexture;\n            uniform mat3 uMapCoord;\n            uniform vec4 uClampFrame;\n            uniform vec2 uClampOffset;\n        ",main:"\n\n        vec2 coord = vUV + ceil(uClampOffset - vUV);\n        coord = (uMapCoord * vec3(coord, 1.0)).xy;\n        vec2 unclamped = coord;\n        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0\n\n        "}};let op,hp;class ap extends Wr{constructor(){op??(op=sa({name:"tiling-sprite-shader",bits:[Cc,sp,va]})),hp??(hp=ra({name:"tiling-sprite-shader",bits:[Pc,rp,ma]}));const t=new Lr({uMapCoord:{value:new ve,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new ve,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}});super({glProgram:hp,gpuProgram:op,resources:{localUniforms:new Lr({uTransformMatrix:{value:new ve,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:t,uTexture:Ve.EMPTY.source,uSampler:Ve.EMPTY.source.style}})}updateUniforms(t,i,e,n,s,r){const o=this.resources.tilingUniforms,h=r.width,a=r.height,u=r.textureMatrix,c=o.uniforms.uTextureTransform;c.set(e.a*h/t,e.b*h/i,e.c*a/t,e.d*a/i,e.tx/t,e.ty/i),c.invert(),o.uniforms.uMapCoord=u.mapCoord,o.uniforms.uClampFrame=u.uClampFrame,o.uniforms.uClampOffset=u.uClampOffset,o.uniforms.uTextureTransform=c,o.uniforms.uSizeAnchor[0]=t,o.uniforms.uSizeAnchor[1]=i,o.uniforms.uSizeAnchor[2]=n,o.uniforms.uSizeAnchor[3]=s,r&&(this.resources.uTexture=r.source,this.resources.uSampler=r.source.style)}}const up=new class extends ac{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}};class cp{constructor(){this.canBatch=!0,this.geometry=new ac({indices:up.indices.slice(),positions:up.positions.slice(),uvs:up.uvs.slice()})}destroy(){var t;this.geometry.destroy(),null==(t=this.shader)||t.destroy()}}class lp{constructor(t){this.Qs=Xr.default2d,this.Yn=t}validateRenderable(t){const i=this.wf(t),e=i.canBatch;this.Mf(t);const n=i.canBatch;if(n&&n===e){const{batchableMesh:e}=i;return!e.Hr.checkAndUpdateTexture(e,t.texture)}return e!==n}addRenderable(t,i){const e=this.Yn.renderPipes.batch;this.Mf(t);const n=this.wf(t),{geometry:s,canBatch:r}=n;if(r){n.batchableMesh||(n.batchableMesh=new Dd);const r=n.batchableMesh;t.didViewUpdate&&(this.Af(t),r.geometry=s,r.renderable=t,r.transform=t.groupTransform,r.setTexture(t.fi)),r.roundPixels=this.Yn.Me|t.Me,e.addToBatch(r,i)}else e.break(i),n.shader||(n.shader=new ap),this.updateRenderable(t),i.add(t)}execute(t){const{shader:i}=this.wf(t);i.groups[0]=this.Yn.globalUniforms.bindGroup;const e=i.resources.localUniforms.uniforms;e.uTransformMatrix=t.groupTransform,e.uRound=this.Yn.Me|t.Me,Sf(t.groupColorAlpha,e.uColor,0),this.Qs.blendMode=wh(t.groupBlendMode,t.texture.di),this.Yn.encoder.draw({geometry:up,shader:i,state:this.Qs})}updateRenderable(t){const i=this.wf(t),{canBatch:e}=i;if(e){const{batchableMesh:e}=i;t.didViewUpdate&&this.Af(t),e.Hr.updateElement(e)}else if(t.didViewUpdate){const{shader:e}=i;e.updateUniforms(t.width,t.height,t.Tf.matrix,t.anchor.x,t.anchor.y,t.texture)}}wf(t){return t.Te[this.Yn.uid]||this._f(t)}_f(t){const i=new cp;return i.renderable=t,t.Te[this.Yn.uid]=i,i}Af(t){const i=this.wf(t),{geometry:e}=i,n=t.texture.source.style;"repeat"!==n.addressMode&&(n.addressMode="repeat",n.update()),function(t,i){const e=t.texture,n=e.frame.width,s=e.frame.height;let r=0,o=0;t.applyAnchorToTexture&&(r=t.anchor.x,o=t.anchor.y),i[0]=i[6]=-r,i[2]=i[4]=1-r,i[1]=i[3]=-o,i[5]=i[7]=1-o;const h=ve.shared;h.copyFrom(t.Tf.matrix),h.tx/=t.width,h.ty/=t.height,h.invert(),h.scale(t.width/n,t.height/s),function(t,i,e,n){let s=0;const r=t.length/i,o=n.a,h=n.b,a=n.c,u=n.d,c=n.tx,l=n.ty;for(e*=i;s<r;){const n=t[e],r=t[e+1];t[e]=o*n+a*r+c,t[e+1]=h*n+u*r+l,e+=i,s++}}(i,2,0,h)}(t,e.uvs),function(t,i){const e=t.anchor.x,n=t.anchor.y;i[0]=-e*t.width,i[1]=-n*t.height,i[2]=(1-e)*t.width,i[3]=-n*t.height,i[4]=(1-e)*t.width,i[5]=(1-n)*t.height,i[6]=-e*t.width,i[7]=(1-n)*t.height}(t,e.positions)}destroy(){this.Yn=null}Mf(t){const i=this.wf(t),e=t.texture;let n=!0;return this.Yn.type===Vr.WEBGL&&(n=this.Yn.context.supports.nonPowOf2wrapping),i.canBatch=e.textureMatrix.isSimple&&(n||e.source.isPowerOfTwo),i.canBatch}}lp.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"tilingSprite"};const fp={name:"local-uniform-msdf-bit",vertex:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32,\n                uRound:f32,\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "},fragment:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n         ",main:"\n            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));\n        "}},dp={name:"local-uniform-msdf-bit",vertex:{header:"\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix *= uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "},fragment:{header:"\n            uniform float uDistance;\n         ",main:"\n            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));\n        "}},pp={name:"msdf-bit",fragment:{header:"\n            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {\n\n                // MSDF\n                var median = msdfColor.r + msdfColor.g + msdfColor.b -\n                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n\n                // SDF\n                median = min(median, msdfColor.a);\n\n                var screenPxDistance = distance * (median - 0.5);\n                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));\n                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);\n                var coverage: f32 = pow(shapeColor.a * alpha, gamma);\n\n                return coverage;\n\n            }\n        "}},vp={name:"msdf-bit",fragment:{header:"\n            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {\n\n                // MSDF\n                float median = msdfColor.r + msdfColor.g + msdfColor.b -\n                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n\n                // SDF\n                median = min(median, msdfColor.a);\n\n                float screenPxDistance = distance * (median - 0.5);\n                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n\n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));\n                float gamma = mix(1.0, 1.0 / 2.2, luma);\n                float coverage = pow(shapeColor.a * alpha, gamma);\n\n                return coverage;\n            }\n        "}};let mp,gp;class bp extends Wr{constructor(t){const i=new Lr({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new ve,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}});mp??(mp=sa({name:"sdf-shader",bits:[oa,la(t),fp,pp,va]})),gp??(gp=ra({name:"sdf-shader",bits:[ha,pa(t),dp,vp,ma]})),super({glProgram:gp,gpuProgram:mp,resources:{localUniforms:i,batchSamplers:ba(t)}})}}class yp extends oc{destroy(){this.context.customShader&&this.context.customShader.destroy(),super.destroy()}}class xp{constructor(t){this.Yn=t,this.Yn.renderableGC.addManagedHash(this,"_gpuBitmapText")}validateRenderable(t){const i=this.kf(t);return this.Yn.renderPipes.graphics.validateRenderable(i)}addRenderable(t,i){const e=this.kf(t);wp(t,e),t.ea&&(t.ea=!1,this.Cf(t,e)),this.Yn.renderPipes.graphics.addRenderable(e,i),e.context.customShader&&this.Sf(t)}updateRenderable(t){const i=this.kf(t);wp(t,i),this.Yn.renderPipes.graphics.updateRenderable(i),i.context.customShader&&this.Sf(t)}Cf(t,i){const{context:e}=i,n=Du.getFont(t.text,t.ai);e.clear(),"none"!==n.distanceField.type&&(e.customShader||(e.customShader=new bp(this.Yn.limits.maxBatchableTextures)));const s=Ko.graphemeSegmenter(t.text),r=t.ai;let o=n.baseLineOffset;const h=Gu(s,r,n,!0),a=r.padding,u=h.scale;let c=h.width,l=h.height+h.offsetY;r.yr&&(c+=r.yr.width/u,l+=r.yr.width/u),e.translate(-t.Se.xt*c-a,-t.Se.qt*l-a).scale(u,u);const f=n.applyFillAsTint?r.mo.color:16777215;let d=n.fontMetrics.fontSize,p=n.lineHeight;r.lineHeight&&(d=r.fontSize/u,p=r.lineHeight/u);let v=(p-d)/2;v-n.baseLineOffset<0&&(v=0);for(let m=0;m<h.lines.length;m++){const t=h.lines[m];for(let i=0;i<t.charPositions.length;i++){const s=t.chars[i],r=n.chars[s];if(null==r?void 0:r.texture){const n=r.texture;e.texture(n,f||"black",Math.round(t.charPositions[i]+r.xOffset),Math.round(o+r.yOffset+v),n.orig.width,n.orig.height)}}o+=p}}kf(t){return t.Te[this.Yn.uid]||this.initGpuText(t)}initGpuText(t){const i=new yp;return t.Te[this.Yn.uid]=i,this.Cf(t,i),i}Sf(t){const i=this.kf(t).context,e=t.ai.fontFamily,n=Os.get(`${e}-bitmap`),{a:s,b:r,c:o,d:h}=t.groupTransform,a=Math.sqrt(s*s+r*r),u=Math.sqrt(o*o+h*h),c=(Math.abs(a)+Math.abs(u))/2,l=n.baseRenderedFontSize/t.ai.fontSize,f=c*n.distanceField.range*(1/l);i.customShader.resources.localUniforms.uniforms.uDistance=f}destroy(){this.Yn=null}}function wp(t,i){i.groupTransform=t.groupTransform,i.groupColorAlpha=t.groupColorAlpha,i.groupColor=t.groupColor,i.groupBlendMode=t.groupBlendMode,i.globalDisplayStatus=t.globalDisplayStatus,i.groupTransform=t.groupTransform,i.localDisplayStatus=t.localDisplayStatus,i.groupAlpha=t.groupAlpha,i.Me=t.Me}xp.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"bitmapText"};class Mp extends sf{constructor(t){super(),this.generatingTexture=!1,this.Yn=t,t.runners.resolutionChange.add(this)}resolutionChange(){const t=this.renderable;t.ia&&t.onViewUpdate()}destroy(){this.Yn.htmlText.returnTexturePromise(this.texturePromise),this.texturePromise=null,this.Yn=null}}function Ap(t,i){const{texture:e,bounds:n}=t,s=i.ai.zo();We(n,i.Se,e);const r=i.Se.xt*s*2,o=i.Se.qt*s*2;n.minX-=s-r,n.minY-=s-o,n.maxX-=s-r,n.maxY-=s-o}class Tp{constructor(t){this.Yn=t}validateRenderable(t){return t.ea}addRenderable(t,i){const e=this.Pf(t);t.ea&&(this.Ef(t).catch(t=>{}),t.ea=!1,Ap(e,t)),this.Yn.renderPipes.batch.addToBatch(e,i)}updateRenderable(t){const i=this.Pf(t);i.Hr.updateElement(i)}async Ef(t){t.ea=!1;const i=this.Pf(t);if(i.generatingTexture)return;i.texturePromise&&(this.Yn.htmlText.returnTexturePromise(i.texturePromise),i.texturePromise=null),i.generatingTexture=!0,t.si=t.ia?this.Yn.resolution:t.resolution;const e=this.Yn.htmlText.getTexturePromise(t);i.texturePromise=e,i.texture=await e;const n=t.renderGroup||t.parentRenderGroup;n&&(n.structureDidChange=!0),i.generatingTexture=!1,Ap(i,t)}Pf(t){return t.Te[this.Yn.uid]||this.initGpuText(t)}initGpuText(t){const i=new Mp(this.Yn);return i.renderable=t,i.transform=t.groupTransform,i.texture=Ve.EMPTY,i.bounds={minX:0,maxX:1,minY:0,maxY:0},i.roundPixels=this.Yn.Me|t.Me,t.si=t.ia?this.Yn.resolution:t.resolution,t.Te[this.Yn.uid]=i,i}destroy(){this.Yn=null}}Tp.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"htmlText"};const _p=new qe;function kp(t,i,e,n){const s=_p;s.minX=0,s.minY=0,s.maxX=t.width/n|0,s.maxY=t.height/n|0;const r=rs.getOptimalTexture(s.width,s.height,n,!1);return r.source.uploadMethodId="image",r.source.resource=t,r.source.alphaMode="premultiply-alpha-on-upload",r.frame.width=i/n,r.frame.height=e/n,r.source.emit("update",r.source),r.updateUvs(),r}async function Cp(t,i){const e=await async function(t){const i=await Ms.get().fetch(t),e=await i.blob(),n=new FileReader;return await new Promise((t,i)=>{n.onloadend=()=>t(n.result),n.onerror=i,n.readAsDataURL(e)})}(i);return`@font-face {\n        font-family: "${t.fontFamily}";\n        font-weight: ${t.fontWeight};\n        font-style: ${t.fontStyle};\n        src: url('${e}');\n    }`}const Sp=new Map;class Pp{constructor(t){this.Yn=t,this.Rf=t.type===Vr.WEBGPU}getTexture(t){return this.getTexturePromise(t)}getTexturePromise(t){return this.Ff(t)}async Ff(t){const{text:i,style:e,resolution:n,textureStyle:s}=t,r=Cn.get(xc),o=function(t,i){const e=i.fontFamily,n=[],s={},r=t.match(/font-family:([^;"\s]+)/g);function o(t){s[t]||(n.push(t),s[t]=!0)}if(Array.isArray(e))for(let h=0;h<e.length;h++)o(e[h]);else o(e);r&&r.forEach(t=>{o(t.split(":")[1].trim())});for(const h in i.tagStyles)o(i.tagStyles[h].fontFamily);return n}(i,e),h=await async function(t){const i=t.filter(t=>Os.has(`${t}-and-url`)).map(t=>{if(!Sp.has(t)){const{entries:i}=Os.get(`${t}-and-url`),e=[];i.forEach(i=>{const n=i.url,s=i.faces.map(t=>({weight:t.weight,style:t.style}));e.push(...s.map(i=>Cp({fontWeight:i.weight,fontStyle:i.style,fontFamily:t},n)))}),Sp.set(t,Promise.all(e).then(t=>t.join("\n")))}return Sp.get(t)});return(await Promise.all(i)).join("\n")}(o),a=function(t,i,e,n){n||(n=wc||(wc=new xc));const{domElement:s,styleElement:r,svgRoot:o}=n;s.innerHTML=`<style>${i.cssStyle};</style><div style='padding:0'>${t}</div>`,s.setAttribute("style","transform-origin: top left; display: inline-block"),e&&(r.textContent=e),document.body.appendChild(o);const h=s.getBoundingClientRect();o.remove();const a=2*i.padding;return{width:h.width-a,height:h.height-a}}(i,e,h,r),u=Math.ceil(Math.ceil(Math.max(1,a.width)+2*e.padding)*n),c=Math.ceil(Math.ceil(Math.max(1,a.height)+2*e.padding)*n),l=r.image;l.width=2+(0|u),l.height=2+(0|c);const f=function(t,i,e,n,s){const{domElement:r,styleElement:o,svgRoot:h}=s;r.innerHTML=`<style>${i.cssStyle}</style><div style='padding:0;'>${t}</div>`,r.setAttribute("style",`transform: scale(${e});transform-origin: top left; display: inline-block`),o.textContent=n;const{width:a,height:u}=s.image;return h.setAttribute("width",a.toString()),h.setAttribute("height",u.toString()),(new XMLSerializer).serializeToString(h)}(i,e,n,h,r);await function(t,i,e){return new Promise(async n=>{e&&await new Promise(t=>setTimeout(t,100)),t.onload=()=>{n()},t.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(i)}`,t.crossOrigin="anonymous"})}(l,f,function(){const{userAgent:t}=Ms.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}()&&o.length>0);const d=l;let p;this.Rf&&(p=function(t,i){const e=$u.getOptimalCanvasAndContext(t.width,t.height,i),{context:n}=e;return n.clearRect(0,0,t.width,t.height),n.drawImage(t,0,0),e}(l,n));const v=kp(p?p.canvas:d,l.width-2,l.height-2,n);return s&&(v.source.style=s),this.Rf&&(this.Yn.texture.initSource(v.source),$u.returnCanvasAndContext(p)),Cn.return(r),v}returnTexturePromise(t){t.then(t=>{this.Of(t)}).catch(()=>{_n()})}Of(t){rs.returnTexture(t,!0),t.source.resource=null,t.source.uploadMethodId="unknown"}destroy(){this.Yn=null}}Pp.extension={type:[ie.WebGLSystem,ie.WebGPUSystem,ie.CanvasSystem],name:"htmlText"};class Ep extends sf{constructor(t){super(),this.Yn=t,t.runners.resolutionChange.add(this)}resolutionChange(){const t=this.renderable;t.ia&&t.onViewUpdate()}destroy(){this.Yn.canvasText.returnTexture(this.texture),this.Yn=null}}class Rp{constructor(t){this.Yn=t}validateRenderable(t){return t.ea}addRenderable(t,i){const e=this.Pf(t);t.ea&&(this.Ef(t),t.ea=!1),this.Yn.renderPipes.batch.addToBatch(e,i)}updateRenderable(t){const i=this.Pf(t);i.Hr.updateElement(i)}Ef(t){const i=this.Pf(t);i.texture&&this.Yn.canvasText.returnTexture(i.texture),t.si=t.ia?this.Yn.resolution:t.resolution,i.texture=this.Yn.canvasText.getTexture(t),Ap(i,t)}Pf(t){return t.Te[this.Yn.uid]||this.initGpuText(t)}initGpuText(t){const i=new Ep(this.Yn);return i.renderable=t,i.transform=t.groupTransform,i.bounds={minX:0,maxX:1,minY:0,maxY:0},i.roundPixels=this.Yn.Me|t.Me,t.Te[this.Yn.uid]=i,i}destroy(){this.Yn=null}}Rp.extension={type:[ie.WebGLPipes,ie.WebGPUPipes,ie.CanvasPipes],name:"text"};class Fp{constructor(t){this.Yn=t}getTexture(t,i,e,n){"string"==typeof t&&(Re(0,"CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),t={text:t,style:e,resolution:i}),t.style instanceof Ou||(t.style=new Ou(t.style)),t.textureStyle instanceof je||(t.textureStyle=new je(t.textureStyle)),"string"!=typeof t.text&&(t.text=t.text.toString());const{text:s,style:r,textureStyle:o}=t,h=t.resolution??this.Yn.resolution,{frame:a,canvasAndContext:u}=mc.getCanvasAndContext({text:s,style:r,resolution:h}),c=kp(u.canvas,a.width,a.height,h);if(o&&(c.source.style=o),r.trim&&(a.pad(r.padding),c.frame.copyFrom(a),c.frame.scale(1/h),c.updateUvs()),r.filters){const t=this.$f(c,r.filters);return this.returnTexture(c),mc.returnCanvasAndContext(u),t}return this.Yn.texture.initSource(c.di),mc.returnCanvasAndContext(u),c}returnTexture(t){const i=t.source;i.resource=null,i.uploadMethodId="unknown",i.alphaMode="no-premultiply-alpha",rs.returnTexture(t,!0)}renderTextToCanvas(){Re(0,"CanvasTextSystem.renderTextToCanvas: no longer supported, use CanvasTextSystem.getTexture instead")}$f(t,i){const e=this.Yn.renderTarget.renderTarget,n=this.Yn.filter.generateFilteredTexture({texture:t,filters:i});return this.Yn.renderTarget.bind(e,!1),n}destroy(){this.Yn=null}}Fp.extension={type:[ie.WebGLSystem,ie.WebGPUSystem,ie.CanvasSystem],name:"canvasText"},se.add(re,oe);var Op=(t=>(t.Orange="orange",t.Black="black",t.Grey="grey",t.Green="green",t.Blue="blue",t.Red="red",t))(Op||{});function $p(i,e){return null!=e?`id: ${i.key}\n${t.jt.has(i.key)?"channel: "+t.jt.get(i.key)+"\n":""}delay: ${e.afterFireChargeDelay}\nstep: ${e.chargePercentStep}\nleakF: ${e.leakFactor}\nleakT: ${e.leakThreshold}\n`:`id: ${i.key}`}function Up(i){const e=t.jt,n=t.Ut.position;for(const s of t.Ot.keys())i(n.get(s))&&e.set(s,0)}function Bp(){return 260}const Ip={Uf:async function(){Ip.Of(),t.app=new Lo,t.render={Nt:new Map,Bf:new Map,If:new Map,jf:new Map,Gf:new Map,zf:new Map,Df:void 0,$t:new Map,Lf:new Map,Nf:[],Vf:[]},await t.app.init({width:qt,height:Xt,backgroundColor:16777215,antialias:!0,webgpu:{backgroundColor:Bt}}),navigator.gpu;const i=document.getElementById("canvas_wrapper");i.innerHTML="",i.appendChild(t.app.canvas)},Of:function(){t&&t.app&&t.app.stage&&(t.app.stage.destroy&&t.app.stage.destroy(!0),t.app.stage=null)},Wf:(i,e)=>{const n=t.app,s=t.config.neurons.radius,r=t.render.Nt,o=t.Dt,h=t.Ut.position.get(i.key);r.set(i.key,function(i,e,n,s,r,o){const h=new ls({x:i,y:e}),a=(new Su).rect(0,0,2*n,2*n).fill("#ffa500"),u=(new Su).rect(0,0,2*n,2*n).fill(Ut),c=(new Su).rect(0,0,2*n,2*n).fill(jt),l=(new Su).rect(0,0,2*n,2*n).fill(Bt),f=(new Su).rect(0,0,2*n,2*n).fill(It),d=(new Su).rect(0,0,2*n,2*n).fill(zt),p=new oc(a),v=(new oc).circle(i+n,e+n,n).fill("white");s&&(h.addChild(p),p.y=2*n,h.mask=v,o.stage.addChild(v));const m=(new Su).circle(i+n,e+n,n+2).fill("#ffa5002b").stroke({color:Lt,pixelLine:!0}),g=(new Su).circle(i+n,e+n,n+2).fill(Dt).stroke({color:Lt,pixelLine:!0}),b=(new Su).circle(i+n,e+n,n+2).fill(Ut).stroke({color:s?t.Bt.get(r)?Gt:Lt:Dt,pixelLine:!0}),y=new oc(s?m:g);return o.stage.addChild(y),o.stage.addChild(h),{update:(t,i,e)=>function(t,i,e,n,s,r){t.y=2*e-n*(2*e/100),t.alpha=s,0!=n||(t.context=i[r])}(p,{orange:a,green:u,blue:c,red:l,black:f,grey:d},n,t,i,e),updateBackground:t=>{!function(t,i,e,n){t.context=i?e:n}(y,t,m,g)},flash:t=>function(t,i,e,n){t.context=n?e:i}(y,m,b,t),wipe:()=>{h.removeChildren(),h.mask&&(o.stage.removeChild(h.mask),h.mask=null),o.stage.removeChild(y),o.stage.removeChild(h),o.stage.removeChild(v),p.destroy(),y.destroy(),v.destroy(),h.destroy(),a.clear(),u.clear(),c.clear(),l.clear(),f.clear(),d.clear(),m.clear(),g.clear(),b.clear()}}}(h.x,h.y,s,e,i.key,n)),Ip.Hf(i,e,h),e&&t.qf.has(i.key)&&(Ip.Xf(h,o.get(i.key)),Ip.Yf(h,o.get(i.key)))},Hf:(i,e,n)=>{t.dC$.showLabels&&t.render.zf.set(i.key,function(i,e,n,s,r){const o=new gc({text:s,style:{fontSize:t.config.neurons.radius,fontFamily:"arial",align:"right",fill:n?It:Lt}});return o.x=i-100,o.y=e-2,r.stage.addChild(o),{update:t=>function(t,i){t.text=i}(o,t),wipe:()=>{o&&!o.destroyed&&(r.stage.removeChild(o),o.destroy())}}}(n.x,n.y,e,e?$p(i,bv(i.key)):"",t.app))},Kf:(t,i)=>{for(const e of t)Ip.Wf(e,!0);for(const e of i)Ip.Wf(e,!1)},Qf:i=>{const e=t.config.neurons.radius,n=t.app,s=t.Ut.position.get(i.sourceKey),r=t.Ut.position.get(i.targetKey);t.dC$.showArrows&&t.render.$t.set(i.key,function(t,i,e,n){const s=(new oc).moveTo(t.x+e,t.y+e).lineTo(i.x+e,i.y+e).moveTo(i.x+e,i.y+e).lineTo(i.x+e-10*Math.cos(Math.atan2(i.y-t.y,i.x-t.x)-Math.PI/6),i.y+e-10*Math.sin(Math.atan2(i.y-t.y,i.x-t.x)-Math.PI/6)).moveTo(i.x+e,i.y+e).lineTo(i.x+e-10*Math.cos(Math.atan2(i.y-t.y,i.x-t.x)+Math.PI/6),i.y+e-10*Math.sin(Math.atan2(i.y-t.y,i.x-t.x)+Math.PI/6)).stroke({color:It,alpha:.3,pixelLine:!0});return n.stage.addChild(s),{update:()=>{},wipe:()=>{s&&!s.destroyed&&(n.stage.removeChild(s),s.destroy())}}}(s,r,e,n)),t.dC$.showLabels&&t.render.Lf.set(i.key,function(i,e,n,s){const r=new gc({text:`${n}`.substring(0,4),style:{fontSize:1.5*t.config.neurons.radius,fontFamily:"serif",fill:jt}});return r.x=i.x+Math.abs(i.x-e.x)/2.5*(i.x<e.x?1:-1),r.y=i.y+Math.abs(i.y-e.y)/2.5*(i.y<e.y?1:-1)+(i.y==e.y?-t.config.neurons.radius/1.5:0),s.stage.addChild(r),{update:t=>function(t,i){i.text=t}(t,r),wipe:()=>{r&&!r.destroyed&&(s.stage.removeChild(r),r.destroy())}}}(s,r,i.weight,n))},Zf:()=>{const i=t.Bt;for(const e of i.values())for(let i=0;i<e.length;i++){const n=t.$t.get(e[i]);Ip.Qf(n)}},Jf:()=>{for(let i=0;i<Bp();i++)t.render.Vf.push({bar:(new Su).rect(5*i,1060,3,Nt).fill(jt),zero:(new Su).rect(5*i,1096,3,4).fill(zt),mark:(new Su).rect(5*i,1096,3,4).fill(Bt)}),i%10==0?(t.render.Nf.push(new oc(t.render.Vf[i].mark)),t.app.stage.addChild(t.render.Nf[i])):(t.render.Nf.push(new oc(t.render.Vf[i].zero)),t.app.stage.addChild(t.render.Nf[i]))},ed:i=>{const e=t.render,n=e.Nf,s=e.Vf;for(let t=0;t<i.length;t++)i[t]?n[t].context=s[t].bar:n[t].context=t%10==0?s[t].mark:s[t].zero},Xf:(i,e)=>{const n=t.config.neurons.radius,s=Nt;for(let r=0;r<Vt;r++){const o=i.x-2*r*2+1*(120+n/1.25),h=i.y-s/1.7-2,a=16,u=h-38,c=.44*a,l=.12*a,f=0,d=.26,p=.12,v=a*d,m=a*p,g=a*(p-(1-3*d)/2)*2;e.inputSpikesContextsBuffer.push({bar1:(new Su).rect(o,u,2,a).fill(jt),bar2:(new Su).rect(o,u-f,2,c).fill(jt).rect(o,u+c+l-f,2,c).fill(jt),bar3:(new Su).rect(o,u-g,2,v).fill(jt).rect(o,u+v+m-g,2,v).fill(jt).rect(o,u+2*(v+m)-g,2,v).fill(jt),barMany:(new Su).rect(o,u,2,a).fill(Gt),inactiveBar:(new Su).rect(o,u,2,a).fill("#b0b0b0"),zero:(new Su).rect(o,h-24+1,2,s/15).fill(zt),mark:(new Su).rect(o,h-24+1,2,s/15).fill(Bt)}),r%10==0?(e.inputSpikesGraphicsBuffer.push(new oc(e.inputSpikesContextsBuffer[r].mark)),t.app.stage.addChild(e.inputSpikesGraphicsBuffer[r])):(e.inputSpikesGraphicsBuffer.push(new oc(e.inputSpikesContextsBuffer[r].zero)),t.app.stage.addChild(e.inputSpikesGraphicsBuffer[r]))}},nd:i=>{if(i.inputSpikesGraphicsBuffer.length>0){for(let e=0;e<Vt;e++){const n=i.inputSpikesContextsBuffer[e];n&&(n.bar1.destroy(),n.bar2.destroy(),n.bar3.destroy(),n.barMany.destroy(),n.zero.destroy(),n.mark.destroy(),n.inactiveBar.destroy());const s=i.inputSpikesGraphicsBuffer[e];s&&(t.app.stage.removeChild(s),s.destroy())}i.inputSpikesContextsBuffer=[],i.inputSpikesGraphicsBuffer=[]}},sd:t=>{const i=t.inputSpikesBuffer,e=t.inputSpikesGraphicsBuffer,n=t.inputSpikesContextsBuffer;for(let s=0;s<e.length;s++)if(i[s]){if(i[s]>0){e[s].context=n[s][`bar${i[s]}`]||n[s].barMany;continue}e[s].context=n[s].inactiveBar}else e[s].context=s%10==0?n[s].mark:n[s].zero},Yf:(i,e)=>{const n=t.config.neurons.radius,s=Nt,r=i.y+3*n-48;for(let o=0;o<Vt;o++){const h=i.x-2*o*2+1*(120+n/1.25);e.outputSpikesContextsBuffer.push({bar:(new Su).rect(h,r-s+2,2,16).fill(Bt),zero:(new Su).rect(h,r-24+1,2,s/15).fill(zt),mark:(new Su).rect(h,r-24+1,2,s/15).fill(Bt)}),o%10==0?(e.outputSpikesGraphicsBuffer.push(new oc(e.outputSpikesContextsBuffer[o].mark)),t.app.stage.addChild(e.outputSpikesGraphicsBuffer[o])):(e.outputSpikesGraphicsBuffer.push(new oc(e.outputSpikesContextsBuffer[o].zero)),t.app.stage.addChild(e.outputSpikesGraphicsBuffer[o]))}},rd:i=>{if(i.outputSpikesGraphicsBuffer.length>0){for(let e=0;e<Vt;e++){const n=i.outputSpikesContextsBuffer[e];n&&(n.bar.destroy(),n.zero.destroy(),n.mark.destroy());const s=i.outputSpikesGraphicsBuffer[e];s&&(t.app.stage.removeChild(s),s.destroy())}i.outputSpikesContextsBuffer=[],i.outputSpikesGraphicsBuffer=[]}},od:t=>{const i=t.outputSpikesBuffer,e=t.outputSpikesGraphicsBuffer,n=t.outputSpikesContextsBuffer;for(let s=0;s<e.length-1;s++)i[s]?e[s+1].context=n[s+1].bar:e[s+1].context=s%10==0?n[s+1].mark:n[s+1].zero},hd:()=>{!function(i,e){const n=t.Ut.position;for(const s of t.jt.keys()){const r=new oc({}).circle(n.get(s).x+i,n.get(s).y+i,2*i).stroke({color:"green",alpha:.6,pixelLine:!0});t.render.Bf.set(s,r),e.stage.addChild(r)}}(t.config.neurons.radius,t.app)},ad:()=>{!function(i,e){const n=t.Ut.position;for(const s of t.ud.keys()){const r=new oc({}).circle(n.get(s).x+i,n.get(s).y+i,2*i).stroke({color:Bt,alpha:1,pixelLine:!0});t.render.If.set(s,r),e.stage.addChild(r)}}(t.config.neurons.radius,t.app)},ld:()=>{!function(){for(const[i,e]of t.render.Bf.entries())t.app.stage.removeChild(e),e.destroy();t.render.Bf=new Map}()},fd:()=>{!function(){for(const[i,e]of t.render.If.entries())t.app.stage.removeChild(e),e.destroy();t.render.If=new Map}()},dd:(i,e)=>{!function(i,e,n,s){const r=t.Ut.position,o=new oc({alpha:.8}).circle(r.get(i).x+e,r.get(i).y+e,1.2*e).fill(n).stroke({color:"#0288D1",alpha:1,pixelLine:!0});t.render.jf.set(i,o),s.stage.addChild(o)}(i,t.config.neurons.radius,e,t.app)},pd:i=>{!function(i,e,n){const s=t.Ut.position,r=t.$t.get(i),o=s.get(r.sourceKey),h=s.get(r.targetKey),a=(new oc).moveTo(o.x+e,o.y+e).lineTo(h.x+e,h.y+e).moveTo(h.x+e,h.y+e).lineTo(h.x+e-10*Math.cos(Math.atan2(h.y-o.y,h.x-o.x)-Math.PI/6),h.y+e-10*Math.sin(Math.atan2(h.y-o.y,h.x-o.x)-Math.PI/6)).moveTo(h.x+e,h.y+e).lineTo(h.x+e-10*Math.cos(Math.atan2(h.y-o.y,h.x-o.x)+Math.PI/6),h.y+e-10*Math.sin(Math.atan2(h.y-o.y,h.x-o.x)+Math.PI/6)).stroke({color:"#0288D1",width:3,alpha:.8});t.render.Gf.set(i,a),n.stage.addChild(a)}(i,t.config.neurons.radius,t.app)},vd:()=>{const i=t.$t,e=t.Bt,n=t.config.connections.defaultWeight,s=t.md,r=t.render.Nt,o=t.Ot;for(const h of o.keys()){const a=r.get(h);t.md.has(h)&&t.md.get(h)==t.gd&&t.md.delete(h),a.update(o.get(h).currentCharge,Xi(h,e,i)==n?1:Yi(h,e,i,n),Xi(h,e,i)==n?e.get(h)?Op.Orange:Op.Grey:Xi(h,e,i)>n/2?Op.Blue:0==Xi(h,e,i)?Op.Black:Op.Red),a.flash(s.has(h))}if(t.dC$.showLabels)for(const[h,a]of t.render.Lf)a.update(Math.round(1e3*i.get(h).weight)/1e3)},bd:()=>{const i=t.Ot.keys(),e=t.render.Nt,n=t.md;for(const t of i)e.get(t).flash(n.has(t))},yd:i=>{var e;const n=t.render.Nt;null==(e=n.get(i))||e.wipe(),n.delete(i)},xd:t=>{Ip.nd(t),Ip.rd(t)},wd:i=>{const e=t.render.Bf.get(i);e&&(t.app.stage.removeChild(e),e.destroy(),t.render.Bf.delete(i));const n=t.render.If.get(i);n&&(t.app.stage.removeChild(n),n.destroy(),t.render.If.delete(i))},Md:i=>{const e=t.render.jf.get(i);e&&(t.app.stage.removeChild(e),e.destroy(),t.render.jf.delete(i))},Ad:i=>{var e;const n=t.render.zf;null==(e=n.get(i))||e.wipe(),n.delete(i)},Td:()=>{const i=t.Bt;for(const t of i.values())for(let i=0;i<t.length;i++)Ip._d(t[i]),Ip.kd(t[i])},_d:i=>{var e;const n=t.render.$t;null==(e=n.get(i))||e.wipe(),n.delete(i)},kd:i=>{var e;const n=t.render.Lf;null==(e=n.get(i))||e.wipe(),n.delete(i)},Cd:i=>{const e=t.render.Gf.get(i);e&&(t.app.stage.removeChild(e),e.destroy(),t.render.Gf.delete(i))},Sd:(i,e)=>{t.render.zf.get(i).update(e)},Pd:(i,e)=>{t.render.Lf.get(i).update(e)},Ed:i=>{i?function(i,e,n){const s=t.Ut.position,r=[...(t.qf.size>0?t.qf:s).keys()],o=r[Math.floor(Math.random()*r.length)],h=new oc({}).circle(s.get(o).x+e,s.get(o).y+e,i).stroke({color:"#9dd6ff",alpha:1,pixelLine:!0});t.render.Df=h,n.stage.addChild(h)}(t.dC$.neurons.visibilityRadius,t.dC$.neurons.radius,t.app):t.render.Df&&(t.app.stage.removeChild(t.render.Df),t.render.Df.destroy(),t.render.Df=void 0)},Rd:t=>{t?Ip.Zf():Ip.Td()},Fd:i=>{for(const e of t.Ot.keys())Ip.Ad(e);for(const e of t.Lt.keys())Ip.Ad(e);if(i){const i=t.qf.size>0?t.qf.keys():[...t.Ot.keys(),...t.Lt.keys()];for(const e of i){const i=t.Ut.position.get(e);t.Ot.has(e)&&Ip.Hf(t.Ot.get(e),!0,i),t.Lt.has(e)&&Ip.Hf(t.Lt.get(e),!0,i)}}},Od:(i,e)=>{if(Ip.Ad(i),e&&t.dC$.showLabels){const e=t.Ut.position.get(i);Ip.Hf(t.Ot.get(i),!0,e)}}};var jp=(t=>(t.Selection="#B3E5FC",t.ConnStart="#0288D1",t))(jp||{});const Gp={pixi:Ip};function zp(i){const e=t.config.renderer;e._d(i),e.kd(i)}function Dp(i){const e=t.config.renderer;if(t.$d.has(i.key))return e.Md(i.key),void t.$d.delete(i.key);t.$d.set(i.key,i),e.dd(i.key,jp.Selection)}function Lp(i){!function(i){const e=t.Lt.get(i);null!=e&&(t.Ot.has(i)||t.Ot.set(i,e),t.Lt.delete(i))}(i),t.render.Nt.get(i).updateBackground(!0)}function Np(){t.config.renderer.Md(t.Ud),t.Ud=void 0}function Vp(i){const e=t.config.renderer;if(t.Bd.has(i.key))return e.Cd(i.key),void t.Bd.delete(i.key);t.Bd.set(i.key,i),e.pd(i.key)}var Wp=(t=>(t.AddAccumulator="AddAccum",t.SelectAccumulator="SelectAccum",t.RemoveAccumulator="RemoveAccum",t.MarkInputAccum="MarkInputAccum",t.MarkOutputAccum="MarkOutputAccum",t.AddConnection="AddConn",t.AddConnectionEnd="AddConnEnd",t.SelectConnection="SelectConn",t.RemoveConnection="RemoveConn",t.AddChannel="AddChannel",t.SelectChannel="SelectChannel",t.RemoveChannel="RemoveChannel",t))(Wp||{}),Hp=(t=>(t.Network="Network",t.Draw="Draw",t.Channels="Channeled",t))(Hp||{});const qp=100;function Xp(t,i,e){const n=[],s=Math.floor(i*qp),r=2*Math.PI*t;for(let o=0;o<s;o++){const t=o/qp,i=1*Math.sin(r*t+Yp(e));n.push({time:t,value:i})}return n}function Yp(t){return t*(Math.PI/180)}function Kp(t,i){const e=[],n=Math.floor((t-i)*qp),s=["white","pink","brownian"],r=s[Math.floor(Math.random()*s.length)];let o=0,h=0;for(let a=0;a<n;a++){const t=a/qp;let i=0;switch(r){case"white":i=1*(2*Math.random()-1);break;case"pink":o=.99886*o+.0555179*(2*Math.random()-1),i=1*o*.5;break;case"brownian":h+=.2*(2*Math.random()-1),h=Math.max(-1,Math.min(1,h)),i=1*h;break;default:const e=.5+2*Math.sin(.3*t);i=.7*Math.sin(2*Math.PI*e*t)}Math.random()<.01&&(i+=1*(Math.random()>.5?1:-1)*.8),e.push({time:t,value:i})}return e}function Qp(t,i,e,n=2){const s=[];for(let r=0;r<n;r++)s.push(...Kp(i,e),...t);return s.map((t,i)=>({value:t.value,time:i}))}function Zp(){globalThis.htmlEventsStream=$t.create();const i=t.greenButtons;globalThis.htmlEventsStream.addListener({next:e=>{if(e.keys&&1==e.keys.length&&t.dC$.mode==ci.INTERACTIVE)switch(e.keys[0]){case"neurons":!function(i,e){const n=t.config.renderer;for(const s of t.$d.values())null!=t.Ut[i]&&(yv(s.key,i,e),n.Sd(s.key,$p(s,bv(s.key))))}(e.type,e.value);break;case"connections":!function(i,e){const n=t.config.renderer;for(const s of t.Bd.keys())null!=t.$t.get(s)&&(t.$t.get(s)["defaultWeight"==i?"weight":i]=e,n.Pd(s,e))}(e.type,e.value)}switch(e.type){case"mode":switch(tv(!1),Jp(Hp.Network),iv(!1),i.doneButton.click(),e.value){case ci.INTERACTIVE:Jp(Hp.Draw);break;case ci.CHANNELS:t.currentChannel=1,t.currentInputAccum=void 0,tv(!0),Jp(Hp.Channels),iv(!0);break;default:return}break;case"inputAreaType":if(t.dC$.mode!=ci.INTERACTIVE)switch(e.value){case ui.LeftRect:t.dC$.connections.outputAreaType=ui.RightRect;break;case ui.TopRect:t.dC$.connections.outputAreaType=ui.BotRect;break;default:return}case"showVisibilityRadius":t.config.renderer.Ed(e.value);break;case"showArrows":t.config.renderer.Rd(e.value);break;case"showLabels":t.config.renderer.Fd(e.value);break;case"visibilityRadius":t.config.renderer.Ed(!1),t.config.renderer.Ed(!0)}}})}function Jp(t){const i=Ri("#buttons"),e=Ri("#draw-buttons"),n=Ri("#channel-buttons"),s=Ri("#channels_visuals");switch(t){case Hp.Network:i.show(),e.hide(),n.hide(),s.hide();break;case Hp.Draw:i.hide(),e.show(),n.hide(),s.hide();break;case Hp.Channels:i.hide(),e.hide(),n.show(),s.show()}}function tv(t){const i=Ri(".nested-container.input");i.find(".field-container:not(.channel-field)").map((i,e)=>{i>1&&(t?Ri(e).hide():Ri(e).show())});const e=i.find(".channel-field");if(t)return e.length>0?void e.show():(i.append(ev("frequency")),i.append(ev("duration")),i.append(ev("offset")),i.append(ev("period")),void i.append(ev("repetitions")));e.length>0&&e.hide()}function iv(t){if(t)return Ri("#canvas_wrapper").hide(),void Ri("#channels_visuals").show();Ri("#canvas_wrapper").show(),Ri("#channels_visuals").hide()}function ev(t){const i=Ri("<input>",{type:"range",class:"range-input",id:`range-${t}`,"data-type":t,min:0,max:100,step:1,value:0}),e=Ri("<input>",{type:"number",class:"slider-input",id:`input-${t}`,"data-type":t,min:0,max:100,step:.1,value:0}),n=Ri("<div>",{class:"slider-wrapper"});n.append(i),n.append(e);const s=Ri("<label>",{class:"field-label",text:t}).append(n);return e.off("change").on("change",()=>{i.val(e.val()),nv(e.data("type"),e.val())}),i.off("change").on("change",()=>{e.val(i.val()),nv(i.data("type"),i.val())}),Ri("<div>",{class:"field-container channel-field"}).append(s).css("margin-left","20px")}function nv(i,e){for(let n=0;n<t.channels.length;n++){const s=t.channels[n];if(t.selectedChannel==s.id){s.config[i]=e;const t=s.config.frequency,n=s.config.duration,r=s.config.offset,o=s.config.period,h=s.config.repetitions,a=Qp(Xp(t,n,r),o,n,h);return s.chart.data.datasets[0].data=a.map(t=>t.value),s.chart.data.zf=a.map(t=>t.time),s.chart.update(),s.dataset=a.map(t=>t.value),void(s.signal=a)}}}function sv(){const i=Ri("#configurator");i.length&&(i.empty(),Zp(),rv(t.dC$,i,0))}function rv(i,e,n){Object.entries(i).forEach(([i,s])=>{"renderer"!=i&&"distribution"!=i&&(function(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}(s)?"groups"!=i&&function(t,i,e,n){const s=Ri("<details>",{class:"config-accordion",open:"open"}),r=Ri("<summary>",{class:"accordion-title",text:t}),o=Ri("<div>",{class:`nested-container ${t}`,"data-key":t});s.append(r,o),e.append(s),rv(i,o,n+1)}(i,s,e,n):"outputAreaType"!=i&&"showGradients"!=i&&function(i,e,n,s,r){const o=Ri("<div>",{class:"field-container"}).css("margin-left",20*r+"px"),h=e=>{Ri("#Reset").removeClass("disabled");let s=ov(a);if(0==t.$d.size&&0==t.Bd.size)if(n[i]=e,s.length>0){let n;for(let i=0;i<s.length;i++)n=t.dC$[s[i]];"geometryType"==i?(n[i]=e,_i(n,e)):n[i]="streamType"==i||"inputAreaType"==i||"outputAreaType"==i||"type"==i||"xyCorrelation"==i||"randomWeights"==i||"ignoreHeatOnInput"==i||"ignoreHeatOnOutput"==i||"keepConnectionsOnReset"==i?e:parseFloat(e)}else t.dC$[i]=parseFloat(e)||e;globalThis.htmlEventsStream.shamefullySendNext({type:i,value:e,keys:s,element:a})},a=function(t,i,e){switch(typeof i){case"boolean":return function(t,i){const e=Ri("<input>",{type:"checkbox",class:"checkbox-input",checked:t}).off("change").on("change",()=>i(e.is(":checked")));return e}(i,e);case"number":return function(t){const i=Ri("<div>",{class:"slider-wrapper"}),e=Ri("<input>",{type:"number",class:"slider-input",value:t}),n=Ri("<input>",{type:"range",class:"range-input",value:t});return i.append(n,e),i}(i);case"string":return function(t,i,e){const n=function(t){return[ui,Ui,di,ci,hi,Zt].find(i=>Object.values(i).includes(t))}(i);if(!n)return null;const s=Ri("<select>",{class:"enum-select",id:t});return Object.values(n).forEach(t=>{if(t==ui.BotRect||t==ui.RightRect||t==ui.Circle)return;const e=Ri("<option>",{value:t,text:t});t===i&&e.attr("selected","true"),s.append(e)}),s.off("change").on("change",()=>e(s.val())),s}(t,i,e)??function(t,i){const e=Ri("<input>",{type:"text",class:"text-input",value:t}).off("change").on("change",()=>i(e.val()));return e}(i,e);default:return Ri("<div>")}}(i,e,h),u=Ri("<label>",{class:"field-label"}),c=Ri("<span>");u.append(c),u.append(a),o.append(u),s.append(o);const l=ov(a);let f;if(l.length>0){for(let i=0;i<l.length;i++)f=t.limits[l[i]];if(f&&f[i])return hv(a,f[i].min,f[i].max,h),void c.text(`${i} ${f[i].measurement?"("+f[i].measurement+")":""}`)}if(f=t.limits[i],f)return hv(a,f.min,f.max,h),void c.text(`${i} ${f.measurement?"("+f.measurement+")":""}`);c.text(i)}(i,s,e,e,n))})}function ov(t){let i=[];return t.parents(".nested-container").map((t,e)=>{i.splice(0,0,e.dataset.key)}),i}function hv(t,i,e,n){const s=t.find("input.slider-input"),r=t.find("input.range-input"),o=t=>{const o=parseFloat(t),h=Math.min(Math.max(o,i),e);s.val(h),r.val(h),n(h)};s.off("input").on("input",()=>{o(s.val())}).attr("min",i).attr("max",e).attr("step",e/100),r.off("input").on("input",()=>{o(r.val())}).attr("min",i).attr("max",e).attr("step",e/10)}class av{constructor(t,i,e){this.center={x:650,y:550},this.distanceThreshold=0,this.probabilityFormula=t=>1/Math.pow(t,2),this.key=t,this.center={...i},this.distanceThreshold=e}}function uv(){return{x:650,y:550}}function cv(t,i,e){return t.x.args={...t.x.args,numElements:i,index:e,min:150,max:1125},t.y.args={...t.y.args,numElements:i,index:e,min:125,max:950},t.x.func=t.x.func?t.x.func:ki(Ai.LinearEvenly).func,t.y.func=t.y.func?t.y.func:ki(Ai.RangeCenter).func,{x:t.x.func(...Object.values(t.x.args)),y:t.y.func(...Object.values(t.y.args))}}function lv(i){const e=Ri(i),n=e[0];n&&e.off("click").on("click",i=>{const e=n.getBoundingClientRect(),s=n.clientWidth/e.width,r=n.clientHeight/e.height,o=(i.clientX-e.left)*s,h=(i.clientY-e.top)*r;if(t.dC$.mode==ci.INTERACTIVE&&null!=t.editingMode){if(t.editingMode==Wp.AddAccumulator)return function(i){const e=Math.round(1e3*Math.random()),{accumulator:n,renderState:s}=xv(e);wv(n,s,i,!0),t.Ot.delete(n.key),t.config.renderer.Wf(n,!0),t.render.Nt.get(n.key).updateBackground(!1)}({x:Math.round(o)-t.config.neurons.radius,y:Math.round(h)-t.config.neurons.radius}),void fv();const i=function(i,e){const n=t.Ut.position;for(const s of t.Ot.values())if(Ii(i,e,n.get(s.key)))return s;for(const s of t.Lt.values())if(Ii(i,e,n.get(s.key)))return s}(Math.round(o),Math.round(h));if(null!=i){if(t.editingMode==Wp.MarkInputAccum)return function(i){const e=t.config.renderer;!t.channels||t.channels.length<=1?t.jt.has(i.key)?t.jt.delete(i.key):t.jt.set(i.key,0):t.channels&&t.channels.length>1&&(t.jt.has(i.key)&&t.currentChannel==t.channels.length?(t.jt.delete(i.key),t.currentChannel=0):t.jt.has(i.key)?t.currentInputAccum==i.key&&(t.jt.set(i.key,t.currentChannel),t.currentChannel+=1):(t.jt.set(i.key,0),t.currentChannel=1),t.currentInputAccum=i.key),e.Sd(i.key,$p(i,bv(i.key))),e.ld(),e.hd()}(i),void fv();if(t.editingMode==Wp.MarkOutputAccum)return function(i){const e=t.config.renderer;t.ud.has(i.key)?t.ud.delete(i.key):t.ud.set(i.key,0),e.fd(),e.ad()}(i),void fv();if(t.editingMode==Wp.AddConnection)return t.editingMode=Wp.AddConnectionEnd,void function(i){if(t.Ud==i)return void Np();const e=t.config.renderer;t.Ud=i,e.dd(i,jp.ConnStart)}(i.key);if(t.editingMode==Wp.AddConnectionEnd)return t.editingMode=Wp.AddConnection,void function(i){const e=t.config.renderer,n=zi(t.Ud,i);null!=n&&(Lp(n.sourceKey),Lp(n.targetKey),Di(n),Vi(n.sourceKey),e.Qf(n)),Np()}(i.key);if(t.editingMode==Wp.RemoveAccumulator)return function(i){const e=t.config.renderer;e.yd(i),e.wd(i),e.Ad(i),e.xd(t.Dt.get(i)),t.Dt.delete(i),t.Ut.position.delete(i),t.Ut[Jt].delete(i),t.Ut[ti].delete(i),t.Ut[ii].delete(i),t.Ut[ei].delete(i),t.Ut[ni].delete(i),t.Ut[si].delete(i),t.Ut[ri].delete(i),t.Ot.delete(i),t.Lt.delete(i),t.jt.delete(i),t.ud.delete(i),t.qf.delete(i)}(i.key),function(i){if(Wi(i),Hi(i),t.Bt.has(i)){for(const e of t.Bt.get(i))zp(e),Qi(t.$t.get(e)),t.$t.delete(e);t.Bt.delete(i)}if(t.It.has(i)){for(const e of t.It.get(i))zp(e),Zi(t.$t.get(e)),t.$t.delete(e);t.It.delete(i)}}(i.key),void fv();if(t.editingMode==Wp.SelectAccumulator)return void Dp(i)}const e=function(i,e){const n=t.Ut.position;for(const s of t.$t.values()){const r=n.get(s.sourceKey),o=n.get(s.targetKey),h=r.x<o.x,a=r.y<o.y,u=Math.abs(r.x-o.x),c=Math.abs(r.y-o.y),l={x:(h?r.x:o.x)+u/2+t.config.neurons.radius,y:(a?r.y:o.y)+c/2+t.config.neurons.radius};let f=u/5,d=c/5;const p=1;if(f<t.config.neurons.radius*p&&(f=t.config.neurons.radius*p),d<t.config.neurons.radius*p&&(d=t.config.neurons.radius*p),ji(i,e,l,f,d))return s}}(Math.round(o),Math.round(h));if(null!=e){if(t.editingMode==Wp.SelectConnection)return void Vp(e);if(t.editingMode==Wp.RemoveConnection)return void function(i){zp(i.key),Qi(i),Zi(i),t.$t.delete(i.key)}(e)}}else!function(i,e){const n=function(i,e){const n=t.Ut.position;for(const s of t.Ot.values())if(Ii(i,e,n.get(s.key)))return s}(i,e),s=t.Dt,r=t.Ut.position,o=t.config.renderer;if(null!=n&&o){if(!t.qf.has(n.key))return t.qf.set(n.key,0),o.Xf(r.get(n.key),s.get(n.key)),o.Yf(r.get(n.key),s.get(n.key)),void o.Od(n.key,!0);t.qf.has(n.key)&&(o.nd(s.get(n.key)),o.rd(s.get(n.key)),o.Od(n.key,!1),t.qf.delete(n.key))}}(Math.round(o),Math.round(h))})}function fv(){t.dC$.topology.geometryType=di.Custom,t.config.topology.geometryType=di.Custom;const i=Ri("select#geometryType");i.length>0&&i.val(di.Custom)}function dv(){const i=Ri(`#${Wp.AddChannel}`),e=Ri(`#${Wp.RemoveChannel}`),n=Ri("#channelsButtonsWrapper");return i.off("click").on("click",()=>{t.editingMode=Wp.AddChannel;const i={id:t.channels.length,config:{frequency:.5,duration:1,offset:0,period:1,repetitions:1},signal:Qp(Xp(.5,1,0),1,1,1)};t.channels.push(pv(i,n)),fv()}),e.off("click").on("click",()=>{t.editingMode=Wp.RemoveChannel;for(let i=0;i<t.channels.length;i++){const e=t.channels[i];if(t.selectedChannel==e.id)return e.button.off("click"),e.button.remove(),e.chart.destroy(),t.channels.splice(i,1),void(t.selectedChannel=void 0)}fv()}),{addChannelButton:i,removeChannelButton:e,channelsButtonWrapper:n}}function pv(i,e){const n=Ri("<button>",{id:`channel-${i.id}-button`,class:"channel-select-action","data-channel":i.id,text:`Channel #${i.id}`});return e.append(n),i.button=n,i.chart=function(t,i){const e=Ri("#channels_visuals"),n=Ri("<canvas>",{id:`channel-${t}-chart`,class:"signal-chart"}).css("top",360*t+20+"px");e.append(n);const s=n[0].getContext("2d");return new Chart(s,{type:"line",data:{labels:i.map(t=>t.time),datasets:[{label:`Pattern: ${t}`,data:i.map(t=>t.value),borderColor:"blue",borderWidth:1}]},options:{scales:{x:{title:{type:"linear",display:!0}},y:{title:{display:!0}}}}})}(i.id,i.signal),i.dataset=i.signal.map(t=>t.value),n.off("click").on("click",()=>{const i=n.data("channel");Ri(".channel-select-action").removeClass("active"),t.selectedChannel==i?t.selectedChannel=void 0:(t.selectedChannel=i,n.addClass("active"),function(){for(let i=0;i<t.channels.length;i++){const e=t.channels[i];if(t.selectedChannel==e.id)return void Object.keys(e.config).map(t=>{Ri(`#range-${t}`).val(e.config[t]),Ri(`#input-${t}`).val(e.config[t])})}}())}),i}function vv(){Wv(),t.config={...t.dC$},t.Nf=[],t.gd=0;const i=t.dC$.topology.geometryType==di.Custom;if(i){t.Ut[oi]=new Map;for(const i of[...t.Ot.keys(),...t.Lt.keys()])t.Ut[oi].set(i,-1),t.Dt.set(i,Mv())}else _i(t.config.topology,t.config.topology.geometryType),t.Ut={position:new Map,[Jt]:new Map,[ti]:new Map,[ii]:new Map,[ei]:new Map,[ni]:new Map,[si]:new Map,[ri]:new Map,[oi]:new Map},t.Ot=new Map,t.Lt=new Map,t.Dt=new Map,t.Id=new Map,t.channels=[],t.jt=new Map,t.ud=new Map,t.qf=new Map;t.currentChannel=0,t.md=new Map,t.$d=new Map,t.Bd=new Map,(!i||i&&!t.dC$.topology.keepConnectionsOnReset)&&(t.zt=new Map,t.Gt=new Map,t.$t=new Map,t.It=new Map,t.Bt=new Map)}function mv(i){if(!i)return;const e={...i.f$nG};t.dC$=e,vv(),function(i){t.Id=new Map(i.gS)}(i),function(i){t.Ot=new Map(i.aA),t.Lt=new Map(i.iA),t.qf=new Map(i.sA);for(const e of t.Ot.values())e.currentCharge=0,t.zt.set(e.key,Rt.create()),t.Dt.set(e.key,Mv());for(const e of t.Lt.values())e.currentCharge=0,t.zt.set(e.key,Rt.create()),t.Dt.set(e.key,Mv());t.Ut={position:new Map(i.aP$),[Jt]:new Map(i[Jt]),[ti]:new Map(i[ti]),[ii]:new Map(i[ii]),[ei]:new Map(i[ei]),[ni]:new Map(i[ni]),[si]:new Map(i[si]),[ri]:new Map(i[ri]),[oi]:new Map(i[ri])}}(i),function(i){t.jt=new Map(i.iNa)}(i),function(i){t.ud=new Map(i.oA)}(i),function(i){t.$t=new Map(i.cNs),t.Bt=new Map(i.o$AcS$n),t.It=new Map(i.iA$CtN),Ni()}(i),function(i){t.channels=[...i.c$Hs];for(const e of t.channels)pv(e,t.redButtons.channelsButtonWrapper)}(i),sv(),Nv()}function gv(){const t=localStorage.getItem(function(){const t=Ri(`#${Fi}`);return`${Ht}${t.val()}`}());if(t){const i=JSON.parse(t),e=new Map,n=new Map;i.aA.map(t=>e.set(t.c$k,{key:t.c$k,currentCharge:t.sH$,lastSpikeTime:t.l$Ts})),i.iA.map(t=>n.set(t.c$k,{key:t.c$k,currentCharge:t.sH$,lastSpikeTime:t.l$Ts}));const s=new Map;return i.cNs.map(t=>s.set(t.hR$i,{key:t.hR$i,sourceKey:t.zD$,targetKey:t.l$Ks,distance:t.dSA$,weight:t.eR$b})),{...{...i,f$nG:{...i.f$nG,renderer:Ip}},aA:e,iA:n,sA:Bi(i.sA),cNs:s,gS:Bi(i.gS),iNa:Bi(i.iNa),iA$CtN:Bi(i.iA$CtN),o$AcS$n:Bi(i.o$AcS$n),oA:Bi(i.oA),channels:{...i.c$Hs},aP$:Bi(i.aP$),[Jt]:Bi(i.nAfCD),[ti]:Bi(i.nLt),[ii]:Bi(i.nLT$h),[ei]:Bi(i.nFt),[ni]:Bi(i.n$Vr),[si]:Bi(i.nCh$Ps),[ri]:Bi(i.n$lF),[oi]:Bi(i.n$lF)}}}function bv(i){return{position:t.Ut.position.get(i),[Jt]:t.Ut[Jt].get(i),[ti]:t.Ut[ti].get(i),[ii]:t.Ut[ii].get(i),[ei]:t.Ut[ei].get(i),[ni]:t.Ut[ni].get(i),[si]:t.Ut[si].get(i),[ri]:t.Ut[ri].get(i),[oi]:t.Ut[oi].get(i)}}function yv(i,e,n){t.Ut[e].set(i,n)}function xv(t){return{accumulator:{key:t,currentCharge:0,lastSpikeTime:0},renderState:Mv()}}function wv(i,e,n,s){!function(i,e,n){const s=t.config.neurons;yv(i,"position",n?e:function(i,e,n){const s=t.dC$;let r={numElements:s.neuronsCount/s.groupsCount,index:i-1,min:65,max:Yt,lambda:5,power:3,mu:e,sigma:110,aspectRatio:s.topology.aspectRatio},o={numElements:s.neuronsCount/s.groupsCount,index:i-1,min:55,max:Kt,lambda:5,power:3,mu:n,sigma:110,aspectRatio:s.topology.aspectRatio};s.topology.yDensity&&(o={...o,sigma:o.sigma/s.topology.yDensity});const h=s.topology.distribution.y.func(...Object.values(Ci(s.topology.distribution.y.type,o)));if(Array.isArray(h))return{x:Math.min(Math.max(h[0],65),Yt),y:Math.min(Math.max(h[1],55),Kt)};const a=h;if(s.topology.xyCorrelation){const t=Math.round(Math.max(a,55)/Xt*100)/7.5||10;r={...r,sigma:r.sigma/t}}s.topology.xDensity&&(r={...r,sigma:r.sigma/s.topology.xDensity});const u=s.topology.distribution.x.func(...Object.values(Ci(s.topology.distribution.x.type,r)));return{x:Math.min(Math.max(u,65),Yt),y:Math.min(Math.max(a,55),Kt)}}(i,e.x,e.y)),yv(i,oi,-1),yv(i,Jt,s[Jt]),yv(i,ti,s[ti]),yv(i,ii,s[ii]),yv(i,ei,s[ei]),yv(i,ni,s[ni]),yv(i,si,s[si]),yv(i,ri,s[ri])}(i.key,n,s),t.Ot.set(i.key,i),t.Lt.set(i.key,i),t.Dt.set(i.key,e),t.zt.set(i.key,Rt.create())}function Mv(){return{inputSpikesBuffer:Array(Vt).fill(0),outputSpikesBuffer:Array(Vt).fill(0),inputSpikesGraphicsBuffer:[],outputSpikesGraphicsBuffer:[],inputSpikesContextsBuffer:[],outputSpikesContextsBuffer:[]}}function Av(i,e,n){const s=t.dC$,r=s.connections,o=t.Ot,h=t.Lt,a=s.topology.inputDropout,u=s.topology.reservoirDropout,c=s.topology.outputDropout,l=li(r.inputAreaType,r.inputAreaWidth),f=fi(r.outputAreaType,r.outputAreaWidth);for(let t=1;t<=e;t++){const e=i.center||{x:650,y:550},{accumulator:s,renderState:r}=xv(t+n);wv(s,r,e,!1)}for(const d of o.keys()){let i=u;l(t.Ut.position.get(d))&&(i=a),f(t.Ut.position.get(d))&&(i=c),Math.random()>i/100?h.delete(d):o.delete(d)}}function Tv(i,e,n,s,r){const o=n.tick>=t.Ut[oi].get(i.key);if(o&&(i.currentCharge+=s,i.currentCharge>=t.Ut[ei].get(i.key)&&(t.md.set(i.key,n.tick+1),i.currentCharge=0,function(i,e,n){const s={value:1,tick:n};t.zt.has(i.key)&&t.zt.get(i.key).shamefullySendNext(s);(function(i,e,n){if(!t.qf.has(i))return;e.outputSpikesBuffer.length>=Vt&&e.outputSpikesBuffer.shift();e.outputSpikesBuffer.push(n)})(i.key,e,s.value),e.lastOutputSpikeTime=n;const r=t.Ut[Jt].get(i.key);t.Ut[oi].set(i.key,n+r/t.dC$.input.firingRate),i.lastSpikeTime=n}(i,e,n.tick),r&&function(i){const e=t.Ot,n=t.$t,s=t.It.get(i.key),r=t.jt,o=t.config.input.plasticity&&t.config.input.plasticity==hi.OFF;for(let t=0;t<s.length;t++){const h=n.get(s[t]);o&&r.has(h.sourceKey)||(h.weight+=ai(e.get(h.sourceKey).lastSpikeTime,i.lastSpikeTime),h.weight<0?h.weight=0:h.weight>2&&(h.weight=2))}}(i))),t.qf.has(i.key)){if(e.lastInputSpikeTime!=n.tick)return function(t,i,e){t.inputSpikesBuffer.push(i*(e?1:-1))}(e,n.value,o),void(e.lastInputSpikeTime=n.tick);!function(t,i){const e=t.inputSpikesBuffer.length-1,n=t.inputSpikesBuffer[e];-1!=n&&(t.inputSpikesBuffer[e]=n+i)}(e,n.value)}}function _v(i,e){return t.jt.has(i)&&t.jt.get(i)==e}function kv(i){return!t.jt.has(i)}function Cv(t){return t==Rv()}function Sv(){const i=t.dC$;switch(i.input.streamType){case Zt.Random:default:return Pv(()=>{return t=i.input.randomThreshold,[{channel:0,spike:{value:Math.random()<t?1:0,tick:Rv()}}];var t});case Zt.Phrase:return Pv(()=>{return[(t=function(t){const i=(t.trim()+"  ").split("").map(t=>Wt[t.toUpperCase()]).join("");return i.split("").map(t=>"."==t?"1":"-"==t?"111":" "==t?"00":void 0).join("0").split("").map(t=>({channel:0,spike:{value:+t,tick:Rv()}}))}(i.input.phrase))[Rv()%t.length]];var t});case Zt.Channels:return function(){for(let i=0;i<t.channels.length;i++)!t.channels[i].dataset&&t.channels[i].signal&&(t.channels[i].dataset=t.channels[i].signal.map(t=>t.value))}(),Pv(Ev)}}function Pv(i){const e=t.config.renderer,n=t.channels.length>0?t.channels.map(t=>$t.create()):[$t.create()],s=t.dC$.showGradients?t.dC$.renderer.vd:t.dC$.renderer.bd;return{loopHandler:setInterval(function(){!function(){let i,e,n;for(const s of t.Ot.values())s.currentCharge>0&&(i=t.Ut[ti].get(s.key),s.currentCharge>=i&&(e=t.Ut[ii].get(s.key),n=t.Ut[ri].get(s.key),(!e||s.currentCharge>=e)&&(s.currentCharge-=n/(1+Math.exp(-10*(s.currentCharge-.5)))),e&&s.currentCharge<e&&(s.currentCharge-=n)),s.currentCharge<0&&(s.currentCharge=0))}(),i().map(i=>{const e=i.spike.value,s=i.channel;n.length>s&&(0!=e?n[s].shamefullySendNext({channel:s,spike:{value:e,tick:Rv()}}):(!function(i){for(const e of t.qf.keys())_v(e,i)&&t.Dt.get(e).inputSpikesBuffer.push(0)}(s),t.Nf.push(0)),function(i){for(const e of t.qf.keys())if(_v(e,i)){const i=t.Dt.get(e);if(Cv(i.lastOutputSpikeTime)){i.lastOutputSpikeTime=void 0;continue}t.Dt.get(e).outputSpikesBuffer.push(0)}}(s),function(i){for(const e of t.qf.keys())_v(e,i)&&(t.Dt.get(e).inputSpikesBuffer.length>=Vt&&t.Dt.get(e).inputSpikesBuffer.shift(),t.Dt.get(e).outputSpikesBuffer.length>=Vt&&t.Dt.get(e).outputSpikesBuffer.shift())}(s),t.Nf.length>=260&&t.Nf.shift())}),t.qf.size>0&&(function(){for(const i of t.qf.keys())if(kv(i)){const e=t.Dt.get(i);if(Cv(e.lastInputSpikeTime)){e.lastInputSpikeTime=void 0;continue}t.Dt.get(i).inputSpikesBuffer.push(0)}}(),function(){for(const i of t.qf.keys())if(kv(i)){const e=t.Dt.get(i);if(Cv(e.lastOutputSpikeTime)){e.lastOutputSpikeTime=void 0;continue}t.Dt.get(i).outputSpikesBuffer.push(0)}}(),function(){for(const i of t.qf.keys())kv(i)&&(t.Dt.get(i).inputSpikesBuffer.length>=Vt&&t.Dt.get(i).inputSpikesBuffer.shift(),t.Dt.get(i).outputSpikesBuffer.length>=Vt&&t.Dt.get(i).outputSpikesBuffer.shift())}()),e.ed(t.Nf);for(const i of t.qf.keys()){const n=t.Dt.get(i);e.sd(n),e.od(n)}s(),t.gd+=1},t.dC$.input.firingRate),streams:n}}function Ev(){const i=[];for(let e=0;e<t.channels.length;e++){const n=t.channels[e].dataset.length;i[e]={channel:e,spike:{value:t.channels[e].dataset[Rv()%n]>0?1:0,tick:Rv()}}}return i}function Rv(){return+t.gd}const Fv=di.Grid,Ov=Fv==di.Columns,$v=Ov?ui.TopRect:ui.LeftRect,Uv=Ov?ui.BotRect:ui.RightRect,Bv=Ov?4:1,Iv=Ov?7:12,jv=Ov?7:12,Gv="Name the model",zv={name:Gv,mode:ci.LEARN,renderer:Gp.pixi,showArrows:!0,showLabels:!1,showGradients:!0,showVisibilityRadius:!1,neuronsCount:56,groupsCount:Bv,topology:{geometryType:Fv,keepConnectionsOnReset:!1,aspectRatio:0,distribution:Ti(Fv),xyCorrelation:Fv==di.Columns,xDensity:Fv==di.Columns?3.5:0,yDensity:Fv==di.Columns?2.5:0,inputDropout:50,reservoirDropout:40,outputDropout:50,heat:0,ignoreHeatOnInput:!0,ignoreHeatOnOutput:!0},connections:{type:Ui.LAYER,sigma:0,inputAreaType:$v,outputAreaType:Uv,inputAreaWidth:Iv,outputAreaWidth:jv,defaultWeight:1,randomWeights:!1},neurons:{visibilityRadius:320,radius:8,leakThreshold:0,linearLeakThreshold:0,fireThreshold:100,afterFireChargeDelay:30,chargePercentStep:10,leakFactor:.01},input:{firingRate:60,streamType:Zt.Phrase,phrase:"eee ttt",randomThreshold:.5,plasticity:hi.OFF},groups:{distribution:{x:ki(Ai.LinearEvenly),y:ki(Ai.RangeCenter)}}};const Dv={neuronsCount:{min:0,max:1e3,measurement:""},groupsCount:{min:0,max:100,measurement:""},neurons:{radius:{min:0,max:50,measurement:"px"},[Jt]:{min:0,max:1e3,measurement:"ms"},[ti]:{min:0,max:100,measurement:"%"},[ii]:{min:0,max:100,measurement:"%"},[ei]:{min:0,max:100,measurement:"%"},[ni]:{min:0,max:Qt,measurement:"px"},[si]:{min:0,max:100,measurement:"%"},[ri]:{min:0,max:10,measurement:"%"}},topology:{heat:{min:0,max:1,measurement:""},xDensity:{min:0,max:10,measurement:""},yDensity:{min:0,max:10,measurement:""},inputDropout:{min:0,max:100,measurement:"%"},reservoirDropout:{min:0,max:100,measurement:"%"},outputDropout:{min:0,max:100,measurement:"%"},aspectRatio:{min:1,max:10,measurement:""}},input:{randomThreshold:{min:0,max:1,measurement:""},firingRate:{min:0,max:1e3,measurement:"ms"}},connections:{inputAreaWidth:{min:0,max:25,measurement:"%"},outputAreaWidth:{min:0,max:25,measurement:"%"},defaultWeight:{min:0,max:10,measurement:""},maxDistance:{min:0,max:1e3,measurement:"px"},sigma:{min:0,max:500,measurement:"%"}}};function Lv(){vv();const i=t.dC$.connections,e=[li(i.inputAreaType,i.inputAreaWidth)];if(t.dC$.topology.geometryType!=di.Custom){!function(){for(let i=0;i<t.config.groupsCount;i++){const e=`${i}`;t.Id.set(e,new av(e,t.config.groupsCount>1?cv(t.config.groups.distribution,t.config.groupsCount,i):uv(),100))}}();let n=0;for(const i of t.Id.values()){const e=Math.ceil(t.dC$.neuronsCount/t.Id.size);Av(i,e,n*e),n+=1}for(let t=0;t<e.length;t++)Up(e[t]);!function(i){const e=t.ud,n=t.Ut.position;for(const s of t.Ot.keys())i(n.get(s))&&e.set(s,0)}(fi(i.outputAreaType,i.outputAreaWidth)),Gi(e)}else t.dC$.topology.keepConnectionsOnReset||Gi(e);Nv()}function Nv(){const i=t.config.renderer;i.Uf(),i.Kf(t.Ot.values(),t.Lt.values()),i.hd(),i.ad(),i.Ed(t.dC$.showVisibilityRadius),i.Jf(),i.Zf()}function Vv(){!function(i){const e=t.jt,n=t.Ot,s=t.Dt;t.runningInputStream=i,t.inputStreamSubscriptions=[],i.streams.map(i=>{t.inputStreamSubscriptions.push(i.subscribe({next:i=>{const r=i.channel,o=i.spike.value;t.Nf.push(o);for(const[h,a]of e)r==a&&n.has(h)&&Tv(n.get(h),s.get(h),i.spike,t.Ut[si].get(h),!1)}}))})}(Sv())}function Wv(){!function(){if(t){const i=t.runningInputStream;null!=i&&(clearInterval(i.loopHandler),i.streams.map(t=>{t.shamefullySendComplete()}),t.runningInputStream=void 0),null!=t.inputStreamSubscriptions&&t.inputStreamSubscriptions.map(t=>{t.unsubscribe()})}}()}function Hv(){const i=function(){const i={...t,f$nG:{...t.config,name:t.dC$.name,showArrows:t.dC$.showArrows,showLabels:t.dC$.showLabels,showGradients:t.dC$.showGradients,showVisibilityRadius:t.dC$.showVisibilityRadius},aA:Array.from(t.Ot.values()).map(t=>({c$k:t.key,sH$:t.currentCharge,l$Ts:t.lastSpikeTime})),iA:Array.from(t.Lt.values()).map(t=>({c$k:t.key,sH$:t.currentCharge,l$Ts:t.lastSpikeTime})),iNa:Object.fromEntries(t.jt),sA:Object.fromEntries(t.qf),cNs:Array.from(t.$t.values()).map(t=>({hR$i:t.key,zD$:t.sourceKey,l$Ks:t.targetKey,dSA$:t.distance,eR$b:t.weight})),gS:Object.fromEntries(t.Id),iA$CtN:Object.fromEntries(t.It),o$AcS$n:Object.fromEntries(t.Bt),oA:Object.fromEntries(t.ud),c$Hs:t.channels,aP$:Object.fromEntries(t.Ut.position),nAfCD:Object.fromEntries(t.Ut[Jt]),nLt:Object.fromEntries(t.Ut[ti]),nLT$h:Object.fromEntries(t.Ut[ii]),nFt:Object.fromEntries(t.Ut[ei]),n$Vr:Object.fromEntries(t.Ut[ni]),nCh$Ps:Object.fromEntries(t.Ut[si]),n$lF:Object.fromEntries(t.Ut[ri])};for(const t of i.c$Hs)delete t.chart,delete t.button,delete t.dataset;return delete i.inputStream,delete i.render,delete i.config,delete i.f$nG.renderer,delete i.dC$,delete i.app,delete i.channels,delete i.md,delete i.Ot,delete i.Lt,delete i.jt,delete i.qf,delete i.It,delete i.gd,delete i.Nf,delete i.$t,delete i.Bt,delete i.Id,delete i.ud,delete i.Gt,delete i.zt,delete i.Dt,delete i.$d,delete i.Bd,delete i.Ut,delete i.limits,delete i.greenButtons,delete i.redButtons,delete i.selectedChannel,delete i.currentChannel,delete i.inputStreamSubscriptions,delete i.currentInputAccum,i}();if(!i.f$nG.name||i.f$nG.name==Gv)return void alert("Please specify unique model name");let e=i.f$nG.name;null!=localStorage.getItem(`${Ht}${e}`)&&(e=prompt(`Overwrite "${e}"? Or you can specify the new name below.`,e)),e&&(localStorage.setItem(`${Ht}${e}`,JSON.stringify({...i,f$nG:{...i.f$nG,name:e}})),alert(`Model "${e}" saved`),$i(null,e))}const qv={...zv,showArrows:!0,showLabels:!0,neuronsCount:4,input:{...zv.input,firingRate:100,streamType:Zt.Random,randomThreshold:1},neurons:{...zv.neurons,radius:15,leakThreshold:0,leakFactor:.25,chargePercentStep:30},topology:{...zv.topology,inputDropout:0,outputDropout:0,reservoirDropout:0,aspectRatio:4},connections:{...zv.connections,inputAreaWidth:15,outputAreaWidth:15}};function Xv(){const i=Ri(`#${Wp.AddAccumulator}`),e=Ri(`#${Wp.SelectAccumulator}`),n=Ri(`#${Wp.RemoveAccumulator}`),s=Ri(`#${Wp.AddConnection}`),r=Ri(`#${Wp.SelectConnection}`),o=Ri(`#${Wp.RemoveConnection}`),h=Ri(`#${Wp.MarkInputAccum}`),a=Ri(`#${Wp.MarkOutputAccum}`),u=Ri("#Done"),c=()=>{i.addClass("disabled").removeClass("active"),h.addClass("disabled").removeClass("active"),a.addClass("disabled").removeClass("active"),e.addClass("disabled").removeClass("active"),n.addClass("disabled").removeClass("active"),s.addClass("disabled").removeClass("active"),r.addClass("disabled").removeClass("active"),o.addClass("disabled").removeClass("active"),u.addClass("disabled").removeClass("active")};return u.off("click").on("click",()=>{c(),i.removeClass("disabled"),h.removeClass("disabled"),a.removeClass("disabled"),e.removeClass("disabled"),n.removeClass("disabled"),s.removeClass("disabled"),r.removeClass("disabled"),o.removeClass("disabled"),t.editingMode=void 0,function(){for(const i of t.$d.values())Dp(i)}(),function(){for(const i of t.Bd.values())Vp(i)}(),Np(),u.addClass("disabled")}),i.off("click").on("click",()=>{i.hasClass("disabled")||(t.editingMode=Wp.AddAccumulator,c(),i.addClass("active"),u.removeClass("disabled"))}),n.off("click").on("click",()=>{n.hasClass("disabled")||(t.editingMode=Wp.RemoveAccumulator,c(),n.addClass("active"),u.removeClass("disabled"))}),e.off("click").on("click",()=>{e.hasClass("disabled")||(t.editingMode=Wp.SelectAccumulator,c(),e.addClass("active"),u.removeClass("disabled"))}),h.off("click").on("click",()=>{h.hasClass("disabled")||(t.editingMode=Wp.MarkInputAccum,c(),h.addClass("active"),u.removeClass("disabled"))}),a.off("click").on("click",()=>{a.hasClass("disabled")||(t.editingMode=Wp.MarkOutputAccum,c(),a.addClass("active"),u.removeClass("disabled"))}),s.off("click").on("click",()=>{s.hasClass("disabled")||(t.editingMode=Wp.AddConnection,c(),s.addClass("active"),u.removeClass("disabled"))}),r.off("click").on("click",()=>{r.hasClass("disabled")||(t.editingMode=Wp.SelectConnection,c(),r.addClass("active"),u.removeClass("disabled"))}),o.off("click").on("click",()=>{o.hasClass("disabled")||(t.editingMode=Wp.RemoveConnection,c(),o.addClass("active"),u.removeClass("disabled"))}),{doneButton:u,addAccumButton:i,selectAccumButton:e,removeAccumButton:n,markInputAccumButton:h,markOutputAccumButton:a,addConnButton:s,selectConnButton:r,removeConnButton:o}}Zt.Random,se.add(gr),se.mixin(ls,{accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,accessibleType:"button",accessibleText:null,accessiblePointerEvents:"auto",accessibleChildren:!0,_s:!1,Ts:null,us:-1}),se.add(No),se.add(Vo),se.add(Zu),se.mixin(ls,Ju),se.add(Lu),se.add(jd),se.add(qa),se.add(Nd),se.add(Zd),se.add(Jd),se.add(Fp),se.add(Rp),se.add(xp),se.add(Pp),se.add(Tp),se.add(lp),se.add(np),se.add(nc),se.add(tc);const Yv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Kv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{Xt as a,Oi as b,qt as c,Xv as d,dv as e,sv as f,Lv as g,lv as h,mv as i,Hv as j,Wv as k,Vv as l,Dv as n,gv as r,qv as s};
